'PSFIN_ProjectCOsting  contains
'Contains commonly used functions for  Project Costing Project.
'Changelog: 
'Date	04/04/2019		Author	Aspire Team				Description

'______________________________________________________ 

'**********************************************************************************************************************************************************
''' <summary>  
''' Find Existing Project() To search for the Exisitn project for Particular Business unit
'''Parameter1:	None.
''' <para>
''' <note>Required Testcase Inputs are "Business UNit"</note> 
''' </para>
''' </summary>
''' <author>Karthik</author>
''' <datecreated>12/12/2018</datecreated>
''' <startstate>Logged in as user that has access to project costing navigation</startstate>
''' <endstate>Project will be displaeyd</endstate>c
'Change Control: 
'   NA
'   Date of Change          Author                Description of change
'***************************************************************************************************************************************************

Public Function FindExistingProject(BusinessUnit,Project)

'Enter the Business unit
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("TargetContent").WebEdit("GI_BusinessUnit")
If .Exist(nMINWAIT) Then
	.Set BusinessUnit
	Reporter.ReportEvent micPass,"The Business UNit is present","and set as"&BusinessUnit
End If
End  With 

'If Project name is present enter project name in text box or search for existing project name
If IsEmpty(Project) Then
	With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("TargetContent").Image("GI_Proj_Search")
	If .Exist(nMINWAIT) Then
		.Click
	End If
	End  With 
	
	'Search for the Web table
	While Not(Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("LookUpProject").WebTable("GI_SearchResults").Exist(nMINWAIT)) 
'	wait for the objects to get loaded
	app_SearchSync()
	Wend
	
	'Searfch for the existing project
	With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("LookUpProject").WebTable("GI_SearchResults")
	If .Exist(nMINWAIT) Then
		appDescription=.GetCellData(2,2)
		If appDescription="No Project" Then
			appProjectName=.GetCellData(3,1)
			Set oProject=.ChildItem(3,1,"Link",0)
			oProject.click
			Reporter.ReportEvent micDone,"The Project name is","is"&appProjectName
			Else
			appProjectName=.GetCellData(3,1)
			Set oProject=.ChildItem(2,1,"Link",0)
			oProject.click
			Reporter.ReportEvent micDone,"The Project name is","is"&appProjectName
		End If
	End If
	End  With 
	
	'wait for the objects to get loaded
	app_SearchSync()
	
	Else
	With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("TargetContent").WebEdit("GI_ProjName")
	If .Exist(nMINWAIT) Then
		.Set Project
		Reporter.ReportEvent micDone,"The project name is present","and set with"&Project
	End If
	End  With 

End If

'Click on Search buttpon
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("TargetContent").WebButton("GI_Search")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With

End Function

Public Function CreateProject()
'Assign the variables
BusinessUnit=GlobalDIctionary("BusinessUnit")
ProjectTemplate=GLobalDictionary("ProjectTemplate")

'Call function to add the project details
Call AddNewProject(BusinessUnit)

'wait for the objects to get loaded
For i=0 to 2
	app_SearchSync()
Next

'Select the Project teamplate
Call CreateProjectFromTemplate(ProjectTemplate)

'Get the Project ID
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("ProjectGeneral").WebElement("ProjectID")
If .Exist(nMINWAIT) Then
	appProjectName=.GetROProperty("innertext")
	If appProjectName="NEXT" Then
		Reporter.ReportEvent micFail,"The Project did not","create sucessfully"
		Else
	GlobalDictionary("ProjectName")=appProjectName
	Reporter.ReportEvent micDone,"The Project ID","created is"&appProjectName
	End If	
End If
End  With 

End Function

Public Function AddNewProject(BusinessUnit)
'Assign the variables
dtCreate=GlobalDictionary("Create")

'Click on Add New Valur Tab
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("TargetContent").WebElement("GI_AddNewValue")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 

'Enter Business Unuit
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("TargetContent").WebEdit("GI_Add_Businessnit")
If .Exist(nMINWAIT) Then
	.Set BusinessUnit
	Reporter.ReportEvent micDone,"The BUsiness UNit is","present and set with"&BusinessUnit
End If
End  With

'Select the DDLB from the project
WIth Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("TargetContent").WebList("Create")
If .Exist(nMINWAIT) Then
	.Select dtCreate
	Reporter.ReportEvent micDone,"The Create DDLB is","present and set with"&dtCreate
End If
End  With 

'Click on Add Button
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("TargetContent").WebButton("GI_Add")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 	

End Function

Public Function CreateProjectFromTemplate(ProjectTemplate)

'Select the Project template
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("ProjectGeneral").WebEdit("PG_ProjectTemplate")
If .Exist(nMINWAIT) Then
	.Set ProjectTemplate
	Reporter.ReportEvent micDone,"The Project template","is present and set with"&ProjectTemplate
End If
End  With 

'Enter th eeffectivbe date
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("ProjectGeneral").WebEdit("PG_NewStartDate")
If .Exist(nMINWAIT) Then
	.Set Date-2
	Reporter.ReportEvent micDone,"The Date is present","and set with"&Date
End If
End  With 

'Click on Create button
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("ProjectGeneral").WebButton("PG_Create")
If .Exist(nMINWAIT) Then
	.click
End If
End  With 

End Function

Public Function CloseActiveProject()
'Assign the variables
Status=GlobalDictionary("Status")

'Navigate to below navigation
'Project Costing > Project Definitions > General Information
SelectMainMenu1(GlobalDictionary("GeneralInformation"))

'Create the new project
Call CreateProject()

'wait for the ojects to get loaded
app_SearchSync()
'wait for the ojects to get loaded
app_SearchSync()

Call CheckProjectStatus()

'wait for the ojects to get loaded
app_SearchSync()
TestName=GlobalDIctionary("StatusLoad")
If instr(1,TestName,"Active")>0 Then
	Reporter.ReportEvent micDone,"The Project is created","Sucessfully with Active Status"
	'logout the application
'	PSFinLogout()
	Exit Function
End If

Call ChangeStatus(Status)

'wait for the ojects to get loaded
app_SearchSync()

Call CheckProjectStatus()

End Function

Public Function ChangeStatus(Status)
'Check the status of the project mand click
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("ProjectGeneral").Link("PG_ProjectStatus")
If .Exist(nMINWAIT) Then
	.Click
	Reporter.ReportEvent micPass,"The Status link","is clicked"
End If
End  With 

For i=0 to 2
'wait for the ojects to get loaded
app_SearchSync()
Next

'CLick on + icon
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("ProjectStatus").WebButton("+")
If .Exist(nMINWAIT) Then
	.Click
	Reporter.ReportEvent micDone,"The + button","is present and clicked"
End If
End  With 

'Enter the Status and Click on Save utton
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("ProjectStatus").WebEdit("PS_Status")
If .Exist(nMINWAIT) Then
	.Set Status
	Reporter.ReportEvent micDone,"The statis is present","and set with"&Status
End If
End  With 

'Click on Save button
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("ProjectStatus").WebButton("PS_Save")
If .Exist(nMINWAIT) Then
	.Click
End If
End  with

'wait for the ojects to get loaded
app_SearchSync()

'CLick on Go to General inforamtiln link
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("ProjectStatus").Link("PS_ReturnToGeneralInformation")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 

End Function

Public Function CheckProjectStatus()
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("ProjectGeneral").Link("PG_ProjectStatus")
If .Exist(nMINWAIT) Then
	appStatus=.GetROProperty("innertext")
	Reporter.ReportEvent micDone,"The Status of the Project","is"&appStatus
End If
End  With 	
End Function

'*******************************************************************************************************
Public Function CreateProjectAndAttach()
'Assign the variables
dtFilePath=GlobalDictionary("FilePath")

'Navigate to below navigation
'Project Costing > Project Definitions > General Information
SelectMainMenu1(GlobalDictionary("GeneralInformation"))

'Create the new project
Call CreateProject()

'wait for the ojects to get loaded
app_SearchSync()
'wait for the ojects to get loaded
app_SearchSync()

Call CheckProjectStatus()

'Click on Attachemnt tab
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("ProjectGeneral").WebElement("PG_Attachment")
If .Exist(nMINWAIT) Then
	.Click
	Reporter.ReportEvent micDone,"The Attachement Tab","is clicked"
End If
End  With 

'wait for the ojects to get loaded
app_SearchSync()

'CLick on Attachment link 
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("ProjectGeneral").Image("PG_AttachmentLink")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 

'wait for the ojects to get loaded
app_SearchSync()

'Uplocad the file
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("FileAttachment").WebFile("PG_FileAttachment")
If .Exist(nMINWAIT) Then
	.Set dtFilePath
	Reporter.ReportEvent micPass,"The File Attachemtn is present","and seti with"&dtFilePath
End If
End  With 

'wait for the ojects to get loaded
app_SearchSync()

'CLick on Upload Button
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("FileAttachment").WebButton("FA_Upload")
If .Exist(nMINWAIT) Then
	.Click
	Reporter.ReportEvent micPass,"The upload button","is present an dclicked"
End If
End  WIth 

'TO get the uploaded file name
docNameSplit=split(dtFilePath,"\")
docName=docNameSplit(UBound(docNameSplit))

'wait for the ojects to get loaded
app_SearchSync()

'Verify the file name in application
With Browser("PeopleSoft Browser").Page("GeneralInformation").PSFrame("ProjectGeneral").WebTable("PG_DocsAttached")
If .Exist(nMINWAIT) Then
	appFIleName=.GetCellData(1,2)
	Reporter.ReportEvent micDone,"The file name in the","Application is"&appFIleName
End If
End  With 

'COmpatre the file name
If Trim(appFIleName)=Trim(docName) Then
	Reporter.ReportEvent micPass,"The same file","is attcedh and verified"
End If

End Function

'1.34
Public Function CreateAccPayExpLine()
	

	
	'Navigate to Account Payable --> Vouchers --> ADD/Update-> Regular Entry
	SelectMainMenu1(GlobalDictionary("MainMenuSelection"))
	
	businessunit=GlobalDictionary("businessunit")
	voucherID=GlobalDictionary("voucherID")
	invoiceNo=GlobalDictionary("invoiceNo")&inVoiceNumberGeneration
	invoiceDate=GlobalDictionary("invoiceDate")
	SupplierID=GlobalDictionary("SupplierID")
	Account=GlobalDictionary("Account")
	Dept=GlobalDictionary("Dept")
	Amount=GlobalDictionary("Amount")
	PC_BusUnit=GlobalDictionary("PC_BusUnit")
	Project=GlobalDictionary("Project")
	Activity=GlobalDictionary("Activity")
	Project1=GlobalDictionary("Project1")
	Activity1=GlobalDictionary("Activity1")
	Project2=GlobalDictionary("Project2")
	Activity2=GlobalDictionary("Activity2")

	'wait for the ojects to get loaded
	app_SearchSync()
	wait 3
	'Add business unit and voucgher id in existing value
	with Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent")
	.WebEdit("BusinessUnit").WaitProperty "visible",True,20000
	If .WebEdit("BusinessUnit").Exist(nMINWAIT) Then
		.WebEdit("BusinessUnit").Set businessunit
		Call WriteToReport(micPass,"Business unit ","is present and entered "&businessunit,false)
		else
		Call WriteToReport(micFail,"Business unit","is not present",True)
	End If
	
	If .WebEdit("VoucherId").Exist(nMINWAIT) Then
		.WebEdit("VoucherId").Set voucherID
		Call WriteToReport(micPass,"Voucher Id ","is present and entered "&voucherID,false)
		else
		Call WriteToReport(micFail,"Voucher Id","is not present",True)
	End If
	
		
	'wait for the ojects to get loaded
	app_SearchSync()
	'enter invoice id and invoice date and save
	If .WebEdit("InvoiceNumber_AddNewValue").Exist(nMINWAIT) Then
		.WebEdit("InvoiceNumber_AddNewValue").Set invoiceNo
		Call WriteToReport(micPass,"invoiceNo ","is present and entered "&invoiceNo,false)
		else
		Call WriteToReport(micFail,"invoiceNo","is not present",True)
	End If
	
	If .WebEdit("InvoiceDate_AddNewValue").Exist(nMINWAIT) Then
		.WebEdit("InvoiceDate_AddNewValue").Set invoiceDate
		Call WriteToReport(micPass,"invoice Date ","is present and entred as "&invoiceDate,false)
		else
		Call WriteToReport(micFail,"invoice Date","is not present",True)
	End If
	
	If .WebEdit("SuuplierId_AddValue").Exist(nMINWAIT) Then
		.WebEdit("SuuplierId_AddValue").Set supplierID
		Call WriteToReport(micPass,"Supplier ID : ","is present and entered as "&supplierID,false)
		else
		Call WriteToReport(micFail,"Supplier ID","is not present",True)
	End If
	
	
	If .WebEdit("GrossInvoiceAmount").Exist(nMINWAIT) Then
		.WebEdit("GrossInvoiceAmount").Set Amount
		Call WriteToReport(micPass,"GrossInvoiceAmount ","is present and entered "&Amount,false)
		else
		Call WriteToReport(micFail,"GrossInvoiceAmount","is not present",True)
	End If
	
	If .WebButton("Add").Exist(nMINWAIT) Then
		wait(4)
		.WebButton("Add").highlight
		.WebButton("Add").Click
		Call WriteToReport(micPass,"Add button to add the voucher","is present and clicked",false)
		else
		Call WriteToReport(micFail,"Add button to add the voucher","is not present",True)
	End If
	
End with

With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent").WebEdit("Account")
If .Exist(nMINWAIT) Then
	.Set Account
	Call WriteToReport(micPass,"Account","is present and entered "&Account,false)
		else
		Call WriteToReport(micFail,"Account","is not present",True)
End If
End  With

With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent").WebEdit("Dept")
If .Exist(nMINWAIT) Then
	.Set Dept
	Call WriteToReport(micPass,"Dept","is present and entered "&Dept,false)
		else
		Call WriteToReport(micFail,"Dept","is not present",True)
End If
End  With

With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent").WebButton("Save")
If .Exist(nMINWAIT) Then
	.Click
	Call WriteToReport(micPass,"Save","is present and clicked ",false)
		else
		Call WriteToReport(micFail,"Save","is not present",True)
End If
End  With 


'validate alert message	
	 With Browser("PeopleSoft Browser").Page("Regular Entry")
      If .WebElement("alertmessage").Exist(nminwait) Then
          WriteToReport micPass,"alertMsg is present","and displayed as"&.WebElement("alertmessage").GetROProperty("innertext"),false
      End If
      If .WebButton("OK").Exist(nminwait) Then
         .WebButton("OK").Click
      End If
       If .WebButton("OK").Exist(nminwait) Then
         .WebButton("OK").Click
      End If
              
      End With

app_SearchSync()

With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent").WebEdit("PC_BusUnit")
If .Exist(nMINWAIT) Then
	.Set PC_BusUnit
	Call WriteToReport(micPass,"PC_BusUnit","is present and entered "&PC_BusUnit,false)
		else
		Call WriteToReport(micFail,"PC_BusUnit","is not present",True)
End If
End  With

With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent").WebEdit("Project")
If .Exist(nMINWAIT) Then
	.Set Project
	Call WriteToReport(micPass,"MISC Project","is present and entered "&Project,false)
		else
		Call WriteToReport(micFail,"MISC Project","is not present",True)
End If
End  With

With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent").WebEdit("Activity")
If .Exist(nMINWAIT) Then
	.Set Activity
	Call WriteToReport(micPass,"Activity","is present and entered "&Activity,false)
		else
		Call WriteToReport(micFail,"Activity","is not present",True)
End If
End  With

With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent").WebButton("Save")
If .Exist(nMINWAIT) Then
	.Click
	Call WriteToReport(micPass,"Save button ","is present and clicked ",false)
		else
		Call WriteToReport(micFail,"Save button","is not present",True)
End If
End  With 


'validate alert message	
	 With Browser("PeopleSoft Browser").Page("Regular Entry")
      If .WebElement("alertmessage").Exist(nminwait) Then
          WriteToReport micPass,"alertMsg is present","and displayed as"&.WebElement("alertmessage").GetROProperty("innertext"),false
      End If
      If .WebButton("OK").Exist(nminwait) Then
         .WebButton("OK").Click
      End If
      If .WebButton("OK").Exist(nminwait) Then
         .WebButton("OK").Click
      End If
      If .WebButton("OK").Exist(nminwait) Then
         .WebButton("OK").Click
      End If
      If .WebButton("OK").Exist(nminwait) Then
         .WebButton("OK").Click
      End If
      End With

With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent").WebEdit("Project")
If .Exist(nMINWAIT) Then
	.Set Project1
	Call WriteToReport(micPass,"CAPEX Project1","is present and entered "&Project1,false)
		else
		Call WriteToReport(micFail,"CAPEX Project1","is not present",True)
End If
End  With

With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent").WebEdit("Activity")
If .Exist(nMINWAIT) Then
	.Set Activity1
	Call WriteToReport(micPass,"Activity1","is present and entered "&Activity1,false)
		else
		Call WriteToReport(micFail,"Activity1","is not present",True)
End If
End  With

With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent").WebButton("Save")
If .Exist(nMINWAIT) Then
	.Click
	Call WriteToReport(micPass,"Save button ","is present and clicked ",false)
		else
		Call WriteToReport(micFail,"Save button","is not present",True)
End If
End  With 


'validate alert message	
	 With Browser("PeopleSoft Browser").Page("Regular Entry")
      If .WebElement("alertmessage").Exist(nminwait) Then
          WriteToReport micPass,"alertMsg is present","and displayed as"&.WebElement("alertmessage").GetROProperty("innertext"),false
      End If
      If .WebButton("OK").Exist(nminwait) Then
         .WebButton("OK").Click
      End If
      If .WebButton("OK").Exist(nminwait) Then
         .WebButton("OK").Click
      End If
      If .WebButton("OK").Exist(nminwait) Then
         .WebButton("OK").Click
      End If
      If .WebButton("OK").Exist(nminwait) Then
         .WebButton("OK").Click
      End If
      End With

With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent").WebEdit("Project")
If .Exist(nMINWAIT) Then
	.Set Project2
	Call WriteToReport(micPass,"MKTG Project2","is present and entered "&Project2,false)
		else
		Call WriteToReport(micFail,"MKTG Project2","is not present",True)
End If
End  With

With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent").WebEdit("Activity")
If .Exist(nMINWAIT) Then
	.Set Activity2
	Call WriteToReport(micPass,"Activity2","is present and entered "&Activity2,false)
		else
		Call WriteToReport(micFail,"Activity2","is not present",True)
End If
End  With

With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent").WebButton("Save")
If .Exist(nMINWAIT) Then
	.Click
	Call WriteToReport(micPass,"Save button ","is present and clicked ",false)
		else
		Call WriteToReport(micFail,"Save button","is not present",True)
End If
End  With 

With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent")
If .WebElement("voucherID").Exist(nMINWAIT) Then
		voucherID=.WebElement("voucherID").GetROProperty("innertext")
		If StrComp(voucherID,"NEXT",1)<>0 Then
			Call WriteToReport(micPass,"voucherID : "&voucherID,"is present and generated as "&voucherID,false)
			else
			Call WriteToReport(micFail,"voucherID","doesn't get generated",True)
		End If
	End If
	End with
	
End Function


'********************************************************************************************
'1.28

'**********************************************************************************************************************************************************
''' <summary>  
''' ValidateCreateReqAgnstAccts() to validate the error message displaeyd upon providing wrong account and Project combination. 
'''Parameter1:	None.
''' <para>
''' <note>Required Testcase Inputs are "Business UNit"</note> 
''' </para>
''' </summary>
''' <author>Karthik</author>
''' <datecreated>12/12/2018</datecreated>
''' <startstate>Logged in as user that has access to project costing navigation</startstate>
''' <endstate>Project will be displaeyd</endstate>c
'Change Control: 
'   NA
'   Date of Change          Author                Description of change
'***************************************************************************************************************************************************
Public Function ValidateCreateReqAgnstAccts()
'Create the Requisisiont
'Navigate to below navigation to create the requisition
'Navigate to NavBar and select  eProcurement > Requisition > Create Requisition
'Navigate to below path to create the requisition
Category=GlobalDictionary("Category")
Qty=GlobalDictionary("Qty")
UOM=GlobalDictionary("UOM")
SupplierID=GlobalDictionary("SupplierID")
price=GlobalDictionary("price")
dtChartfeild=GlobalDictionary("Account") 
dtDept=GlobalDictionary("Dept")

'Navigate to below navigation
'eProcurement > Requisition > Create Requisition
SelectMainMenu1(GlobalDictionary("CreateRequisition"))


'Click on Requisiion setting link
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").Link("link_Requisition Settings")
If .Exist(nMINWAIT) Then
	'ENter the details in the REquisiton setting page
	Call RequisitionSettings()
End If
End  With 

'wait for the ojects to get loaded
app_SearchSync()

With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").Link("Special Requests")
If .Exist(nMINWAIT) Then
	.Click
	Reporter.ReportEvent micPass,"Special request link","is present and clicked"
End If
End  With 

'Create the Requuistion
Call addSpecialRequisition(Category,Qty,UOM,SupplierID,price)

'wait for the ojects to get loaded
app_SearchSync()

'Click on Check out button
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebButton("Checkout")
If .Exist(nMINWAIT) Then
	.Click
	Reporter.ReportEvent micPass,"THe check out button","is present and clicekd"
	Else
	Reporter.ReportEvent micFail,"The check out button","is not present and clicked"
End If
End  With

'CLick  on Save and submit butrton
'Click on Submit button
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebButton("Save & submit")
	If .Exist(nMINWAIT) Then
		.Click
		Reporter.ReportEvent micPass,"Submit button","is present and clicked"
	End If
End With

'Captutre the Error message displaeyd
With Browser("PeopleSoft Browser").Page("Requisition").WebElement("Message")
If .Exist(nMINWAIT) Then
	Reporter.ReportEvent micDone,"The Account/Dept Combo","error message is displayed upon not giving any project details"&.GetROProperty("innertext")
End If
End  With 

'CLick on OK button present in the pop up message
With Browser("PeopleSoft Browser").Page("Requisition").WebButton("OK")
If .Exist(nMINWAIT) Then
	.Click
End If
ENd  With 


dtProjID=Split(GlobalDIctionary("ProjID"),";")
dtActivity=Split(GlobalDIctionary("Activity"),";")
dtMessage=Split(GLobalDictionary("Message"),";") 
AcctNumber=Split(GlobalDictionary("AcctNo"),";")

'Call the function to validate the error message for diff combination of Proj with MKT accounts\
For i=0 to 2
	Call EditandSubmitRequitisionforDiffProjects(AcctNumber(i),dtProjID(i),dtActivity(i))
Next

End Function


'***********************************************************************************************************
Public Function EditandSubmitRequitisionforDiffProjects(AcctNumber,ProjID,Activity)
'Dim AcctNumber,DeptName,appNO,TotalLines,LInes

DeptName=GlobalDictionary("DeptName")
dtPCBusUnit=GlobalDictionary("PCBusUnit")


'wait for the ojects to get loaded
For k=0 to 2
	app_SearchSync()
Next

Reporter.ReportEvent micDone,"THe project ID is","is"&ProjID

'Clickon Expand section
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").Image("Expand Section")
If .Exist(nMINWAIT) Then
	.Click
	Reporter.ReportEvent micPass,"The Expand section is","present and clicekd"
	Else
	Reporter.ReportEvent micPass,"The Expand section","is already expanded"
End If
End  With 

'Expand the Account section if not
WIth Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").Image("Expand section Accounting")
If .Exist(nMINWAIT) Then
	.Click
	Reporter.ReportEvent micPass,"The accounting section","is expanded"
	Else
	Reporter.ReportEvent micPass,"The Accounting section is","already expanded"
End If
End  With 

'Click on Chartfiedl line 2
WIth Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebElement("Chartfields2_Tab")
If .Exist(nMINWAIT) Then
	.Click
	Reporter.ReportEvent micPass,"The Chartfield tab","is presetna nd clicekd"
End If
End  With 

'Enter th edetails oint eh Chartfield section

With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebEdit("Chartfields2_Account")
If .Exist(nMINWAIT) Then
.Set Trim(AcctNumber)
Reporter.ReportEvent micPass,"The Chartfeild tab","is present and clicekd"
End If
End  With


With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebEdit("Chartfields2_DeptID")
If .Exist(nMINWAIT) Then
	.Set DeptName
End If
End  With

'Click on Chartfeild tab 3
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebElement("Chartfields3_Tab")
If .Exist(nMINWAIT) Then
	.Click
	Reporter.ReportEvent micPass,"The CHartfiled Tab","is present and clicked"
End If
End  With 

'Enter the Account, Dept and PC bus unit detqaiols
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebEdit("PC BusUnit")
If .Exist(nMINWAIT) Then
	.Set dtPCBusUnit
	Reporter.ReportEvent micDone,"The PC UNit textboix","is present and set with"&dtPCBusUnit
End If
End  With 

wait(2)

'Enter the Project ID
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebEdit("PROJECT_ID")
If .Exist(nMINWAIT) Then
	.Set Trim(ProjID)
	Reporter.ReportEvent micDone,"The Project ID","is present and set with"&ProjID
End If
End  With 

'Enter the activity
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebEdit("ACTIVITY_ID")
If .Exist(nMINWAIT) Then
	.Set Trim(Activity)
	Reporter.ReportEvent micDone,"The Activity text box","is present and set with"&Activity
End If
End  With 

'Collpase the expansiopm
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").Image("Collapse Section")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 


'wait for the ojects to get loaded
For i=0 to 2
	app_SearchSync()
Next

'Click on Submit button
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebButton("Save & submit")
	If .Exist(nMINWAIT) Then
		.Click
		Reporter.ReportEvent micPass,"Submit button","is present and clicked"
	End If
End With

'wait for pplitio load
For i=0 to 2 
	app_SearchSync()
Next

'Validate teh error message
With Browser("PeopleSoft Browser").Page("Requisition").WebElement("Message")
If .Exist(nMINWAIT) Then
	appMessage=.GetROProperty("innertext")
	Reporter.ReportEvent micDone,"Following pop up message","is gettign displayed"&appMessage
	'CLick on Ok butyton
	With Browser("PeopleSoft Browser").Page("Requisition").WebButton("OK")
	If .Exist(nMINWAIT) Then
	.Click
	End If
End  WIth
End If	
End With

'Get the requisition ID
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebElement("Specialrequest_RequesitionID")
If .Exist(nMINWAIT) Then
	appRequisitionID=.GetROProperty("innertext")
	Reporter.ReportEvent micDone,"The requisition ID","created is"&appRequisitionID
	GlobalDictionary("RequisitionID")=appRequisitionID
End If
End  With

End  Function

'**************************************************************************************************************
''' <summary> 
''' Verify the error message while create a Requisiton with closed project
''' </summary>
''' <author>Vijayakumar N</author>
''' <datecreated>4/10/2019</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'*************************************************************************************************************
'PCost_1.58
Public Function RequisitionClosedProject()
	Dim strSQL, connectionString,Businessunit, sheetName,VoucherID,SupplierID
	
	sheetName=GlobalDictionary("sheetName")
	
	connectionString = "Provider=SQLOLEDB;Server=PSFNREGSQLSTG1;DATABASE=FNREG;uid='';pwd='';Trusted_Connection=Yes"
	
	strSQL= GlobalDictionary("strSQL")

	If dbGetSpecifiRecords(strSQL, connectionString, sheetName) Then
		Call WriteToReport(micPass,"DB records ","SQL query["&strSQL&"] executed sucessfully " ,false)
		App_searchSync()
		project =DataTable.Value("PROJECT_ID",sheetName)

		GlobalDictionary("ProjectName")=project
		Call WriteToReport(micPass,"Project Name ","Taken from the SQL = "&project ,false)
		
End If

End Function

'**************************************************************************************************************
''' <summary> 
''' Verify the error message while create a Voucher with Pending Project 
''' </summary>
''' <author>Gunasekaran S</author>
''' <datecreated>4/10/2019</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'*************************************************************************************************************
'PCost_1.59
Public Function CreateVoucherforPendingProject()

	
	Dim strSQL, connectionString,Businessunit, sheetName,VoucherID,SupplierID,status
	
	Businessunit=GlobalDictionary("BusinessUnit")
	VoucherID=GlobalDictionary("VoucherID")
	SupplierID=GlobalDictionary("SupplierID")
	GrossInvoiceAmount=GlobalDictionary("GrossInvoiceAmount")
	
	'Assign the variables
Status=GlobalDictionary("Status")

'Navigate to below navigation
'Project Costing > Project Definitions > General Information
SelectMainMenu1(GlobalDictionary("GeneralInformation"))

'Create the new project
Call CreateProject()

'wait for the ojects to get loaded
app_SearchSync()
'wait for the ojects to get loaded
app_SearchSync()

Call CheckProjectStatus()

'wait for the ojects to get loaded
app_SearchSync()


Call ChangeStatus(Status)

'wait for the ojects to get loaded
app_SearchSync()

Call CheckProjectStatus()
	
	
	
	

	If StrComp(Trim(GlobalDictionary("ProjectName")),"NEXT",1)<>0 Then
		
	
'Navigate to Transaction Adjustment
		SelectMainMenu1(GlobalDictionary("NavigationRegularEntry"))
		
		App_searchSync()
		project =GlobalDictionary("ProjectName")

		With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent")
			If .WebEdit("BusinessUnit").Exist(nminwait) Then
				.WebEdit("BusinessUnit").Set Businessunit
				WriteToReport micPass,"Businessunit text box","Businessunit text box  is exist and entered as ["&Businessunit &"]",false
			Else:WriteToReport micFail,"Businessunit text box ","Businessunit text box  isn't exist ",True
			End If
			If .WebEdit("VoucherId").Exist(nminwait) Then
				.WebEdit("VoucherId").Set VoucherID
				WriteToReport micPass,"VoucherId","VoucherId text box  is exist and entered as ["&VoucherId &"]",false
			Else:WriteToReport micFail,"VoucherId text box ","VoucherId text box  isn't exist ",True
			End If
			If .WebEdit("GrossInvoiceAmount").Exist(nminwait) Then
				.WebEdit("GrossInvoiceAmount").Set GrossInvoiceAmount
				WriteToReport micPass,"GrossInvoiceAmount","GrossInvoiceAmount text box  is exist and entered as ["&GrossInvoiceAmount&"]",false
			Else:WriteToReport micFail,"GrossInvoiceAmount text box ","GrossInvoiceAmount text box  isn't exist ",True
			End If
			If .WebButton("Add").Exist(nminwait) Then
				.WebButton("Add").Click
				WriteToReport micPass,"Add","Add is exist and Clicked",false
			Else:WriteToReport micFail,"ADD ","Add isn't exist ",True
			End If
			If .WebEdit("invoiceNo").Exist(nminwait) Then
				.WebEdit("invoiceNo").Set Replace(Replace(Replace(now,":",""),"/","")," ","")
			End If
			If .WebEdit("invoiceDate").Exist(nminwait) Then
				.WebEdit("invoiceDate").Set date-2
			End If
			If .WebEdit("SupplierID").Exist(nminwait) Then
				.WebEdit("SupplierID").Set SupplierID
			End If
			If .WebEdit("PC_BusUnit").Exist(nminwait) Then
				.WebEdit("PC_BusUnit").Set Businessunit
				WriteToReport micPass,"PC Businessunit","PC Businessunit  is exist and entered as ["&Businessunit&"]",false
				Else:WriteToReport micFail,"PC Businessunit ","PC Businessunit  isn't exist ",True
			End If
			If .WebEdit("Project").Exist(nminwait) Then
				.WebEdit("Project").Set project
				WriteToReport micPass,"Project","Project  is exist and entered as ["&project&"]",false
				Else:WriteToReport micFail,"Project ","Project  isn't exist ",True
			End If
			If .WebButton("Save").Exist(nminwait) Then
				.WebButton("Save").Click
				WriteToReport micPass,"Save","Save is exist and Clicked",false
			Else:WriteToReport micFail,"Save ","Save isn't exist ",True
			End If
			app_searchsync():app_searchsync()
		
		End With
		With Browser("PeopleSoft Browser").Page("Regular Entry")
			If .WebElement("MessageforDifference").Exist(nminwait) Then
				strMsg=.WebElement("MessageforDifference").GetROProperty("innertext")
				If (InStr(1,Trim(strMsg),"Pending",1)<>0) AND (InStr(1,Trim(strMsg),project,1)<>0) Then
					WriteToReport micPass,"Expected Pop up message is displayed","POp up displayed as "&strMsg,false
				else:WriteToReport micfail,"Expected Pop up message isn't displayed","POp up displayed as "&strMsg,True
				End If
			Else:WriteToReport micFail,"Pop up message doesn't displayed ","popup message isn't exist ",True
			End If
			If .WebButton("OK").Exist(nminwait) Then
				.WebButton("OK").Click
				WriteToReport micPass,"OK button","OK button is exist and Clicked",false
			Else:WriteToReport micFail,"OK button ","OK button isn't exist ",True
			End If
		End With
		With Browser("PeopleSoft Browser").Page("Regular Entry")
			If .WebButton("HomeTop").Exist(nminwait) Then
				.WebButton("HomeTop").Click
			End If
			If .WebButton("No").Exist(nminwait) Then
				.WebButton("No").Click
			End If
		End With
End If

End Function

'**************************************************************************************************************
''' <summary> 
''' Verify Voucher should be created with Active Project 
''' </summary>
''' <author>Gunasekaran S</author>
''' <datecreated>4/10/2019</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'*************************************************************************************************************
'PCost_1.61
Public Function CreateVoucherforActiveProject()
	Dim strSQL, connectionString,Businessunit, sheetName,VoucherID,SupplierID,project,account,deptid
	Businessunit=GlobalDictionary("Businessunit")
	VoucherID=GlobalDictionary("VoucherID")
	GrossInvoiceAmount=GlobalDictionary("GrossInvoiceAmount")
	sheetName=GlobalDictionary("sheetName")
	
	connectionString = "Provider=SQLOLEDB;Server=PSFNREGSQLSTG1;DATABASE=FNREG;uid='';pwd='';Trusted_Connection=Yes"
	
	strSQL= GlobalDictionary("strSQL")

	If dbGetSpecifiRecords(strSQL, connectionString, sheetName) Then
		Call WriteToReport(micPass,"DB records ","SQL query["&strSQL&"] executed sucessfully " ,false)
	
'Navigate to Transaction Adjustment
		SelectMainMenu1(GlobalDictionary("NavigationRegularEntry"))
		
		App_searchSync()
		project =DataTable.Value("PROJECT_ID",sheetName)
		account =DataTable.Value("ACCOUNT",sheetName)
		deptID =DataTable.Value("DEPTID",sheetName)
		SupplierID =DataTable.Value("VENDOR_ID",sheetName)

		With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent")
			If .WebEdit("BusinessUnit").Exist(nminwait) Then
				.WebEdit("BusinessUnit").Set Businessunit
				WriteToReport micPass,"Businessunit text box","Businessunit text box  is exist and entered as ["&Businessunit &"]",false
			Else:WriteToReport micFail,"Businessunit text box ","Businessunit text box  isn't exist ",True
			End If
			If .WebEdit("VoucherId").Exist(nminwait) Then
				.WebEdit("VoucherId").Set VoucherID
				WriteToReport micPass,"VoucherId","VoucherId text box  is exist and entered as ["&VoucherId &"]",false
			Else:WriteToReport micFail,"VoucherId text box ","VoucherId text box  isn't exist ",True
			End If
			If .WebEdit("GrossInvoiceAmount").Exist(nminwait) Then
				.WebEdit("GrossInvoiceAmount").Set GrossInvoiceAmount
				WriteToReport micPass,"GrossInvoiceAmount","GrossInvoiceAmount text box  is exist and entered as ["&GrossInvoiceAmount&"]",false
			Else:WriteToReport micFail,"GrossInvoiceAmount text box ","GrossInvoiceAmount text box  isn't exist ",True
			End If
			If .WebButton("Add").Exist(nminwait) Then
				.WebButton("Add").Click
				WriteToReport micPass,"Add","Add is exist and Clicked",false
			Else:WriteToReport micFail,"ADD ","Add isn't exist ",True
			End If
			If .WebEdit("invoiceNo").Exist(nminwait) Then
				strInvoiceNo=Replace(Replace(Replace(now,":",""),"/","")," ","")
				.WebEdit("invoiceNo").Set strInvoiceNo
				WriteToReport micPass,"invoiceNo","invoiceNo text box  is exist and entered as ["&strInvoiceNo&"]",false
			Else:WriteToReport micFail,"invoiceNo text box ","invoiceNo text box  isn't exist ",True
			End If
			If .WebEdit("invoiceDate").Exist(nminwait) Then
				.WebEdit("invoiceDate").Set date-2
				WriteToReport micPass,"invoiceDate","invoiceDate text box  is exist and entered as ["&date-2&"]",false
			Else:WriteToReport micFail,"invoiceDate text box ","invoiceDate text box  isn't exist ",True
			End If
			If .WebEdit("SupplierID").Exist(nminwait) Then
				.WebEdit("SupplierID").Set SupplierID
				WriteToReport micPass,"SupplierID","SupplierID text box  is exist and entered as ["&SupplierID&"]",false
			Else:WriteToReport micFail,"SupplierID text box ","SupplierID text box  isn't exist ",True
			End If
			If .WebEdit("PC_BusUnit").Exist(nminwait) Then
				.WebEdit("PC_BusUnit").Set Businessunit
				WriteToReport micPass,"PC Businessunit","PC Businessunit  is exist and entered as ["&Businessunit&"]",false
				Else:WriteToReport micFail,"PC Businessunit ","PC Businessunit  isn't exist ",True
			End If
			If .WebEdit("Project").Exist(nminwait) Then
				.WebEdit("Project").Set project
				WriteToReport micPass,"Project","Project  is exist and entered as ["&project&"]",false
				Else:WriteToReport micFail,"Project ","Project  isn't exist ",True
			End If
			If .WebEdit("Account").Exist(nminwait) Then
				.WebEdit("Account").Set account
				WriteToReport micPass,"Project","Project  is exist and entered as ["&account&"]",false
				Else:WriteToReport micFail,"Project ","Project  isn't exist ",True
			End If
			If .WebEdit("Dept").Exist(nminwait) Then
				.WebEdit("Dept").Set deptID
				WriteToReport micPass,"Project","Project  is exist and entered as ["&deptID&"]",false
				Else:WriteToReport micFail,"Project ","Project  isn't exist ",True
			End If
			
			If .WebButton("ActivityID Lookup").Exist(nminwait) Then
				.WebButton("ActivityID Lookup").Click
				WriteToReport micPass,"ActivityID Lookup","ActivityID Lookup is exist and Clicked",false
			Else:WriteToReport micFail,"ActivityID Lookup ","ActivityID Lookup isn't exist ",True
			End If
		end with
		With Browser("PeopleSoft Browser").Page("Regular Entry").PSFrame("LookupActivity")
			If .WebTable("ActivityList").Exist(nminwait) Then
				WriteToReport micPass,"Activity name","selected Activity name is ["&.WebTable("ActivityList").GetCellData(2,3)&"]" ,false
				.WebTable("ActivityList").childitem(2,3,"Link",0).click
			ElseIf .Link("Activity0").Exist(nminwait) Then
				WriteToReport micPass,"Activity name","selected Activity name is ["&.Link("Activity0").GetROProperty("innertext") &"]" ,false
				.Link("Activity0").Click
			End If
		End With
		app_searchsync():app_searchsync()
		With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent")	
			If .WebButton("Save").Exist(nminwait) Then
				.WebButton("Save").Click
				WriteToReport micPass,"Save","Save is exist and Clicked",false
			Else:WriteToReport micFail,"Save ","Save isn't exist ",True
			End If
			app_searchsync():app_searchsync()
			If .WebElement("voucherID").Exist(nMINWAIT) Then
				voucherID=.WebElement("voucherID").GetROProperty("innertext")
				If StrComp(voucherID,"NEXT",1)<>0 Then
					Call WriteToReport(micPass,"voucherID : "&voucherID,"is present and generated as "&voucherID,false)
					else
					Call WriteToReport(micFail,"voucherID","doesn't get generated",True)
				End If
			End If
		End With
		
		With Browser("PeopleSoft Browser").Page("Regular Entry")
			If .WebElement("MessageforDifference").Exist(nminwait) Then
				strMsg=.WebElement("MessageforDifference").GetROProperty("innertext")
				WriteToReport micfail,"Error Pop up message is displayed","POp up displayed as "&strMsg,True
			End If
			If .WebButton("OK").Exist(nminwait) Then
				.WebButton("OK").Click
				WriteToReport micFail,"OK button","OK button is exist and Clicked",false
			End If
		End With
		With Browser("PeopleSoft Browser").Page("Regular Entry")
			If .WebButton("HomeTop").Exist(nminwait) Then
				.WebButton("HomeTop").Click
			End If
			If .WebButton("No").Exist(nminwait) Then
				.WebButton("No").Click
			End If
		End With
End If

End Function

'**************************************************************************************************************
''' <summary> 
''' Verify the error message while try to adjust the values in Transaction page
''' </summary>
''' <author>Gunasekaran S</author>
''' <datecreated>4/10/2019</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'*************************************************************************************************************
'PCost_1.70
Public Function AdjustmentinProjectCostingtoClosedProject()

	Dim strSQL, connectionString,businessUnit, sheetName,project
	Businessunit=GlobalDictionary("Businessunit")
	sheetName=GlobalDictionary("sheetName")
	
	connectionString = "Provider=SQLOLEDB;Server=PSFNREGSQLSTG1;DATABASE=FNREG;uid='';pwd='';Trusted_Connection=Yes"
	
	strSQL= GlobalDictionary("strSQL")

	If dbGetSpecifiRecords(strSQL, connectionString, sheetName) Then
		Call WriteToReport(micPass,"DB records ","SQL query["&strSQL&"] executed sucessfully " ,false)
	
'Navigate to Transaction Adjustment
		SelectMainMenu1(GlobalDictionary("NavigationTransactionAdjustment"))
		
		App_searchSync()
		project =DataTable.Value("PROJECT_ID",sheetName)
		
		With Browser("PeopleSoft Browser").Page("TransactionAdjustment").PSFrame("TransactionAdjustment")
			If .WebEdit("Project Businessunit").Exist(nminwait) Then
				.WebEdit("Project Businessunit").Set Businessunit
				WriteToReport micPass,"Project Businessunit","Project Businessunit is exist and entered as ["&Businessunit&"]",false
				Else:WriteToReport micFail,"Project Businessunit","Project Businessunit isn't exist ",True
			End If
			If .WebButton("Lookup Project").Exist(nminwait) Then
				.WebButton("Lookup Project").Click
				WriteToReport micPass,"Lookup Project","Lookup Project  is exist and Clicked",false
				Else:WriteToReport micFail,"Lookup Project ","Lookup Project  isn't exist ",True
			End If
			
		End With
		With Browser("PeopleSoft Browser").Page("TransactionAdjustment").PSFrame("Lookup Project")
			If .WebEdit("Project").Exist(nminwait) Then
				.WebEdit("Project").Set project
				WriteToReport micPass,"Project","Project  is exist and entered as ["&project&"]",false
				Else:WriteToReport micFail,"Project ","Project  isn't exist ",True
			End If
			If .WebButton("Search").Exist(nminwait) Then
				.WebButton("Search").Click
				WriteToReport micPass,"Search","Search is exist and Clicked",false
				Else:WriteToReport micFail,"Search ","Search isn't exist ",True
			End If
			If .WebElement("Error Message").Exist(nminwait) Then
				str=.WebElement("Error Message").GetROProperty("innertext")
				If InStr(1,Trim(str),"No matching values were found",1) Then
					WriteToReport micPass,"Expected Error message displayed","Closed Project doesn't get populated, While searching with closed status project got the error message as ["&str&"]",false
				Else:WriteToReport micFail,"Expected Error message isn't displayed ","Expected Error message isn't displayed ",True
				End If
			Else:WriteToReport micFail,"Expected Error message field isn't displayed ","Expected Error message field isn't exist ",True
			End If
		End With

		
	End If

End Function
Public Function RunReceivablesCostCollection()

'Navigate to Below page
'Project Costing > Revenue Collection > Adjustments from Receivables
'SignInUser=GlobalDictionary("SignInUser")
'SelectMainMenu1(GlobalDictionary("MainMenuSelection"))
RunControlId=(GlobalDictionary("RunControlId"))  & inVoiceNumberGeneration
Options=(GlobalDictionary("Options"))
DateOption=(GlobalDictionary("DateOption"))

With Browser("PeopleSoft Browser").Page("Adjustments from Receivables").PSFrame("TargetContent").WebElement("PCost_AddaNewValue")
If .Exist(nMainWait) Then
	.Click
		Call WriteToReport(micPass,"AddanewvalueTab is present", "and clicked",False)
		Else
		Call WriteToReport(micFail,"AddanewvalueTab is not present", "and not clicked",True)
End If
End WIth

'enter RunControlId
WITH Browser("PeopleSoft Browser").Page("Adjustments from Receivables").PSFrame("TargetContent").WebEdit("PCost_RunControlId")
		if .Exist(nminwait) Then
		    .Set  RunControlId
		  	Reporter.ReportEvent micPass,"RunControlId ","field is present and entered as"&RunControlId
		End If
		End with

'click on ADD button
With Browser("PeopleSoft Browser").Page("Adjustments from Receivables").PSFrame("TargetContent").WebButton("PCost_Add")
If .Exist(nMainWait) Then
	.Click
		Call WriteToReport(micPass,"ADD button is present", "and displayed",False)
		Else
		Call WriteToReport(micFail,"ADD button is not present", "and not displayed",True)
End If
End WIth

'SELECT THE OPTION FROM WEBLIST
With Browser("PeopleSoft Browser").Page("Adjustments from Receivables").PSFrame("TargetContent")
	If .WebList("PCost_Option").Exist(nminwait) Then
		.WebList("PCost_Option").Select(Options)
		WriteToReport micPass,"Option field "," is displayed and set as"&Options,false
	Else
		WriteToReport micFail,"Option field ","is not displayed",true
		
	End If
	If .WebList("PCost_DateOption").Exist(nminwait) Then
		.WebList("PCost_DateOption").Select(DateOption)
		WriteToReport micPass,"Option field "," is displayed and set as"&DateOption,false
	Else
		WriteToReport micFail,"Option field ","is not displayed",true
		
	End If
End  With

'click on Run button
With Browser("PeopleSoft Browser").Page("Adjustments from Receivables").PSFrame("TargetContent").WebButton("PCost_Run")
If .Exist(nMainWait) Then
	.Click
		Call WriteToReport(micPass,"Run button is present", "and clicked",False)
		Else
		Call WriteToReport(micFail,"Run button is not present", "and not clicked",True)
End If
End WIth

		
'wait for the ojects to get loaded
		app_SearchSync()
		
	'Enter values in Process scheduler request
		With Browser("PeopleSoft Browser").Page("Adjustments from Receivables").PSFrame("Process Scheduler Request")
		If .WebTable("ProcessList").Exist(nminwait) Then
			If Cint(trim(.WebTable("ProcessList").RowCount))>1 Then
				.WebTable("ProcessList").ChildItem(2,1,"WebCheckBox",0).set "ON"
				appProcess=.WebTable("ProcessList").GetCellData(2,3)
				Call WriteToReport(micPass,"Process : "&appProcess," Process is present and selected as "& appProcess ,false)
			End If
		End If
		If .WebButton("OK").Exist(nminwait) Then
			.WebButton("OK").Click
		End If
	    End with 

		
	'wait for the ojects to get loaded
	app_SearchSync()
	
	
		with Browser("PeopleSoft Browser").Page("Adjustments from Receivables").PSFrame("TargetContent")
			If .WebElement("ProcessInstance").Exist(nminwait) Then
				appProcessInstance=.WebElement("ProcessInstance").GetROProperty("innertext")
				appProcessInstance=Trim(Split(appProcessInstance,":")(1))
				Call WriteToReport(micPass,"ProcessInstance : "&appProcessInstance,"is present and generated as "&appProcessInstance,false)
			else
				Call WriteToReport(micFail,"ProcessInstance","doesn't get generated",True)
			End If
			If .Link("ProcessMonitor").Exist(nminwait) Then
				.Link("ProcessMonitor").Click
			End If
		End with 
		
		'refresh the process untill it get success and posted
		CheckProcessMontiorStatus ""


End Function

Public Function PayableCostCollectionVoucher()

'Click on Add new value Tab
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebTabStrip("AddNew/Existingvalue")
If .Exist(nMINWAIT) Then
    .Select ("Add a New Value")
End If
End  With 

'Enter the Run control ID
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebEdit("RunControlID")
If .Exist(nMINWAIT) Then
    .Set "Pay" & Clng(Timer)
End If
End  With 

'CLick on Add Button
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebButton("Add")
If .Exist(nMINWAIT) Then
    .click
End If
End  With 

For i=0 to 2
    app_SearchSync()
Next

dtOption="Business Unit/Project/Activity"
'Select the options
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebList("Options")
If .Exist(nMINWAIT) Then
    .Select dtOption 
End If
End  With 

'Wait
app_SearchSync()

'Enter th Account, Project and Activity
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebEdit("BusinessUnit")
If .Exist(nMINWAIT) Then
    .Set GLobalDictionary("BusinessUnit")
    Reporter.ReportEvent micDone,"The Business unit","is present and set with"&GLobalDictionary("BusinessUnit")
End If
End  With 

'Wait
app_SearchSync()

'Enter the Project
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebEdit("Project")
If .Exist(nMINWAIT) Then
    .Set GlobalDictionary("ProjectID")
    Reporter.ReportEvent micPass,"The Project ID","is present and set with"&GlobalDictionary("ProjectID")
End If
End  With 

'Wait
app_SearchSync()

'Enter the activity
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebEdit("Activity")
If .Exist(nMINWAIT) Then
    .Set GlobalDictionary("Activity")
    Reporter.ReportEvent micPass,"The Activity is present","and set with"&GlobalDictionary("Activity")
End If
End  With 

'Wait
app_SearchSync()

'CLick on Run button
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebButton("Run")
If .Exist(nMINWAIT) Then
    .click
End If
End  With 

''Wait
app_SearchSync()

'Get the process namer
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("ProcesScheduler").WebElement("ProcessName")
If .Exist(nMINWAIT) Then
    processname=.GetROProperty("innertext")
    Reporter.ReportEvent micDone,"The Process name","is"&processname
End If
End  With 

'CLick on Okbutton
WIth Browser("PeopleSoft Browser").Page("Payables").PSFrame("ProcesScheduler").WebButton("Ok")
If .Exist(nMINWAIT) Then
    .click
End If
End  With 

'''Wait
app_SearchSync()

'Click on Process monitor link
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").Link("ProcessMonitor")
If .Exist(nMINWAIT) Then
    .click
End If
End  With

'''Wait
app_SearchSync()

'CLick on refresh untill status becomes success and posted
Call CheckProcessMontiorStatus(processname)

End Function

'**************************************************************************************************************
''' <summary> 
''' Verify the transaction while searching the Error query 
''' </summary>
''' <author>Gunasekaran S</author>
''' <datecreated>4/10/2019</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'*************************************************************************************************************
'PCost_1.87
Public Function Interfacedatathatcameinbutdidnotsuccessfullyprocess()
	Dim strQuery, businessUnit,rc,i,StrRows,flag
	
	Dim sheetName,VoucherID,SupplierID,status,Account,Dept
	'GlobalDictionary("Activity"),GlobalDictionary("ProjectID"),GLobalDictionary("BusinessUnit")
	Businessunit=GlobalDictionary("BusinessUnit")
	VoucherID=GlobalDictionary("VoucherID")
	SupplierID=GlobalDictionary("SupplierID")
	account=GlobalDictionary("Account")
	deptID=GlobalDictionary("Dept")
	GrossInvoiceAmount=GlobalDictionary("GrossInvoiceAmount")
	dtControlID=(GlobalDictionary("RunControlID"))&inVoiceNumberGeneration
	dtRequestID=(GlobalDictionary("RequestID"))
	dtDescription=(GlobalDictionary("Description"))
	dtPostVoucherOption=(GlobalDictionary("PostVoucherOption"))
	dtPrepaymentApplicationMethod=(GlobalDictionary("PrepaymentApplicationMethod"))
	dtProcessFrequency=(GlobalDictionary("ProcessFrequency"))

'Navigate to below navigation
'Project Costing > Project Definitions > General Information
SelectMainMenu1(GlobalDictionary("GeneralInformation"))

'Create the new project
Call CreateProject()

'wait for the ojects to get loaded
app_SearchSync()
'wait for the ojects to get loaded
app_SearchSync()

Call CheckProjectStatus()

'wait for the ojects to get loaded
app_SearchSync()


	GlobalDictionary("pCostUser")=GlobalDictionary("SignInUser")
	GlobalDictionary("SignInUser")=GlobalDictionary("UserAPAdmin")
	UserSignIn()

	If StrComp(Trim(GlobalDictionary("ProjectName")),"NEXT",1)<>0 Then
		
	
'Navigate to Transaction Adjustment
		SelectMainMenu1(GlobalDictionary("NavigationRegularEntry"))
		
		App_searchSync()
		project =GlobalDictionary("ProjectName")
		
		With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent")
			If .WebEdit("BusinessUnit").Exist(nminwait) Then
				.WebEdit("BusinessUnit").Set Businessunit
				WriteToReport micPass,"Businessunit text box","Businessunit text box  is exist and entered as ["&Businessunit &"]",false
			Else:WriteToReport micFail,"Businessunit text box ","Businessunit text box  isn't exist ",True
			End If
			If .WebEdit("VoucherId").Exist(nminwait) Then
				.WebEdit("VoucherId").Set VoucherID
				WriteToReport micPass,"VoucherId","VoucherId text box  is exist and entered as ["&VoucherId &"]",false
			Else:WriteToReport micFail,"VoucherId text box ","VoucherId text box  isn't exist ",True
			End If
			If .WebEdit("GrossInvoiceAmount").Exist(nminwait) Then
				.WebEdit("GrossInvoiceAmount").Set GrossInvoiceAmount
				WriteToReport micPass,"GrossInvoiceAmount","GrossInvoiceAmount text box  is exist and entered as ["&GrossInvoiceAmount&"]",false
			Else:WriteToReport micFail,"GrossInvoiceAmount text box ","GrossInvoiceAmount text box  isn't exist ",True
			End If
			If .WebButton("Add").Exist(nminwait) Then
				.WebButton("Add").Click
				WriteToReport micPass,"Add","Add is exist and Clicked",false
			Else:WriteToReport micFail,"ADD ","Add isn't exist ",True
			End If
			If .WebEdit("invoiceNo").Exist(nminwait) Then
				strInvoiceNo=Replace(Replace(Replace(now,":",""),"/","")," ","")
				.WebEdit("invoiceNo").Set strInvoiceNo
				WriteToReport micPass,"invoiceNo","invoiceNo text box  is exist and entered as ["&strInvoiceNo&"]",false
			Else:WriteToReport micFail,"invoiceNo text box ","invoiceNo text box  isn't exist ",True
			End If
			If .WebEdit("invoiceDate").Exist(nminwait) Then
				.WebEdit("invoiceDate").Set date-2
				WriteToReport micPass,"invoiceDate","invoiceDate text box  is exist and entered as ["&date-2&"]",false
			Else:WriteToReport micFail,"invoiceDate text box ","invoiceDate text box  isn't exist ",True
			End If
			If .WebEdit("SupplierID").Exist(nminwait) Then
				.WebEdit("SupplierID").Set SupplierID
				WriteToReport micPass,"SupplierID","SupplierID text box  is exist and entered as ["&SupplierID&"]",false
			Else:WriteToReport micFail,"SupplierID text box ","SupplierID text box  isn't exist ",True
			End If
			If .WebEdit("PC_BusUnit").Exist(nminwait) Then
				.WebEdit("PC_BusUnit").Set Businessunit
				WriteToReport micPass,"PC Businessunit","PC Businessunit  is exist and entered as ["&Businessunit&"]",false
				Else:WriteToReport micFail,"PC Businessunit ","PC Businessunit  isn't exist ",True
			End If
			If .WebEdit("Project").Exist(nminwait) Then
				.WebEdit("Project").Set project
				WriteToReport micPass,"Project","Project  is exist and entered as ["&project&"]",false
				Else:WriteToReport micFail,"Project ","Project  isn't exist ",True
			End If
			If .WebEdit("Account").Exist(nminwait) Then
				.WebEdit("Account").Set account
				WriteToReport micPass,"Account","Account  is exist and entered as ["&account&"]",false
				Else:WriteToReport micFail,"Account ","Account  isn't exist ",True
			End If
			app_searchsync()
			If .WebEdit("Dept").Exist(nminwait) Then
				.WebEdit("Dept").Set deptID
				WriteToReport micPass,"Dept","Dept  is exist and entered as ["&deptID&"]",false
				Else:WriteToReport micFail,"Dept ","Dept  isn't exist ",True
			End If
			
			If .WebButton("ActivityID Lookup").Exist(nminwait) Then
				.WebButton("ActivityID Lookup").Click
				WriteToReport micPass,"ActivityID Lookup","ActivityID Lookup is exist and Clicked",false
			Else:WriteToReport micFail,"ActivityID Lookup ","ActivityID Lookup isn't exist ",True
			End If
		end with
		With Browser("PeopleSoft Browser").Page("Regular Entry").PSFrame("LookupActivity")
			If .WebTable("ActivityList").Exist(nminwait) Then
				GlobalDictionary("Activity")=.WebTable("ActivityList").GetCellData(2,3)
				WriteToReport micPass,"Activity name","selected Activity name is ["&GlobalDictionary("Activity")&"]" ,false
				.WebTable("ActivityList").childitem(2,3,"Link",0).click
			ElseIf .Link("Activity0").Exist(nminwait) Then
				GlobalDictionary("Activity")=.Link("Activity0").GetROProperty("innertext")
				WriteToReport micPass,"Activity name","selected Activity name is ["&GlobalDictionary("Activity") &"]" ,false
				.Link("Activity0").Click
			End If
		End With
		app_searchsync():app_searchsync()
		With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent")	
			If .WebButton("Save").Exist(nminwait) Then
				.WebButton("Save").Click
				WriteToReport micPass,"Save","Save is exist and Clicked",false
			Else:WriteToReport micFail,"Save ","Save isn't exist ",True
			End If
			app_searchsync():app_searchsync()
			If .WebElement("voucherID").Exist(nMINWAIT) Then
				voucherID=.WebElement("voucherID").GetROProperty("innertext")
				If StrComp(voucherID,"NEXT",1)<>0 Then
					Call WriteToReport(micPass,"voucherID : "&voucherID,"is present and generated as "&voucherID,false)
					else
					Call WriteToReport(micFail,"voucherID","doesn't get generated",True)
				End If
			End If
						
			
			If .WebTabStrip("tabSelection").Exist(10) Then
				.WebTabStrip("tabSelection").Select("Voucher Attributes")
				Call WriteToReport(micPass,"Voucher Attributes tab","is present",false)
			else
				Call WriteToReport(micFail,"Voucher Attributes tab","is not present",True)
			End If
		'wait for the ojects to get loaded
			app_SearchSync()	
		
			
			If .WebButton("SubmitForApproval_VoucherAttribute").Exist(nMINWAIT) Then
				.WebButton("SubmitForApproval_VoucherAttribute").Click
				Call WriteToReport(micPass,"SubmitApproval button in invoice information","is present",false)
				else
				Call WriteToReport(micFail,"SubmitApproval button in invoice information","is not present",True)
			End If
		End with
		'wait for the ojects to get loaded
			app_SearchSync()
			If Browser("PeopleSoft Browser").Page("Regular Entry").Frame("Approval Comments").WebEdit("AdditionalDetails").Exist(nMAXWAIT) Then
				Browser("PeopleSoft Browser").Page("Regular Entry").Sync
				Browser("PeopleSoft Browser").Page("Regular Entry").Frame("Approval Comments").WebEdit("AdditionalDetails").Click
				wait(2)
				Browser("PeopleSoft Browser").Page("Regular Entry").Frame("Approval Comments").WebEdit("AdditionalDetails").Set voucherID&" is Approved"
			End If
			If Browser("PeopleSoft Browser").Page("Regular Entry").Frame("Approval Comments").WebButton("OK").Exist(nMAXWAIT) Then
				Browser("PeopleSoft Browser").Page("Regular Entry").Frame("Approval Comments").WebButton("OK").Click
			End If
			If Browser("PeopleSoft Browser").Page("Regular Entry").WebButton("OK").Exist(10) Then
				Browser("PeopleSoft Browser").Page("Regular Entry").WebButton("OK").Click
			End if
		'wait for the ojects to get loaded
			app_SearchSync()	
		with Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent")	
			If .WebTabStrip("tabSelection").Exist(nMINWAIT) Then
				.WebTabStrip("tabSelection").Select("Summary")
				Call WriteToReport(micPass,"Summary tab","is present and selected",false)
			elseIf .WebElement("Summary").Exist(nminwait) Then
				.WebElement("Summary").Click
				Call WriteToReport(micPass,"Summary tab","is present and selected",false)
			else
				Call WriteToReport(micFail,"Summary tab","is not present",True)
			End If
		End With
		
		With Browser("PeopleSoft Browser").Page("Regular Entry")
			If .WebElement("MessageforDifference").Exist(nminwait) Then
				strMsg=.WebElement("MessageforDifference").GetROProperty("innertext")
				WriteToReport micfail,"Error Pop up message is displayed","POp up displayed as "&strMsg,True
			End If
			If .WebButton("OK").Exist(nminwait) Then
				.WebButton("OK").Click
				WriteToReport micFail,"OK button","OK button is exist and Clicked",false
			End If
		End With
		
End If
	
	Businessunit=GlobalDictionary("Businessunit")
	
	
	strQuery= GlobalDictionary("strQuery")
If StrComp(Trim(voucherID),"NEXT",1)<>0 Then
	
	'To get the value of Post status before batch process
	With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent").WebElement("PostStatus")
	If .Exist(nMINWAIT) Then
		poststatus=.GetROProperty("innertext")
		Call WriteToReport(micPass,"The post status ","of the voucher before batch process is="&poststatus, false)	
	End If
	End  With 
	With Browser("PeopleSoft Browser").Page("Regular Entry")
		If .WebButton("HomeTop").Exist(nminwait) Then
			.WebButton("HomeTop").Click
		End If
		If .WebButton("No").Exist(nminwait) Then
			.WebButton("No").Click
		End If
	End With
	'Navigate to Following page
	'Accounts Payable / Batch Processes / Vouchers / Voucher Posting
	SelectMainMenu1(GlobalDictionary("MainMenuSelection"))
	
	
	'CLick on Add NEw value Tab
	With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebElement("AddNewValue")
	If .Exist(nMINWAIT) Then
		.Click

		'Enter the control ID
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebEdit("PRCSRUNCNTL_RUN_CNTL_ID")
		If .Exist(nMINWAIT) Then
			.Set dtControlID
			Call WriteToReport(micPass,"Control ID","Control ID is="&dtControlID,false)
		End If
		End WIth 
		
		'CLick on Add Button
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebButton("Add")
		If .Exist(nMINWAIT) Then
			.Click:Call WriteToReport(micPass,"Add button","is present and clicked",false)
		End If
		End With 

	End If
	End With 

	'Wait for the applicatoin load
	App_searchSync()
	
	'Check if the adding nwe contorl page ois displayed
	If Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebEdit("RequestID").WaitProperty("visible",True,2000) Then
		
		'Enter the Run control IDF values in the Page
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebEdit("RequestID")
		If .Exist(nMINWAIT) Then
			.Set dtRequestID
			Call WriteToReport(micPass,"Request ID","Request ID is="&dtRequestID,false)
		End If
		End WIth 
		
		'Enter the description
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebEdit("Description")
		If .Exist(nMINWAIT) Then
			.Set dtDescription
			Call WriteToReport(micPass,"Description ID","Description ID is="&dtDescription,false)
		End If
		End WIth 
		
		'Select the voucher Posting option
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebList("PostVoucherOption")
		If .Exist(nMINWAIT) Then
			.Select dtPostVoucherOption
		End If
		End WIth 
		
		'Select the Prepamenty application
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebList("PrepaymentApplicationMethod")
		If .Exist(nMINWAIT) Then
			.Select dtPrepaymentApplicationMethod
		End If
		End With
		
		'Select the process frequency
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebList("ProcessFrequency")
		If .Exist(nMINWAIT) Then
			.Select dtProcessFrequency
		End If
		End With
		
		'ENter the Business UNit
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebEdit("BusinessUnit")
		If .Exist(nMINWAIT) Then
			.Set BusinessUnit
			Call WriteToReport(micPass,"BusinessUnit","BusinessUnit is="&BusinessUnit,false)
		End If
		End WIth 
		
	
		'Enter the Voucher ID
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebEdit("VoucherID")
		If .Exist(nMINWAIT) Then
			.Set VoucherId
			Call WriteToReport(micPass,"VoucherID","VoucherID is="&VoucherId,false)
		End If
		End WIth 
		
		'Click on Run button
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebButton("Run")
		If .Exist(nMINWAIT) Then
			.Click
		End If
		End WIth 
		
		app_SearchSync()
		app_SearchSync()
		
		'Selcet the post voucher and clickon Ok button
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("ProcessSchdeluerRequest").WebTable("ProcessList")
		If .Exist(nMINWAIT) Then
			For i=2 to .RowCount
				appDescription=.GetCellData(i,2)
				If appDescription="Post vouchers" Then
					appProcessName=.GetCellData(i,3)
					Set oVoucherLink=.ChildItem(i,1,"WebCheckBox",0)
					If oVoucherLink.exist(nMINWAIT) Then
						oVoucherLink.click
						Exit For
					End If
				End If
			Next
		End If
		End With 
	End  If
	
	'Click on Ok button
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("ProcessSchdeluerRequest").WebButton("Ok")
		If .Exist(nMINWAIT) Then
			.Click
		End If
		End WIth 
	
	app_SearchSync()
	
	'Click on Process moonitor
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("VoucherPostingRequest").Link("Process Monitor")
		If .Exist(nMINWAIT) Then
			.Click
		End If
		End With 
	
	app_SearchSync()
	Call CheckProcessMontiorStatus (sProcessName)
			
		With Browser("PeopleSoft Browser").Page("Process Monitor").PSFrame("Process Monitor").WebElement("RunDate")
		If .Exist(nMINWAIT) Then
			runDate=.GetROProperty("innertext")
			rundat=split(runDate," ")
			postedDate=rundat(0)
			Call WriteToReport(micPass,"Voucher posted date is="&postedDate,"is displayed",false) 
		End If
		End With
	
	With Browser("PeopleSoft Browser").Page("Regular Entry")
		If .WebButton("HomeTop").Exist(nminwait) Then
			.WebButton("HomeTop").Click
		End If
		If .WebButton("No").Exist(nminwait) Then
			.WebButton("No").Click
		End If
	End With	
	
	GlobalDictionary("SignInUser")=GlobalDictionary("pCostUser")
	UserSignIn()
	GlobalDictionary("ProjectID")=GlobalDictionary("ProjectName")
	
	SelectMainMenu1(GlobalDictionary("NavigationPCostPayables"))
	PayableCostCollectionVoucher()
	
	With Browser("PeopleSoft Browser").Page("Regular Entry")
			If .WebButton("HomeTop").Exist(nminwait) Then
				.WebButton("HomeTop").Click
			End If
			If .WebButton("No").Exist(nminwait) Then
				.WebButton("No").Click
			End If
		End With
	'Navigate to Transaction Adjustment
	SelectMainMenu1(GlobalDictionary("NavigationQueryViwer"))
	App_searchSync()	
	With browser("PeopleSoft Browser").Page("Query Viewer").PSFrame("Query Viewer")
		If .WebEdit("SearchText").Exist(nminwait) Then
			.WebEdit("SearchText").Set strQuery
			WriteToReport micPass,"Query Name","Query Name text box  is exist and entered as ["&strQuery&"]",false
			Else:WriteToReport micFail,"Query Name text box ","Query Name text box  isn't exist ",True
		End If
		If .WebButton("Search").Exist(nminwait) Then
			.WebButton("Search").Click
			WriteToReport micPass,"Search","Search is exist and Clicked",false
			Else:WriteToReport micFail,"Search ","Search isn't exist ",True
		End If
		app_searchsync()
		flag=false
		If .Link("HTML").Exist(nminwait) Then
			.Link("HTML").Click
			flag=true
			WriteToReport micPass,"HTML link","HTML link is exist and Clicked",false
			Else:WriteToReport micFail,"HTML link ","HTML link isn't exist ",True
		End If
	End With	
	app_SearchSync()
	If flag Then
		With browser("PeopleSoft Browser NewTab").Page("QueryResults")
			If .WebElement("QueryViewer_TotalRows").Exist(nminwait) Then
				strRows=.WebElement("QueryViewer_TotalRows").GetROProperty("innertext")
				WriteToReport micPass,"No of Transactions are related to ERR ","Query ["&strQuery&"] has ["&strRows&"] transactions are related to ERR ",false
			End If
			If .WebTable("SearchResults").Exist(nminwait) Then
				rc=.WebTable("SearchResults").RowCount
				For i = 2 To rc Step 1
					If STRComp(Trim(.WebTable("SearchResults").GetCellData(i,16)),"ERR",1)<>0 Then
						flag=false
						WriteToReport micFail,"Transaction not related to ERR type ","Project ["&.WebTable("SearchResults").GetCellData(i,5)&"], Activity ["&.WebTable("SearchResults").GetCellData(i,6)&"]Transaction not related to ERR type ",True
						Exit for
					End If
				Next
				If flag Then
					WriteToReport micPass,"Al the transactions are related to ERR ","Al the transactions are related to ERR ",false
				End If
			Else:WriteToReport micFail,"Search Results of Query ","Search Results table isn't exist ",True
			End If
		End With
	End If
	If browser("PeopleSoft Browser NewTab").Page("QueryResults").Exist(nminwait) Then
		browser("PeopleSoft Browser NewTab").Close
	End If
End If	
End Function
'**************************************************************************************************************
''' <summary> 
''' Verify the error message while create a Voucher with Closed Project 
''' </summary>
''' <author>Gunasekaran S</author>
''' <datecreated>4/10/2019</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'*************************************************************************************************************
'PCost_1.62
Public Function CreateVoucherforClosedProject
	Dim strSQL, connectionString,Businessunit, sheetName,VoucherID
	Businessunit=GlobalDictionary("Businessunit")
	VoucherID=GlobalDictionary("VoucherID")
	GrossInvoiceAmount=GlobalDictionary("GrossInvoiceAmount")
	sheetName=GlobalDictionary("sheetName")
	
	connectionString = "Provider=SQLOLEDB;Server=PSFNREGSQLSTG1;DATABASE=FNREG;uid='';pwd='';Trusted_Connection=Yes"
	
	strSQL= GlobalDictionary("strSQL")

	If dbGetSpecifiRecords(strSQL, connectionString, sheetName) Then
		Call WriteToReport(micPass,"DB records ","SQL query["&strSQL&"] executed sucessfully " ,false)
	
'Navigate to Transaction Adjustment
		SelectMainMenu1(GlobalDictionary("NavigationRegularEntry"))
		
		App_searchSync()
		project =DataTable.Value("PROJECT_ID",sheetName)

		With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent")
			If .WebEdit("BusinessUnit").Exist(nminwait) Then
				.WebEdit("BusinessUnit").Set Businessunit
				WriteToReport micPass,"Businessunit text box","Businessunit text box  is exist and entered as ["&Businessunit &"]",false
			Else:WriteToReport micFail,"Businessunit text box ","Businessunit text box  isn't exist ",True
			End If
			If .WebEdit("VoucherId").Exist(nminwait) Then
				.WebEdit("VoucherId").Set VoucherID
				WriteToReport micPass,"VoucherId","VoucherId text box  is exist and entered as ["&VoucherId &"]",false
			Else:WriteToReport micFail,"VoucherId text box ","VoucherId text box  isn't exist ",True
			End If
			If .WebEdit("GrossInvoiceAmount").Exist(nminwait) Then
				.WebEdit("GrossInvoiceAmount").Set GrossInvoiceAmount
				WriteToReport micPass,"GrossInvoiceAmount","GrossInvoiceAmount text box  is exist and entered as ["&GrossInvoiceAmount&"]",false
			Else:WriteToReport micFail,"GrossInvoiceAmount text box ","GrossInvoiceAmount text box  isn't exist ",True
			End If
			If .WebButton("Add").Exist(nminwait) Then
				.WebButton("Add").Click
				WriteToReport micPass,"Add","Add is exist and Clicked",false
			Else:WriteToReport micFail,"ADD ","Add isn't exist ",True
			End If
			If .WebButton("ProjectLookup").Exist(nminwait) Then
				.WebButton("ProjectLookup").Click
			End If
		End With

		With Browser("PeopleSoft Browser").Page("Regular Entry").PSFrame("LookUP Project")
			If .WebEdit("Project").Exist(nminwait) Then
				.WebEdit("Project").Set project
				WriteToReport micPass,"Project","Project  is exist and entered as ["&project&"]",false
				Else:WriteToReport micFail,"Project ","Project  isn't exist ",True
			End If
			If .WebButton("Lookup").Exist(nminwait) Then
				.WebButton("Lookup").Click
				WriteToReport micPass,"Lookup button","Lookup button is exist and Clicked",false
			Else:WriteToReport micFail,"Lookup button ","Lookup button isn't exist ",True
			End If
			app_searchsync():app_searchsync()
			If .WebElement("Message").Exist(nminwait) Then
				WriteToReport micPass,"Closed status project aren't populated","Closed status Project  isn't displayed. while searching got the message as ["&.WebElement("Message").GetROProperty("innertext")&"]",false
				Else:WriteToReport micFail,"Closed Project are listed while searching","Closed Project  is displayed while searching ",True
			End If
		End With
	End If
End Function
'**************************************************************************************************************
''' <summary> 
''' Verify the error message while create a Voucher with In-Service Project 
''' </summary>
''' <author>Gunasekaran S</author>
''' <datecreated>4/10/2019</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'*************************************************************************************************************
'PCost_1.61
Public Function CreateVoucherforInServiceProject()
	Dim strSQL, connectionString,Businessunit, sheetName,VoucherID,SupplierID
	Businessunit=GlobalDictionary("Businessunit")
	VoucherID=GlobalDictionary("VoucherID")
	SupplierID=GlobalDictionary("SupplierID")
	GrossInvoiceAmount=GlobalDictionary("GrossInvoiceAmount")
	sheetName=GlobalDictionary("sheetName")
	
	connectionString = "Provider=SQLOLEDB;Server=PSFNREGSQLSTG1;DATABASE=FNREG;uid='';pwd='';Trusted_Connection=Yes"
	
	strSQL= GlobalDictionary("strSQL")

	If dbGetSpecifiRecords(strSQL, connectionString, sheetName) Then
		Call WriteToReport(micPass,"DB records ","SQL query["&strSQL&"] executed sucessfully " ,false)
	
'Navigate to Transaction Adjustment
		SelectMainMenu1(GlobalDictionary("NavigationRegularEntry"))
		
		App_searchSync()
		project =DataTable.Value("PROJECT_ID",sheetName)

		With Browser("PeopleSoft Browser").Page("Regular Entry").Frame("TargetContent")
			If .WebEdit("BusinessUnit").Exist(nminwait) Then
				.WebEdit("BusinessUnit").Set Businessunit
				WriteToReport micPass,"Businessunit text box","Businessunit text box  is exist and entered as ["&Businessunit &"]",false
			Else:WriteToReport micFail,"Businessunit text box ","Businessunit text box  isn't exist ",True
			End If
			If .WebEdit("VoucherId").Exist(nminwait) Then
				.WebEdit("VoucherId").Set VoucherID
				WriteToReport micPass,"VoucherId","VoucherId text box  is exist and entered as ["&VoucherId &"]",false
			Else:WriteToReport micFail,"VoucherId text box ","VoucherId text box  isn't exist ",True
			End If
			If .WebEdit("GrossInvoiceAmount").Exist(nminwait) Then
				.WebEdit("GrossInvoiceAmount").Set GrossInvoiceAmount
				WriteToReport micPass,"GrossInvoiceAmount","GrossInvoiceAmount text box  is exist and entered as ["&GrossInvoiceAmount&"]",false
			Else:WriteToReport micFail,"GrossInvoiceAmount text box ","GrossInvoiceAmount text box  isn't exist ",True
			End If
			If .WebButton("Add").Exist(nminwait) Then
				.WebButton("Add").Click
				WriteToReport micPass,"Add","Add is exist and Clicked",false
			Else:WriteToReport micFail,"ADD ","Add isn't exist ",True
			End If
			If .WebEdit("invoiceNo").Exist(nminwait) Then
				.WebEdit("invoiceNo").Set Replace(Replace(Replace(now,":",""),"/","")," ","")
			End If
			If .WebEdit("invoiceDate").Exist(nminwait) Then
				.WebEdit("invoiceDate").Set date-2
			End If
'			If .WebEdit("SupplierID").Exist(nminwait) Then
'				.WebEdit("SupplierID").Set SupplierID
'			End If
			If .WebEdit("PC_BusUnit").Exist(nminwait) Then
				.WebEdit("PC_BusUnit").Set Businessunit
				WriteToReport micPass,"PC Businessunit","PC Businessunit  is exist and entered as ["&Businessunit&"]",false
				Else:WriteToReport micFail,"PC Businessunit ","PC Businessunit  isn't exist ",True
			End If
			If .WebEdit("Project").Exist(nminwait) Then
				.WebEdit("Project").Set project
				WriteToReport micPass,"Project","Project  is exist and entered as ["&project&"]",false
				Else:WriteToReport micFail,"Project ","Project  isn't exist ",True
			End If
			If .WebButton("Save").Exist(nminwait) Then
				.WebButton("Save").Click
				WriteToReport micPass,"Save","Save is exist and Clicked",false
			Else:WriteToReport micFail,"Save ","Save isn't exist ",True
			End If
			app_searchsync():app_searchsync()
		
		End With
		With Browser("PeopleSoft Browser").Page("Regular Entry")
			If .WebElement("MessageforDifference").Exist(nminwait) Then
				strMsg=.WebElement("MessageforDifference").GetROProperty("innertext")
				If (InStr(1,Trim(strMsg),"In-Service",1)<>0) AND (InStr(1,Trim(strMsg),project,1)<>0) Then
					WriteToReport micPass,"Expected Pop up message is displayed","POp up displayed as "&strMsg,false
				else:WriteToReport micfail,"Expected Pop up message isn't displayed","POp up displayed as "&strMsg,True
				End If
			Else:WriteToReport micFail,"Pop up message doesn't displayed ","popup message isn't exist ",True
			End If
			If .WebButton("OK").Exist(nminwait) Then
				.WebButton("OK").Click
				WriteToReport micPass,"OK button","OK button is exist and Clicked",false
			Else:WriteToReport micFail,"OK button ","OK button isn't exist ",True
			End If
		End With
		With Browser("PeopleSoft Browser").Page("Regular Entry")
			If .WebButton("HomeTop").Exist(nminwait) Then
				.WebButton("HomeTop").Click
			End If
			If .WebButton("No").Exist(nminwait) Then
				.WebButton("No").Click
			End If
		End With
End If

End Function

'**************************************************************************************************************
''' <summary> 
''' Utility function to determine account and deptID combinations based on active projects
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>April 17, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'04/24/2019			Stephen King	Added a check for a project ID flag when building the first SQL query. Won't change the default behavior if the flag isn't already in a datasheet.
'**************************************************************************************************************
Public Function GetAccountAndDeptData
	Dim strSQL, strTemp
	Dim arrRecordValues(), arrResults
	Dim i, nResult, sResults

	'Build our first part of the final SQL query - eg, MKT
	If GlobalDictionary("ProjectID") <> "" Then
		strTemp = "SELECT BUSINESS_UNIT, PROJECT_ID, PROJECT_TYPE FROM PS_PROJECT WHERE PROJECT_ID = '" & GlobalDictionary("ProjectID") & "' AND START_DT >= '01/01/" & Year(Now) & "' AND EFF_STATUS = 'A'"
	Else
		strTemp = "SELECT BUSINESS_UNIT, PROJECT_ID, PROJECT_TYPE FROM PS_PROJECT WHERE PROJECT_ID LIKE '" & GlobalDictionary("Code") & "%' AND START_DT >= '01/01/" & Year(Now) & "' AND EFF_STATUS = 'A'"
	End If
	WriteToReport micDone, "First SQL query", strTemp, False

	'Execute the query
	arrResults = dbGetFirstRecord(strTemp, "", arrRecordValues, "GetAccountAndDeptData_PS_Project")

	If IsArray(arrResults) Then
		WriteToReport micPass, "GetAccountAndDeptData", "SQL query returned Business Unit " & arrResults(0) & ", Project ID " & arrResults(1) & ", and Project Type " & arrResults(2), False
	Else
		WriteToReport micFail, "GetAccountAndDeptData", "No data found. Check SQL query. Exiting test.", False
		ExitTest
	End If

	'If still here, store our values for future use. Sometimes we store two keys depending on which test case calls this function
	GlobalDictionary("BusinessUnit") = arrResults(0)
	GlobalDictionary("PCBUSUnit") = GlobalDictionary("BusinessUnit")
	GlobalDictionary("ProjectID") = arrResults(1)
	GlobalDictionary("Project") = GlobalDictionary("ProjectID")
	GlobalDictionary("ProjectType") = arrResults(2)

	'Navigate to Set Up Financials/Supply Chain> Common Definitions> Design ChartFields> Combination Editing > CDW Category Account Combo Cus
	If SelectMainMenu1(GlobalDictionary("CategoryAccount")) = True Then
		WriteToReport micPass, "GetAccountAndDeptData", "On the CDW Category Account Combo Cus page.", False
	Else
		WriteToReport micFail, "GetAccountAndDeptData", "Navigation to CDW Category Account Combo Cus page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("CDW Category Account Combo").PSFrame("Category - Account Combo")

		'Expand our results table if needed
		If .Link("View All").Exist(5) Then
			.Link("View All").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Confirm that our table exists
		If .WebTable("ResultsTable").Exist(5) Then
			WriteToReport micPass, "GetAccountAndDeptData", "Results table found.", False
		Else
			WriteToReport micFail, "GetAccountAndDeptData", "Results table not found. Exiting test.", True
			ExitTest
		End If

		'If still here, search our table for our project info
		GlobalDictionary("Account") = ""
		For i = 0 To .WebTable("ResultsTable").GetROProperty("rows") - 1
			If .WebEdit("html id:=CDW_CAT_ACCT_PROJECT_TYPE\$" & i).Exist(1) AND Trim(.WebEdit("html id:=CDW_CAT_ACCT_PROJECT_TYPE\$" & i).GetROProperty("default value")) = Trim(GlobalDictionary("ProjectType")) Then

				'Store two keys depending on which test case calls this function
				GlobalDictionary("Account") = Trim(.WebEdit("html id:=CDW_CAT_ACCT_ACCOUNT\$" & i).GetROProperty("default value"))
				GlobalDictionary("Account1") = GlobalDictionary("Account")
				Exit For
			End If
		Next

		'Validate that we have results, otherwise exit the test
		If GlobalDictionary("Account") <> "" Then
			WriteToReport micPass, "GetAccountAndDeptData", "Project info found, using account " & GlobalDictionary("Account"), False
		Else
			WriteToReport micFail, "GetAccountAndDeptData", "Project info not found. Exiting test.", True
			ExitTest
		End If
	End With

	'Reset
	Erase arrResults
	Erase arrRecordValues

	'Run our second query with our new account. Process_group is usually constant for our purposes(00000), but we data drive it just in case
	strTemp = "SELECT * FROM PS_COMBO_DATA_TBL WHERE PROCESS_GROUP = '" & GlobalDictionary("ProcessGroup") & "' AND ACCOUNT = '" & GlobalDictionary("Account") & "'"
	WriteToReport micDone, "Second SQL query", strTemp, False

	'Execute the query
	arrResults = dbGetFirstRecord(strTemp, "", arrRecordValues, "GetAccountAndDeptData_PS_COMBO_DATA_TBL")

	'Validate our results
	If IsArray(arrResults) Then
		WriteToReport micPass, "GetAccountAndDeptData", "SQL query returned Department ID " & arrResults(5), False
	Else
		WriteToReport micFail, "GetAccountAndDeptData", "No data found. Check SQL query. Exiting test.", False
		ExitTest
	End If

	'If still here, store our values for future use. Store two keys depending on which test case calls this function
	GlobalDictionary("DeptID") = arrResults(5)
	GlobalDictionary("Dept1") = arrResults(5)
End Function

'**************************************************************************************************************
''' <summary> 
''' Creating a journal for based on using a specific account and dept combination. Used for tests PC_1.25 and _1.26
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>April 18, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function PCJournalEntryWithSpecificProject

	'Call our GL function to create the journal
	SharedCreateAddJournal "PCJournalEntryWithSpecificProject", False

	'Submit our journal for approval
	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Click on the Approval link to switch tabs
		.Link("Approval").Click
		Browser("Peoplesoft Browser").Sync

		'If not, then click Submit
		.WebButton("Submit").Click
		Browser("Peoplesoft Browser").Sync
	End With

	'Not currently needed, but left here in case user permissions or test flow changes
	'SharedApprovejournal "PCJournalEntryWithSpecificProject", False

	'Process(post) our journal
	SharedProcessJournal "PCJournalEntryWithSpecificProject", False

	'Log out of CDW_BATCH and back in as our original user
	Login GlobalDictionary("SignInUser")

	'Review our journal status. Confirm it is posted and valid
	ReviewJournalStatus
End Function

'**************************************************************************************************************
''' <summary> 
''' Create a deposit using specific account and dept data. PC_1.48
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>April 18, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter: FunctionName - the name of the function calling this so we can have accurate reporter statements
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function DirectJournalPayment
	sheetName=GlobalDictionary("sheetName2")
	connectionString = "Provider=SQLOLEDB;Server=PSFNREGSQLSTG1;DATABASE=FNREG;uid='';pwd='';Trusted_Connection=Yes"

	'Get account and dept info for a MKT test case
	GetAccountAndDeptData

	'Call our RegularDeposit function to start building our payment
	RegularDeposit

	'On the Create Accounting Entries page
	EnterCreateAccountingEntriesData

	'Login as GWENCHO here if not already using her

	'Run our Generate Journals process
	AMGenerateJournals
	
	'navigate to homepage
	With Browser("PeopleSoft Browser").Page("Regular Entry")
		If .WebButton("HomeTop").Exist(nminwait) Then
			.WebButton("HomeTop").Click
		End If
		If .WebButton("No").Exist(nminwait) Then
			.WebButton("No").Click
		End If
	End With
	
	'navigate to Project Costing > Revenue Collection > Adjustments from Receivables
	If SelectMainMenu1(GlobalDictionary("AdjustmentsfromReceivables")) = True Then
		WriteToReport micPass, "DirectJournalPayment", "On the Adjustments from Receivables page.", False
	Else
		WriteToReport micFail, "DirectJournalPayment", "Navigation to Adjustments from Receivables page failed. Exiting test.", True
		ExitTest
	End If
	
	'Run the procees for receivables cost collection
	RunReceivablesCostCollection()
	
	'navigate to homepage
	With Browser("PeopleSoft Browser").Page("Regular Entry")
		If .WebButton("HomeTop").Exist(nminwait) Then
			.WebButton("HomeTop").Click
		End If
		If .WebButton("No").Exist(nminwait) Then
			.WebButton("No").Click
		End If
	End With
	
	'Project Costing > Interactive Reports > Manager Transaction Review
	If SelectMainMenu1(GlobalDictionary("ManagerTransactionReview")) = True Then
		WriteToReport micPass, "DirectJournalPayment", "On the Manager Transaction Review page.", False
	Else
		WriteToReport micFail, "DirectJournalPayment", "Navigation to Manager Transaction Review page failed. Exiting test.", True
		ExitTest
	End If
	
	'Review Expense/cost Transaction detail
	VerifyAmountinReviewRevenueTransactionDetails GlobalDictionary("BusinessUnit"),GlobalDictionary("Project"),GlobalDictionary("PaymentAmount"),""
	
	'Project Costing > Interactive Reports > Manager Transaction Review
	If SelectMainMenu1(GlobalDictionary("ExpenseExtract")) = True Then
		WriteToReport micPass, "DirectJournalPayment", "On the Expense Extract page.", False
	Else
		WriteToReport micFail, "DirectJournalPayment", "Navigation to Expense Extract page failed. Exiting test.", True
		ExitTest
	End If
	
	'Run the expese extrat process
	RunExpenseExtract
	
	'query to fetch the created Deposit
	strSQL=" SELECTPROJECT_ID,RESOURCE_AMOUNT,*FROMPS_CDW_MRMEX_STG where DEPOSIT_ID = '"&GlobalDictionary("DepositID")&"'"
	
	'Get the record created for thr deposit
	If dbGetSpecifiRecords(strSQL, connectionString, sheetName) Then
		WriteToReport micPass, "Deposit expense added to database", "Deposit expense added to the PS_CDW_MRMEX_STG table.", False
		If StrComp(GlobalDictionary("Project"),Trim(DataTable.Value("PROJECT_ID",sheetname)),1)=0 Then
			WriteToReport micPass, "Project ID matched to database", "Project ID matched to the PS_CDW_MRMEX_STG table.", False
		End If
		If CDBL(GlobalDictionary("PaymentAmount"))=CDBL(Trim(DataTable.Value("RESOURCE_AMOUNT",sheetname))) Then
			WriteToReport micPass, "RESOURCE_AMOUNT matched to database", "RESOURCE_AMOUNT matched to the PS_CDW_MRMEX_STG table.", False
		End If
	Else
		WriteToReport micFail,  "Deposit expense not added to database", "Deposit expense isn't added to the PS_CDW_MRMEX_STG table.", True
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Entering specifc data on the Create Accounting Entries page
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>April 19, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition: Being on the Create Accounting Entries page. This function is called from other functions.
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function EnterCreateAccountingEntriesData

	With Browser("PeopleSoft Browser").Page("Create Accounting Entries").PSFrame("Direct Journal")

		'Enter the business unit
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")

		'Enter our Line Amount, which is negative
		.WebEdit("Amount").Set "-" & GlobalDictionary("FixedAmount")

		'Enter our account
		.WebEdit("Account").Set GlobalDictionary("Account")
		Browser("PeopleSoft Browser").Sync

		'Enter our dept ID
		.WebEdit("DeptID").Set GlobalDictionary("Dept1")
		Browser("PeopleSoft Browser").Sync

		'Enter our PC Bus Unit
		.WebEdit("PCBusinessUnit").Set GlobalDictionary("BusinessUnit")

		'Enter our project
		.WebEdit("ProjectID").Set GlobalDictionary("ProjectID")
		Browser("PeopleSoft Browser").Sync

		'Enter our activity
		'.WebEdit("Activity").Set GlobalDictionary("Activity")
		'Data is inconsistent based on journal type, so just take first entry.
		'Click on the search icon
		.Image("Look up Activity").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm that we have search results
		If Browser("PeopleSoft Browser").Page("Create Accounting Entries").PSFrame("title:=Look Up Activity").Link("html id:=RESULT4\$0").Exist(5) Then
			Browser("PeopleSoft Browser").Page("Create Accounting Entries").PSFrame("title:=Look Up Activity").Link("html id:=RESULT4\$0").Click
			Browser("PeopleSoft Browser").Sync
		Else
			WriteToReport micFail, "EnterCreateAccountingEntriesData", "Unable to locate valid results for 'Activity' field", True
			ExitTest
		End If

		'Enter our analysis type(eg, EXP or REV)
		.WebEdit("AnalysisType").Set GlobalDictionary("AnalysisType")

		'Click Save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Create offsetting entry(Click on the Lightning Bolt)
		.Image("Create").Click
		Browser("PeopleSoft Browser").Sync

		'Click on check box next to "complete"
		If .WebCheckBox("JournalComplete").GetROProperty("checked") = 0 Then
			.WebCheckBox("JournalComplete").Click
		End If

		'Click Save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Unpost one of our previously created journals. PC_1.27
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>April 19, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function UnpostProjectCostingJournals
	Dim arrRecordValues(), arrResults
	Dim nResult
	Dim strSQL

	'Pull a posted journal associated with a marketing project created within the last day or two(depending on when the test runs). Using a known BusinessUnit to match testcase PC_1.25
	'strSQL = "Select * FROM PS_JRNL_HEADER WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND JOURNAL_ID LIKE '" & GlobalDictionary("Code") & "%' AND JRNL_HDR_STATUS = 'P' AND REVERSAL_CD ='N' AND UNPOST_SEQ = '0'"	' AND TRANSACTION_DATE >= '" & DateAdd("d", -2, Date) & "'"
	strSQL = "Select * FROM PS_JRNL_HEADER WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND DESCR LIKE '%" & GlobalDictionary("Code") & "%' AND JRNL_HDR_STATUS = 'P' AND REVERSAL_CD ='N' AND UNPOST_SEQ = '0' AND TRANSACTION_DATE >= '" & DateAdd("d", -2, Date) & "' ORDER BY JOURNAL_DATE DESC"

	'Used for FNQA testing
	'strSQL = "Select * FROM PS_JRNL_HEADER WHERE JRNL_HDR_STATUS = 'P' AND REVERSAL_CD ='N' AND UNPOST_SEQ = '0' AND TRANSACTION_DATE >= '04/01/2019'"

	'Check that data exists, otherwise we need to create it by running the precondition test
	WriteToReport micDone, "UnpostProjectCostingJournals - SQL Query", "SQL query is " & strSQL, False

	nResult = -1
	arrResults = dbGetFirstRecord(strSQL, "", arrRecordValues, "UnpostProjectCostingJournals")

    'Confirm that we have results from our SQL query, exit otherwise
    On Error Resume Next
	nResult = UBound(arrRecordValues)
	On Error GoTo 0
	If nResult > 0 Then

		'Used for FNQA testing. Should already have due to 1.25
		'GlobalDictionary("BusinessUnit") = ArrRecordValues(0)
		
        'Storing our Journal ID for later use
        GlobalDictionary("JournalID") = ArrRecordValues(1)

        'Storing our Ledger Group for later use
        GlobalDictionary("Ledger") = ArrRecordValues(9)

        'Storing our Source for later use
        GlobalDictionary("Source") = ArrRecordValues(21)
        WriteToReport micPass, "UnpostProjectCostingJournals - SQL Query Executed", "SQL query successfully executed. Values were returned and the test will continue.", False
    Else
    	'On Error Goto 0
    	WriteToReport micFail, "UnpostProjectCostingJournals - SQL Query Executed", "SQL query successfully executed. However, no values were returned and the test will stop. Please run PC_1.25_JournalEntryMktPRoj", False
    	ExitTest
	End If

	'Navigate to the PeopleSoft Mark Journals For Unposting page
	If SelectMainMenu1(GlobalDictionary("UnpostSelection1")) = True Then
		WriteToReport micPass, "UnpostProjectCostingJournals", "On the Mark Journals For Unposting page.", False
	Else
		WriteToReport micFail, "UnpostProjectCostingJournals", "Navigation to Mark Journals For Unposting page failed. Exiting test.", True
		ExitTest
	End If

	'User our OR and clean up our object calls
	With Browser("PeopleSoft Browser").Page("Mark Journals for Unposting").PSFrame("Mark Journals for Unpost")

		'Enter all of the fields for searching as they are required while using our SQL results
		'Unit
		Browser("PeopleSoft Browser").Sync
		.WebEdit("Business Unit").Set GlobalDictionary("BusinessUnit")

		'Ledger group
		If arrRecordValues(9) <> "" Then
			.WebEdit("Ledger Group").Set GlobalDictionary("Ledger")
		End If

		'Fiscal Year
		If arrRecordValues(6) <> "" Then
			.WebEdit("Fiscal Year").Set arrRecordValues(6)
		End If

		'Period
		If arrRecordValues(7) <> "" Then
			.WebEdit("Period").Set arrRecordValues(7)
		End If

		'Source
		If arrRecordValues(21) <> "" Then
			.WebEdit("Source").Set arrRecordValues(21)
		End If

		'Second Row
		'Journal ID
		If arrRecordValues(1) <> "" Then
			.WebEdit("Journal ID").Set arrRecordValues(1)
		End If

		'Dates
		If arrRecordValues(2) <> "" Then

			'Date From
			.WebEdit("Date From").Set arrRecordValues(2)

			'Date To
			.WebEdit("Date To").Set arrRecordValues(2)
		End If

		'User ID
		If arrRecordValues(38) <> "" Then
			.WebEdit("User ID").Set arrRecordValues(38)
		End If

		'Journal Class
		If arrRecordValues(63) <> "" Then
			.WebEdit("Journal Class").Set arrRecordValues(63)
		End If

		'Click the Search button
		.WebButton("Search").Click
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
			Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Click
		End If

		'Select journal for unposting(should only be one)
		If .WebCheckBox("Process").GetROProperty("disabled") = 0 Then	'Exist(5) Then
			.WebCheckBox("Process").Set "ON"	'Two values, ON/OFF
		End  If

		'Confirm that the checkbox was enabled and selected. Otherwise, exit test
		If .WebCheckBox("Process").GetROProperty("Checked") = 1 Then
			WriteToReport micPass, "UnpostProjectCostingJournals", "Successfully selected the Process checkbox after searching for our journal.", False
		Else
			On Error GoTo 0
			WriteToReport micFail, "UnpostProjectCostingJournals", "Unable to select the Process checkbox after searching for our journal. Please confirm the test data.", True
			ExitTest
		End If

		'Click Save and wait for it to save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Process our journal for unposting
		SharedProcessJournal "UnpostProjectCostingJournals", False

		'Perform a SQL query to grab the current info with our processed journal
		arrResults = FindJournal(GlobalDictionary("JournalID"))

		'Confirm that we have results from our SQL query, exit otherwise
		nResult = -1
	    On Error Resume Next
		nResult = UBound(arrResults)
		If nResult > 0 Then

			'Confirm that the journals behaved appropriately given the nature of the test step
			If arrResults(26) = "U" Then
    			WriteToReport micPass, "UnpostProjectCostingJournals - Status", "Journal expected to unpost, and successfully did so after test ran.", False
    		Else
	    		On Error Goto 0
	    		WriteToReport micFail, "UnpostProjectCostingJournals - Status", "Journal did not update or post after test run. Still " & arrRecordValues(26) & ". Exiting test.", False
	    		ExitTest
	    	End If
	    Else
	    	On Error Goto 0
	    	WriteToReport micFail, "UnpostProjectCostingJournals  - Journal ID not found", "Unable to return results based on journal ID " & GlobalDictionary("JournalID") & ".", False
	    	ExitTest
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' WriteOff a Partial credit balance of a Marketing project. PCost_1.49_WOPartialMarketBal
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>April 22, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function WriteOffPartialMarketingBalance
	Dim strSQL
	Dim arrRecordValues, arrResults()
	Dim nResult

	'Run our first SQL query
	strSQL = "SELECT * FROM PS_CUSTOMER WHERE VENDOR_ID <> ''"
	WriteToReport micDone, "WriteOffPartialMarketingBalance - SQL Query", "Query being used is " & strSQL, False

	'Get the first journal that meets our criteria, exit if none found
	arrRecordValues = dbGetFirstRecord(strSQL, "", arrResults, "WriteOffPartialMarketingBalance")
	nResult = -1

	On Error Resume Next
	nResult = UBound(arrRecordValues)
	On Error GoTo 0
	If nResult >= 0 Then
		WriteToReport micPass, "WriteOffPartialMarketingBalance - PS_CUSTOMER SQL results", "There were " & nResult + 1 & " journal(s) found!", False
	Else
		WriteToReport micFail, "WriteOffPartialMarketingBalance - PS_CUSTOMER SQL results", "There were 0 journals found. Exiting test.", False
		ExitTest
	End If

	GlobalDictionary("SetID") = arrRecordValues(0)
	GlobalDictionary("CustID") = arrRecordValues(1)
	GlobalDictionary("Name") = arrRecordValues(10)
	GlobalDictionary("VendorID") = arrRecordValues(26)

	'With our first query, run a check for our customer. We need to find whether or not there is a supplier attached to them before continuing
	'Navigate to the Customers > Customer Information > General Information page
	If SelectMainMenu1(GlobalDictionary("CustGenInfo")) Then
		WriteToReport micPass, "WriteOffPartialMarketingBalance", "Navigated to General Information page", False
	Else
		WriteToReport micFail, "WriteOffPartialMarketingBalance", "Unable to navigate to General Information page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("General Information").PSFrame("TargetContent")

		'Search for our customer
		.WebEdit("Set ID").Set GlobalDictionary("SetID")
		.WebEdit("Customer ID").Set GlobalDictionary("CustID")
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Click on the Miscellaneous General tab
		.WebElement("Miscellaneous General").Click
		Browser("PeopleSoft Browser").Sync

		'Validate
		If .WebEdit("SupplierSetID").Exist(5) Then
			WriteToReport micPass, "WriteOffPartialMarketingBalance", "Beginning to enter the Miscellaneous General Tab information", False
		Else
			WriteToReport micFail, "WriteOffPartialMarketingBalance", "Unable to enter the Miscellaneous General Tab information", False
			ExitTest
		End If

		'Validate supplier set ID
		If Trim(.WebEdit("SupplierSetID").GetROProperty("default value")) = GlobalDictionary("SetID") Then
			WriteToReport micPass, "WriteOffPartialMarketingBalance", "Supplier Set ID confirmed - " & GlobalDictionary("SetID"), False
		Else
			WriteToReport micFail, "WriteOffPartialMarketingBalance", "Supplier Set ID does not match - " & Trim(.WebEdit("SupplierSetID").GetROProperty("default value")) & " vs - " & GlobalDictionary("SetID"), True
			ExitTest
		End If

		'Validate supplier ID - stored on previous page
		If Trim(.WebEdit("SupplierID").GetROProperty("default value")) <> "" Then
			WriteToReport micPass, "WriteOffPartialMarketingBalance", "Supplier ID confirmed - " & Trim(.WebEdit("SupplierID").GetROProperty("default value")), False
		Else
			WriteToReport micFail, "WriteOffPartialMarketingBalance", "No Supplier ID found.", True
			ExitTest
		End If
	End With

	'Run our second SQL query. We have a window before we can use them, so we set it for two months
'	strSQL = "SELECT * FROM PS_ITEM WHERE ITEM_STATUS = 'O' AND BAL_AMT < 0 AND BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & 	"'"
'	WriteToReport micDone, "WriteOffPartialMarketingBalance - PS_ITEM SQL Query", "Query being used is " & strSQL, False
'
'	'Get the first journal that meets our criteria, exit if none found
'	arrRecordValues = dbGetFirstRecord(strSQL, "", arrResults, "WriteOffPartialMarketingBalance")
'	nResult = -1
'
'	On Error Resume Next
'	nResult = UBound(arrRecordValues)
'	On Error GoTo 0
'	If nResult >= 0 Then
'		WriteToReport micPass, "WriteOffPartialMarketingBalance - PS_ITEM SQL results", "There were " & nResult + 1 & " journal(s) found!", False
'	Else
'		WriteToReport micFail, "WriteOffPartialMarketingBalance - PS_ITEM SQL results", "There were 0 journals found. Exiting test.", False
'		ExitTest
'	End If
'
'	'Grab the item returned in our new SQL query
'    GlobalDictionary("ITEM") = arrRecordValues(2)
'
'	'Grab the dates for future reference
'	GlobalDictionary("FromDate") = arrRecordValues(10)	'(Assigned)

	arrRecordValues = dbGetItemWriteOffNegativeAmount

	GlobalDictionary("ITEM") = arrRecordValues(1)
	GlobalDictionary("FromDate") = arrRecordValues(3)

	'Store the SQL query given for this test case
	'strSQL = "SELECT * FROM PS_ITEM WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND ITEM_STATUS = 'O' AND BAL_AMT < '.01'"

	'Determine our account and dept combination
	GetAccountAndDeptData

	'Call our shared function to create a worksheet
	SharedCreateMaintWorksheet "WriteOffPartialMarketingBalance"

	'Select our workflow action
	With Browser("PeopleSoft Browser").Page("Finalize Worksheet")

        'Verify on Worksheet Action Page
        If .WebList("Posting Action").Exist(30) Then
           Call WriteToReport (micPass, "Worksheet Action", "Page is displayed.", False)
        Else
           Call WriteToReport (micFail, "Worksheet Action", "Page is not displayed.", True)  
           ExitTest  
        End If

        'Select Submit to Workflow
        .WebList("Posting Action").Select "Submit to Workflow" 

        'Click OK
        .WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync

        'Click Save
        .WebButton("Save").Click
        Browser("PeopleSoft Browser").Sync

        'Go back a page to reload the batch options available
        .Link("Worksheet Application").click
        Browser("PeopleSoft Browser").Sync

        'Click on the Worksheet Action link to go back to our original page
		Browser("PeopleSoft Browser").Page("Update Worksheet").Link("Worksheet Action").Click
		Browser("PeopleSoft Browser").Sync

		'select Batch Standard from our options
		.WebList("Posting Action").Select "Batch Standard"

		'Click OK
		.WebButton("Ok").Click
		Browser("PeopleSoft Browser").Sync

		'Click Save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Creating a GL journal entry based on using a specific account and dept combination. Used for test PC_1.64
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>April 22, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CreateGLJournalEntryWithActiveProject
	Dim sIRunID
	Dim aInstance
	Dim strTemp, arrTemp

	'Determine our account and dept combination
	GetAccountAndDeptData

	'Build our combo edit data - Step 1
	'Navigate to Build Combination Data
	If SelectMainMenu1(GlobalDictionary("BuildCombinationDataMenu")) = True Then
		WriteToReport micPass, "CreateGLJournalEntryWithActiveProject", "On the Build Combination Data page.", False
	Else
		WriteToReport micFail, "CreateGLJournalEntryWithActiveProject", "Navigation to Build Combination Data page failed. Exiting test.", True
		ExitTest
	End If

	'Use our OR
	With Browser("PeopleSoft Browser").Page("Build Combination Data")

		'Create our run ID
		sRunId = "Auto" & CLng(Timer)
	    WriteToReport micDone, "Run control ID", sRunID, False

		If Not .PSFrame("TargetContent").WebList("Process_Frequency").Exist(10) Then		
			.PSFrame("TargetContent").Link("Add a New Value").Click
			.PSFrame("TargetContent").WebEdit("Control_ID").Set sRunId
			.PSFrame("TargetContent").WebButton("Add").Click
		End If

		.PSFrame("TargetContent").WebEdit("GL_PANELS_WRK_AS_OF_DATE").Set Date	'sDate?
		.PSFrame("TargetContent").WebList("Process_Frequency").Select GlobalDictionary("Frequency")
		.PSFrame("TargetContent").WebEdit("Business_Unit").Set GlobalDictionary("BusinessUnit")
		.PSFrame("TargetContent").WebEdit("Ledger_Group").Set GlobalDictionary("Ledger")
		.PSFrame("TargetContent").WebList("BuiildOption").Select GlobalDictionary("BuildOption")
		.PSFrame("TargetContent").WebEdit("AsofDate").Set Date 'sDate
		.PSFrame("TargetContent").WebCheckBox("UseWildCardsinCombination").Set "OFF"
		.PSFrame("TargetContent").WebCheckBox("ActiveValuesOnly").Set "OFF"
		.PSFrame("TargetContent").WebButton("Run").Click
		Browser("PeopleSoft Browser").Sync

		.PSFrame("Process Scheduler Request").WebCheckBox("FS_CEBD").Set "ON"
		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync

		'Grab ProcessInstance
		aInstance = Split(.PSFrame("Status Bar").WebElement("ProcessInstance").GetROProperty("innertext"),":")
		.PSFrame("Status Bar").Link("Process Monitor").Click
		getStatus Trim(aInstance (1)), GlobalDictionary("SignInUser")		
	End With

	'Step 2, 3, 4 - Create, submit, post, and validate a GL Journal Entry
	PCJournalEntryWithSpecificProject

	'Step 5
	'Navigate to the Project Costing > Cost Collection > General Ledger page
	If SelectMainMenu1(GlobalDictionary("PCGeneralLedger")) = True Then
		WriteToReport micPass, "CreateGLJournalEntryWithActiveProject", "On the General Ledger page.", False
	Else
		WriteToReport micFail, "CreateGLJournalEntryWithActiveProject", "Navigation to General Ledger page failed. Exiting test.", True
		ExitTest
	End If

	'Enter our data for consolidating
	With Browser("PeopleSoft Browser").Page("General Ledger")

		'Click to add a new value
		.PSFrame("TargetContent").Link("Add a New Value").Click

		'Enter run ID
	    sRunId = "Auto" & CLng(Timer)
	    WriteToReport micDone, "CreateGLJournalEntryWithActiveProject - Run control ID", sRunID, False
		.PSFrame("TargetContent").WebEdit("RunID").Set sRunId

		'Click Add
		.PSFrame("TargetContent").WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Select Options dropdown
		.PSFrame("TargetContent").WebList("Options").Select "Business Unit/Project/Activity"
		Browser("PeopleSoft Browser").Sync

		'Business Unit
		.PSFrame("TargetContent").WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")

		'Project
		.PSFrame("TargetContent").WebEdit("Project").Set GlobalDictionary("ProjectID")

		'Activity
		.PSFrame("TargetContent").WebEdit("Activity").Set GlobalDictionary("Activity")

		'Process Frequency weblist
		.PSFrame("TargetContent").WebList("ProcessFrequency").Select "Always"	'Frequency already in use. New flag?

		'Click the Save button
		.PSFrame("TargetContent").WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Click the Run button
		.PSFrame("TargetContent").WebButton("Run").Click
		Browser("PeopleSoft Browser").Sync

		'Check WebCheckBox if it's not
		If .PSFrame("Process Scheduler Request").WebCheckBox("Process").GetROProperty("checked") <> "1" Then
			.PSFrame("Process Scheduler Request").WebCheckBox("Process").Click
		End If

		'Click OK
		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		.Sync

		'Grab the Instance number of the new process
		strTemp = .PSFrame("TargetContent").WebElement("Process").GetROProperty("innertext")
		arrTemp = Split(strTemp, ":")
		GlobalDictionary("InstanceNumber") = arrTemp(1)
		WriteToReport micDone, "CreateGLJournalEntryWithActiveProject - Instance Number", GlobalDictionary("InstanceNumber"), False

		'Store our process name
		GlobalDictionary("Process") = "PC_GL_TO_PC"
		WriteToReport micDone, "CreateGLJournalEntryWithActiveProject - Process Name", GlobalDictionary("Process"), False

		'Click the 'Process Monitor link
		.PSFrame("TargetContent").Link("Process Monitor").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Monitor our job execution status
	SharedProcessMonitor "CreateGLJournalEntryWithActiveProject"
End Function

'**************************************************************************************************************
''' <summary> 
''' Creating a GL journal entry based on using a specific account and dept combination. Used for test PC_1.63
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>April 24, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CreateGLJournalEntryWithPendingProject

	GetAccountAndDeptDataNonActiveProject "CreateGLJournalEntryWithPendingProject"

	'Build our combo edit data - Step 1
	'Navigate to Build Combination Data
	If SelectMainMenu1(GlobalDictionary("BuildCombinationDataMenu")) = True Then
		WriteToReport micPass, "CreateGLJournalEntryWithPendingProject", "On the Build Combination Data page.", False
	Else
		WriteToReport micFail, "CreateGLJournalEntryWithPendingProject", "Navigation to Build Combination Data page failed. Exiting test.", True
		ExitTest
	End If

	'Use our OR
	With Browser("PeopleSoft Browser").Page("Build Combination Data")

		'Create our run ID
		sRunId = "Auto" & CLng(Timer)
	    WriteToReport micDone, "Run control ID", sRunID, False

		If Not .PSFrame("TargetContent").WebList("Process_Frequency").Exist(10) Then		
			.PSFrame("TargetContent").Link("Add a New Value").Click
			.PSFrame("TargetContent").WebEdit("Control_ID").Set sRunId
			.PSFrame("TargetContent").WebButton("Add").Click
		End If

		.PSFrame("TargetContent").WebEdit("GL_PANELS_WRK_AS_OF_DATE").Set Date	'sDate?
		.PSFrame("TargetContent").WebList("Process_Frequency").Select GlobalDictionary("Frequency")
		.PSFrame("TargetContent").WebEdit("Business_Unit").Set GlobalDictionary("BusinessUnit")
		.PSFrame("TargetContent").WebEdit("Ledger_Group").Set GlobalDictionary("Ledger")
		.PSFrame("TargetContent").WebList("BuiildOption").Select GlobalDictionary("BuildOption")
		.PSFrame("TargetContent").WebEdit("AsofDate").Set Date 'sDate
		.PSFrame("TargetContent").WebCheckBox("UseWildCardsinCombination").Set "OFF"
		.PSFrame("TargetContent").WebCheckBox("ActiveValuesOnly").Set "OFF"
		.PSFrame("TargetContent").WebButton("Run").Click
		Browser("PeopleSoft Browser").Sync

		.PSFrame("Process Scheduler Request").WebCheckBox("FS_CEBD").Set "ON"
		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync

		'Grab ProcessInstance
		aInstance = Split(.PSFrame("Status Bar").WebElement("ProcessInstance").GetROProperty("innertext"),":")
		.PSFrame("Status Bar").Link("Process Monitor").Click
		getStatus Trim(aInstance (1)), GlobalDictionary("SignInUser")		
	End With

	'Step 2, 3, 4 - Create, submit, approve, post, and validate a GL Journal Entry
	PCJournalEntryWithSpecificProject	
End Function

Public Function VerifyAmountinReviewCostTransactionDetails(businessunit,Project,strAmount,Activity)
'"Project Costing > Interactive Reports > Manager Transaction Review"

Dim appAmount
With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("Manager Transaction Review")
If .WebEdit("Businessunit").Exist(nminwait) Then
.WebEdit("Businessunit").Set businessunit
WriteToReport micPass," Business unit"," Businessunit is present and entered as["&Businessunit&"]",false
else: WriteToReport micfail,"Businessunit ","Businessunit field isn't present",true
End If

If .WebEdit("Project").Exist(nminwait) Then
.WebEdit("Project").Set project
WriteToReport micPass," Project "," Project is present and entered as["&Project&"]",false
else: WriteToReport micfail,"Project  ","Project field isn't present",true
End If

If .WebEdit("Activity").Exist(nminwait) Then
.WebEdit("Activity").Set Activity
WriteToReport micPass," Activity "," Activity is present and entered as["&Activity&"]",false
else: WriteToReport micfail,"Project  ","Project field isn't present",true
End If

If .WebButton("Search").Exist(nminwait) Then
.WebButton("Search").Click
WriteToReport micPass," Search "," Search button is present and clicked",false
else: WriteToReport micfail,"Search  ","search field isn't present",true
End If

'wait for the objects to get loaded
app_SearchSync()

app_searchsync()


With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("Manager Transaction Review").WebTable("DetailsReview_2")
If .Exist(nMINWAIT) Then
For i=1 to .RowCount
appDate=.GetCellData(i,2)
If CDate(appDate)=Date Then
appAmount=Cdbl(Replace(Trim(Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("Manager Transaction Review").WebTable("DetailsReviewF6Cols").GetCellData(1,5) ),"$",""))
If Cint(appAmount)=Cint(strAmount) Then
WriteToReport micPass,"Amount validation done","Expense amount is matched in Project Costing",false    
End If
End  If
Next
End If

End  With 

End With


End Function

Public Function RunExpenseExtract()
'click on Add New value Buytton
With Browser("PeopleSoft Browser").Page("ExtractProcess").PSFrame("TargetContent").WebTabStrip("SelectingValue")
If .Exist(nMINWAIT) Then
.Select "Add a New Value"
End If
End  With 

'Enter the run control ID
With Browser("PeopleSoft Browser").Page("ExtractProcess").PSFrame("TargetContent").WebEdit("RunControlID")
If .Exist(nMINWAIT) Then
.Set "EXP" & CLng(Timer)
End If
End  With 

'CLick on Add Button
With Browser("PeopleSoft Browser").Page("ExtractProcess").PSFrame("TargetContent").WebButton("Add")
If .Exist(nMINWAIT) Then
.Click
End If
End  With 

'wait for the ojects to get loaded
app_SearchSync()

'Click on Run button
With Browser("PeopleSoft Browser").Page("ExtractProcess").PSFrame("TargetContent").WebButton("Run")
If .Exist(nMINWAIT) Then
.Click
End If
End  With 

'wait for the ojects to get loaded
app_SearchSync()

'Seledct the Process
With Browser("PeopleSoft Browser").Page("ExtractProcess").PSFrame("ProcessScheduler").WebCheckBox("ProcessName")
If .Exist(nMINWAIT) Then
.Click
End If
End  With 

appProcessName="CDW_MRMEX_OB"
Reporter.ReportEvent micPass,"The Process Name","is"&appProcessName

'CLick on OK button
With Browser("PeopleSoft Browser").Page("ExtractProcess").PSFrame("ProcessScheduler").WebButton("Ok")
If .Exist(nMINWAIT) Then
.Click
End If
End  With 

'wait for the ojects to get loaded
app_SearchSync()

'CLick on Process monit link
With Browser("PeopleSoft Browser").Page("ExtractProcess").PSFrame("StatusBar").Link("ProcessMonitor")
If .Exist(nMINWAIT) Then
.Click
End If
End  With 

'wait for the ojects to get loaded
app_SearchSync()

'Check for the process monit pscreen
CheckProcessMontiorStatus(appProcessName)

End Function

Public Function ValidateEMMScreen(CreationType)
sheetName=GlobalDictionary("sheetName2")
connectionString = "Provider=SQLOLEDB;Server=PSFNREGSQLSTG1;DATABASE=FNREG;uid='';pwd='';Trusted_Connection=Yes"

Select Case CreationType
Case "Journal"
GlobalDictionary("AppValue")=GlobalDictionary("JournalID")
strSQL=GlobalDictionary("strSQLJournal")
If NOT dbGetSpecifiRecords(strSQL, connectionString, sheetName) Then
Call WriteToReport(micFail, "Verifying the Record from Database", "No Record Exist for SQL: [" & strSQL & "]",true)
else
Call WriteToReport(micPass,"DB records fetched successfully","SQL query executed sucessfully ["&strSQL&"]" ,false)
End  If

Case "Voucher"
GlobalDictionary("AppValue")=GlobalDictionary("VoucherID")
strSQL=GlobalDictionary("strSQLVoucher")
If NOT dbGetSpecifiRecords(strSQL, connectionString, sheetName) Then
Call WriteToReport(micFail, "Verifying the Record from Database", "No Record Exist for SQL: [" & strSQL & "]",true)
else
Call WriteToReport(micPass,"DB records fetched successfully","SQL query executed sucessfully ["&strSQL&"]" ,false)
End  If

End Select

ParameterName=GlobalDictionary("ParameterName")
Set table=DataTable.GetSheet(sheetName)
For k=1 to table.GetRowCount
table.SetCurrentRow(k)
If Trim(DataTable.Value(ParameterName,sheetName))=GlobalDictionary("AppValue") Then
Reporter.ReportEvent micDone,"The Project Details are","are"&DataTable.Value(ParameterName,sheetName)
Reporter.ReportEvent micPass,"The Project Details","is present"
Exit Function
End If
Next
End Function

Public Function VerifyAmountinReviewRevenueTransactionDetails(businessunit,Project,strAmount,Activity)
'"Project Costing > Interactive Reports > Manager Transaction Review"

Dim appAmount
With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("Manager Transaction Review")
	If .WebEdit("Businessunit").Exist(nminwait) Then
		.WebEdit("Businessunit").Set businessunit
		WriteToReport micPass," Business unit"," Businessunit is present and entered as["&Businessunit&"]",false
	else: WriteToReport micfail,"Businessunit ","Businessunit field isn't present",true
	End If
	
	If .WebEdit("Project").Exist(nminwait) Then
		.WebEdit("Project").Set project
		WriteToReport micPass," Project "," Project is present and entered as["&Project&"]",false
	else: WriteToReport micfail,"Project  ","Project field isn't present",true
	End If
	If Not IsEmpty(Activity) Then
	if Activity <> "" Then
		If .WebEdit("Activity").Exist(nminwait) and Activity<>"" Then
			.WebEdit("Activity").Set Activity
			WriteToReport micPass," Activity "," Activity is present and entered as["&Activity&"]",false
		else
			WriteToReport micfail,"Activity","Activity field isn't present",true
		End If
	End If
	End if
	
	
	If .WebButton("Search").Exist(nminwait) Then
	.WebButton("Search").Click
	WriteToReport micPass," Search "," Search button is present and clicked",false
	else: WriteToReport micfail,"Search  ","search field isn't present",true
	End If
	
	'wait for the objects to get loaded
	app_SearchSync()
	
	app_searchsync()
	Browser("PeopleSoft Browser").Sync
	If .WebElement("Revenue review").Exist(nminwait) Then
		.WebElement("Revenue review").Click
		Browser("PeopleSoft Browser").Sync
	End If
End  With 
With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("Manager Transaction Review").WebTable("RevenueReviewLast6cols")
	If .Exist(nMINWAIT) Then
		For i=1 to .RowCount
			appDate=.GetCellData(i,1)
			If CDate(appDate)=Date Then
				appAmount=Cdbl(Replace(Trim(Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("Manager Transaction Review").WebTable("RevenueReviewfst6cols").GetCellData(1,5) ),"$",""))
				If Cint(appAmount)=Cint(strAmount) Then
					WriteToReport micPass,"Amount validation done","Expense amount is matched in Project Costing",false    
					Exit for
					Else
					Reporter.ReportEvent micFail,"The Expense details","are not present in the Manage Transcation review Table",true
					Exit For
				End If
			End  If
		Next
	End If
End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Creating a GL journal entry based on using a specific account and dept combination. Used for test PC_1.65
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>April 24, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CreateGLJournalEntryWithInServiceProject

	GetAccountAndDeptDataNonActiveProject "CreateGLJournalEntryWithInServiceProject"

	'Step 1 - 	'Call our GL function to create the journal. Should fail.
	SharedCreateAddJournal "CreateGLJournalEntryWithInServiceProject", True	
End Function

'**************************************************************************************************************
''' <summary> 
''' Creating a GL journal entry based on using a specific account and dept combination. Used for test PC_1.66
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>April 24, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CreateGLJournalEntryWithClosedProject

	GetAccountAndDeptDataNonActiveProject "CreateGLJournalEntryWithClosedProject"

	'Step 1 - 	'Call our GL function to create the journal. Should fail.
	SharedCreateAddJournal "PCJournalEntryWithSpecificProject", True
End Function

'**************************************************************************************************************
''' <summary> 
''' Helper function to determine account and deptID combinations for projects that aren't active
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>April 25, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function GetAccountAndDeptDataNonActiveProject(functionName)
	Dim sRunID
	Dim nResult
	Dim strSQL, arrRecordValues, arrTemp()

	'Run our SQL query
	'GlobalDictionary("ProjectStatus") = "P"
	strSQL = "SELECT TOP 1 * FROM PS_PROJECT_STATUS WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND PROJECT_STATUS = '" & GlobalDictionary("ProjectStatus") & "' ORDER BY EFFDT DESC"

	WriteToReport micDone, functionName & " - PS_PROJECT_STATUS SQL Query", "Query being used is " & strSQL, False

	'Get the first journal that meets our criteria, exit if none found
	arrRecordValues = dbGetFirstRecord(strSQL, "", arrTemp, functionName)
	nResult = -1

	On Error Resume Next
	nResult = UBound(arrRecordValues)
	On Error GoTo 0
	If nResult >= 0 Then
		WriteToReport micPass, functionName & " - PS_PROJECT_STATUS SQL results", "Results found", False
	Else
		WriteToReport micFail, functionName & " - PS_PROJECT_STATUS SQL results", "No results found. Exiting test.", False
		ExitTest
	End If

	'GlobalDictionary("BusinessUnit") = arrRecordValues(0)
	GlobalDictionary("ProjectID") = arrRecordValues(1)

	'Run our second SQL query
	strSQL = "SELECT PROJECT_TYPE, * FROM PS_PROJECT WHERE PROJECT_ID = '" & GlobalDictionary("ProjectID") & "'"
	WriteToReport micDone, functionName & " - PS_PROJECT SQL Query", "Query being used is " & strSQL, False

	'Get the first journal that meets our criteria, exit if none found
	Erase arrRecordValues
	Erase arrTemp
	arrRecordValues = dbGetFirstRecord(strSQL, "", arrTemp, functionName)
	nResult = -1

	On Error Resume Next
	nResult = UBound(arrRecordValues)
	On Error GoTo 0
	If nResult >= 0 Then
		WriteToReport micPass, functionName & " - PS_PROJECT SQL results", "Results found", False
	Else
		WriteToReport micFail, functionName & " - PS_PROJECT SQL results", "No results found. Exiting test.", False
		ExitTest
	End If

	GlobalDictionary("ProjectType") = arrRecordValues(0)

	strSQL = "SELECT TOP 1 * FROM PS_COMBO_DATA_TBL WHERE PROJECT_ID = '" & GlobalDictionary("ProjectID") & "'"
	WriteToReport micDone, functionName & " - PS_COMBO_DATA_TBL SQL Query", "Query being used is " & strSQL, False

	'If needed, grab Account and Dept data. Not always required.
	If UCase(GlobalDictionary("ProjectStatus")) <> "C" Then

		'Get the first journal that meets our criteria, exit if none found
		Erase arrRecordValues
		Erase arrTemp
		arrRecordValues = dbGetFirstRecord(strSQL, "", arrTemp, functionName)
		nResult = -1

		On Error Resume Next
		nResult = UBound(arrRecordValues)
		On Error GoTo 0
		If nResult >= 0 Then
			WriteToReport micPass, functionName & " - PS_COMBO_DATA_TBL SQL results", "Results found", False
		Else
			WriteToReport micFail, functionName & " - PS_COMBO_DATA_TBL SQL results", "No results found. Exiting test.", False
			ExitTest
		End If

		GlobalDictionary("Account") = arrRecordValues(3)
		GlobalDictionary("Account1") = arrRecordValues(3)
		GlobalDictionary("DeptID") = arrRecordValues(5)
		GlobalDictionary("Dept1") = arrRecordValues(5)
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Driver function to run test PCost_1.35
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>April 30, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function GLMarketingVariousTests
	Dim strSQL, strTemp
	Dim arrRecordValues(), arrResults
	Dim i, nResult, sResults

	'STEP 1 - Call our GL function to create the journal - will fail with data from sheet
	SharedCreateAddJournal "GLMarketingVariousTests", True

	'STEP 2 - Keep data same as before, but get a MISC account project ID
	GlobalDictionary("Code") = "MISC"

	'Build our SQL string
	'strTemp = "SELECT BUSINESS_UNIT, PROJECT_ID, PROJECT_TYPE FROM PS_PROJECT WHERE PROJECT_ID LIKE '" & GlobalDictionary("Code") & "%' AND START_DT >= '01/01/" & Year(Now) & "' AND EFF_STATUS = 'A'"
	strTemp = "SELECT TOP 1 BUSINESS_UNIT, PROJECT_ID, PROJECT_TYPE, * FROM PS_PROJECT WHERE PROJECT_TYPE = '" & GlobalDictionary("Code") & "' AND START_DT >= '01/01/" & Year(Now) & "' AND EFF_STATUS = 'A'"
	WriteToReport micDone, "MISC SQL query", strTemp, False

	'Execute the query
	arrResults = dbGetFirstRecord(strTemp, "", arrRecordValues, "GLMarketingVariousTests")

	If IsArray(arrResults) Then
		WriteToReport micPass, "GetAccountAndDeptData", "SQL query returned Business Unit " & arrResults(0) & ", Project ID " & arrResults(1) & ", and Project Type " & arrResults(2), False
	Else
		WriteToReport micFail, "GetAccountAndDeptData", "No data found. Check SQL query. Exiting test.", False
		ExitTest
	End If

	'If still here, store our values for future use. Sometimes we store two keys depending on which test case calls this function
	GlobalDictionary("BusinessUnit") = arrResults(0)
	GlobalDictionary("PCBUSUnit") = GlobalDictionary("BusinessUnit")
	GlobalDictionary("ProjectID") = arrResults(1)
	GlobalDictionary("ProjectType") = arrResults(2)

	'Create our new journal
	SharedCreateAddJournal "GLMarketingVariousTests", True

	'Cleanup
	Erase arrResults
	Erase arrRecordValues
	GlobalDictionary("BusinessUnit") = ""
	GlobalDictionary("PCBUSUnit") = ""
	GlobalDictionary("ProjectID") = ""
	GlobalDictionary("ProjectType") = ""

	'STEP 3 - Keep data same as before, but get a CAPEX account project ID
	GlobalDictionary("Code") = "CAPEX"

	'Build our SQL string
	'strTemp = "SELECT BUSINESS_UNIT, PROJECT_ID, PROJECT_TYPE FROM PS_PROJECT WHERE PROJECT_ID LIKE '" & GlobalDictionary("Code") & "%' AND START_DT >= '01/01/" & Year(Now) & "' AND EFF_STATUS = 'A'"
	strTemp = "SELECT TOP 1 BUSINESS_UNIT, PROJECT_ID, PROJECT_TYPE, * FROM PS_PROJECT WHERE PROJECT_TYPE = '" & GlobalDictionary("Code") & "' AND START_DT >= '01/01/" & Year(Now) & "' AND EFF_STATUS = 'A'"
	WriteToReport micDone, "MISC SQL query", strTemp, False

	'Execute the query
	arrResults = dbGetFirstRecord(strTemp, "", arrRecordValues, "GLMarketingVariousTests")

	If IsArray(arrResults) Then
		WriteToReport micPass, "GetAccountAndDeptData", "SQL query returned Business Unit " & arrResults(0) & ", Project ID " & arrResults(1) & ", and Project Type " & arrResults(2), False
	Else
		WriteToReport micFail, "GetAccountAndDeptData", "No data found. Check SQL query. Exiting test.", False
		ExitTest
	End If

	'If still here, store our values for future use. Sometimes we store two keys depending on which test case calls this function
	GlobalDictionary("BusinessUnit") = arrResults(0)
	GlobalDictionary("PCBUSUnit") = GlobalDictionary("BusinessUnit")
	GlobalDictionary("ProjectID") = arrResults(1)
	GlobalDictionary("ProjectType") = arrResults(2)

	'Create our new journal
	SharedCreateAddJournal "GLMarketingVariousTests", True

	'Cleanup
	Erase arrResults
	Erase arrRecordValues
	GlobalDictionary("BusinessUnit") = ""
	GlobalDictionary("PCBUSUnit") = ""
	GlobalDictionary("ProjectID") = ""
	GlobalDictionary("ProjectType") = ""

	'STEP 4 - Keep data same as before, but get a MKT account project ID
	GlobalDictionary("Code") = "MKT"

	'Get accurate project, account, and dept data
	GetAccountAndDeptData

	'We know which function we're calling and we don't need to use this flag
	GlobalDictionary("Project") = ""

	'Create our new journal
	SharedCreateAddJournal "GLMarketingVariousTests", False

	'Submit our journal for approval
	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Click on the Approval link to switch tabs
		.Link("Approval").Click
		Browser("Peoplesoft Browser").Sync

		'If not, then click Submit
		.WebButton("Submit").Click
		Browser("Peoplesoft Browser").Sync
	End With

	'Process(post) our journal
	SharedProcessJournal "GLMarketingVariousTests", False

	'Log out of CDW_BATCH and back in as our original user
	Login GlobalDictionary("SignInUser")

	'Review our journal status. Confirm it is posted and valid
	ReviewJournalStatus

	'Cleanup
	GlobalDictionary("BusinessUnit") = ""
	GlobalDictionary("PCBUSUnit") = ""
	GlobalDictionary("ProjectID") = ""
	GlobalDictionary("ProjectType") = ""
End Function

'**************************************************************************************************************
''' <summary> 
''' Driver function to run test PCost_1.36
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>April 30, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function GLCapexVariousTests
	Dim strSQL, strTemp
	Dim arrRecordValues(), arrResults
	Dim i, nResult, sResults

	'STEP 1 - Call our GL function to create the journal - will fail with data from sheet
	SharedCreateAddJournal "GLMarketingVariousTests", True

	'STEP 2 - Keep data same as before, but get a MISC account project ID
	GlobalDictionary("Code") = "MISC"

	'Build our SQL string
	'strTemp = "SELECT BUSINESS_UNIT, PROJECT_ID, PROJECT_TYPE FROM PS_PROJECT WHERE PROJECT_ID LIKE '" & GlobalDictionary("Code") & "%' AND START_DT >= '01/01/" & Year(Now) & "' AND EFF_STATUS = 'A'"
	strTemp = "SELECT TOP 1 BUSINESS_UNIT, PROJECT_ID, PROJECT_TYPE, * FROM PS_PROJECT WHERE PROJECT_TYPE = '" & GlobalDictionary("Code") & "' AND START_DT >= '01/01/" & Year(Now) & "' AND EFF_STATUS = 'A'"
	WriteToReport micDone, "MISC SQL query", strTemp, False

	'Execute the query
	arrResults = dbGetFirstRecord(strTemp, "", arrRecordValues, "GLMarketingVariousTests")

	If IsArray(arrResults) Then
		WriteToReport micPass, "GetAccountAndDeptData", "SQL query returned Business Unit " & arrResults(0) & ", Project ID " & arrResults(1) & ", and Project Type " & arrResults(2), False
	Else
		WriteToReport micFail, "GetAccountAndDeptData", "No data found. Check SQL query. Exiting test.", False
		ExitTest
	End If

	'If still here, store our values for future use. Sometimes we store two keys depending on which test case calls this function
	GlobalDictionary("BusinessUnit") = arrResults(0)
	GlobalDictionary("PCBUSUnit") = GlobalDictionary("BusinessUnit")
	GlobalDictionary("ProjectID") = arrResults(1)
	GlobalDictionary("ProjectType") = arrResults(2)

	'Create our new journal
	SharedCreateAddJournal "GLMarketingVariousTests", True

	'Cleanup
	Erase arrResults
	Erase arrRecordValues
	GlobalDictionary("BusinessUnit") = ""
	GlobalDictionary("PCBUSUnit") = ""
	GlobalDictionary("ProjectID") = ""
	GlobalDictionary("ProjectType") = ""

	'STEP 3 - Keep data same as before, but get a CAPEX account project ID
	GlobalDictionary("Code") = "DIRMK"

	'Build our SQL string
	'strTemp = "SELECT BUSINESS_UNIT, PROJECT_ID, PROJECT_TYPE FROM PS_PROJECT WHERE PROJECT_ID LIKE '" & GlobalDictionary("Code") & "%' AND START_DT >= '01/01/" & Year(Now) & "' AND EFF_STATUS = 'A'"
	strTemp = "SELECT TOP 1 BUSINESS_UNIT, PROJECT_ID, PROJECT_TYPE, * FROM PS_PROJECT WHERE PROJECT_TYPE = '" & GlobalDictionary("Code") & "' AND START_DT >= '01/01/" & Year(Now) & "' AND EFF_STATUS = 'A'"
	WriteToReport micDone, "Marketing SQL query", strTemp, False

	'Execute the query
	arrResults = dbGetFirstRecord(strTemp, "", arrRecordValues, "GLMarketingVariousTests")

	If IsArray(arrResults) Then
		WriteToReport micPass, "GetAccountAndDeptData", "SQL query returned Business Unit " & arrResults(0) & ", Project ID " & arrResults(1) & ", and Project Type " & arrResults(2), False
	Else
		WriteToReport micFail, "GetAccountAndDeptData", "No data found. Check SQL query. Exiting test.", False
		ExitTest
	End If

	'If still here, store our values for future use. Sometimes we store two keys depending on which test case calls this function
	GlobalDictionary("BusinessUnit") = arrResults(0)
	GlobalDictionary("PCBUSUnit") = GlobalDictionary("BusinessUnit")
	GlobalDictionary("ProjectID") = arrResults(1)
	GlobalDictionary("ProjectType") = arrResults(2)

	'Create our new journal
	SharedCreateAddJournal "GLMarketingVariousTests", True

	'Cleanup
	Erase arrResults
	Erase arrRecordValues
	GlobalDictionary("BusinessUnit") = ""
	GlobalDictionary("PCBUSUnit") = ""
	GlobalDictionary("ProjectID") = ""
	GlobalDictionary("ProjectType") = ""

	'STEP 4 - Keep data same as before, but get a Capex account project ID
	GlobalDictionary("Code") = "CAPEX"

'	'Get accurate project, account, and dept data
'	'GetAccountAndDeptData
'
'	'We know which function we're calling and we don't need to use this flag
'	GlobalDictionary("Project") = ""

	'Build our SQL string
	strTemp = "SELECT TOP 1 BUSINESS_UNIT, PROJECT_ID, PROJECT_TYPE, * FROM PS_PROJECT WHERE PROJECT_TYPE = '" & GlobalDictionary("Code") & "' AND START_DT >= '01/01/" & Year(Now) & "' AND EFF_STATUS = 'A'"
	WriteToReport micDone, "Capex SQL query", strTemp, False

	'Execute the query
	arrResults = dbGetFirstRecord(strTemp, "", arrRecordValues, "GLMarketingVariousTests")

	If IsArray(arrResults) Then
		WriteToReport micPass, "GetAccountAndDeptData", "SQL query returned Business Unit " & arrResults(0) & ", Project ID " & arrResults(1) & ", and Project Type " & arrResults(2), False
	Else
		WriteToReport micFail, "GetAccountAndDeptData", "No data found. Check SQL query. Exiting test.", False
		ExitTest
	End If

	'If still here, store our values for future use. Sometimes we store two keys depending on which test case calls this function
	GlobalDictionary("BusinessUnit") = arrResults(0)
	GlobalDictionary("PCBUSUnit") = GlobalDictionary("BusinessUnit")
	GlobalDictionary("ProjectID") = arrResults(1)
	GlobalDictionary("ProjectType") = arrResults(2)

	'Create our new journal
	SharedCreateAddJournal "GLMarketingVariousTests", False

	'Submit our journal for approval
	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Click on the Approval link to switch tabs
		.Link("Approval").Click
		Browser("Peoplesoft Browser").Sync

		'If not, then click Submit
		.WebButton("Submit").Click
		Browser("Peoplesoft Browser").Sync
	End With

	'Process(post) our journal
	SharedProcessJournal "GLMarketingVariousTests", False

	'Log out of CDW_BATCH and back in as our original user
	Login GlobalDictionary("SignInUser")

	'Review our journal status. Confirm it is posted and valid
	ReviewJournalStatus

	'Cleanup
	Erase arrResults
	Erase arrRecordValues
	GlobalDictionary("BusinessUnit") = ""
	GlobalDictionary("PCBUSUnit") = ""
	GlobalDictionary("ProjectID") = ""
	GlobalDictionary("ProjectType") = ""
End Function

'**************************************************************************************************************
''' <summary> 
''' Driver function for test PCost_1.31
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>May 1, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function EmployeeExpenseInvalidCombination
	TravelExpenseCenterCreateExpenseReport "EmployeeExpenseInvalidCombination"
End Function

'**************************************************************************************************************
''' <summary> 
''' Shared function to create our Travel And Expenses expense reports
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>May 1, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function TravelExpenseCenterCreateExpenseReport(functionName)
	Dim arrResults

	'Determine our Employee ID based off of our sign-in name
	arrResults = dbFindEMPLIDByOPRID(GlobalDictionary("SignInUser"))

	'Navigate to Travel and Expenses > Travel and Expense Center > Expense Report > Create/Modify
	If SelectMainMenu1(GlobalDictionary("ExpReportCreate")) = True Then
		WriteToReport micPass, functionName, "On the Create/Modify page.", False
	Else
		WriteToReport micFail, functionName, "Navigation to Create/Modify page failed. Exiting test.", True
		ExitTest
	End If

	'Use our OR to enter our fields
	With Browser("PeopleSoft Browser").Page("Create/Modify_TE").PSFrame("TargetContent")

		'Set our employee ID
		.WebEdit("EmployeeID").Set arrResults(0)

		'Click "Add"
		.WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Enter description
		.WebEdit("ReportDescription").Set GlobalDictionary("Description")

		'Enter Business Purpose
		.WebList("BusinessPurpose").Select GlobalDictionary("BusinessPurpose")

		'Enter Expense Type
		.WebList("ExpenseType").Select GlobalDictionary("ExpenseType")

		'Enter Date
		.WebEdit("Date").Set Date

		'Enter our Currency
		.WebEdit("Currency").Set GlobalDictionary("Currency")

		'Enter our Amount
		.WebEdit("Amount").Set GlobalDictionary("Amount")

		'Enter our Payment Type
		.WebList("PaymentType").Select GlobalDictionary("PaymentType")

		'Enter our Billing Type
		.WebList("BillingType").Select GlobalDictionary("BillingType")

		'Click to Expand and enter Project Data if needed
		If GlobalDictionary("ProjectData") <> "" Then

			'Click the "Expand Accounting Lines" image
			.Image("Expand Accounting Lines").Click
			Browser("PeopleSoft Browser").Sync

			'Enter our PCBusiness Unit
			.WebEdit("PCBusinessUnit").Set GlobalDictionary("PCBusinessUnit")

			'Enter our Project ID
			If GlobalDictionary("ProjectID") <> "" Then
				.WebEdit("ProjectID").Set GlobalDictionary("ProjectID")
			Else
				.Image("Look up Project").Click
				Browser("PeopleSoft Browser").Sync

				'Filter by our project type
				Browser("PeopleSoft Browser").Page("Create/Modify_TE").PSFrame("Look Up Project").WebEdit("ProjectID").Set GlobalDictionary("ProjectType")
				Browser("PeopleSoft Browser").Page("Create/Modify_TE").PSFrame("Look Up Project").WebButton("Look Up").Click
				Browser("PeopleSoft Browser").Sync

				'Click the first link
				Browser("PeopleSoft Browser").Page("Create/Modify_TE").PSFrame("Look Up Project").Link("FirstResult").Click
				Browser("PeopleSoft Browser").Sync
			End If

			'Enter our Dept ID if any1
			If GlobalDictionary("DeptID") <> "" Then
				.WebEdit("DeptID").Set GlobalDictionary("DeptID")
			Else
				.Image("Look up Dept").Click
				Browser("PeopleSoft Browser").Sync
				GlobalDictionary("DeptID") = Browser("PeopleSoft Browser").Page("Create/Modify_TE").PSFrame("Look Up Dept").Link("FirstResult").GetROProperty("text")
				Browser("PeopleSoft Browser").Page("Create/Modify_TE").PSFrame("Look Up Dept").Link("FirstResult").Click
				Browser("PeopleSoft Browser").Sync
			End If

			'Enter our Activity
			If GlobalDictionary("Activity") <> "" Then
				.WebEdit("Activity").Set GlobalDictionary("Activity")
			Else
				.Image("Look up Activity").Click
				Browser("PeopleSoft Browser").Sync
				GlobalDictionary("Activity") = Browser("PeopleSoft Browser").Page("Create/Modify_TE").PSFrame("Look Up Activity").Link("FirstResult").GetROProperty("text")
				Browser("PeopleSoft Browser").Page("Create/Modify_TE").PSFrame("Look Up Activity").Link("FirstResult").Click
				Browser("PeopleSoft Browser").Sync
			End If
		End If

		'Enter Description
		.WebEdit("Description").Set GlobalDictionary("Description")

		'Enter Location 
		.WebEdit("Location").Set GlobalDictionary("Location")

		'Enter Merchant if test calls for it
		If .WebEdit("Merchant").Exist(5) AND GlobalDictionary("Merchant") <> "" Then
			.WebEdit("Merchant").Set GlobalDictionary("Merchant")
		End If

		'Click Summary and Submit link
		.Link("Summary and Submit").Click
		Browser("PeopleSoft Browser").Sync
		WriteToReport micPass, functionName, "Clicked on the Summary and Submit link", False

		'Click Expense Confirmation checkbox if not already clicked
		If .WebCheckBox("Submit").GetROProperty("checked") = 0 Then
			.WebCheckBox("Submit").Click
			Wait 1
		End If

		'Click Submit Expense Report button
		.WebButton("Submit Expense Report").Click
		Browser("PeopleSoft Browser").Sync
		WriteToReport micPass, functionName, "Clicked on Submit Expense Report button", False

		'Validate our error message
		If .Image("Missing or invalid information").Exist(5) Then
			If GlobalDictionary("NegativeTest") <> "" Then
				WriteToReport micPass, functionName & " - Error Checking", "'Missing or invalid information' error message appears", False
			Else
				WriteToReport micFail, functionName & " - Error Checking", "'Missing or invalid information' error message appears. Check data.", True
				ExitTest
			End If
		Else
			If GlobalDictionary("NegativeTest") <> "" Then
				WriteToReport micFail, functionName & " - Error Checking", "'Missing or invalid information' error message did not appear. Check data.", True
				ExitTest
			Else
				WriteToReport micPass, functionName & " - Error Checking", "'Missing or invalid information' error message did not appear", False
			End If
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Driver function for tests PCost_1.32 and PCost_1.33
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>May 3, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function EmployeeExpenseMultipleProjects
	Dim i, nResult
	Dim strTemp
	Dim arrResults, arrRecordValues()

	TravelExpenseCenterCreateExpenseReport "EmployeeExpenseMultipleProjects"

	For i = 1 To 3

		'Use our OR to enter our fields
		With Browser("PeopleSoft Browser").Page("Create/Modify_TE").PSFrame("TargetContent")

			'Enter our business unit
			.WebEdit("GLBusinessUnit").Set GlobalDictionary("BusinessUnit")

			'Enter our PCBusiness Unit
			.WebEdit("PCBusinessUnit").Set GlobalDictionary("PCBusinessUnit")

			'Enter our Project ID
			If GlobalDictionary("ProjectID" & i) <> "" Then
				.WebEdit("ProjectID").Set GlobalDictionary("ProjectID" & i)
			Else
				.Image("Look up Project").Click
				Browser("PeopleSoft Browser").Sync
				Browser("PeopleSoft Browser").Page("Create/Modify_TE").PSFrame("Look Up Project").Link("FirstResult").Click
				Browser("PeopleSoft Browser").Sync			
			End If

			'Enter our Dept ID if any1
			If GlobalDictionary("DeptID" & i) <> "" Then
				.WebEdit("DeptID").Set GlobalDictionary("DeptID" & i)
			Else
				.Image("Look up Dept").Click
				Browser("PeopleSoft Browser").Sync
				Browser("PeopleSoft Browser").Page("Create/Modify_TE").PSFrame("Look Up Dept").Link("FirstResult").Click
				Browser("PeopleSoft Browser").Sync
			End If

			'Enter our Activity
			If GlobalDictionary("Activity") <> "" Then
				.WebEdit("Activity").Set GlobalDictionary("Activity")
			Else
				.Image("Look up Activity").Click
				Browser("PeopleSoft Browser").Sync
				Browser("PeopleSoft Browser").Page("Create/Modify_TE").PSFrame("Look Up Activity").Link("FirstResult").Click
				Browser("PeopleSoft Browser").Sync
			End If

			'Click Summary and Submit link
			.Link("Summary and Submit").Click
			Browser("PeopleSoft Browser").Sync
			WriteToReport micPass, functionName, "Clicked on the Summary and Submit link", False

			'Add a validation for In-Service projects
			If Browser("PeopleSoft Browser").Page("Create/Modify_TE").WebElement("html id:=ptModContent.*").Exist(5) Then
				If InStr(1, Browser("PeopleSoft Browser").Page("Create/Modify_TE").WebElement("html id:=ptModContent.*").GetROProperty("innertext"), "In-Service", vbTextCompare) Then
					Browser("PeopleSoft Browser").Page("Create/Modify_TE").WebButton("html id:=#ICOK").Click
					Browser("PeopleSoft Browser").Sync
					.WebEdit("ProjectID").Set ""
				End If
			End If

			'Click Expense Confirmation checkbox if not already clicked
			If .WebCheckBox("Submit").GetROProperty("checked") = 0 Then
				.WebCheckBox("Submit").Click
				Wait 1
			End If

			'Click Submit Expense Report button
			.WebButton("Submit Expense Report").Click
			Browser("PeopleSoft Browser").Sync
			WriteToReport micPass, "EmployeeExpenseMultipleProjects", "Clicked on Submit Expense Report button", False

			'Validate our error message
			If .Image("Missing or invalid information").Exist(5) Then
				If i <> 3 Then
					WriteToReport micPass, "EmployeeExpenseMultipleProjects - Error Checking", "'Missing or invalid information' error message appears", False
				Else
					WriteToReport micFail, "EmployeeExpenseMultipleProjects - Error Checking", "'Missing or invalid information' error message appears. Check data.", True
					ExitTest
				End If
			Else
				If i <> 3 Then
					WriteToReport micFail, "EmployeeExpenseMultipleProjects - Error Checking", "'Missing or invalid information' error message did not appear. Check data.", True
					ExitTest
				Else
					WriteToReport micPass, "EmployeeExpenseMultipleProjects - Error Checking", "'Missing or invalid information' error message did not appear", False
				End If
			End If
		End With
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Driver function for tests PCost_1.19 and PCost_1.20
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>May 7, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function EmployeeExpenseSingleProjectsWithApproval
	Dim strTemp

	'Call our function to create our Expense Report
	TravelExpenseCenterCreateExpenseReport "EmployeeExpenseSingleProjectsWithApproval"

	'Click OK to submit after confirming it exists
	Browser("PeopleSoft Browser").Page("Create/Modify_TE").PSFrame("Expense Report Submit").WebButton("OK").Click
	Browser("PeopleSoft Browser").Sync

	'Get our web element with the Expense Report ID in it - split on " " - EG, 0000820847
	Wait 60
	strTemp = Browser("PeopleSoft Browser").Page("Create/Modify_TE").PSFrame("Expense Report Inquiry").WebElement("ExpenseReportSubmitted").GetROProperty("innertext")
	GlobalDictionary("TransactionID") = Split(strTemp, " ")(3)
	GlobalDictionary("TransactionID") = Trim(GlobalDictionary("TransactionID"))

	'Call our Approve Transaction function
	'TravelExpenseCenterApproveTransaction
	GlobalDictionary("ExpenseReportID") = GlobalDictionary("TransactionID")
	ApproveExpenseReport

	'New validation post-review - confirm that our expense report is fully approved and submitted.
	Login(GlobalDictionary("SignInUser"))

	'Navigate to Travel and Expenses>Expense Report > View
	If SelectMainMenu1(GlobalDictionary("EXViewReports")) = True Then
		WriteToReport micPass, "EmployeeExpenseSingleProjectsWithApproval - View Page", "On the View page.", False
	Else
		WriteToReport micFail, "EmployeeExpenseSingleProjectsWithApproval - View Page", "Navigation to View page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("View").PSFrame("TargetContent")
		.WebEdit("ReportID").Set GlobalDictionary("TransactionID")
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'ID is SEARCH_RESULT1
		'innertext is GlobalDictionary("TransactionID")
		'status link is RESULT4$0
		'innertext is status. Submitted, Pending, Staged, etc.

		'WebElement("html id:=EX_ICLIENT_WRK_REPORT_NUM_STATUS) is status if the others don't exist
		'One entry might go directly to the page
		If .Link("html id:=SEARCH_RESULT1").Exist(5) Then
			strTemp = Trim(.Link("html id:=SEARCH_RESULT1").GetROProperty("Innertext"))
			If strTemp = "Approved" Then
				WriteToReport micPass, "EmployeeExpenseSingleProjectsWithApproval", "Expense status is 'Approved'", False
			Else
				WriteToReport micFail, "EmployeeExpenseSingleProjectsWithApproval", "Expense status is '" & strTemp & "', expecting 'Approved'", False
				ExitTest
			End If
		ElseIf .Webelement("html id:=EX_ICLIENT_WRK_REPORT_NUM_STATUS").Exist(5) Then
			strTemp = Trim(.Webelement("html id:=EX_ICLIENT_WRK_REPORT_NUM_STATUS").GetROProperty("Innertext"))
			If InStr(1, strTemp,  "Approved for Payment", vbTextCompare) Then
				WriteToReport micPass, "EmployeeExpenseSingleProjectsWithApproval", "Expense status is 'Approved for Payment'", False
			Else
				WriteToReport micFail, "EmployeeExpenseSingleProjectsWithApproval", "Expense status is '" & strTemp & "', expecting 'Approved for Payment'", False
				ExitTest
			End If
		End If
	End With

	'Log in as Process user if not already- EG, AIDESEG
	If GlobalDictionary("TEProcessing") <> "" Then
		Login(GlobalDictionary("TEProcessing"))
	End If

	ExpenseTransactionProcessingPost "EmployeeExpenseSingleProjectsWithApproval"

	'Log in as a user with Project Costing rights. RINIDAT, GWENCHO, etc
	'If GlobalDictionary("SignInUser") <> "" Then
	Login(GlobalDictionary("SignInUser"))
	'End If

	ProjectCostingCostCollectionExpenses

	ProjectCostingManagerTransactionReview

	RunExpenseExtractOutboundProcess
End Function

'**************************************************************************************************************
''' <summary> 
''' Approve our created Travel And Expense Center expense reports
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>May 7, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function TravelExpenseCenterApproveTransaction

	'Log in as approval user if not already- EG, FRANDVO
	If GlobalDictionary("TEApprover") <> "" Then
		Login(GlobalDictionary("TEApprover"))
	End If

	'Navigate to Travel and Expenses > Approve Transactions > Approve Transactions
	If SelectMainMenu1(GlobalDictionary("ApproveTransaction")) = True Then
		WriteToReport micPass, "TravelExpenseCenterApproveTransaction", "On the Approve Transactions page.", False
	Else
		WriteToReport micFail, "TravelExpenseCenterApproveTransaction", "Navigation to Approve Transactions page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions")

		'Click on Expense Reports webelement
		.WebElement("Expense Reports").Click
		Browser("PeopleSoft Browser").Sync

		'Click on Search icon
		.Image("Search Pending Transactions_ExporCollapse").Click
		Browser("PeopleSoft Browser").Sync

		'Filter based on Transaction ID
		'Select Column Name from weblist
		.WebList("COLUMN NAME").Select "Transaction ID"

		'Set our expression
		.WebList("EXPRESSION").Select "="

		'Enter our Transaction ID
		.WebEdit("TransactionID").Set GlobalDictionary("TransactionID")

		'Click Search
		.Webbutton("Search").Click
		Browser("PeopleSoft Browser").Sync
	End  With
	
	With Browser("PeopleSoft Browser").Page("Approve Transactions_TE")

		'Validate that we have search results
		If .PSFrame("Approve Transactions").Link("TransactionLink").Exist(5) Then
			WriteToReport micPass, "TravelExpenseCenterApproveTransaction", "Transaction ID found. Clicking link.", False
		Else
			WriteToReport micFail, "TravelExpenseCenterApproveTransaction", "Link with Transaction ID " & GlobalDictionary("TransactionID") & " not found. Exiting Test.", True
			ExitTest
		End If

		'If still here, click our result link
		.PSFrame("Approve Transactions").Link("TransactionLink").Click
		Browser("PeopleSoft Browser").Sync

		'Click Verify
		.PSFrame("Approve Expense Report").WebButton("Verify Receipt").Click
		Browser("PeopleSoft Browser").Sync

		'Click OK
		.PSFrame("Save Confirmation").WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync
	End  With
End Function

'**************************************************************************************************************
''' <summary> 
''' Run our Project Costing Cost Collection Expenses process
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>May 8, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function ProjectCostingCostCollectionExpenses
	Dim sRunID
	Dim arrTemp

	'Navigate to Project Costing > Cost Collection > Expenses
	If SelectMainMenu1(GlobalDictionary("PCostExpenses")) = True Then
		WriteToReport micPass, "ProjectCostingCostCollectionExpenses", "On the Expenses page.", False
	Else
		WriteToReport micFail, "ProjectCostingCostCollectionExpenses", "Navigation to Expenses page failed. Exiting test.", True
		ExitTest
	End If

	'Use our OR
	With Browser("PeopleSoft Browser").Page("ProjCost_Expenses")

		'Create our run ID
		sRunId = "Auto" & CLng(Timer)
	    WriteToReport micDone, "Run control ID", sRunID, False

		'Click to Add A New value
		.PSFrame("TargetContent").Link("Add a New Value").Click
		Browser("PeopleSoft Browser").Sync

		'Create our new Run ID
		.PSFrame("TargetContent").WebEdit("RunID").Set sRunId
		.PSFrame("TargetContent").WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Enter our Option selection
		.PSFrame("TargetContent").WebList("Option").Select GlobalDictionary("Option")	'EG, All

		'Enter our Date Option selection
		.PSFrame("TargetContent").WebList("DateOption").Select GlobalDictionary("DateOption")	'EG, All

		'Click the Save button
		.PSFrame("TargetContent").WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Click the Run button
		.PSFrame("TargetContent").WebButton("Run").Click
		Browser("PeopleSoft Browser").Sync

		'Make sure our process is selected to run
		.PSFrame("Process Scheduler Request").WebCheckBox("Process").Set "ON"
		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync

		'Store our process name	
		GlobalDictionary("Process") = "PC_EX_TO_PC"

		'Store our process instance
		arrTemp = Split(.PSFrame("TargetContent").WebElement("ProcessInstance").GetROProperty("innertext"),":")
		GlobalDictionary("InstanceNumber") = arrTemp(1)
		
		'Click the Process Monitor link to go to the new page
		.PSFrame("TargetContent").Link("Process Monitor").Click
	End With

	'Call our SharedProcessMonitor function
	SharedProcessMonitor "ProjectCostingCostCollectionExpenses"
End Function

'**************************************************************************************************************
''' <summary> 
''' Validate our created expense appears in the Manager Transaction Review page.
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>May 9, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'05/10/2019			Stephen King	Currently unfinished, pending a test step review
'**************************************************************************************************************
Public Function ProjectCostingManagerTransactionReview
	Dim i

	'Navigate to Project Costing > Interactive Reports > Manager Transaction Review
	If SelectMainMenu1(GlobalDictionary("PCManagerReview")) = True Then
		WriteToReport micPass, "ProjectCostingManagerReview", "On the Manager Transaction Review page.", False
	Else
		WriteToReport micFail, "ProjectCostingManagerReview", "Navigation to Manager Transaction Review page failed. Exiting test.", True
		ExitTest
	End If

	'Use our OR
	With Browser("PeopleSoft Browser").Page("Manager Transaction Review")

		'Enter our business unit - required
		.PSFrame("Manager Transaction Review").WebEdit("Businessunit").Set GlobalDictionary("BusinessUnit")

		'Enter our Project ID, if any
		If GlobalDictionary("ProjectID") <> "" Then
			.PSFrame("Manager Transaction Review").WebEdit("Project").Set GlobalDictionary("ProjectID")
			
			'Click Search, which will take us to the Cost Review page
			.PSFrame("Manager Transaction Review").WebButton("Search").Click			
		Else
			'Click the Cost Review link
			.PSFrame("Project Manager Review").Link("Cost Review").Click
		End If

		'Wait for our page to load
		Browser("PeopleSoft Browser").Sync

		'Click the Transaction Date webelement twice to get the most recent entries. This can take a while.
		.PSFrame("Manager Transaction Review").WebElement("TransDate_Asc").Click
		Browser("PeopleSoft Browser").Sync
		.PSFrame("Manager Transaction Review").WebElement("TransDate_Asc").Click
		Browser("PeopleSoft Browser").Sync

		'Check our results table. Should be sorted, but also not sure where it falls due to the number of other transactions processed
		For i = 0 To .PSFrame("Manager Transaction Review").WebTable("DetailsReviewF6Cols").GetROProperty("rows") - 1

			'Compare Accounting Date
			If .WebElement("html id:=ACCOUNTING_DT\$" & i).Exist(1) And Trim(.WebElement("html id:=ACCOUNTING_DT\$" & i).GetROProperty("innertext")) = DateLeadingZeros Then

				'Compare Activity
				If Trim(.WebElement("html id:=ACTIVITY_ID1\$" & i).GetROProperty("innertext")) = GlobalDictionary("Activity") Then

					'Compare Amount
					If InStr(1, .WebElement("html id:=AMOUNT\$" & i).GetROProperty("innertext"), GlobalDictionary("Amount"), vbTextCompare) Then
						WriteToReport micPass, "ProjectCostingManagerReview", "Transaction found.", False
						Exit Function
					End If
				End  If
			End If
		Next

		'If still here, then transaction wasn't found
		WriteToReport micFail, "ProjectCostingManagerReview", "Transaction not found. Check data and previous test steps.", True

		'Project ID - 		.WebElement("html id:=PROJECT_ID\$0").GetROProperty("innertext")
		'ACTIVITY_ID1$0	- EG, COMP_SOFTWARE - .WebElement("html id:=ACTIVITY_ID1\$0").GetROProperty("innertext")
		'AMOUNT$0 - EG, $-30,000.00 - .WebElement("html id:=AMOUNT\$0").GetROProperty("innertext")
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the ExpenseExtractOutbound process on the Expense Extract page
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>May 9, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function RunExpenseExtractOutboundProcess
	Dim sRunID
	Dim arrTemp

	'Navigate to CDW Projects > Expense Extract
	If SelectMainMenu1(GlobalDictionary("ExpenseExtract")) = True Then
		WriteToReport micPass, "RunExpenseExtractOutboundProcess", "On the Expense Extract page.", False
	Else
		WriteToReport micFail, "RunExpenseExtractOutboundProcess", "Navigation to Expense Extract page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Expense Extract")

		'Create our run ID
		sRunId = "Auto" & CLng(Timer)
	    WriteToReport micDone, "Run control ID", sRunID, False

		'Click to Add A New value
		.PSFrame("TargetContent").Link("Add a New Value").Click
		Browser("PeopleSoft Browser").Sync

		'Create our new Run ID
		.PSFrame("TargetContent").WebEdit("RunID").Set sRunId
		.PSFrame("TargetContent").WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Click Run button
		.PSFrame("TargetContent").WebButton("Run").Click
		Browser("PeopleSoft Browser").Sync

		'Set flag(s) as needed
		.PSFrame("Process Scheduler Request").WebCheckBox("MRM Expense Data Outbound").Set "ON"

		'Store our process name
		GlobalDictionary("Process") = .PSFrame("Process Scheduler Request").WebElement("MRM Expense Data Outbound Process").GetROProperty("innertext")

		'Click OK
		.PSFrame("Process Scheduler Request").WebButton("OK").Click

		'Store our process instance
		arrTemp = Split(.PSFrame("Status Bar").WebElement("ProcessInstance").GetROProperty("innertext"),":")
		GlobalDictionary("InstanceNumber") = arrTemp(1)
		
		'Click Process Monitor link
		.PSFrame("Status Bar").Link("Process Monitor").Click
	End With

	'Call our SharedProcessMonitor function
	SharedProcessMonitor "ProjectCostingCostCollectionExpenses"
End Function

'**************************************************************************************************************
''' <summary> 
''' Adds a Transaction to a Project for an Activity determined at runtime
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function AddTransactions
	Dim arrResult, arrTemp
	Dim TransactionID
	Dim nRand
	Const PROJ_COL = 1
	Const ACT_COL = 2
	Const PROCNAME = "PC_WRAPPER"
	Randomize
	'Get Project and Activity
	Select Case GlobalDictionary("TestName")
		Case "PC74_AM_1.01_US_ExpDefn"
			arrResult = dbGetOpenProjAndActivity("")
			GlobalDictionary.Add "ProjectID", arrResult(PROJ_COL)
			GlobalDictionary.Add "ActivityID", arrResult(ACT_COL)
		Case "AM_1.02_US_DfnAndAssign"
			nRand = Int((4)*Rnd)
			arrTemp = Split(GlobalDictionary("Projects"), ",")
			GlobalDictionary("ProjectID") = Replace(arrTemp(nRand), "'", "")
		Case "PC76_AddCostsNextYear","PC77_NewProj_TwoMonthsCosts","PC78_NewProj_TeamMember" 
			'PC76 uses same proj/diff activity as PC74.
			'PC77 runs twice on a new project, second time using the same activity. PCContinued = TRUE second time
			'PC78 is a new project, needs an activity.
			If GlobalDictionary("PCContinued") <> "TRUE" Then
				arrResult = dbGetOpenProjAndActivity(GlobalDictionary("ProjectID"))
				GlobalDictionary("ActivityID") = arrResult(ACT_COL)
			End If
		Case Else 'Already in GlobalDictionary
			WriteToReport micDone, "Using Project ID: "&GlobalDictionary("ProjectID"), "", FALSE
			WriteToReport micDone, "Using Activity ID: "&GlobalDictionary("ActivityID"), "", FALSE
	End Select

	'Navigate to Add Transactions
	If SelectMainMenu1(GlobalDictionary("PCAddTransactions")) Then
		WriteToReport micPass, "Add Transactions Page", "On the Add Transactions page.", FALSE
	Else
		WriteToReport micFail, "Add Transactions Page", "Navigation to Add Transactions page failed. Exiting test.", TRUE
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("AddTransactions").PSFrame("TargetContent")
		'Set Business Unit
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set the Business Unit to: "&GlobalDictionary("BusinessUnit"), "Business Unit Set", FALSE

		'Set Project ID
		.WebEdit("Project").Set GlobalDictionary("ProjectID")
		WriteToReport micDone, "Set the Project ID to: "&GlobalDictionary("ProjectID"), "Project ID Set", FALSE

		'Set Activity ID
		.WebEdit("Activity").Set GlobalDictionary("ActivityID")
		WriteToReport micDone, "Set the Activity ID to: "&GlobalDictionary("ActivityID"), "Activity ID Set", FALSE

		'Click Search
		.WebButton("Search").Click
		WriteToReport micDone, "Clicked the Search Button", "Button Clicked", FALSE

		'Set Analysis Group
		.WebEdit("AnalysisGroup").Set GlobalDictionary("AnalysisGroup")
		WriteToReport micDone, "Set the Analysis Group to: "&GlobalDictionary("AnalysisGroup"), "Analysis Group Set", FALSE

		'Set Analysis Type
		.WebEdit("AnalysisType").Set GlobalDictionary("AnalysisType")
		WriteToReport micDone, "Set the Analysis Type to: "&GlobalDictionary("AnalysisType"), "Analysis Type Set", FALSE

		'Set Quantity
		.WebEdit("Quantity").Set GlobalDictionary("Quantity")
		WriteToReport micDone, "Set the Quantity to: "&GlobalDictionary("Quantity"), "Quantity Set", FALSE

		'Set Unit of Measure
		.WebEdit("UnitOfMeasure").Set GlobalDictionary("UnitOfMeasure")
		WriteToReport micDone, "Set the Unit of Measure to: "&GlobalDictionary("UnitOfMeasure"), "Unit of Measure Set", FALSE

		'Set Source Amount
		If GlobalDictionary("PCContinued") = "TRUE" AND GlobalDictionary("AddSecondTransaction") = "TRUE"  Then
			.WebEdit("SourceAmount").Set GlobalDictionary("SourceAmount2")
			WriteToReport micDone, "Set the Source Amount to: "&GlobalDictionary("SourceAmount2"), "Source Amount Set", FALSE
		Else
			.WebEdit("SourceAmount").Set GlobalDictionary("SourceAmount")
			WriteToReport micDone, "Set the Source Amount to: "&GlobalDictionary("SourceAmount"), "Source Amount Set", FALSE
		End If
		
		'Click Transaction Detail Image
		.Image("TransactionDetail").Click
		WriteToReport micDone, "Clicked the Transaction Detail Image", "Image Clicked", FALSE
	End With

	With Browser("PeopleSoft Browser").Page("TransactionDetail").PSFrame("TargetContent")
		'Set Description
		.WebEdit("Description").Set GlobalDictionary("PCDescription")
		WriteToReport micDone, "Set the Description: "&GlobalDictionary("PCDescription"), "Description Set", FALSE

		'Set Profile ID
		GlobalDictionary("Profile") = ""
		Select Case GlobalDictionary("ActivityID")
			Case "BUILD_IMP"
				GlobalDictionary("Profile") = "BLDG-LT5"
			Case "COMP_HARDWARE"
				GlobalDictionary("Profile") = "CPTRS3"
			Case "EXT_LABOR"
				GlobalDictionary("Profile") = "EXEFF3"
			Case "INT_LABOR"
				GlobalDictionary("Profile") = "INTEFF3"
			Case "FURNITURE"
				GlobalDictionary("Profile") = "FF-HMS-C5"
			Case "LEASE_IMP"
				GlobalDictionary("Profile") = "LEASEHLD"
			Case "MACH_EQUIP"
				GlobalDictionary("Profile") = "ME5"
			Case "COMP_SOFTWARE"
				GlobalDictionary("Profile") = "SOFTWARE3"
			Case Else
				WriteToReport micFail, "No Profile Known for Activity: "&GlobalDictionary("ActivityID"), "Cannot Continue; Please Add Profile or Verify Valid Activity", FALSE
				ExitTest
		End Select
		.WebEdit("ProfileID").Set GlobalDictionary("Profile")
		WriteToReport micDone, "Set Profile ID: "&GlobalDictionary("Profile"), "Profile ID Set", FALSE

		If GlobalDictionary("DatePlusYear") = "TRUE" Then
			'Set Date to 1 Year out
			.WebEdit("TransactionDate").Set AnyDateLeadingZeros(DateSerial(Year(Now)+1, Month(Now)+1, 0))
			.Webedit("AccountingDate").Set AnyDateLeadingZeros(DateSerial(Year(Now)+1, Month(Now)+1, 0))
			WriteToReport micDone, "Set Transaction and Accounting Date to: "&AnyDateLeadingZeros(DateSerial(Year(Now)+1, Month(Now)+1, 0)), "Dates Set", FALSE
		End If

		If GlobalDictionary("DateLastMonth") = "TRUE" Then
			'Set Date to End of Last Month
			.WebEdit("TransactionDate").Set AnyDateLeadingZeros(DateSerial(Year(Now), Month(Now), 0))
			WriteToReport micDone, "Set Transaction Date to: "&AnyDateLeadingZeros(DateSerial(Year(Now), Month(Now), 0)), "Date Set", FALSE
		End If

		'Clear Transaction Type
		.WebEdit("TransactionType").Set ""
		WriteToReport micDone, "Cleared the Transaction Type", "Field Cleared", FALSE

		'Set Account
		.WebEdit("Account").Set GlobalDictionary("Account")
		WriteToReport micDone, "Set Account: "&GlobalDictionary("Account"), "Account Set", FALSE

		'Set Department
		.WebEdit("Department").Set GlobalDictionary("Dept")
		WriteToReport micDone, "Set Department: "&GlobalDictionary("Dept"), "Department Set", FALSE

		'Click Save
		.WebButton("Save").Click
		WriteToReport micDone, "Clicked the Save Button", "Button Clicked", FALSE

		'Click Show All Transaction Details
		.Link("ShowAllTransactionDetails").Click
		WriteToReport micDone, "Clicked the Show All Transaction Details", "Link Clicked", FALSE

		'Note the Transaction ID
		TransactionID = .WebElement("TransactionID").GetROProperty("innertext")
		WriteToReport micDone, "The Transaction ID is: "&TransactionID, "Transaction ID Stored", FALSE

		'Click Return to Transaction Detail
		.Link("ReturnToTransactionDetail").Click
		WriteToReport micDone, "Clicked the Return to Transaction Detail", "Link Clicked", FALSE

		'Click Process Transactions
		.WebButton("ProcessTransactions").Click
		WriteToReport micDone, "Clicked the Process Transactions Button", "Button Clicked", FALSE

		'Click OK
		Browser("PeopleSoft Browser").Page("TransactionDetail").WebButton("OK").Click

		'Click Process Monitor
		.Link("ProcessMonitor").Click
		WriteToReport micDone, "Clicked the Process Monitor", "Link Clicked", FALSE

		'Monitor until Success/Posted
		Call CheckProcessMontiorStatus(PROCNAME)
	End With
End Function
'**************************************************************************************************************
''' <summary> 
''' Creates a Project for PC PC77
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function PCCreateProject
	'Navigate to General Information
	If SelectMainMenu1(GlobalDictionary("GeneralInformation")) Then
		WriteToReport micPass, "General Information Page", "On the General Information page.", FALSE
	Else
		WriteToReport micFail, "General Information Page", "Navigation to General Information page failed. Exiting test.", TRUE
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("GeneralInformation")
		'Click Add a New Value
		.PSFrame("TargetContent").WebElement("GI_AddNewValue").Click
		WriteToReport micDone, "Clicked Add a New Value", "Tab Clicked", FALSE

		'Set BU
		.PSFrame("TargetContent").WebEdit("GI_Add_Businessnit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set the Business Unit to: "&GlobalDictionary("BusinessUnit"), "Business Unit Set", FALSE

		'Select Create
		.PSFrame("TargetContent").WebList("Create").Select GlobalDictionary("Create")
		WriteToReport micDone, "Selected Create Option: "&GlobalDictionary("Create"), "Create Option Selected", FALSE

		'Click Add
		.PSFrame("TargetContent").WebButton("GI_Add").Click
		WriteToReport micDone, "Clicked the Add Button", "Button Clicked", FALSE

		'Set Project Template
		.PSFrame("ProjectGeneral").WebEdit("PG_ProjectTemplate").Set GlobalDictionary("ProjectTemplate")
		WriteToReport micDone, "Set Project Template: "&GlobalDictionary("ProjectTemplate"), "Project Template Set", FALSE

		'Set New Start Date
		.PSFrame("ProjectGeneral").WebEdit("PG_NewStartDate").Set DateLeadingZeros
		WriteToReport micDone, "Set New Start Date: "&DateLeadingZeros, "New Start Date Set", FALSE

		'Click Create
		.PSFrame("ProjectGeneral").WebButton("PG_Create").Click
		WriteToReport micDone, "Clicked the Create Button", "Button Clicked", FALSE

		'Click Asset Integration Rules Tab
		If NOT .PSFrame("ProjectGeneral").WebElement("AssetIntegrationRules").Exist(5) Then
			.PSFrame("ProjectGeneral").Image("ShowFollowingTabs").Click
			If .PSFrame("ProjectGeneral").WebElement("AssetIntegrationRules").Exist(30) Then
				.PSFrame("ProjectGeneral").WebElement("AssetIntegrationRules").Click
				WriteToReport micDone, "Clicked the Asset Integration Rules Tab", "Tab Clicked", FALSE
			Else
				WriteToReport micFail, "Failed to Locate Asset Integration Rules Tab", "Failed to Load Tabs", FALSE
				ExitTest
			End If
		Else
			.PSFrame("ProjectGeneral").WebElement("AssetIntegrationRules").Click
			WriteToReport micDone, "Clicked the Asset Integration Rules Tab", "Tab Clicked", FALSE
		End If

		'Click Asset Integration Rule
		Call .PSFrame("ProjectGeneral").WebElement("AssetIntegrationRule").SetTOProperty("innertext", GlobalDictionary("AssetIntegrationRule"))
		If NOT .PSFrame("ProjectGeneral").WebElement("AssetIntegrationRule").Exist(5) Then
			WriteToReport micFail, "Cannot Locate Asset Integration Rule: "&GlobalDictionary("AssetIntegrationRule"), "Check the Asset Integration Rule", TRUE
			ExitTest
		Else
			.PSFrame("ProjectGeneral").WebElement("AssetIntegrationRule").Click
			WriteToReport micDone, "Clicked the Asset Integration Rule: "&GlobalDictionary("AssetIntegrationRule"), "Clicked the Asset Integration Rule", FALSE
		End If

		'Set Distribution, if applicable
		If GlobalDictionary("Distribution") <> "" Then
			.PSFrame("ProjectGeneral").WebList("Distribution").Select GlobalDictionary("Distribution")
			WriteToReport micDone, "Selected Distribution: "&GlobalDictionary("Distribution"), "Distribution Selected", FALSE
		End If

		'Click Save
		.PSFrame("ProjectGeneral").WebButton("Save").Click
		WriteToReport micDone, "Clicked the Save Button", "Button Clicked", FALSE

		'Note Project ID
		If GlobalDictionary.Exists("ProjectID") Then
       		GlobalDictionary.Remove("ProjectID")
    	End If
    	GlobalDictionary.Add "ProjectID", .PSFrame("ProjectGeneral").WebElement("ProjectID").GetROProperty("innertext")
    	WriteToReport micDone, "Grabbed the Project ID: "&GlobalDictionary("ProjectID"), "Project ID Stored", FALSE
	End With
End Function
'**************************************************************************************************************
''' <summary> 
''' Many to Many Percent Express Asset Definition PC77
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function ManyToManyPercentExpressAssetDefinition
	Dim sIndex, sDate
	'Navigate to Express Asset Definition
	If SelectMainMenu1(GlobalDictionary("ExpressAssetDefinition")) Then
		WriteToReport micPass, "Navigated to the Express Asset Definition Page", "On the Express Asset Definition page.", FALSE
	Else
		WriteToReport micFail, "Did Not Navigate to the Express Asset Definition Page", "Navigation to Express Asset Definition page failed. Exiting test.", TRUE
		ExitTest
	End If
	With Browser("PeopleSoft Browser").Page("Express Asset Definition").PSFrame("TargetContent")
		'Set Business Unit
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set Business Unit to [" & GlobalDictionary("BusinessUnit") & "]", "BU Set after navigating to the Express Asset Definition page.", FALSE

		'Set Project ID
		.WebEdit("Project").Set GlobalDictionary("ProjectID")
		WriteToReport micDone, "Set Project to [" & GlobalDictionary("ProjectID") & "]", "Project Set", FALSE

		'Click Search
		.WebButton("Search").Click
		WriteToReport micDone, "Clicked the Search Button", "Search started.", FALSE

		'Verify Navigation
		If NOT .Link("View All").Exist(30) Then
			WriteToReport micFail, "Failed Navigation to the Search Results Page", "Failed navigation to the search results page after clicking search.", TRUE
			ExitTest
		End If

		.Link("View All").Click
		WriteToReport micDone, "Clicked the View All Link to Expose All Activities", "Link Clicked", FALSE

		'Get the HTML index associated to the Activity
		Call .WebElement("%Activity").SetTOProperty("innertext", GlobalDictionary("ActivityID"))
		If NOT .WebElement("%Activity").Exist(5) Then
			WriteToReport micFail, "Activity Not Found: "&GlobalDictionary("ActivityID"), "Check Activity ID", TRUE
			ExitTest
		End If
		'Uses the id format PC_AM_ACTRUL_VW_ACTIVITY_ID$3, splits over _ID$, takes the right hand result
		sIndex = Split(.WebElement("%Activity").GetROProperty("html id"), "_ID$")(1)

		If GlobalDictionary("PCContinued") = "TRUE" Then
			Call .WebButton("+Rows").SetTOProperty("html id", "PC_AM_EXP5_VW$newm$"&sIndex&"$$"&sIndex)
			.WebButton("+Rows").Click
			If NOT Browser("PeopleSoft Browser").Dialog("NoofRowsToAdd").Exist(10) Then
				WriteToReport micFail, "Dialog to Add Rows Not Found", "Could Not Add Rows", TRUE
				ExitTest
			End If
			Browser("PeopleSoft Browser").Dialog("NoofRowsToAdd").WinEdit("NoOfRows").Set 1
			Browser("PeopleSoft Browser").Dialog("NoofRowsToAdd").WinButton("OK").Click
			WriteToReport micDone, "Set Rows to Add: 1 and Clicked the Add Button", "Row Added", FALSE
		End If

		'Set the Percentage for the Activity
		If GlobalDictionary("PCContinued") = "TRUE" Then
			Call .WebEdit("Percentage").SetTOProperty("name", "PC_AM_EXP5_VW_DISTRIBUTION_PCT$"&sIndex)
			.WebEdit("Percentage").Set GlobalDictionary("Percentage2") 'Set Original to new Percentage
			WriteToReport micDone, "Set Original Asset Percentage: "&GlobalDictionary("Percentage2"), "Percentage Set", FALSE
			Call .WebEdit("Percentage").SetTOProperty("name", "PC_AM_EXP5_VW_DISTRIBUTION_PCT$"&CInt(sIndex)+1)
			.WebEdit("Percentage").Set GlobalDictionary("Percentage")
			WriteToReport micDone, "Set New Asset Percentage: "&GlobalDictionary("Percentage"), "Percentage Set", FALSE
		Else
			Call .WebEdit("Percentage").SetTOProperty("name", "PC_AM_EXP5_VW_DISTRIBUTION_PCT$"&sIndex)
			.WebEdit("Percentage").Set GlobalDictionary("Percentage")
			WriteToReport micDone, "Set Percentage: "&GlobalDictionary("Percentage"), "Percentage Set", FALSE
		End If
		
		'Click Define Assets
		If GlobalDictionary("PCContinued") = "TRUE" Then
			Call .Link("Define Assets").SetTOProperty("html id", "DRILL_TO_DEFN$"&CInt(sIndex)+1)
			.Link("Define Assets").Click
		Else
			Call .Link("Define Assets").SetTOProperty("html id", "DRILL_TO_DEFN$"&sIndex)
			.Link("Define Assets").Click
		End If	
	End With
	With Browser("PeopleSoft Browser").Page("Express Asset Definition").Frame("PC Asset Definition Popup")
		'Verify Navigation
		If NOT .WebEdit("Profile").Exist(30) Then
			WriteToReport micFail, "Failed To Navigate To PC Asset Definition Popup", "Popup window did not appear after clicking the 'Define Assets' link. Exiting Test.", TRUE
			ExitTest
		End If

		'Set the following
		'Profile
		.WebEdit("Profile").Set GlobalDictionary("Profile")
		WriteToReport micDone, "Set Profile to [" & GlobalDictionary("Profile") & "]", "Profile Set", FALSE
		
		'Description
		.WebEdit("Description").Set GlobalDictionary("Description")
		WriteToReport micDone, "Set Description to [" & GlobalDictionary("Description") & "]", "Description Set", FALSE

		'Short Desc
		.WebEdit("ShortDesc").Set GlobalDictionary("ShortDesc")
		WriteToReport micDone, "Set Short Description to [" & GlobalDictionary("ShortDesc") & "]", "Short Description Set", FALSE

		'Dept 
		.WebEdit("Department").Set GlobalDictionary("Dept")
		WriteToReport micDone, "Set Department to [" & GlobalDictionary("Dept") & "]", "Department Set", FALSE

		If GlobalDictionary("DateLastMonth") = "TRUE" Then
			sDate = AnyDateLeadingZeros(DateSerial(Year(Now), Month(Now), 0)) 'Last day, last month
		Else 
			sDate = DateLeadingZeros 'TODAY
		End If

		'Trans. Date
		.WebEdit("TransDate").Set sDate 
		WriteToReport micDone, "Set Transaction Date to [" & sDate & "]", "Transaction Date Set", FALSE
		
		'Acct. Date
		.WebEdit("AcctDate").Set DateLeadingZeros
		WriteToReport micDone, "Set Account Date to [" & DateLeadingZeros & "]", "Account Date Set", FALSE

		'In Service Date
		.WebEdit("InServiceDate").Set sDate
		WriteToReport micDone, "Set In Service Date to [" & sDate & "]", "In Service Date Set", FALSE

		'Location
		.WebEdit("Location").Set GlobalDictionary("Location")
		WriteToReport micDone, "Set Location to [" & GlobalDictionary("Location") & "]", "Location Set", FALSE

		'Click Apply
		.WebButton("Apply").Click
		WriteToReport micDone, "Clicked the 'Apply' Button", "Applying Changes", FALSE
		
		'Give time to apply.
		Browser("PeopleSoft Browser").Page("Express Asset Definition").Sync
		
		'Click OK
		.WebButton("OK").Click
		WriteToReport micDone, "Clicked the 'OK' Button To Close Popup", "Closing PC Asset Definition Popup.", FALSE
	End With
	With Browser("PeopleSoft Browser").Page("Express Asset Definition").PSFrame("TargetContent")
		'Click Save
		.WebButton("Save").Click
		WriteToReport micDone, "Clicked the 'Save' Button", "Saving Express Asset Definition Table Changes", FALSE
		
		'Give time for Page to finish Saving.
		Browser("PeopleSoft Browser").Page("Express Asset Definition").Sync

		'Note the Asset ID
		If GlobalDictionary("PCContinued") = "TRUE" Then
			Call .WebElement("AssetIDType5").SetTOProperty("html id", "PC_AM_EXP5_VW_ASSET_ID$"&CInt(sIndex)+1)
		Else
			Call .WebElement("AssetIDType5").SetTOProperty("html id", "PC_AM_EXP5_VW_ASSET_ID$"&sIndex)
		End If
		
		If GlobalDictionary.Exists("AssetID") Then
      		GlobalDictionary.Remove("AssetID")
    	End If
    	GlobalDictionary.Add "AssetID", .WebElement("AssetIDType5").GetROProperty("innertext")
    	WriteToReport micDone, "Asset Created with ID [" & GlobalDictionary("AssetID") & "]", "Asset ID Stored", FALSE
	End With
End Function
'**************************************************************************************************************
''' <summary> 
''' Add Team Member to Project PC78
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function AddTeamMember
	'Navigate to Team
	If SelectMainMenu1(GlobalDictionary("PCTeam")) Then
		WriteToReport micPass, "Team Page", "On the Team page.", FALSE
	Else
		WriteToReport micFail, "Team Page", "Navigation to Team page failed. Exiting test.", TRUE
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Team").PSFrame("TargetContent")
		'Set BU
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set Business Unit: "&GlobalDictionary("BusinessUnit"), "BU Set", FALSE

		'Set Project ID
		.WebEdit("Project").Set GlobalDictionary("ProjectID")
		WriteToReport micDone, "Set the Project ID to: "&GlobalDictionary("ProjectID"), "Project ID Set", FALSE

		'Click Search
		.WebButton("Search").Click
		WriteToReport micDone, "Clicked the Search Button", "Button Clicked", FALSE

		'Verify Navigation to Result, Click if applicable
		If .WebButton("AddTeamMember").Exist(15) Then
			.WebButton("AddTeamMember").Click
			WriteToReport micDone, "Clicked the Add Team Member Button", "Button Clicked", FALSE
		Else
			WriteToReport micFail, "Failed to Load Project Page to Add Team Member", "Check Project ID", TRUE
			ExitTest
		End If

		'Set Employee ID
		.WebEdit("EmployeeID").Set dbFindEMPLIDByOPRID(GlobalDictionary("UserToAdd"))(0)
		WriteToReport micDone, "Set Employee ID to User "&GlobalDictionary("UserToAdd")&"'s ID: "&dbFindEMPLIDByOPRID(GlobalDictionary("UserToAdd"))(0), "ID Set", FALSE

		'Set Project Role
		.WebEdit("ProjectRole").Set GlobalDictionary("ProjectRole")
		WriteToReport micDone, "Set Project Role: "&GlobalDictionary("ProjectRole"), "Project Role Set", FALSE

		'Check Project Manager Box
		.WebCheckBox("ProjectMgr").Set "ON"
		WriteToReport micDone, "Checked Project Manager Box", "Box Checked", FALSE

		'Click Save
		.WebButton("Save").Click
		WriteToReport micDone, "Clicked the Save Button", "Button Clicked", FALSE
	End With
End Function


Public Function CreateReqWithMktProjAndVerifyEMM()
'Call the GetAccountAndDeptData function to get our data that we don't already have
Call GetAccountAndDeptData()

GlobalDictionary("price")=GlobalDictionary("Amount")
'Create the Requisition and match the voucher
GlobalDictionary("SignInUser")=GlobalDictionary("RequisitionUser")

'Loging out of application
Call PSFinLogout()

'Logging to application
Call UserSignIn()

Call CreateReqApproveAndMatchVoucher()

GlobalDictionary("SignInUser")=GlobalDictionary("VoucherPosting")

'Loging out of application
Call PSFinLogout()

'Logging to application
Call UserSignIn()

GlobalDictionary("MainMenuSelection")=GlobalDictionary("VoucherPost")

'Post the voucher
Call PostTheVoucher()

GlobalDictionary("SignInUser")=GlobalDictionary("CostCollector")

'Loging out of application
Call PSFinLogout()

'Logging to application
Call UserSignIn()

SelectMainMenu1(GlobalDictionary("CostCollectionVoucher"))

'Run payable cost collection
Call PayableCostCollectionVoucher()

'Validate whether transcation is present in the Review trans
businessunit=GLobalDictionary("BusinessUnit")
Project=GlobalDictionary("ProjectID")
strAmount=GlobalDictionary("Amount")
Activity=GlobalDictionary("Activity")

'Navigate to Project Costing > Interactive Reports > Manager Transaction Review
SelectMainMenu1(GlobalDictionary("ManageTransReview"))
'Revire the transcaion details
Call VerifyAmountinReviewCostTransactionDetails(businessunit,Project,strAmount,Activity)


'Navigate to CDW Projects > Expense Extract
SelectMainMenu1(GlobalDictionary("ExpenseExtract"))

'Run the Emm extract
Call RunExpenseExtract()

CreationType=GlobalDictionary("CreationType")
'Validate the Details in EMM
Call ValidateEMMScreen(CreationType)

End Function


Public Function CreateReqApproveAndMatchVoucher()
'Navigate to below navigation to create the requisition
'Navigate to NavBar and select  eProcurement > Requisition > Create Requisition
'Navigate to below path to create the requisition
Category=GlobalDictionary("Category")
Qty=GlobalDictionary("Qty")
UOM=GlobalDictionary("UOM")
SupplierID=GlobalDictionary("SupplierID")
price=GlobalDictionary("price")
dtChartfeild=GlobalDictionary("Account") 
dtDept=GlobalDictionary("Dept")

'Navigate to below navigation
'eProcurement > Requisition > Create Requisition
SelectMainMenu1(GlobalDictionary("CreateRequisition"))

'Click on Requisiion setting link
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").Link("Requisition Settings")
If .Exist(nMINWAIT) Then
.Click
'ENter the details in the REquisiton setting page
Call RequisitionSettings()
End If
End  With 

'wait for the ojects to get loaded
app_SearchSync()

With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").Link("Special Requests")
If .Exist(nMINWAIT) Then
.Click
Reporter.ReportEvent micPass,"Special request link","is present and clicked"
End If
End  With 

'wait for the ojects to get loaded
app_SearchSync()

'Create the Requuistion
Call addSpecialRequisition(Category,Qty,UOM,SupplierID,price)

'wait for the ojects to get loaded
app_SearchSync()

'Click on Check out button

'Click on Check out button
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebButton("Checkout")
If .Exist(nMINWAIT) Then
.Click
Reporter.ReportEvent micPass,"THe check out button","is present and clicekd"
End If
End  With 

'wait for the ojects to get loaded
For i=0 to 2
app_SearchSync()
Next

'Clickon Expand section
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").Image("Expand Section")
If .Exist(nMINWAIT) Then
.Click
Reporter.ReportEvent micPass,"The Expand section is","present and clicekd"
End If
End  With

For i=0 to 1
	app_SearchSync()
Next

'Expand the Accounting lines if not
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").Image("Expand section Accounting")
If .Exist(nMINWAIT) Then
	.Click
End If 
End  With 

For i=0 to 1
	app_SearchSync()
Next

'CLick on Chartfiuel 2 button
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebElement("Chartfields2_Tab")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 

'ait for some tiume
app_SearchSync()

'Enter the Account and Dept dtails
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebEdit("Chartfields2_Account")
If .Exist(nMINWAIT) Then
	.Set GlobalDictionary("Account1")
	Reporter.ReportEvent micDone,"The Account is set with","with"&GlobalDictionary("Account1")
End If
End  With 

'ait for some tiume
app_SearchSync()

'Set the Dept details
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebEdit("Chartfields2_DeptID")
If .Exist(nMINWAIT) Then
	.Set GlobalDictionary("Dept1")
	Reporter.ReportEvent micDone,"The Department ID","is"&GlobalDictionary("Dept1")
End If
End  With

'ait for some tiume
app_SearchSync()

With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebElement("Chartfields3_Tab")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 

'ait for some tiume
app_SearchSync()

'Set the PC BUs unit, Project and Activity
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebEdit("PC BusUnit")
If .Exist(nMINWAIT) Then
	.Set GlobalDictionary("PCBUSUnit")
	Reporter.ReportEvent micDone,"The PC BUs unit","is present and set with"&GlobalDictionary("PCBUSUnit")
End If
End  With 

'ait for some tiume
app_SearchSync()

With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebEdit("PROJECT_ID")
If .Exist(nMINWAIT) Then
	.Set GlobalDictionary("Project")
	Reporter.ReportEvent micDone,"The Project ID","is present and set with"&GlobalDictionary("Project")	
End If
End  With 

'ait for some tiume
app_SearchSync()

With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebEdit("ACTIVITY_ID")
If .Exist(nMINWAIT) Then
	.Set GlobalDictionary("Activity")
	Reporter.ReportEvent micDone,"The Project ID","is present and set with"&GlobalDictionary("Activity")	
End If
End  With 

'ait for some tiume
app_SearchSync()

'Click on save for later
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebButton("Save for Later")
If .Exist(nMINWAIT) Then
.Click
Reporter.ReportEvent micPass,"The Save for later","butto is present and clicked"
End If
End  With 

'wait for the ojects to get loaded
For i=0 to 2
app_SearchSync()
Next

'CLick on Preview approvals page

With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").Link("PreviewApprovals")
If .Exist(nMINWAIT) Then
.Click
Reporter.ReportEvent micDone,"The Preview approval link","isd present and clicked"
End If
End with 

'wait for the ojects to get loaded
For i=0 to 2
app_SearchSync()
Next

'Capture the Approver names
Set oPreviewApproverFrame=Browser("PeopleSoft Browser").Page("Requisition").PSFrame("Preview Approvals")

ApproverNames=ep_captureApproverNames(oPreviewApproverFrame)
GlobalDIctionary("ApproverNames")=ApproverNames

'CLick on Return button in the preview approval form
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("Preview Approvals").WebButton("PreAppr_Return")
If .Exist(nMINWAIT) Then
.Click
Reporter.ReportEvent micPass,"The return button is","presetna nd clicked"
End If
End  With 

app_SearchSync()

'Click on Submit button
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebButton("Save & submit")
If .Exist(nMINWAIT) Then
.Click
Reporter.ReportEvent micPass,"Submit button","is present and clicked"
End If
End With

'wait for pplitio load
For i=0 to 2 
app_SearchSync()
Next

'Validate teh error message
With Browser("PeopleSoft Browser").Page("Requisition").WebElement("Message")
If .Exist(nMINWAIT) Then
appMessage=.GetROProperty("innertext")
Reporter.ReportEvent micDone,"Following pop up message","is gettign displayed"&appMessage
End If	
End With

'CLick on Ok butyton
With Browser("PeopleSoft Browser").Page("Requisition").WebButton("OK")
If .Exist(nMINWAIT) Then
.Click
End If
End  WIth

'Get the requisition ID
With Browser("PeopleSoft Browser").Page("Requisition").PSFrame("ePro Requisitions").WebElement("Specialrequest_RequesitionID")
If .Exist(nMINWAIT) Then
appRequisitionID=.GetROProperty("innertext")
GlobalDictionary("RequisitionID")=appRequisitionID
End If
End  With

With Browser("PeopleSoft Browser").Page("index:=1")
If .Exist(nMINWAIT) Then
Set oObj=Description.Create
oObj("MicClass").value="WebElement"
oObj("class").value="awStageLabel"
oObj("html tag").value="TD"
Set oApproved=.ChildObjects(oObj)
For i=0 to oApproved.count-1
appApprovalFlow=oApproved(i).getRoProperty("innertext")
Reporter.ReportEvent micDone,"The name of the approval flow","is"&appApprovalFlow
Wait(2)
Next
End If
End  With

With Browser("PeopleSoft Browser").Page("index:=1")
If .Exist(nMINWAIT) Then
Set oObj=Description.Create
oObj("MicClass").value="WebElement"
oObj("class").value="awPathHeader"
oObj("html tag").value="TD"
Set oApproved=.ChildObjects(oObj)
For i=0 to oApproved.count-1
appApprovalFlow=oApproved(i).getRoProperty("innertext")
Reporter.ReportEvent micDone,"The name of the approval flow","is"&appApprovalFlow
Wait(2)
Next
End If
End  With

GlobalDictionary("RequestorName")=GlobalDictionary("SignInUser")

'Assign the USer id to Admin to perform montir approvas
GlobalDictionary("SignInUser")=GlobalDictionary("Admin")


'Loging out of application
Call PSFinLogout()

'Logging to application
Call UserSignIn()

'Check whether user is not having access to Process monitopr approvals
SelectMainMenu1(GlobalDictionary("MonitorApproval"))

reasignTo=GlobalDictionary("userID1")
reqID=GlobalDictionary("RequisitionID")
ApprovalProcess=GlobalDictionary("ApprovalProcess") 'Requisition
DefinitionID=GlobalDictionary("DefinitionID")   'Share
HeaderStatus=GlobalDictionary("HeaderStatus")
Requestior=GlobalDictionary("RequestorName")

'cHECK THE MONITOR PROCESS APPROVALS
Call ep_ApproveinMonitorApprovals(reqID,ApprovalProcess,DefinitionID,HeaderStatus,Requestior,reasignTo)


'GlobalDictionary("RequestorName")=GlobalDictionary("SignInUser")
'wait for the ojects to get loaded
app_SearchSync()

'Navigate to below pagfe
'eProcurement > Buyer Center > Expedite Requisitions
'Check whether user is not having access to Process monitopr approvals
SelectMainMenu1(GlobalDictionary("ExpediteRequisition"))

'Enter the details and perform the requisition 
Call ExpediteRequisitions()

'Navigate to belwo navigate to perform manag=e requisisiont
'Navigate to belwo page
'Navigate to eProcurement > Buyer Center > Dispatch Purchase Order
SelectMainMenu1(GlobalDictionary("ManageRequisition"))

'wait for the ojects to get loaded
app_SearchSync()

Call ManageRequisitionsLifeCycle()

'wait for the ojects to get loaded
app_SearchSync()

'Navigate to Purchsae order and dispatch
SelectMainMenu1(GlobalDictionary("ManagePurchaseOrder"))

'wait for the ojects to get loaded
app_SearchSync()

'Ent4er all the details and perform dispattch PO order
'Call DispatchPurchaseOrder()

Call ManagePurchaseOrder()

'wait for the ojects to get loaded
app_SearchSync()

'Navigate to belweo page to perfrom manager requisition
'eProcurement > Manage Requisition
SelectMainMenu1(GlobalDictionary("ManageRequisition"))

'wait for the ojects to get loaded
app_SearchSync()

If Not GlobalDictionary("flag")="1" Then


'ENter al the details and enter search
businessUnit=GlobalDictionary("Setting_BusinessUnit")
RequisitionID=GlobalDictionary("RequisitionID")

'Search for manage requisitions
Call ManageRequisitionSearch(businessUnit, RequisitionID)

'wait for the ojects to get loaded
For i=0 To 1
app_SearchSync()
Next

'Select the receive button and clicko n GO button
Set oDropd=Description.Create
oDropd("MicClass").value="WebList"
oDropd("class").value="PSDROPDOWNLIST"
oDropd("html id").value="PV_REQSTAT_WRK_PV_REQ_ACTION.*"

Set oDropDown=Browser("PeopleSoft Browser").Page("ManageRequisition").PSFrame("ManageRequisition").ChildObjects(oDropd)
oDropDown(0).select GlobalDictionary("perform")

With Browser("PeopleSoft Browser").Page("ManageRequisition").PSFrame("ManageRequisition").WebButton("ManReq_GO")
If .Exist(nMINWAIT) Then
.Click
End If
End  With 

'wait for the ojects to get loaded
For i=0 to 2
app_SearchSync()
Next

With Browser("PeopleSoft Browser").Page("ManageRequisition").PSFrame("ReceiveItems").WebButton("CheckAll")
If .Exist(nMINWAIT) Then
.Click
End If
End  With 

With Browser("PeopleSoft Browser").Page("ManageRequisition").PSFrame("ReceiveItems").WebButton("ReceiveSelected")
If .Exist(nMINWAIT) Then
.Click
End If
End  With 

'wait for the ojects to get loaded
For i=0 to 1
app_SearchSync()
Next

'Seelct the BU*siness unit and clickon save receipt
With Browser("PeopleSoft Browser").Page("ManageRequisition").PSFrame("CasualReceiving").WebEdit("ReceiveItsm_BU")
If .Exist(nMINWAIT) Then
.Set (GlobalDictionary("Setting_BusinessUnit"))
End If
End  With 

With Browser("PeopleSoft Browser").Page("ManageRequisition").PSFrame("CasualReceiving").WebButton("CasRec_SaveReceipt")
If .Exist(nMINWAIT) Then
.Click
End If
End  With 

'wait for the ojects to get loaded
For i=0 to 1
app_SearchSync()
Next

str=Browser("PeopleSoft Browser").Page("ManageRequisition").PSFrame("SucessFrame").WebElement("ReceiptID").GetROProperty("innertext")
Set RegEx = CreateObject("vbscript.regexp") 
RegEx.Pattern = "[^\d]"
RegEx.IgnoreCase = True 
RegEx.Global = True 
numStr=RegEx.Replace(str, "") 
GLobalDIctionary("ReceiptNumber")=numStr
Reporter.ReportEvent micDone,"The receipt number","is"&GLobalDIctionary("ReceiptNumber")

GlobalDictionary("SignInUser")=GlobalDictionary("VoucherCreateUser")

'Loging out of application
Call PSFinLogout()

'Logging to application
Call UserSignIn()

'Navigate to regular entryu page to create voucher
'Navigate to Accounts Payable > Vouchers > Add/Update > Regular Entry

SelectMainMenu1(GlobalDictionary("RegularEntry"))
BusinessUnit=GlobalDictionary("Setting_BusinessUnit")
SupplierID=GlobalDictionary("SupplierID")

voucherID=ap_createVoucherWithCopyReceipt(BusinessUnit,SupplierID)
GlobalDictionary("VoucherID")=voucherID
'Wait for some time
app_searchSync()

SelectMainMenu1(GlobalDictionary("Matching"))

'Perfoprm matching
result=ap_matchingVoucher(BusinessUnit,voucherID)

If result="success" Then
Reporter.ReportEvent micPass,"The matching is done","sucessfully"
Else
Reporter.ReportEvent micFail,"THe matching is not done sucessfully"
End If

'Navigate to regular entryu page to create voucher
'Navigate to Accounts Payable > Vouchers > Add/Update > Regular Entry

SelectMainMenu1(GlobalDictionary("RegularEntry"))

'Wait for some time
app_searchSync()
businessunit=GlobalDictionary("Setting_BusinessUnit")
'voucherID=voucherID
Call ap_openExistingVoucher(businessunit,voucherID)

'Wait for some time
app_searchSync()

strMatchStatus="Matched"
Call ap_verifyMatchstatusofVoucher(strMatchStatus,strOption)

End If

End Function


Public Function PostTheVoucher()

	dtControlID=(GlobalDictionary("RunControlID"))&inVoiceNumberGeneration
	dtRequestID=(GlobalDictionary("RequestID"))
	dtDescription=(GlobalDictionary("Description"))
	dtPostVoucherOption=(GlobalDictionary("PostVoucherOption"))
	dtPrepaymentApplicationMethod=(GlobalDictionary("PrepaymentApplicationMethod"))
	dtProcessFrequency=(GlobalDictionary("ProcessFrequency"))
	dtBusinessUnit=(GlobalDictionary("BusinessUnit"))
	dtVoucherID=(GlobalDictionary("VoucherID"))
	SelectMainMenu1(GlobalDictionary("MainMenuSelection2"))
	supplierID=(GlobalDictionary("supplierID"))
	
	'Navigate to Following page
	'Accounts Payable / Batch Processes / Vouchers / Voucher Posting
	SelectMainMenu1(GlobalDictionary("MainMenuSelection"))
	
	
	'CLick on Add NEw value Tab
	With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebElement("AddNewValue")
	If .Exist(nMINWAIT) Then
		.Click
		
		'Enter the control ID
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebEdit("PRCSRUNCNTL_RUN_CNTL_ID")
		If .Exist(nMINWAIT) Then
			.Set dtControlID
			Call WriteToReport(micPass,"Control ID","Control ID is="&dtControlID,false)
		End If
		End WIth 
		
		'CLick onb Add Button
		With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebButton("Add")
		If .Exist(nMINWAIT) Then
			.Click:Call WriteToReport(micPass,"Add button","is present and clicked",false)
		End If
		End With 

	End If
	End WIth 

	'Wait for the applicatoin load
	Browser("PeopleSoft Browser").Sync
	
	'Check if the add ing nwe contorl page ois displayed
	If Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebEdit("RequestID").WaitProperty("visible",True,2000) Then
		
	'Enter the Run control IDF values in the Page
	With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebEdit("RequestID")
	If .Exist(nMINWAIT) Then
		.Set dtRequestID
		Call WriteToReport(micPass,"Request ID","Request ID is="&dtRequestID,false)
	End If
	End WIth 
	
	'Enter the description
	With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebEdit("Description")
	If .Exist(nMINWAIT) Then
		.Set dtDescription
		Call WriteToReport(micPass,"Description ID","Description ID is="&dtDescription,false)
	End If
	End WIth 
	
	'Select the voucher Posting option
	With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebList("PostVoucherOption")
	If .Exist(nMINWAIT) Then
		.Select dtPostVoucherOption
	End If
	End WIth 
	
	'Select the Prepamenty application
	With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebList("PrepaymentApplicationMethod")
	If .Exist(nMINWAIT) Then
		.Select dtPrepaymentApplicationMethod
	End If
	End With
	
	'Select the process frequency
	With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebList("ProcessFrequency")
	If .Exist(nMINWAIT) Then
		.Select dtProcessFrequency
	End If
	End With
	
	'ENter the Business UNit
	With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebEdit("BusinessUnit")
	If .Exist(nMINWAIT) Then
		.Set dtBusinessUnit
		Call WriteToReport(micPass,"BusinessUnit","BusinessUnit is="&dtBusinessUnit,false)
	End If
	End WIth 
	
	'Enter the Voucher ID
	With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebEdit("VoucherID")
	If .Exist(nMINWAIT) Then
		.Set dtVoucherID
		Call WriteToReport(micPass,"VoucherID","VoucherID is="&dtVoucherID,false)
	End If
	End WIth 
	
	'Click on Run button
	With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("TargetContent").WebButton("Run")
	If .Exist(nMINWAIT) Then
		.Click
	End If
	End WIth 
	
	app_SearchSync()
	app_SearchSync()
	
	'Selcet the post voucejhr and clickon Ok button
	With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("ProcessSchdeluerRequest").WebTable("ProcessList")
	If .Exist(nMINWAIT) Then
		For i=2 to .RowCount
			appDescription=.GetCellData(i,2)
			If appDescription="Post vouchers" Then
				appProcessName=.GetCellData(i,3)
				Set oVoucherLink=.ChildItem(i,1,"WebCheckBox",0)
				If oVoucherLink.exist(nMINWAIT) Then
					oVoucherLink.click
					Exit For
				End If
			End If
		Next
	End If
	End With 
	End  If
	
	'Click on Ok button
	With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("ProcessSchdeluerRequest").WebButton("Ok")
	If .Exist(nMINWAIT) Then
		.Click
	End If
	End WIth 
	
	app_SearchSync()
	
	'Click on Process moonitor
	With Browser("PeopleSoft Browser").Page("Voucher Posting").PSFrame("VoucherPostingRequest").Link("Process Monitor")
	If .Exist(nMINWAIT) Then
		.Click
	End If
	End With 
	
	app_SearchSync()
	Call CheckProcessMontiorStatus (sProcessName)
	

Browser("PeopleSoft Browser").Sync

'Navigate toe Next page toe search for the entries
'(Accounts Payable / Review / Vouchers / Voucher Accounting Entries)
SelectMainMenu1(GlobalDictionary("MainMenuSelection1"))

'Enter the voucher NUmber and Business UNit
With Browser("PeopleSoft Browser").Page("VoucehrAccountingEntries").PSFrame("AccountingEntries").WebEdit("BusinessUnit")
If .Exist(nMINWAIT) Then
	.Set dtBusinessUnit
Call WriteToReport(micPass,"BusinessUnit","BusinessUnit is="&dtBusinessUnit,false)
End If
End With 

'Enter the voucher ID
With Browser("PeopleSoft Browser").Page("VoucehrAccountingEntries").PSFrame("AccountingEntries").WebEdit("VoucherID")
If .Exist(nMINWAIT) Then
	.Set dtVoucherID
	Call WriteToReport(micPass,"VoucherID","VoucherID is="&dtVoucherID,false)
End If
End With 

'Click on Seqarch button
With Browser("PeopleSoft Browser").Page("VoucehrAccountingEntries").PSFrame("AccountingEntries").WebButton("Search")
If .Exist(nMINWAIT) Then
	.Click
End If
End With 

'Search for the Table
WIth Browser("PeopleSoft Browser").Page("VoucehrAccountingEntries").PSFrame("AccountingEntries").WebTable("AccountingInformation")
If .Exist(nMINWAIT) Then
Call WriteToReport(micPass,"THe voucehr entries are added in the", "table",false)
	If .RowCount>=2 Then
		For i=1 to .RowCount
			appDate=.GetCellData(i,6)
			If CDate(appDate)=Date() Then
				Call WriteToReport(micPass,"THe voucehr entries are added in the", "table",false)
			End If
		Next
	End If
	
End If
End With 

End Function

Public Function PayableCostCollectionVoucher()

'Click on Add new value Tab
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebTabStrip("AddNew/Existingvalue")
If .Exist(nMINWAIT) Then
	.Select ("Add a New Value")
End If
End  With 

'Enter the Run control ID
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebEdit("RunControlID")
If .Exist(nMINWAIT) Then
	.Set "Pay" & Clng(Timer)
End If
End  With 

'CLick on Add Button
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebButton("Add")
If .Exist(nMINWAIT) Then
	.click
End If
End  With 

For i=0 to 2
	app_SearchSync()
Next

dtOption="Business Unit/Project/Activity"
'Select the options
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebList("Options")
If .Exist(nMINWAIT) Then
	.Select dtOption 
End If
End  With 

'Wait
app_SearchSync()

'Enter th Account, Project and Activity
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebEdit("BusinessUnit")
If .Exist(nMINWAIT) Then
	.Set GLobalDictionary("BusinessUnit")
	Reporter.ReportEvent micDone,"The Business unit","is present and set with"&GLobalDictionary("BusinessUnit")
End If
End  With 

'Wait
app_SearchSync()

'Enter the Project
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebEdit("Project")
If .Exist(nMINWAIT) Then
	.Set GlobalDictionary("ProjectID") 
	Reporter.ReportEvent micPass,"The Project ID","is present and set with"&GlobalDictionary("ProjectID")
End If
End  With 

'Wait
app_SearchSync()

'Enter the activity
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebEdit("Activity")
If .Exist(nMINWAIT) Then
	.Set GlobalDictionary("Activity")
	Reporter.ReportEvent micPass,"The Activity is present","and set with"&GlobalDictionary("Activity")
End If
End  With 

'Wait
app_SearchSync()

'CLick on Run button
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").WebButton("Run")
If .Exist(nMINWAIT) Then
	.click
End If
End  With 

''Wait
app_SearchSync()

'Get the process namer
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("ProcesScheduler").WebElement("ProcessName")
If .Exist(nMINWAIT) Then
	processname=.GetROProperty("innertext")
	Reporter.ReportEvent micDone,"The Process name","is"&processname
End If
End  With 

'CLick on Okbutton
WIth Browser("PeopleSoft Browser").Page("Payables").PSFrame("ProcesScheduler").WebButton("Ok")
If .Exist(nMINWAIT) Then
	.click
End If
End  With 

'''Wait
app_SearchSync()

'Click on Process monitor link
With Browser("PeopleSoft Browser").Page("Payables").PSFrame("Payables").Link("ProcessMonitor")
If .Exist(nMINWAIT) Then
	.click
End If
End  With

'''Wait
app_SearchSync()

'CLick on refresh untill status becomes success and posted
Call CheckProcessMontiorStatus(processname)

End Function

Public Function UnpostJournalEntryMktExpandVerifyEMM()
'Un post the jounrl entery 
Call UnpostProjectCostingJournals()

GlobalDictionary("SignInUser")=GlobalDictionary("CostCollector")

'Loging out of application
Call PSFinLogout()

'Logging to application
Call UserSignIn()

JournalID=GlobalDictionary("JournalID")
Call GetProjectActivityForExistignJournal(JournalID)

'Navigate to Project Costing > Cost Collection > General Ledger
SelectMainMenu1(GlobalDictionary("GeneralLedger"))

'Run the Ledger cost collection 
Call GeneralLedgerCostCollection()

''Navigate to Project Costing > Interactive Reports > Manager Transaction Review
'SelectMainMenu1(GlobalDictionary("ManageTransReview"))
'
'businessunit=GLobalDictionary("BusinessUnit")
'Project=GlobalDictionary("ProjectID")
'strAmount=GlobalDictionary("Amount")
'Activity=GlobalDictionary("Activity")
'
''Revire the transcaion details
'Call VerifyAmountinReviewCostTransactionDetails(businessunit,Project,strAmount,Activity)

'Navigate to CDW Projects > Expense Extract
SelectMainMenu1(GlobalDictionary("ExpenseExtract"))

'Run the Emm extract
Call RunExpenseExtract()

CreationType=GlobalDictionary("CreationType")
'Validate the Details in EMM
Call ValidateEMMScreen(CreationType)

End Function

Public Function GetProjectActivityForExistignJournal(JournalID)
sheetName=GlobalDictionary("sheetName3")
connectionString = "Provider=SQLOLEDB;Server=PSFNREGSQLSTG1;DATABASE=FNREG;uid='';pwd='';Trusted_Connection=Yes"
strSQL="SELECTPROJECT_ID,ACTIVITY_DESCR,RESOURCE_AMOUNTFROMPS_CDW_MRMEX_STGWHEREJOURNAL_ID = '" &JournalID& "'"
If NOT dbGetSpecifiRecords(strSQL, connectionString, sheetName) Then
Call WriteToReport(micFail, "Verifying the Record from Database", "No Record Exist for SQL: [" & strSQL & "]",true)
else
Call WriteToReport(micPass,"DB records fetched successfully","SQL query executed sucessfully ["&strSQL&"]" ,false)
End  If

Set table=DataTable.GetSheet(sheetName)
table.SetCurrentRow(1)
GlobalDictionary("ProjectID")=Datatable.Value("PROJECT_ID",sheetName)
GlobalDictionary("Activity")=Datatable.Value("ACTIVITY_DESCR",sheetName)
GlobalDictionary("Amount")=Datatable.Value("RESOURCE_AMOUNT",sheetName)
End Function

Public Function ManagerTranscationReviewSearch(businessunit,project,Activity)
With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("Manager Transaction Review")
'Enter the Business Unit
If .WebEdit("Businessunit").Exist(nminwait) Then
.WebEdit("Businessunit").Set businessunit
WriteToReport micPass," Business unit"," Businessunit is present and entered as["&Businessunit&"]",false
else: WriteToReport micfail,"Businessunit ","Businessunit field isn't present",true
End If

'ENter the Project ID
If .WebEdit("Project").Exist(nminwait) Then
.WebEdit("Project").Set project
WriteToReport micPass," Project "," Project is present and entered as["&Project&"]",false
else: WriteToReport micfail,"Project  ","Project field isn't present",true
End If

'Enter the Activity
If .WebEdit("Activity").Exist(nminwait) Then
.WebEdit("Activity").Set Activity
WriteToReport micPass," Activity "," Activity is present and entered as["&Activity&"]",false
else: WriteToReport micfail,"Project  ","Project field isn't present",true
End If

If .WebButton("Search").Exist(nminwait) Then
.WebButton("Search").Click
WriteToReport micPass," Search "," Search button is present and clicked",false
else: WriteToReport micfail,"Search  ","search field isn't present",true
End If
End  With 
End Function

Public Function AdjustCostInProjects()
'Create the Requisisions, map with vouchers, post the vouchers and prjectgs
Call CreateReqWithMktProjAndVerifyEMM()

app_SearchSync() 

'Navigate to Manager transcation Review
SelectMainMenu1(GlobalDictionary("ManageTransReview"))
businessunit=GLobalDictionary("BusinessUnit")
Project=GlobalDictionary("ProjectID")
strAmount=GlobalDictionary("Amount")
Activity=GlobalDictionary("Activity")
'Search for the manager transcation reviuew
Call ManagerTranscationReviewSearch(businessunit,project,Activity)

For i=0 to 1
	app_SearchSync()
Next

'strAmount=GlobalDictionary("Amount")
'Click on the check box next to adjustment
On Error Resume Next
With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("Manager Transaction Review").WebTable("DetailsReview_2")
If .Exist(nMINWAIT) Then
For i=1 to .RowCount
appDate=.GetCellData(i,2)
If CDate(appDate)=Date Then
appAmount=Cdbl(Replace(Trim(Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("Manager Transaction Review").WebTable("DetailsReviewF6Cols").GetCellData(i,5) ),"$",""))
If Cint(appAmount)=Cint(strAmount) Then
Set oCheckBox=Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("Manager Transaction Review").WebTable("DetailsReviewF6Cols").ChildItem(i,7,"WebCheckBox",0)
If oCheckBox.Exist(nMINWAIT) Then
If oCheckBox.GetRoProperty("disabled")=0 Then	
	oCheckBox.click
Exit For
End If
End If
End If
End  If
Next
End If

End  With
On Error GoTo 0

'CLick on Adjust Button
With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("Manager Transaction Review").WebButton("Adjust")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 

For i=0 to 1
	app_SearchSync()
Next

AdjustmentType=GlobalDictionary("AdjustmentType")
Call TypeOfAdjustment(AdjustmentType)

SelectMainMenu1(GlobalDictionary("TranscationList"))
'Call the trancation loisyt
Call TranscationList()

End Function

Public Function TypeOfAdjustment(AdjustmentType)
Select Case AdjustmentType
	Case "Project"
	With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebButton("Next")
	If .Exist(nMINWAIT) Then
		.Click
	End If
	End  With 
	
	'wait for the ojects to get loaded
     app_SearchSync()
     
     'Click on tyhe magnifying glass
     With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").Image("ProjectID_Search")
     If .Exist(nMINWAIT) Then
     	.Click
     End If
     End  With 
     
          'wait for the ojects to get loaded
     app_SearchSync()
     
    With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("LookUpProject_TransAdj").WebEdit("ProjectID")
    If .Exist(nMINWAIT) Then
    	.Set "MKT"
    End If
End  WIth 

With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("LookUpProject_TransAdj").WebButton("Search")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 

     ''wait for the ojects to get loaded
     app_SearchSync()
     
     'wait for the ojects to get loaded
     app_SearchSync()
     
    With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("LookUpProject_TransAdj").WebTable("SearfchResults")
    If .Exist(nMINWAIT) Then
    	For i=2 to .RowCount
    		appProjectID=.GetCellData(i,1)
    		If Not(instr(1,GlobalDictionary("ProjectName"),appProjectID))>0 Then
    			Set oProj=.ChildItem(i,1,"Link",0)
    			oProj.click
    			Reporter.ReportEvent micPass,"The Project ID","selected is"&appProjectID
    			GlobalDictionary("NewProjectName")=appProjectID
    			Exit For
    		End If
    	Next
    End If
    End  With 
    
    'wait for the ojects to get loaded
     app_SearchSync()
     
     With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").Image("ActivityID_Search")
     If .Exist(nMINWAIT) Then
     	.Click
     End If
     End  With 
     
     ''wait for the ojects to get loaded
     app_SearchSync()
     

     'Search results
     With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("LookUpActivity_Adj").WebTable("SearchResults")
     If .Exist(nMINWAIT) Then
     	appActivityName=.GetCellData(2,1)
     	GlobalDictionary("NewActivity")=appActivityName
     	Set oLInk=.ChildItem(2,1,"Link",0)
     	If oLInk.exist(nMINWAIT) Then
     		oLInk.click
     		Reporter.ReportEvent micPass,"The Activity is","is"&appActivityName
   
     	End If
     End If
     End  WIth 
     
     
       ''wait for the ojects to get loaded
     app_SearchSync()
     
     'CLick on Finish Button
     With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebButton("Finish")
     If .Exist(nMINWAIT) Then
     	.Click
     End If
     End  With
     
     Case "Amount"
     With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebRadioGroup("AdjustmentType")
     If .Exist(nMINWAIT) Then
     	.Select "A"
     End If
     End  WIth 
     
      ''wait for the ojects to get loaded
     app_SearchSync()
     
     ''wait for the ojects to get loaded
     app_SearchSync()
     
     'Get the Quantity and set the quantity in text feild
     With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebElement("appQuantity")
     If .Exist(nMINWAIT) Then
     	appQty=.GetROProperty("innertext")
     	With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebEdit("ChangeToQuan")
			If .Exist(nMINWAIT) Then
			 .Set appQty
			End If
		End  With 
     End If
     End  With 
     
     'GEt the amoiunt and set in the amount field
    With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebElement("appAmount")
    If .Exist(nMINWAIT) Then
    	appAmt=.GetROProperty("innertext")
     With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebEdit("ChangeToAmt")
     If .Exist(nMINWAIT) Then
     	.Set appAmt
     	Reporter.ReportEvent micPass,"The amount is","set with"&appAmt
     End If
     End  With 
    End If
    End  With 
 

GlobalDictionary("NewProjectName")=GlobalDictionary("ProjectID")
GlobalDictionary("NewActivity")=GlobalDictionary("Activity")
    
'Click on Next button
With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebButton("Next")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 

'CLick on Ok button in message
With Browser("PeopleSoft Browser").Page("Manager Transaction Review").WebButton("Ok")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 


'CLick on Ok button in message
With Browser("PeopleSoft Browser").Page("Manager Transaction Review").WebButton("Ok")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 



''wait for the ojects to get loaded
 app_SearchSync()
 
 Case "AmountAndProj"
  With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebRadioGroup("AdjustmentType")
     If .Exist(nMINWAIT) Then
     	.Select "B"
     End If
     End  WIth 
     
      ''wait for the ojects to get loaded
     app_SearchSync()
     
     ''wait for the ojects to get loaded
     app_SearchSync()
     
     'Get the Quantity and set the quantity in text feild
     With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebElement("appQuantity")
     If .Exist(nMINWAIT) Then
     	appQty=.GetROProperty("innertext")
     	With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebEdit("ChangeToQuan")
			If .Exist(nMINWAIT) Then
			 .Set appQty
			End If
		End  With 
     End If
     End  With 
     
     'GEt the amoiunt and set in the amount field
    With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebElement("appAmount")
    If .Exist(nMINWAIT) Then
    	appAmt=.GetROProperty("innertext")
     With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebEdit("ChangeToAmt")
     If .Exist(nMINWAIT) Then
     	.Set appAmt
     	Reporter.ReportEvent micPass,"The amount is","set with"&appAmt
     End If
     End  With 
    End If
    End  With
    
    'Click on Next button
With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebButton("Next")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 


     ''wait for the ojects to get loaded
     app_SearchSync()
     
With Browser("PeopleSoft Browser").Page("Manager Transaction Review").WebButton("Ok")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 

     ''wait for the ojects to get loaded
     app_SearchSync()
     
'Click on tyhe magnifying glass
     With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").Image("ProjectID_Search")
     If .Exist(nMINWAIT) Then
     	.Click
     End If
     End  With 
     
     'wait for the ojects to get loaded
     app_SearchSync()
     
    With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("LookUpProject_TransAdj").WebEdit("ProjectID")
    If .Exist(nMINWAIT) Then
    	.Set "MKT"
    End If
End  WIth 

With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("LookUpProject_TransAdj").WebButton("Search")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 

     ''wait for the ojects to get loaded
     app_SearchSync()

     
    With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("LookUpProject_TransAdj").WebTable("SearfchResults")
    If .Exist(nMINWAIT) Then
    	For i=2 to .RowCount
    		appProjectID=.GetCellData(i,1)
    		If Not(instr(1,GlobalDictionary("ProjectName"),appProjectID))>0 Then
    			Set oProj=.ChildItem(i,1,"Link",0)
    			oProj.click
    			Reporter.ReportEvent micPass,"The Project ID","selected is"&appProjectID
    			GlobalDictionary("NewProjectName")=appProjectID
    			Exit For
    		End If
    	Next
    End If
    End  With 
    
    'wait for the ojects to get loaded
     app_SearchSync()
     
     With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").Image("ActivityID_Search")
     If .Exist(nMINWAIT) Then
     	.Click
     End If
     End  With 
     
     ''wait for the ojects to get loaded
     app_SearchSync()
     

     'Search results
     With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("LookUpActivity_Adj").WebTable("SearchResults")
     If .Exist(nMINWAIT) Then
     	appActivityName=.GetCellData(2,1)
     	GlobalDictionary("NewActivity")=appActivityName
     	Set oLInk=.ChildItem(2,1,"Link",0)
     	If oLInk.exist(nMINWAIT) Then
     		oLInk.click
     		Reporter.ReportEvent micPass,"The Activity is","is"&appActivityName
     	End If
     End If
     End  WIth 
     
     
       ''wait for the ojects to get loaded
     app_SearchSync()
     
     'CLick on Finish Button
     With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebButton("Finish")
     If .Exist(nMINWAIT) Then
     	.Click
     End If
     End  With 
     
End  Select

'Click on Save button
With Browser("PeopleSoft Browser").Page("Manager Transaction Review").PSFrame("TransactionAdjustment").WebButton("Save")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 
    
 'Print the message and click on Ok button
 With Browser("PeopleSoft Browser").Page("Manager Transaction Review").WebElement("Message")
 If .Exist(nMINWAIT) Then
 	Reporter.ReportEvent micDone,"The Messge displayed","is"&.GetROProperty("innertext")
 End If
 End  WIth 
 
 'CLick on Ok button
 With Browser("PeopleSoft Browser").Page("Manager Transaction Review").WebButton("Ok")
 If .Exist(nMINWAIT) Then
 	.Click
 End If
 End  With 
 
 ''wait for the ojects to get loaded
 app_SearchSync()
 
 'Navigate to Process Monitor screen
 SelectMainMenu1(GlobalDictionary("ProcessMonitor"))

AppProcess="PC_INTFEDIT"
  ''wait for the ojects to get loaded
 app_SearchSync()
 
 'CLick on Refresh button untill status becoes success and posted
 Call CheckProcessMontiorStatus(AppProcess)
 
 ''wait for the ojects to get loaded
 app_SearchSync()
 
 

End Function

Public Function TranscationList()
'Set the Business UNit
With Browser("PeopleSoft Browser").Page("TransationList").PSFrame("Transation List").WebEdit("Businessunit")
If .Exist(nMINWAIT) Then
	.Set GLobalDictionary("BusinessUnit")
	Reporter.ReportEvent micDone,"The Business UNit is set with","the value"&GLobalDictionary("BusinessUnit")
End If
End  With 


'Enter the Prject
With Browser("PeopleSoft Browser").Page("TransationList").PSFrame("Transation List").WebEdit("Project")
If .Exist(nMINWAIT) Then
	.Set GlobalDictionary("NewProjectName")
	Reporter.ReportEvent micDone,"The Project name is set with","with"&GlobalDictionary("NewProjectName")
End If
End  With 

'Enter the activity
With Browser("PeopleSoft Browser").Page("TransationList").PSFrame("Transation List").WebEdit("Activity")
If .Exist(nMINWAIT) Then
	.Set GlobalDictionary("NewActivity")
	Reporter.ReportEvent micDone,"The Activity name is set with","with"&GlobalDictionary("NewActivity")
End If
End  With 

'CLick on Seafh button
With Browser("PeopleSoft Browser").Page("TransationList").PSFrame("Transation List").WebButton("Search")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With

For i=0 to 1
	app_SearchSync()
Next


'Select the analysis group
With Browser("PeopleSoft Browser").Page("TransationList").PSFrame("Transation List").WebEdit("Analysis group")
If .Exist(nMINWAIT) Then
	.Set GlobalDictionary("AnalysisGroup")
End If
End  With 

'Enter the dates
With Browser("PeopleSoft Browser").Page("TransationList").PSFrame("Transation List").WebEdit("From date")
If .Exist(nMINWAIT) Then
	.Set dateadd("m","-1",Date)
End If
End  With 

With Browser("PeopleSoft Browser").Page("TransationList").PSFrame("Transation List").WebEdit("Through Date")
If .Exist(nMINWAIT) Then
	.Set Date
End If
End  With 

'CLick on Searfh buttoinb
With Browser("PeopleSoft Browser").Page("TransationList").PSFrame("Transation List").WebButton("Search")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 

For i=0 to 1
	app_SearchSync()
Next

On Error Resume Next
'Verify whether trancation is present
With Browser("PeopleSoft Browser").Page("TransationList").PSFrame("Transation List").WebElement("TranscationAmount")
If .Exist(nMINWAIT) Then
	appTransAmount=.GetROProperty("innertext")
	If CInt(GlobalDictionary("Amount"))=Cint(appTransAmount) Then
		Reporter.ReportEvent micDone,"The transcation is present","in the list"
	End If
End If
End  With 
On Error Goto 0 

'Click on No button

With Browser("PeopleSoft Browser").Page("TransationList").WebButton("No")
If .Exist(nMINWAIT) Then
	.Click
End If
End  With 
End Function

'**************************************************************************************************************
''' <summary> 
''' Function to run the EX_TRAN_PRCS process for the PC tests
''' </summary>
''' <author>Stephen King</author>
''' <startstate></startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
''' <param>functionName - name of the function calling this. Used for reporting.</param>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function ExpenseTransactionProcessingPost(functionName)
	Dim strDate, strTemp
	Dim arrTemp
	Dim oldNum, newNum
	Dim nResult, sSQL, arrRecordValues, arrSqlTemp()

	'Navigate to Travel and Expenses > Process Expenses > Expense Processing
	If SelectMainMenu1(GlobalDictionary("ExpenseProcessing")) = True Then
		WriteToReport micPass, functionName, "On the Expense Processing page.", False
	Else
		WriteToReport micFail, functionName, "Not on the Expense Processing page.", True
		ExitTest
	End If

	With Browser("Peoplesoft Browser").Page("Expense Processing").PSFrame("TargetContent")

		'Use an existing run id
		.WebEdit("RunID").Set "PCReport"
		.WebButton("Search").Click
		Browser("Peoplesoft Browser").Sync
		WriteToReport micDone, functionName & " - Run Control", "Run control used - PCReport", False

		'Check if our run ID got erased
		If .WebEdit("RunID").Exist(5) Then
			'click Add New Value linke
			.Link("Add a New Value").Click

			'Click "Add" button. Run ID is carried over, no need to enter it again
			.WebButton("AddNewValue").Click
			Browser("Peoplesoft Browser").Sync
			WriteToReport micDone, functionName & " - Run Control", "Run control used - PCReport", False
		End If

		'Popup handling, sometimes appears due to business units
		If Browser("Peoplesoft Browser").Page("Expense Processing").WebButton("OK").Exist(10) Then
			Browser("Peoplesoft Browser").Page("Expense Processing").WebButton("OK").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Confirm we're on the correct page
		If .WebTabStrip("WebTabStrip").Exist(5) Then
			WriteToReport micPass, functionName & " - Expense Processing Page", "On Expense Processing page", False
		Else
			WriteToReport micFail, functionName & " - Expense Processing Page", "Not on Expense Processing page. Exiting test.", False
			ExitTest
		End If

		'Set up our business units for the test
		'Enter our data
		.WebTabStrip("WebTabStrip").Select "Selected Business Units"
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")
		.WebButton("Add").Click
		.WebButton("Save").Click
		Browser("Peoplesoft Browser").Sync
		WriteToReport micPass, functionName & " - Business Unit", "Business Unit " & GlobalDictionary("BusinessUnit") & " entered.", False

		'Return back to the previous page
		.Link("Expense Processes").Click
		Browser("Peoplesoft Browser").Sync

		'Clear any processing options
		.WebButton("Deselect All").Click

		'Select the chosen process, and store the expense report count
		'If this function ever needs to be modified for more post options, check SharedExpenseProcessingPost in PSFIN_Expenses
		.WebCheckBox("PostLiabilities").Set "ON"
		WriteToReport micPass, functionName & " - Process", "Test option Post Liabilities set.", False

		'Click Save
		.WebButton("Save").Click
		Browser("Peoplesoft Browser").Sync

		'Click Refresh
		.WebButton("Refresh").Click
		Browser("Peoplesoft Browser").Sync

		'Store the number which we use for one immediate validation and one after running the process
		oldNum = .WebElement("LiabilitiesCount").GetROProperty("Innertext")

		'Confirm we have at least one, otherwise our created expense is not ready for processing. While we can't confirm here that ours is one of them, if we have zero then we know for sure it isn't.
		If oldNum >= 1 Then
			WriteToReport micPass, functionName & " - Liabilities Results", oldNum & " liabilities found for processing.", False
		Else
			WriteToReport micWarning, functionName & " - Liabilities Results", "No liabilities found for processing. Exiting test.", False
			'ExitTest
		End If

		'Start the process 
		.WebButton("Run").Click
		Browser("Peoplesoft Browser").Sync
	End With

	'Process popup window
	With Browser("Peoplesoft Browser").Page("Expense Processing").PSFrame("Process Scheduler Request")

		'Run our Transaction Process
		.WebCheckBox("TransactionProcessFlag").Set "ON"

		'Grab our process name
		strTemp = .WebElement("TransactionProcessName").GetROProperty("Innertext")
		If strTemp <> "" Then
			GlobalDictionary("Process") = strTemp
			WriteToReport micDone, functionName & " - Process Name", strTemp, False
		End If

		'Click OK
		.WebButton("OK").Click
		Browser("Peoplesoft Browser").Sync
	End With

	'Return to the main screen
	With Browser("Peoplesoft Browser").Page("Expense Processing").PSFrame("Status Bar")

		'Grab the Instance number of the new process
		strTemp = .WebElement("InstanceNumber").GetRoProperty("innertext")
		arrTemp = Split(strTemp, ":")
		GlobalDictionary("InstanceNumber") = arrTemp(1)
		WriteToReport micDone, functionName & " - Instance number", arrTemp(1), False

		'Needs the process monitor link clicked
		.Link("Process Monitor").Click
	End With

	'Run the process
	GlobalDictionary("ClearName") = True
	SharedProcessMonitor functionName

	'Return back to the original screen
	Browser("Peoplesoft Browser").Page("Process Monitor").PSFrame("Process Monitor").Link("Go back").Click

	'Close the Save popup in case it appears
	If Browser("Peoplesoft Browser").Page("Process Monitor").WebButton("No").Exist Then
		Browser("Peoplesoft Browser").Page("Process Monitor").WebButton("No").Click
		Browser("Peoplesoft Browser").Sync
	End If

	With Browser("Peoplesoft Browser").Page("Expense Processing").PSFrame("Expenses Transaction Process")

		'Grab our new count
		newNum = .WebElement("LiabilitiesCount").GetROProperty("Innertext")
	End With

	'Compare our numbers after processing
	If oldNum >= newNum Then
		WriteToReport micPass, functionName & " - Expense Report count", "Current report count is " & newNum & ", previous was " & oldNum, False
	Else
		WriteToReport micFail, functionName & " - Expense Report count", "Current report count is " & newNum & ", previous was " & oldNum, True
	End If
End Function
