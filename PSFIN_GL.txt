Option Explicit
'**************************************************************************************************************
''' <summary> 
''' Shared code for our tests involving the Create/Update Journal Entry page
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>June 21, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter: FunctionName - the name of the function calling this so we can have accurate reporter statements
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function SharedCreateEditUpdateJournalStart(functionName, negativeTest)

	'Log out of our current user and in as our test user
	'login(GlobalDictionary("SignInUser"))

	'Navigate to the PeopleSoft Create/Update Journal Entries page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection1")) = True Then
		WriteToReport micPass, functionName & " - Create/Edit Journal Page", "On the Create/Update Journal Entries page.", False
	Else
		WriteToReport micFail, functionName & " - Create/Edit Journal Page", "Navigation to Create/Update Journal Entries page failed. Exiting test.", True
		ExitTest
	End If

	Browser("PeopleSoft Browser").Sync

	'Use our OR for the remainder of the function
	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Ensure that we're on the right page. Sometimes it stays on the last tab you were on
		If .Link("Find an Existing Value").Exist(5) Then
			.Link("Find an Existing Value").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Click the clear button so we don't filter by anything that we don't want
		.WebButton("Clear").Click

		Wait 3

		'Set our Business Unit
		.WebEdit("Journal Business Unit").Set GlobalDictionary("BusinessUnit")

		'Set our journal status if the test needs it
		If GlobalDictionary("Status") <> "" Then
			.WebList("Journal Status").Select GlobalDictionary("Status")	
		End If

		'Set our Attachment status if the test needs it
		If GlobalDictionary("Attachment") <> "" Then
			.WebList("Journal Attachment").Select "Y" 'GlobalDictionary("Attachment")
		End If

		'Set our Entered By status if the test needs it
		If GlobalDictionary("EnteredBy") <> "" Then
			.WebEdit("Entered By").Set GlobalDictionary("EnteredBy")
		End If

		'Set our journal ID if we have one
		If GlobalDictionary("JournalID") <> "" Then
			.WebEdit("Journal ID").Set GlobalDictionary("JournalID")
		End If

		'Click the search button 
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Page("Create/Update Journal").Sync

		'Validate that we have search results. If we only have one journal result then it automatically takes us to that page. Otherwise there's a table.
		If .Link("Journal Date").Exist(5) OR .WebElement("Journal ID").Exist(5) Then
			If negativeTest Then
				WriteToReport micFail, functionName & " - Journal Validation", "Valid journal(s) found when expecting none. Exiting test.", True
				ExitTest
			Else
				WriteToReport micPass, functionName & " - Journal Validation", "Valid journal(s) found!", False
			End If
		Else
			If negativeTest Then
				WriteToReport micPass, functionName & " - Journal Validation", "No journal(s) found when not expecting any", False
			Else
				WriteToReport micFail, functionName & " - Journal Validation", "No valid journal(s) found. Exiting test.", True
				ExitTest
			End If
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Validate an error on the journal results page
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>June 15, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function ValidateJournalWithComboErrors	'GL 1.03
	Dim journalID

	'Create our combo error data ourselves
	SharedCreateAddJournal "ValidateJournalWithComboErrors", True

	'Use our OR for the remainder of the function
	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'After our Add function, navigate to the Errors tab if we aren't already there
		If .Link("Errors").Exist(5) Then
		
			'Click on the errors link
			.Link("Errors").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Check for Header errors
		If .Link("text:="& GlobalDictionary("BusinessUnit")).Exist(5) Then
			WriteToReport micPass, "ValidateJournalWithComboErrors - Error Checking", "Header error line for journal ID and business unit found.", False
		Else
			WriteToReport micFail, "ValidateJournalWithComboErrors - Error Checking", "Header error line for journal ID and business unit not found.", False
		End If

		'Check for the Line errors table and specifically the first row existing 'and the first row not being blank
		If .WebElement("Line Error Line 1").Exist(5) Then 'And .WebElement("Line Error Line 1").GetROProperty("innertext") <> "" Then
			WriteToReport micPass, "ValidateJournalWithComboErrors - Error Checking", "Line error line for journal ID and business unit found.", False
		Else
			WriteToReport micFail, "ValidateJournalWithComboErrors - Error Checking", "Line error line for journal ID and business unit not found.", False
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Delete a journal
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>June 18, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'01/21/2019			Stephen King	Commented out the "date" link clicking as the newest journals are unable to be edited in all business units. Can remove if we create an end-to-end delete journal test
'______________________________________________________ 
'**************************************************************************************************************
Public Function DeleteJournal	'GL 1.14
	Dim journalID

	'Call our shared journal search code with our function name and a flag for negative testing
	SharedCreateEditUpdateJournalStart "DeleteJournal", False

	'Use our OR for the remainder of the function
	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'If there are more than one journals returned
		If .Link("Journal Date").Exist(5) Then
			'Click the sort by date link twice to sort in Descending order and grab the most recent journal
			'.Link("Journal Date").Click
			'.Link("Journal Date").Click

			'Store the journal ID that we will be processing
			journalID = .Link("Journal ID").GetROProperty("innertext")

			'Click on the first journal link
			.Link("Journal ID").Click
			Browser("PeopleSoft Browser").Sync

			'Ensure that the journal results page loaded
			If .Link("Errors").Exist(5) Then
				WriteToReport micPass, "DeleteJournal - Journal Results Page", "Journal results page loaded", False
			Else
				WriteToReport micFail, "DeleteJournal - Journal Results Page", "Journal results page did not load. Exiting test.", True
				ExitTest
			End If
		Else
			journalID = .WebElement("Journal ID").GetROProperty("innertext")
		End If

		'Output our soon-to-be-deleted journal id
		WriteToReport micPass, "DeleteJournal - Journal ID", "The journal to be deleted is " & journalID, False

		'Click on the Lines link
		.Link("Lines").Click
		Browser("PeopleSoft Browser").Sync

		'Set our process to 'Delete Journal'
		If .WebList("Journal Process").Exist(5) Then
			WriteToReport micPass, "DeleteJournal - Lines Page", "Lines page loaded successfully.", False
		Else
			WriteToReport micFail, "DeleteJournal - Lines Page", "Lines page did not loaded successfully. Exiting test.", True
			ExitTest
		End If

		'Select "Delete Process"
		.WebList("Journal Process").Select "Delete Journal"

		'Click the Process button
		.WebButton("Process").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm that we mean to delete it
		Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("Yes").Click
		Browser("PeopleSoft Browser").Sync
		Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync

		'Ensure that we are back on the Create/Update Journal Entries page
		If .WebButton("Clear").Exist(5) Then
			WriteToReport micPass, "DeleteJournal - Create/Update Journal Entries Page", "On the Create/Update Journal Entries page.", False
		Else
			WriteToReport micFail, "DeleteJournal - Create/Update Journal Entries Page", "Navigation to Create/Update Journal Entries page failed. Exiting test.", True
			ExitTest
		End If

		'Run a negative test to ensure that the journal has been deleted
		GlobalDictionary("JournalID") = journalID
		SharedCreateEditUpdateJournalStart "DeleteJournal", True
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Create a journal and add 3 attachments
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>June 18, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CreateJournalWithAttachments	'GL 1.18
	Dim i

	'Call our shared journal creation code with our function name for reporting and a flag for negative testing
	SharedCreateAddJournal "CreateJournalWithAttachments", False

	'Process our newly created journal
	SharedProcessJournal "CreateJournalWithAttachments", False

	'Log out of cdw_batch and back in as our test user
	login(GlobalDictionary("SignInUser"))

	'Search for our recently processed journal
	SharedCreateEditUpdateJournalStart "CreateJournalWithAttachments", False

	'Submit journal for approval
	SharedSubmitForApproval "CreateJournalWithAttachments", False

	'Log out of our admin user and back in as our test user
	login(GlobalDictionary("SignInUser"))

	'Search for our finished journal
	SharedCreateEditUpdateJournalStart "CreateJournalWithAttachments", False

	'Click on the attachment link and confirm that all attachments exist
	Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").Link("Attachments").Click
	Browser("PeopleSoft Browser").Sync
	For i = 1 To GlobalDictionary("Attachment")
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Journal Entry Attachments").Link("html id:=VIEWBUTTON\$" & i - 1).Exist(3) Then
			WriteToReport micPass, "CreateJournalWithAttachments - Attachment", "Attachment number " & i & " found!", False
		Else
			WriteToReport micFail, "CreateJournalWithAttachments - Attachment", "Attachment number " & i & " not found. Please check the page or the data.", True
		End If
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Attempt to delete an attachment on a posted journal
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>June 18, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Attachment not deleted</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function DeleteAttachmentOnPostedJournal	'GL 1.19
	Dim journalID

	'Call our shared journal search code with our function name and a flag for negative testing
	SharedCreateEditUpdateJournalStart "DeleteAttachmentOnPostedJournal", False

	'Use our OR for the remainder of the function
	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Click the sort by date link twice to sort in Descending order and grab the most recent journal
		.Link("Journal Date").Click
		.Link("Journal Date").Click

		'Store the journal ID that we will be processing
		journalID = .Link("Journal ID").GetROProperty("innertext")
		WriteToReport micPass, "DeleteAttachmentOnPostedJournal - Journal ID", "The journal to be processed is " & journalID, False

		'Click on the first journal link
		.Link("Journal ID").Click
		Browser("PeopleSoft Browser").Sync

		'Ensure that the journal results page loaded
		If .Link("Attachments").Exist(5) Then
			WriteToReport micPass, "DeleteAttachmentOnPostedJournal - Journal results Page", "Journal results page loaded", False
		Else
			WriteToReport micFail, "DeleteAttachmentOnPostedJournal - Journal results Page", "Journal results page did not load. Exiting test.", True
			ExitTest
		End If

		'Click on the Attachments link
		.Link("Attachments").Click
		Browser("PeopleSoft Browser").Sync
	End With

	With Browser("PeopleSoft Browser").Page("Create/Update Journal")

		'Confirm that the Delete Attachments button exists
		If .PSFrame("Journal Entry Attachments").WebButton("Delete Attachment").Exist(5) Then
			WriteToReport micPass, "DeleteAttachmentOnPostedJournal - Delete Attachment Button", "Delete Attachment button found.", False
		Else
			WriteToReport micFail, "DeleteAttachmentOnPostedJournal - Delete Attachment Button", "Delete Attachment button not found. Check page and object properties. Exiting test.", True
			ExitTest
		End If

		'Click "Delete Attachment" button
		.PSFrame("Journal Entry Attachments").WebButton("Delete Attachment").Click

		'Click the OK button
		.WebButton("Alert OK").Click

		'Confirm that we can't delete the attachment(s)
		If .WebButton("OK").Exist(5) Then
			.WebButton("OK").Click
			WriteToReport micPass, "DeleteAttachmentOnPostedJournal - Delete Attachment Warning", "Delete Attachment Warning found. Unable to delete attachment.", False
		Else
			WriteToReport micFail, "DeleteAttachmentOnPostedJournal - Delete Attachment Warning", "Delete Attachment Warning not found. Able to delete attachment. Exiting test.", True
			ExitTest
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Confirm that we have a Canadian Journal based on the business unit.
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>June 19, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Canadian journal entry found</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function ConfirmCanadianJournal	'GL 1.21

	'Call our shared Add Journal code with our function name and a flag for negative testing
	SharedCreateAddJournal "ConfirmCanadianJournal", False
	
	'Call our shared Verify CORPORATE ledger
	SharedVerifyCORPORATELEDGER "ConfirmCanadianJournal", False
	
	'Call our shared journal approval code with the function name for reporting and a flag for negative testing
	SharedSubmitForApproval "ConfirmCanadianJournal", False

	'Call our shared process journal code with the function name for reporting and a flag for negative testing
	SharedProcessJournal "ConfirmCanadianJournal", False
	
	'Log out of cdw_batch and back in as our test user
	login(GlobalDictionary("SignInUser"))

	'Search for our recently processed journal
	SharedCreateEditUpdateJournalStart "ConfirmCanadianJournal", False
End Function

'**************************************************************************************************************
''' <summary> 
''' Create a journal using data from the spreadsheet
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>June 25, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user at the Add Journal page</startstate>
''' <endstate>Journal created</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'30July2018			Eric Trout		Updated sync with .exist of Message due to Runtime Error
'02Jan2019			Eric Trout		Add option to use Create Date if in datasheet
'	17JAN19			Brian B.		Added second Canada exception to line add, BU 00012.
'	12MAR19			Eric Trout		Added small wait to allow time for attachment path to populate
'	April 26, 2019  Stephen King	Added a check for tests that don't have account or dept IDs and have the script pick the first valid option
'______________________________________________________ 
'**************************************************************************************************************
Public Function SharedCreateAddJournal(functionName, negativeTest)
	Dim i, sMessage, nRows, nTemplate

	'Navigate to the PeopleSoft Create/Update Journal Entries page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection1")) = True Then
		WriteToReport micPass, functionName & " - Create/Update Journal Entries page", "On the Create/Update Journal Entries page.", False
	Else
		WriteToReport micFail, functionName & " - Create/Update Journal Entries page", "Navigation to Create/Update Journal Entries page failed. Exiting test.", True
		ExitTest
	End If

	'Use the Object Repository and cleaner code
	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Ensure we are on the Add A New Value page
		If .Link("Add a New Value").Exist(5) Then
			.Link("Add a New Value").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Enter our business unit
		.WebEdit("Header Business Unit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, functionName & " - Business Unit", "Business unit being used is " & GlobalDictionary("BusinessUnit"), False

		'If Create Date has a value us that date
		If GlobalDictionary("JournalDate") <> "" Then
			.WebEdit("Header_JOURNAL_DATE").Set GlobalDictionary("JournalDate")
		End If

		'Click the Add button to go to the next page
		.WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Enter the necessary fields for creating our journal

		'Enter our Ledger value(required in FNREG, not required in FNQA)
		If GlobalDictionary("Ledger") <> "" Then
			.WebEdit("Ledger Group").Set GlobalDictionary("Ledger")
		End If

		'Enter our source(usually AR or BI)
		.WebEdit("Header Source").Set GlobalDictionary("Source")

		'If we have a description
		If GlobalDictionary("Description") <> "" Then
			.WebEdit("Header_DESCRIPTION").Set GlobalDictionary("Description")
		End If

		'If we have a reversal setting
		If GlobalDictionary("Reversal") <> "" Then

			'Click the Reversal link
			.Link("Reversal: Do Not Generate").Click
			Browser("PeopleSoft Browser").Page("Create/Update Journal").Frame("Journal Entry Reversal").WebRadioGroup("Header").Select GlobalDictionary("Reversal")
			Browser("PeopleSoft Browser").Page("Create/Update Journal").Frame("Journal Entry Reversal").WebButton("OK").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'If we have any attachments to enter
		If GlobalDictionary("Attachment") <> "" Then

			'Click on the Attachment Link
			.Link("Attachments").Click
			For i = 1 To GlobalDictionary("Attachment")

				'Click the Add button
				Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Journal Entry Attachments").WebButton("Add Attachment").Click
				Browser("PeopleSoft Browser").Sync

				'Enter the path to our test file
				Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("File Attachment").WebFile("Browse").Set GlobalDictionary("FilePath") & i & ".pdf"
				'Give time for filepath to populate and take
				wait(5)
				Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("File Attachment").WebButton("Upload").Click
			Next

			Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Journal Entry Attachments").WebButton("Ok").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Click the Lines tab to enter data on the second page
		.WebTabStrip("WebTabStrip").Select "Lines"
		Browser("PeopleSoft Browser").Sync

		'***********Use GlobalDictionary("Project") as flag to change Template
		If GlobalDictionary("Project") <> "" OR  GlobalDictionary("ProjectID") <> "" Then		
			.Link("Template List").Click

			'use to pull number of Rows
			nRows = Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Journal Entry Template List").WebTable("Journal_Templates").GetROProperty("rows")

			For i = 0 To nRows - 1
				Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Journal Entry Template List").WebElement("Template_ID").SetTOProperty "html id", "JRNL_TMPLT_VW_TMPLT_ID$" & i
				
				nTemplate = Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Journal Entry Template List").WebElement("Template_ID").GetROProperty("innertext")
				
				Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Journal Entry Template List").WebCheckBox("Select_Template").SetTOProperty "name", "JRNL_TMPLT_VW_SELECTED_FLAG$"&i
				
				'Select for Project and unselect for all others
				If TRIM(nTemplate) = "PROJECT" Then
					Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Journal Entry Template List").WebCheckBox("Select_Template").Set "ON"
				Else
					Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Journal Entry Template List").WebCheckBox("Select_Template").Set "OFF"
				End If
			Next

			Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Journal Entry Template List").WebButton("OK").Click
		End If

		'Set our first line account.
		If Trim(GlobalDictionary("Account1")) <> "" Then
			.WebEdit("Account").Set GlobalDictionary("Account1")
		Else
			'Bring up the Account search frame if needed
			.Image("Look up Account").Click
			Browser("PeopleSoft Browser").Sync

			'Check that we have results, otherwise exit the test
			If Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Account").Link("FirstAccount").Exist(5) Then

				'Store the value
				GlobalDictionary("Account1") = Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Account").Link("FirstAccount").GetROProperty("text")
				WriteToReport micDone, functionName & " - Account", "Account " & GlobalDictionary("Account1") & " selected", False

				'Click the first valid link
				Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Account").Link("FirstAccount").Click
				Browser("PeopleSoft Browser").Sync
			Else
				WriteToReport micFail, functionName, "No valid Accounts found", True
				ExitTest
			End If
		End If

		'Exit with the journal still in 'n' state
		If GlobalDictionary("N") = "Y" Then

			'Click Save
			.WebButton("Save").Click
			Browser("PeopleSoft Browser").Sync

			'Check for a confirmation popup(might not appear if there was a process involved)
			If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Click
			End If
			Exit Function
		End If

		'set our first line department
		If Trim(GlobalDictionary("Dept1")) <> "" Then
			.WebEdit("LINE1_DEPTID$0").Set GlobalDictionary("Dept1")
		Else
			'Bring up the Dept search frame
			.Image("Look up Dept").Click
			Browser("PeopleSoft Browser").Sync

			'Check that we have results, otherwise exit the test
			If Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Dept").Link("FirstDept").Exist(5) Then
				
				'Store the value
				GlobalDictionary("Dept1") = Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Dept").Link("FirstDept").GetROProperty("text")
				WriteToReport micDone, functionName & " - Dept ID", "Dept ID " & GlobalDictionary("Dept1") & " selected", False

				'Click the first valid link
				Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Dept").Link("FirstDept").Click
				Browser("PeopleSoft Browser").Sync
			Else
				WriteToReport micFail, functionName, "No valid Dept IDs found", True
				ExitTest
			End If
		End If

		'Existing Project code. Unchanged.
		If GlobalDictionary("Project") <> "" Then	

			'*********Set PC Business Unit
			.WebEdit("LINE1_BUSINESS_UNIT_PC$0").Set GlobalDictionary("PCBUSUnit")
			.WebEdit("LINE1_PROJECT_ID$0").Set GlobalDictionary("Project")	
			.WebEdit("LINE1_ACTIVITY_ID$0").Set GlobalDictionary("Activity")
			.WebEdit("LINE1_ANALYSIS_TYPE$0").Set GlobalDictionary("AnalysisType")
			
		'Project Costing flag to check if value exists in dropdown due to Project Costing tests
		ElseIf GlobalDictionary("ProjectID") <> "" Then

			'Enter our business unit in the PCBusinessUnit field
			.WebEdit("LINE1_BUSINESS_UNIT_PC$0").Set GlobalDictionary("BusinessUnit")

			'Click on the "Look Up Project" image
			.Image("Look up Project").Click
			Browser("PeopleSoft Browser").Sync

			'Enter our project ID
			Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Project").WebEdit("Project ID").Set GlobalDictionary("ProjectID")
			Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Project").WebButton("Look Up").Click
			Browser("PeopleSoft Browser").Sync

			'Check for results
			If Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Project").WebElement("No Matching Values").Exist(5) AND negativeTest Then
				WriteToReport micPass, functionName, "Project ID not found, as expected.", False
				ExitTest
			ElseIf Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Project").Link("FirstResult").Exist(1) AND Trim(Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Project").Link("FirstResult").GetROProperty("text")) = GlobalDictionary("ProjectID") Then
				WriteToReport micPass, functionName, "Project ID " & GlobalDictionary("ProjectID") & " found and expected.", False
				Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Project").Link("FirstResult").Click
				Browser("PeopleSoft Browser").Sync
			Else
				WriteToReport micFail, functionName, "Project ID " & GlobalDictionary("ProjectID") & " not found. Check data.", True
				ExitTest
			End If
			
			'If still here, determine a valid Activity
			.Image("Look up Activity").Click
			Browser("PeopleSoft Browser").Sync

			'Check that we have results, otherwise exit the test
			If Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Activity").Link("FirstResult").Exist(5) Then

				'Store the value
				GlobalDictionary("Activity") = Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Activity").Link("FirstResult").GetROProperty("text")
				WriteToReport micDone, functionName & " - Activity", "Activity " & GlobalDictionary("Activity") & " selected", False

				'Click the first valid link
				Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("Look Up Activity").Link("FirstResult").Click
				Browser("PeopleSoft Browser").Sync
			Else
				WriteToReport micFail, functionName, "No valid Activities found", True
				ExitTest
			End If

			'Enter our analysis type
			.WebEdit("LINE1_ANALYSIS_TYPE$0").Set GlobalDictionary("AnalysisType")
		End If

		'Set our first line amount
		Wait 1
		.WebEdit("Foreign Amount").Set GlobalDictionary("Amount")

		'Enter our affiliate(if any)
		If GlobalDictionary("Affiliate") <> "" Then
			.WebEdit("LINE1_AFFILIATE$0").Set GlobalDictionary("Affiliate")
		End If

		'Check our data if we have another line to add
		If GlobalDictionary("Account2") <> "" Then

			'Click the + button to add a new line to our journal
			.WebButton("Add Journal Line").Click
			Browser("PeopleSoft Browser").Sync

			'Enter a bad business unit if doing a negative test, except for Canada
			If negativeTest Then
				If GlobalDictionary("BusinessUnit") = "00017" OR GlobalDictionary("BusinessUnit") = "00012" Then
					.WebEdit("LINE2_BUSINESS_UNIT$1").Set GlobalDictionary("BusinessUnit")
				Else
					.WebEdit("LINE2_BUSINESS_UNIT$1").Set "00000"
				End If
			End If

			'Set our second account.
			.WebEdit("LINE2_ACCOUNT$1").Set GlobalDictionary("Account2")

			'set our second department
			.WebEdit("LINE2_DEPTID$1").Set GlobalDictionary("Dept2")

			'Set our second amount
			Wait 1
			.WebEdit("LINE2_FOREIGN_AMOUNT$1").Set "-" & GlobalDictionary("Amount")

			'Enter our affiliate(if any)
			If GlobalDictionary("Affiliate") <> "" Then
				.WebEdit("LINE2_AFFILIATE$1").Set GlobalDictionary("Affiliate")
			End If
		End If

		'Add a second pair of lines if needed - ex, 1.09
		If GlobalDictionary("BusinessUnit2") <> "" Then

			'Click the + button to add a new line to our journal
			.WebButton("Add Journal Line").Click
			Browser("PeopleSoft Browser").Sync

			'Set our new business unit
			.WebEdit("LINE3_BUSINESS_UNIT$2").Set GlobalDictionary("BusinessUnit2")
			WriteToReport micDone, functionName & " - Second Business Unit", "Second business unit being used is " & GlobalDictionary("BusinessUnit2"), False

			'Set our first line account.
			.WebEdit("LINE3_ACCOUNT$2").Set GlobalDictionary("Account1")

			'set our first line department
			.WebEdit("LINE3_DEPTID$2").Set GlobalDictionary("Dept1")

			'Set our first line amount
			.WebEdit("LINE3_FOREIGN_AMOUNT$2").Set GlobalDictionary("Amount2")

			'Click the + button to add a new line to our journal
			.WebButton("Add Journal Line").Click
			Browser("PeopleSoft Browser").Sync

			'Repeat the above on the new line
			.WebEdit("LINE4_BUSINESS_UNIT$3").Set GlobalDictionary("BusinessUnit2")

			'Set our second account.
			.WebEdit("LINE4_ACCOUNT$3").Set GlobalDictionary("Account2")

			'set our second department
			.WebEdit("LINE4_DEPTID$3").Set GlobalDictionary("Dept2")

			'Set our second amount
			.WebEdit("LINE4_FOREIGN_AMOUNT$3").Set "-" & GlobalDictionary("Amount2")
		End If

		'Click Save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Check for a confirmation popup(might not appear if there was a process involved)
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
			Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Click
		End If

		'Select our process with (if any)
		If GlobalDictionary("Process_Status") <> "" Then
			.WebList("Journal Process").Select GlobalDictionary("Process_Status")

			'Click the Process button
			.WebButton("Process").Click
			'Browser("PeopleSoft Browser").Sync

			'Certain processes require an extra confirmation
			If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("Yes").Exist(30) Then
				Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("Yes").Click
				Browser("PeopleSoft Browser").Sync
			End If

			'Look for journal Saved Message as sync due to Browser Sync causing Replay error
			If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebElement("JournalMessage").Exist(180) Then
				sMessage = Browser("PeopleSoft Browser").Page("Create/Update Journal").WebElement("JournalMessage").GetROProperty("innertext")
				WriteToReport micPass, functionName, sMessage, False
			End If

			'Click OK
			If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(30) Then
				Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Click
			End If

			'Click Save
			.WebButton("Save").Click
			Browser("PeopleSoft Browser").Sync

			'Check for a confirmation popup(might not appear if there was a process involved)
			If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Click
			End If
		End If

		'Click Save
'		.WebButton("Save").Click
'		Browser("PeopleSoft Browser").Sync
'
'		'Check for a confirmation popup(might not appear if there was a process involved)
'		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
'			Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Click
'		End If

		'Confirm our journal status	
		If Not negativeTest Then
			If Trim(.WebElement("Journal Status").GetROProperty("innertext")) = "V" Then
				WriteToReport micPass, functionName & " - Journal Created", "Journal created with no errors", False
			Else
				WriteToReport micFail, functionName & " - Journal Created", "Journal not created successfully. Status is " & .WebElement("Journal Status").GetROProperty("innertext") & ". Exiting test.", True
				ExitTest
			End If
		Else
			If Trim(.WebElement("Journal Status").GetROProperty("innertext")) <> "V" Then
				WriteToReport micPass, functionName & " - Journal Created", "Journal created with errors", False
			Else
				WriteToReport micFail, functionName & " - Journal Created", "Journal created successfully. Status is " & .WebElement("Journal Status").GetROProperty("innertext") & ". Exiting test.", True
				ExitTest
			End If
		End If

		'store our new journal ID
		GlobalDictionary("JournalID") = .WebElement("Journal ID").GetROProperty("innertext")
		If GlobalDictionary("JournalID") <> "" Then
			WriteToReport micPass, functionName & " - Journal ID", "Successfully created journal with ID: " & GlobalDictionary("JournalID"), False
		Else
			WriteToReport micFail, functionName & " - Journal ID", "Could not create journal. Exiting test.", True
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Create a reversing journal using data from the spreadsheet
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>June 25, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Reversing Journal created</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CreateReverseJournal	'1.07

	'Call our shared journal add code with our function name for reporting and a flag for negative testing
	'We're passing a true flag here as our created journal does not have a flag of V. Just N.
	SharedCreateAddJournal "CreateReverseJournal", False

	'Call our shared journal approval code with the function name for reporting and a flag for negative testing
	'SharedSubmitForApproval "CreateReverseJournal", False

	'Call our shared process code now that we have to post this journal
	SharedProcessJournal "CreateReverseJournal", False
	
	'Log out of cdw_batch and back in as our test user
	login(GlobalDictionary("SignInUser"))

	'Search for our recently processed journal
	SharedCreateEditUpdateJournalStart "CreateReverseJournal", False
End Function

'**************************************************************************************************************
''' <summary> 
''' Post journals in various statuses
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>June 27, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Journals posted if supposed to, declined if supposed to</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function BatchPostJournals	'1.05
	Dim arrRecordValues, arrSearchValues(2, 2)
	Dim nResult
	Dim sResults, sValue
	Dim count, i, x

	arrSearchValues(0, 0) = GlobalDictionary("SQL1")
	arrSearchValues(0, 1) = False
	arrSearchValues(0, 2) = GlobalDictionary("SQLCount1")
	arrSearchValues(1, 0) = GlobalDictionary("SQL2")
	arrSearchValues(1, 1) = True
	arrSearchValues(1, 2) = GlobalDictionary("SQLCount2")
	arrSearchValues(2, 0) = GlobalDictionary("SQL3")
	arrSearchValues(2, 1) = True
	arrSearchValues(2, 2) = GlobalDictionary("SQLCount3")

	For x = 0 To UBound(arrSearchValues)

		'Reset our array in case of bad search results
		If IsArray(arrRecordValues) Then
			Erase arrRecordValues
		End If

		'Check that data exists, otherwise we need to create it
		dbGetFirstRecord arrSearchValues(x, 2), "", arrRecordValues, "GL_01_05_Count_" & x
		DataTable.SetCurrentRow(1)
		count = DataTable.Value("", "GL_01_05_Count_" & x)
		'count = 0
		If count = 0 OR count = "0" Then
			'Set our global flags
			GlobalDictionary("Process_Status") = GlobalDictionary("Process_Status" & i)
			GlobalDictionary("Reversal") = GlobalDictionary("Reversal" & i)
			SharedCreateAddJournal "BatchPostJournals", False
		End If

		'Reset our array in case of bad search results
		If IsArray(arrRecordValues) Then
			Erase arrRecordValues
		End If

		'Call our SQL function
		arrRecordValues = FindJournalsByPostedStatus(arrSearchValues(x, 0))

	    'Confirm that we have results from our SQL query, exit otherwise
	    On Error Resume Next
		nResult = UBound(arrRecordValues)
		If nResult > 0 Then

	        'Storing our journal info for later use
	        GlobalDictionary("JournalID") = ArrRecordValues(1)
	        GlobalDictionary("JournalDate") = ArrRecordValues(2)
	        GlobalDictionary("Ledger") = ArrRecordValues(9)
	        GlobalDictionary("Source") = ArrRecordValues(21)
	        GlobalDictionary("InitialValue") = arrRecordValues(26)
	        WriteToReport micPass, "BatchPostJournals - Test Step " & x + 1 & " - SQL Query Executed", "SQL query successfully executed. Journal ID is " & GlobalDictionary("JournalID") & ".", False
	    Else
	    	On Error Goto 0
	    	WriteToReport micFail, "BatchPostJournals - Test Step " & x + 1 & " - SQL Query Executed", "SQL query successfully executed. However, no values were returned and the test will stop.", False
	    	ExitTest
		End If

		'Process the journal
		GlobalDictionary("Process") = "GL_JP"
		SharedProcessJournal "BatchPostJournals", False

		'Check that the process worked successfully. So the current journal status should not match the initial search parameter
		arrRecordValues = FindJournal(GlobalDictionary("JournalID"))

		'Confirm that we have results from our SQL query, exit otherwise
	    On Error Resume Next
		nResult = UBound(arrRecordValues)
		If nResult > 0 Then

			'Confirm that the journals behaved appropriately given the nature of the test step
			If  arrSearchValues(x, 1) = False Then
				If arrRecordValues(26) = "P" Then
	    			WriteToReport micPass, "BatchPostJournals - Test Step " & x + 1 & " - Status", "Journal expected to update and post, and successfully did so after test ran. Currently " & arrRecordValues(26) & ", was " & arrSearchValues(x, 0) & ".", False
	    		Else
		    		On Error Goto 0
		    		WriteToReport micFail, "BatchPostJournals - Test Step " & x + 1 & " - Status", "Journal did not update or post after test run. Still " & arrRecordValues(26) & ". Exiting test.", False
		    		ExitTest
		    	End If
	    	Else
	    		If arrRecordValues(26) <> GlobalDictionary("InitialValue") Then
	    			On Error Goto 0
	    			WriteToReport micFail, "BatchPostJournals - Test Step " & x + 1 & " - Negative test status", "Journal updated and posted after test run. Unexpected result. Currently " & arrRecordValues(26) & ", was " & GlobalDictionary("InitialValue") & ". Exiting test.", False
	    			ExitTest
	    		Else
	    			WriteToReport micPass, "BatchPostJournals - Test Step " & x + 1 & " - Negative test Status", "Journal did not update and post, which is intended. Still showing as " & GlobalDictionary("InitialValue"), False
	    		End If
			End If
	    Else
	    	On Error Goto 0
	    	WriteToReport micFail, "BatchPostJournals  - No Status - Journal ID not found", "Unable to return results based on journal ID " & GlobalDictionary("JournalID") & ".", False
	    	ExitTest
		End If
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Unpost journals in various statuses
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>June 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Journals posted if supposed to, declined if supposed to</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function BatchUnpostJournals	'1.08
	Dim arrRecordValues, arrDate, arrCommands(3, 2)
	Dim nResult
	Dim sDate, sValue
	Dim count, i, j
	Dim unpostedJournalID
	Dim acct2, dept2, ledger, src, jrnlDate

	'Populate our commands so we can execute all our test steps in a loop
	'Journal status - P, U, N, E, V
	'arrCommands(0, 0) = "Select * FROM PS_JRNL_HEADER WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND SOURCE NOT IN ('ACR', 'TAR', 'FNA') AND OPRID = '" & GlobalDictionary("SignInUser") & "' AND JRNL_HDR_STATUS = 'P' AND REVERSAL_CD ='N'" '"N"
	'arrCommands(0, 0) = "Select * FROM PS_JRNL_HEADER WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND SOURCE IN ('CNV', 'BI', 'AR') AND JRNL_HDR_STATUS = 'P' AND REVERSAL_CD ='N' AND UNPOST_SEQ = '0' AND TRANSACTION_DATE > '2018-01-01 00:00:00.000'" '"N"
	arrCommands(0, 0) = "Select * FROM PS_JRNL_HEADER WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND JRNL_HDR_STATUS = 'P' AND REVERSAL_CD ='N' AND UNPOST_SEQ = '0' AND TRANSACTION_DATE > '2019-01-01 00:00:00.000'" '"N"
	arrCommands(0, 1) = False
	arrCommands(0, 2) = "Select Count(DISTINCT JOURNAL_ID) FROM PS_JRNL_HEADER WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND JRNL_HDR_STATUS = 'P' AND REVERSAL_CD ='N' AND UNPOST_SEQ = '0' AND TRANSACTION_DATE > '2019-01-01 00:00:00.000'"
	arrCommands(1, 0) = "Select * FROM PS_JRNL_HEADER WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND JRNL_HDR_STATUS = 'P' AND REVERSAL_CD = 'X' AND UNPOST_SEQ = '0' AND TRANSACTION_DATE >= '2019-01-01 00:00:00.000'"	' & DateAdd("d", -1, Date) & "'"  '"R"
	arrCommands(1, 1) = False
	arrCommands(1, 2) = "Select Count(DISTINCT JOURNAL_ID) FROM PS_JRNL_HEADER WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND JRNL_HDR_STATUS = 'P' AND REVERSAL_CD ='X' AND UNPOST_SEQ = '0' AND TRANSACTION_DATE >= '2019-01-01 00:00:00.000'" 'AND TRANSACTION_DATE <= '" & DateAdd("d", -1, Date) & "'"	'2019-01-01 00:00:00.000'"
	'arrCommands(2, 0) = "Select * FROM PS_JRNL_HEADER WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND SOURCE NOT IN ('ACR', 'TAR', 'FNA') AND OPRID = '" & GlobalDictionary("SignInUser") & "' AND JRNL_HDR_STATUS NOT IN ('P', 'U')" 'Unposted a non-posted, non-unposted journal
	arrCommands(2, 0) = "Select * FROM PS_JRNL_HEADER WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND JRNL_HDR_STATUS NOT IN ('P', 'U')" 'Unposted a non-posted, non-unposted journal
	arrCommands(2, 1) = True
	arrCommands(2, 2) = "Select Count(DISTINCT JOURNAL_ID) FROM PS_JRNL_HEADER WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND JRNL_HDR_STATUS NOT IN ('P', 'U')"
	arrCommands(3, 0) = "Select * FROM PS_JRNL_HEADER WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND SOURCE NOT IN ('ACR', 'TAR', 'FNA') AND JRNL_HDR_STATUS = 'U'"	'Unposted journal	'AND OPRID = '" & GlobalDictionary("SignInUser") & "' 
	arrCommands(3, 1) = True
	arrCommands(3, 2) = "Select Count(DISTINCT JOURNAL_ID) FROM PS_JRNL_HEADER WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") & "' AND JRNL_HDR_STATUS = 'P' AND REVERSAL_CD ='N' AND UNPOST_SEQ = '0' AND TRANSACTION_DATE > '2018-10-01 00:00:00.000'"

	unpostedJournalID = ""
	nResult = -1
	acct2 = GlobalDictionary("Account2")
	dept2 = GlobalDictionary("Dept2")
 	ledger = GlobalDictionary("Ledger")
	src = GlobalDictionary("Source")
	jrnlDate = GlobalDictionary("JournalDate")

	For i = 0 To UBound(arrCommands)
		'Check that data exists, otherwise we need to create it
		WriteToReport micDone, "BatchUnpostJournals - Test Step " & i + 1 & " - SQL Count Query", "SQL count query is " & arrCommands(i, 2), False
		dbGetFirstRecord arrCommands(i, 2), "", arrRecordValues, "GL_01_08_Count_" & i
		DataTable.SetCurrentRow(1)
		count = DataTable.Value("", "GL_01_08_Count_" & i)
		'count = 0
		If count = 0 OR count = "0" Then
			WriteToReport micDone, "BatchUnpostJournals - Test Step " & i + 1 & " - SQL Count Executed", "SQL count executed. No data found. Creating now.", False

			'Set our global flags
			If i = 1 Then
				GlobalDictionary("Ledger") = ledger
				GlobalDictionary("Source") = src
				'GlobalDictionary("Account2") = ""
				'GlobalDictionary("Dept2") = ""
				GlobalDictionary("Reversal") = "X"
				GlobalDictionary("JournalDate") = jrnlDate
			Else
				GlobalDictionary("Ledger") = ledger
				GlobalDictionary("Source") = src
				'GlobalDictionary("Account2") = acct2
				'GlobalDictionary("Dept2") = dept2
				GlobalDictionary("Reversal") = ""
				GlobalDictionary("JournalDate") = jrnlDate
			End If

			'Create our journal
			SharedCreateAddJournal "BatchUnpostJournals", False

			'First two tests involve looking for posted journals. Others are fine with V or E
			If i = 0 OR i = 1 Then

				'Mark our created journals for post
				Login(GlobalDictionary("AdminUser"))

				'Search for our newly submitted journal
				SharedCreateEditUpdateJournalStart "BatchUnpostJournals", False

				'Go to the Approval page if we aren't already there
				With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")
					If .Link("Approval").Exist(5) Then
						.Link("Approval").Click
						Browser("Peoplesoft Browser").Sync
					End If

					'Validate we are on the Approval page
					If .WebButton("Submit").Exist(5) Then
						WriteToReport micPass, "BatchUnpostJournals - Approval Page", "Successfully loaded approval page.", False
					Else
						WriteToReport micFail, "BatchUnpostJournals - Approval Page", "Did not successfully load approval page. Exiting test.", True
						ExitTest
					End If

					'Approve
					.WebList("Approval Action").Select "Approve"
					.WebButton("Submit").Click

					'Give the process time to start, as a Sync can sometimes fail or time out
					Wait 60
					Browser("Peoplesoft Browser").Sync

					'Check for Approved status
					If .WebElement("Approved").Exist Then
						WriteToReport micPass, "BatchUnpostJournals - Journal Approved", "Journal approved.", True
					Else
						WriteToReport micWarning, "BatchUnpostJournals - Journal Approved", "Journal not approved. Check if amount doesn't require it.", True
					End If
				End With

				'Reverse journals are a day in the future
				'If i = 1 Then
				'	GlobalDictionary("JournalDate") = DateAdd("d", 1, Date)
				'End If

				'Post our journals
				GlobalDictionary("Process") = "GL_JP"
				SharedProcessJournal "BatchUnpostJournals", False
			End If

			'Log back in as our original user
			Login(GlobalDictionary("SignInUser"))
		Else
			WriteToReport micDone, "BatchUnpostJournals - Test Step " & i + 1 & " - SQL Count Executed", "SQL count executed. Count returned is " & count & ".", False
		End If

		'Call our SQL function
		'First parameter is for Status, which is based on unposted or not(0/1)
		'Second parameter is for Reversed(N/R)
		arrRecordValues = FindJournalForNegativeTesting(arrCommands(i, 0))

	    'Confirm that we have results from our SQL query, exit otherwise
	    On Error Resume Next
		nResult = UBound(arrRecordValues)
		On Error GoTo 0
		If nResult > 0 Then

	        'Storing our Journal ID for later use
	        GlobalDictionary("JournalID") = ArrRecordValues(1)

	        'Storing our Ledger Group for later use
	        GlobalDictionary("Ledger") = ArrRecordValues(9)

	        'Storing our Source for later use
	        GlobalDictionary("Source") = ArrRecordValues(21)
	        WriteToReport micPass, "BatchUnpostJournals - Test Step " & i + 1 & " - SQL Query Executed", "SQL query successfully executed. Values were returned and the test will continue.", False
	    Else
	    	'On Error Goto 0
	    	WriteToReport micFail, "BatchUnpostJournals - Test Step " & i + 1 & " - SQL Query Executed", "SQL query successfully executed. However, no values were returned and the test will stop.", False
	    	ExitTest
		End If

		'Navigate to the PeopleSoft Mark Journals For Unposting page
		If SelectMainMenu1(GlobalDictionary("UnpostSelection1")) = True Then
			WriteToReport micPass, "BatchUnpostJournals - Test Step " & i + 1, "On the Mark Journals For Unposting page.", False
		Else
			WriteToReport micFail, "BatchUnpostJournals - Test Step " & i + 1, "Navigation to Mark Journals For Unposting page failed. Exiting test.", True
			ExitTest
		End If

		'User our OR and clean up our object calls
		With Browser("PeopleSoft Browser").Page("Mark Journals for Unposting").PSFrame("Mark Journals for Unpost")

			'Enter all of the fields for searching as they are required while using our SQL results
			'Unit
			Browser("PeopleSoft Browser").Sync
			.WebEdit("Business Unit").Set GlobalDictionary("BusinessUnit")

			'Ledger group
			If arrRecordValues(9) <> "" Then
				.WebEdit("Ledger Group").Set GlobalDictionary("Ledger")
			End If

			'Fiscal Year
			If arrRecordValues(6) <> "" Then
				.WebEdit("Fiscal Year").Set arrRecordValues(6)
			End If

			'Period
			If arrRecordValues(7) <> "" Then
				.WebEdit("Period").Set arrRecordValues(7)
			End If

			'Source
			If arrRecordValues(21) <> "" Then
				.WebEdit("Source").Set arrRecordValues(21)
			End If

			'Second Row
			'Journal ID
			If arrRecordValues(1) <> "" Then
				.WebEdit("Journal ID").Set arrRecordValues(1)
			End If

			'Dates
			If arrRecordValues(2) <> "" Then

				'The date has to be in a specific format, which is different from how it's stored in the database. So we replace - with / and put it in MM/DD/YYYY format
				'arrDate = split(arrRecordValues(2), "-")
				'sDate = arrDate(1) & "/" & Left(arrDate(2), 2) & "/" & arrDate(0)

				'Date From
				.WebEdit("Date From").Set arrRecordValues(2)

				'Date To
				.WebEdit("Date To").Set arrRecordValues(2)
			End If

			'User ID
			If arrRecordValues(38) <> "" Then
				.WebEdit("User ID").Set arrRecordValues(38)
			End If

			'Journal Class
			If arrRecordValues(63) <> "" Then
				.WebEdit("Journal Class").Set arrRecordValues(63)
			End If

			'Click the Search button
			.WebButton("Search").Click
			If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Click
			End If

			'Select journal for unposting(should only be one)
			If .WebCheckBox("Process").GetROProperty("disabled") = 0 Then	'Exist(5) Then
				.WebCheckBox("Process").Set "ON"	'Two values, ON/OFF

				'Check for negative testing
				If arrCommands(i, 1) = False Then

					'Confirm that the checkbox was enabled and selected. Otherwise, exit test
					If .WebCheckBox("Process").GetROProperty("Checked") = 1 Then
						WriteToReport micPass, "BatchUnpostJournals - Test Step " & i + 1, "Successfully selected the Process checkbox after searching for our journal.", False
					Else
						On Error GoTo 0
						WriteToReport micFail, "BatchUnpostJournals - Test Step " & i + 1, "Unable to select the Process checkbox after searching for our journal. Please check that data exists.", True
						ExitTest
					End If

					'Click Save and wait for it to save
					.WebButton("Save").Click
					Browser("PeopleSoft Browser").Sync

					'Process our journal for unposting
					SharedProcessJournal "BatchUnPostJournals", arrCommands(i, 1)

					'Perform a SQL query to grab the current info with our processed journal
					arrRecordValues = FindJournal(GlobalDictionary("JournalID"))

					'Confirm that we have results from our SQL query, exit otherwise
				    On Error Resume Next
					nResult = UBound(arrRecordValues)
					If nResult > 0 Then

						'Confirm that the journals behaved appropriately given the nature of the test step
						If arrRecordValues(26) = "U" Then
			    			WriteToReport micPass, "BatchUnPostJournals - Test Step " & i + 1 & " - Status", "Journal expected to unpost, and successfully did so after test ran.", False
			    		Else
				    		On Error Goto 0
				    		WriteToReport micFail, "BatchUnPostJournals - Test Step " & i + 1 & " - Status", "Journal did not update or post after test run. Still " & arrRecordValues(26) & ". Exiting test.", False
				    		ExitTest
				    	End If
				    Else
				    	On Error Goto 0
				    	WriteToReport micFail, "BatchUnPostJournals  - Test Step " & i + 1 & " - Journal ID not found", "Unable to return results based on journal ID " & GlobalDictionary("JournalID") & ".", False
				    	ExitTest
					End If
				Else

					'Confirm that the checkbox was enabled and selected. Otherwise, exit test
					If .WebCheckBox("Process").GetROProperty("Checked") = 1 Then
						On Error GoTo 0
						WriteToReport micFail, "BatchUnpostJournals - Test Step " & i + 1 & " - Negative testing", "Selected the Process checkbox after searching our journal.", True
						ExitTest
					Else
						WriteToReport micPass, "BatchUnpostJournals - Test Step " & i + 1 & " - Negative testing", "Unable to select the Process checkbox after searching for our journal.", False
					End If
				End If
			Else
				If arrCommands(i, 1) = False Then
					On Error Goto 0
					WriteToReport micFail, "BatchUnpostJournals - Test Step " & i + 1, "Process checkbox not enabled after searching. Exiting test.", True
					ExitTest
				Else
					WriteToReport micPass, "BatchUnpostJournals - Test Step " & i + 1 & " - Negative testing", "Process checkbox not enabled as intended.", False
				End If
			End If
		End With

		'Store our successful unposted journal
		If i = 0 Then
			unpostedJournalID = GlobalDictionary("JournalID")
		End If

		'After switching to CDW_BATCH, go back to our login user
		Login(GlobalDictionary("SignInUser"))
	Next

	'step 5 - attempt to post an unposted journal
	If unpostedJournalID = "" Then
		WriteToReport micFail, "BatchUnpostJournals - Test Step 5", "Unposted journal ID not found from earlier. Exiting test", False
		ExitTest
	End If

	'Confirm that we have results from our SQL query, exit otherwise
	arrRecordValues = FindJournal(unpostedJournalID)
	On Error Resume Next
	nResult = UBound(arrRecordValues)
	If nResult > 0 Then

        'Storing our Journal ID for later use
        GlobalDictionary("JournalID") = ArrRecordValues(1)

        'Storing our Ledger Group for later use
        GlobalDictionary("Ledger") = ArrRecordValues(9)

        'Storing our Source for later use
        GlobalDictionary("Source") = ArrRecordValues(21)
        WriteToReport micPass, "BatchUnpostJournals - Test Step 5 - SQL Query Executed", "SQL query successfully executed. Values were returned and the test will continue.", False
    Else
    	On Error Goto 0
    	WriteToReport micFail, "BatchUnpostJournals - Test Step 5 - SQL Query Executed", "SQL query successfully executed. However, no values were returned and the test will stop.", False
    	ExitTest
	End If

	'Post our recently approved journals
	WriteToReport micPass, "BatchUnpostJournals - Test Step 5", "Beginning posting process of journal ID " & unpostedJournalID, False
	SharedProcessJournal "BatchUnpostJournals", False

	'Log out of cdw_batch and back in as our test user
	login(GlobalDictionary("SignInUser"))

	'Navigate to our journal search page and check for valid journal entries
	SharedCreateEditUpdateJournalStart "BatchUnpostJournals", False
	
	'Use our OR for the remainder of the function
	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")
	
		'Make sure that we aren't on the single entry page
		If .WebButton("Return to Search").Exist(5) Then
			.WebButton("Return to Search").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Check the first row value for our journal header status
		If UCase(.Link("Journal Header Status").GetRoProperty("innertext")) = "UNPOSTED" Then
			WriteToReport micPass, "BatchUnpostJournals - Test Step 5 - Journal status", "First journal entry is Unposted, as expected.", False
		Else
			WriteToReport micFail, "BatchUnpostJournals - Test Step 5 - Journal status", "First journal entry is " & .Link("Journal Header Status").GetRoProperty("innertext") & ", expected Unposted.", False
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Create a valid journal on the Peoplesoft website
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>July 03, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Journals posted if supposed to, declined if supposed to</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'07/26/2018			Stephen King	Updated to match new test steps. Commented SQL, updated to just create with unique handling
'**************************************************************************************************************
Public Function CreateValidJournal	'1.01

	'Call our shared journal add code with our function name and a flag for negative testing
	SharedCreateAddJournal "CreateValidJournal", False
End Function

'**************************************************************************************************************
''' <summary> 
''' Repeated steps involved with approving a journal
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>July 09, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user with an order pending approval</startstate>
''' <endstate>Journal approved</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'01/24/2019			Eric Trout		Updatd so it actually looks for the JournalID,  Also added JmournalID in reporter so it is documented the correct one is approved
'______________________________________________________ 
'**************************************************************************************************************
Public Function SharedApprovejournal(functionName, negativeTest)
	Dim i
	Dim bApproved

	'Login as our admin user
	Login(GlobalDictionary("AdminUser"))

	'Navigate to the Worklist page
	If SelectMainMenu1(GlobalDictionary("ApprovalSelection1")) = True Then
		WriteToReport micPass, functionName & " - Worklist Page", "On the Worklist page.", False
	Else
		WriteToReport micFail, functionName & " - Worklist Page", "Navigation to Worklist page failed. Exiting test.", True
		ExitTest
	End If

	'Look for a row with the user's name in it and then click the Mark Worked button
	With Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist")

		bApproved = False
		
		'Makes sure table is loaded
		If .WebTable("Worklist_WorklistTable").Exist(20) Then
			WriteToReport micPass, functionName & " - Worklist Page", "Worklist Items are displayed.", False
		Else
			WriteToReport micFail, functionName & " - Worklist Page", "There are not any Worklist Items displayed.", True
			ExitTest		
		End If

		'If we have results, make sure that we get the most recent first
		If .Link("DateFrom").Exist(5) Then
			.Link("DateFrom").Click
			Browser("PeopleSoft Browser").Sync
			.Link("DateFrom").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Search the table for our item
		For i = 0 To .WebTable("Worklist_WorklistTable").GetROProperty("rows")
			If .WebElement("html id:=win0divPSOPRDEFN_OPRDEFNDESC\$" & i).Exist(2) Then

				'Confirm that we found our submission by checking user and JournalID
				'If Trim(.WebElement("html id:=win0divPSOPRDEFN_OPRDEFNDESC\$" & i).GetROProperty("innertext")) = GlobalDictionary("FromUsername") AND Instr(.Link("url:=javascript:submitAction_win0\(document\.win0,'#ICWorkItem\$" & i + 1 & "'\);").GetROProperty("innertext"),GlobalDictionary("JournalID")) > 0 Then
				If Trim(.WebElement("html id:=PSOPRDEFN_OPRDEFNDESC\$" & i).GetROProperty("innertext")) = GlobalDictionary("FromUsername") AND Instr(.Link("xpath:=//TABLE[@id=""ACE_width""]/TBODY[1]/TR[7]/TD[2]/DIV[1]/TABLE[1]/TBODY[1]/TR[2]/TD[1]/TABLE[1]/TBODY[1]/TR[" & i + 2 & "]/TD[6]/DIV[1]/DIV[1]/DIV[1]/A[1]").GetROProperty("innertext"), GlobalDictionary("JournalID")) > 0 Then
					WriteToReport micPass, functionName & " - Journal Found", "Successfully found the journal [" &GlobalDictionary("JournalID") &"] for approval", False

					'Click the link to take us to the approve page
					'.Link("url:=javascript:submitAction_win0\(document\.win0,'#ICWorkItem\$" & i + 1 & "'\);").click
					.Link("xpath:=//TABLE[@id=""ACE_width""]/TBODY[1]/TR[7]/TD[2]/DIV[1]/TABLE[1]/TBODY[1]/TR[2]/TD[1]/TABLE[1]/TBODY[1]/TR[" & i + 2 & "]/TD[6]/DIV[1]/DIV[1]/DIV[1]/A[1]").Click
					Browser("PeopleSoft Browser").Sync

					'Approve or Deny the journal based on the test
					With Browser("PeopleSoft Browser").Page("Approvals")

						If negativeTest Then
							.Webbutton("Deny").Click
							WriteToReport micPass, functionName & " - Journal Action", "Successfully denied the journal", False
						Else
							.Webbutton("Approval").Click
							WriteToReport micPass, functionName & " - Journal Action", "Successfully approved the journal", False
						End If

						Browser("PeopleSoft Browser").Sync

						'Enter our approval text
						.PSFrame("Approve").WebEdit("Comments").Set "Test"

						'Click the submit button
						.PSFrame("Approve").Webbutton("Submit").Click
						.Sync
						bApproved = True
					End With
					Exit For
				End If
			End If
		Next

		'Report a failure if the journal was not found
		If Not bApproved Then
			WriteToReport micFail, functionName & " - Journal Not Found", "No journal found for username " & GlobalDictionary("FromUsername"), True	
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Submit a journal for approval that is over $25000
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>July 05, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Journal approved</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function SubmitJournalOver25000	'2.01

	'Updated for TFS steps - create new journal ourselves
	SharedCreateAddJournal "SubmitJournalOver25000", False

	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Click on the Approval link to switch tabs
		.Link("Approval").Click
		Browser("Peoplesoft Browser").Sync

		'If not, then click Submit
		.WebButton("Submit").Click
		Browser("Peoplesoft Browser").Sync
	End With

	'Call our Approve journal method
	SharedApproveJournal "SubmitJournalOver25000", False

	'Check for our new journal existing
	SharedCreateEditUpdateJournalStart "SubmitJournalOver25000", False
End Function

'**************************************************************************************************************
''' <summary> 
''' Create and approve a journal for approval that is under $25000
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>July 09, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Journal approved</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CreateAndApproveJournalUnder25000	'2.02

	'Call our shared journal add code with our function name and a flag for negative testing
	SharedCreateAddJournal "CreateAndApproveJournalUnder25000", False

	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Confirm we are on the Lines tab
		If Not .WebButton("Process").Exist(5) Then
			.Link("Lines").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Click the Process button
		.WebButton("Process").Click
		Browser("PeopleSoft Browser").Sync

		'Check for an error message
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
			WriteToReport micFail, "CreateAndApproveJournalUnder25000 - Processing Journal", "Could not process journal. Exiting test.", True
			ExitTest
		Else
			WriteToReport micPass, "CreateAndApproveJournalUnder25000 - Processing Journal", "Successfully processed journal with ID: " & GlobalDictionary("JournalID"), False
		End If

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Submit our journal for approval
		.WebButton("Submit").Click
		Browser("Peoplesoft Browser").Sync

		'Check for a popup - if it exists, that means something went wrong in the approval process and we need to screenshot it and exit the test
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
			WriteToReport micFail, "CreateAndApproveJournalUnder25000 - Submitting Journal", "Could not submit journal for approval. Exiting test.", True
		Else
			WriteToReport micPass, "CreateAndApproveJournalUnder25000 - Submitting Journal", "Submitted journal for approval.", True
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Create and approve a journal for approval that is under $15000
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>July 09, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Journal approved</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CreateAndApproveJournalOver25000	'2.03

	'Create our journal using the data in the spreadsheet(line 4586)
	SharedCreateAddJournal "CreateAndApproveJournalOver25000", False

	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Submit our journal for approval
		.WebButton("Submit").Click
		Browser("Peoplesoft Browser").Sync

		'Check for a popup - if it exists, that means something went wrong in the approval process and we need to screenshot it and exit the test
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
			WriteToReport micFail, "CreateAndApproveJournalOver25000 - Submitting Journal", "Could not submit journal for approval. Exiting test.", True
		End If

		'Check for the email
		If .WebElement("Pending").Exist(5) Then
			WriteToReport micPass, "CreateAndApproveJournalOver25000 - Submitting Journal", "Successfully submitted journal for approval and sent email.", False
		Else
			WriteToReport micFail, "CreateAndApproveJournalOver25000 - Submitting Journal", "Submitted journal for approval but email was not sent. Exiting test.", True
			ExitTest
		End If

		'Perform our manager approval steps
		SharedApprovejournal "CreateAndApproveJournalOver25000", False

		'Search for our recently created and approved journal
		SharedCreateEditUpdateJournalStart "CreateAndApproveJournalOver25000", False

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Validate we are on the Approval page
		If .Webbutton("Submit").Exist(5) Then
			WriteToReport micPass, "CreateAndApproveJournalOver25000 - Approval Page", "Successfully loaded approval page.", False
		Else
			WriteToReport micFail, "CreateAndApproveJournalOver25000 - Approval Page", "Did not successfully load approval page. Exiting test.", True
			ExitTest
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' ValidJournalNegativeTesting - confirm that no journals exist for bad/incorrect business units
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>July 18, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>No journals found</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function ValidJournalNegativeTesting

	'Call our shared journal search code with our function name and a flag for negative testing
	SharedCreateEditUpdateJournalStart "ValidJournalNegativeTesting", True
End Function

'**************************************************************************************************************
''' <summary> 
''' SharedSubmitForApproval - The repeated steps of submitting a journal during the approval process
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>July 18, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>No journals found</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function SharedSubmitForApproval(functionName, negativeTest)

	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Click on the Approve tab
		Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebTabStrip("WebTabStrip").Select "Approval"

		'Select our approval action(should always be approve)
		Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebList("Approval Action").Select "Approve"

		'Click on the "Submit" button
		.WebButton("Submit").Click
		Browser("PeopleSoft Browser").Sync

		'Regardless of Approval or Errors, a popup appears
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("Ok").Exist(5) Then
			Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("Ok").Click
		End If

'UNCOMMENT THESE LATER FOR EMAIL APPROVAL TESTS.
'		'Text box
'		Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebElement("GL_WF_WRK_APPR_ACTION$0").Click
'
'		'Approval History expansion
'		Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebElement("JRNL_AF_LOG_VW$expand$0").Click
'
'		'Table, currently no results
'		Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebElement("win0divPSXLATITEM_XLATLONGNAME").Click
'		Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebElement("win0divPSXLATITEM_XLATLONGNAME").Click

		'Click on the errors link
		.Link("Errors").Click
		Browser("PeopleSoft Browser").Sync

		'Check for Header errors - UPDATE for negativeTest being true
		If .Link("text:="& GlobalDictionary("BusinessUnit")).Exist(5) Then
			WriteToReport micFail, functionName & "  - Error Checking", "Header error line for approved journal found, expecting no errors. Exiting test.", True
			ExitTest
		Else
			WriteToReport micPass, functionName & "  - Error Checking", "Header error line for approved journal not found.", False
		End If

		'Check for the Line errors
		If .WebElement("Line Error Line 1").Exist(5) Then
			WriteToReport micFail, functionName & "  - Error Checking", "Line error(s) for approved journal found. Exiting test.", True
			ExitTest
		Else
			WriteToReport micPass, functionName & "  - Error Checking", "Line error line for approved journal not found.", False
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Create, submit, and approve a journal for approval that is under $15000
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>July 25, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Journal approved</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CreateAndSubmitJournalOver25000	'2.04

	'Create our journal using the data in the spreadsheet(line 4586)
	SharedCreateAddJournal "CreateAndSubmitJournalOver25000", False

	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Confirm we are on the Lines tab
		If Not .WebButton("Process").Exist(5) Then
			.Link("Lines").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Submit our journal for approval now that it's been processed
		.WebList("Journal Process").Select "Submit Journal"

		'Click the Process button
		.WebButton("Process").Click
		Browser("PeopleSoft Browser").Sync

		'Check for an error message
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
			WriteToReport micFail, "CreateAndSubmitJournalOver25000 - Process Journal", "Could not process journal. Exiting test.", True
			ExitTest
		Else
			WriteToReport micPass, "CreateAndSubmitJournalOver25000 - Process Journal", "Successfully processed journal with ID: " & GlobalDictionary("JournalID"), False
		End If

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Check for the email
		If .WebElement("Pending").Exist(5) Then
			WriteToReport micPass, "CreateAndSubmitJournalOver25000 - Submit Journal", "Successfully submitted journal for approval and sent email.", False
		Else
			WriteToReport micFail, "CreateAndSubmitJournalOver25000 - Submit Journal", "Submitted journal for approval but email was not sent. Exiting test.", True
			ExitTest
		End If

		'Perform our manager approval steps
		SharedApprovejournal "CreateAndSubmitJournalOver25000", False

		'Search for our newly approved journal
		SharedCreateEditUpdateJournalStart "CreateAndSubmitJournalOver25000", False

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Validate we are on the Approval page
		If .Webbutton("Submit").Exist(5) Then
			WriteToReport micPass, "CreateAndSubmitJournalOver25000 - Approval Page", "Successfully loaded approval page.", False
		Else
			WriteToReport micFail, "CreateAndSubmitJournalOver25000 - Approval Page", "Did not successfully load approval page. Exiting test.", True
			ExitTest
		End If

		'Check for approved status
		If .Webelement("Approved").Exist Then
			WriteToReport micPass, "CreateAndSubmitJournalOver25000 - Journal Approved", "Journal approved.", False
		Else
			WriteToReport micFail, "CreateAndSubmitJournalOver25000 - Journal Approved", "Journal not approved. Check data.", True
			ExitTest
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Process Journal
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>July 25, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Process Journal</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function SharedProcessJournal(functionName, negativeTest)
	Dim i
	Dim sRunId, sValue

	'Log in as our batch user - might be test-specific, but normally just CDW_BATCH
	'If GlobalDictionary("BatchUser") <> "" Then
	'	Login(GlobalDictionary("BatchUser"))
	'Else
		logincdwbatch()
	'End If

	'Navigate to the PeopleSoft Post Journal page
	If SelectMainMenu1(GlobalDictionary("ProcessSelection1")) = True Then
		WriteToReport micPass, functionName & " - Post Journals Entries Page", "On the Post Journals Entries page.", False
	Else
		WriteToReport micFail, functionName & " - Post Journals Entries Page", "Navigation to Post Journal Entries page failed. Exiting test.", True
		ExitTest
	End If

	'Use our OR
	With Browser("PeopleSoft Browser").Page("Post Journals").PSFrame("TargetContent")

		'Create our new run control
		If .Link("Add a New Value").Exist(5) Then
			.Link("Add a New Value").Click
		End If

		'Enter a name for our run process ID
	    sRunId = "Auto" & CLng(Timer)
	    WriteToReport micDone, "Run control ID", sRunID, False
		.WebEdit("Control ID").Set sRunID

		'Click the Add button
		.WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync
		If Not .WebRadioGroup("Frequency").Exist(60) Then
			Wait 10
		End If

		'Set our Process Frequency value - O\A\N
		If Len(GlobalDictionary("Frequency")) > 1 Then
			.WebRadioGroup("Frequency").Select Left(GlobalDictionary("Frequency"), 1)
		Else
			.WebRadioGroup("Frequency").Select GlobalDictionary("Frequency")
		End If

		'Set our business unit
		.WebEdit("Business Unit").Set GlobalDictionary("BusinessUnit")

		'Set our source
		.WebEdit("Source").Set GlobalDictionary("Source")

		'Set our Description value. At least make sure it's not blank
		.WebEdit("Description").Set "Test description - GL testing"

		'Set our ledger group
		.WebEdit("Ledger Group").Set GlobalDictionary("Ledger")

'		'Journal ID From search - check that it's not blank, as it usually auto-populates
'		If .WebEdit("ID From").GetROProperty("value") <> GlobalDictionary("JournalID") Then
'			.WebEdit("ID From").Set	GlobalDictionary("JournalID")
'		End If
'
'		'Fill in our ID To value if it doesn't auto-populate
'		If .WebEdit("ID To").GetROProperty("value") <> GlobalDictionary("JournalID") Then
'			.WebEdit("ID To").Set GlobalDictionary("JournalID")
'		End If

		'The majority of GlobalDictionary("JournalID") uses are a single use. However, certain tests require testing a range.
		If InStr(1, GlobalDictionary("JournalID"), ";", vbTextCompare) Then
			Dim arrJournals
			arrJournals = Split(GlobalDictionary("JournalID"), ";")
			.WebEdit("ID From").Set	arrJournals(0)
			.WebEdit("ID To").Set arrJournals(UBound(arrJournals))
		ElseIf GlobalDictionary("JournalID") <> "" Then
			.WebEdit("ID From").Set	GlobalDictionary("JournalID")
			.WebEdit("ID To").Set GlobalDictionary("JournalID")
		End If

		'If we have a date entry then update those(otherwise they default to today)
		If GlobalDictionary("JournalDate") <> "" Then
			.WebEdit("Date From").Set GlobalDictionary("JournalDate")
			.WebEdit("Date To").Set GlobalDictionary("JournalDate")
		End If

		'Click save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Click run
		.WebButton("Run").Click
		Browser("PeopleSoft Browser").Sync

		'Click OK. Check that the window exists as well
		If Browser("PeopleSoft Browser").Page("Post Journals").PSFrame("Process Scheduler Request").WebButton("OK").Exist(10) Then
			Browser("PeopleSoft Browser").Page("Post Journals").PSFrame("Process Scheduler Request").WebButton("OK").Click
			WriteToReport micPass, functionName & " - Journal(s) Process Scheduled", "Journal(s) successfully scheduled for processing!", False
		Else
			WriteToReport micFail, functionName & " - Journal(s) Process Scheduled", "Journal(s) did not schedule for processing", True
		End If
	End With

	'Click on the process monitor link
	With Browser("PeopleSoft Browser").Page("Post Journals")
		.PSFrame("TargetContent").Link("Process Monitor").Click
		.Sync

		'Enter our username
		'If GlobalDictionary("BatchUser") <> "" Then
		'	.PSFrame("Process Monitor").WebEdit("PMN_FILTER_WRK_WS_OPRID").Set GlobalDictionary("BatchUser")
		'Else
			.PSFrame("Process Monitor").WebEdit("PMN_FILTER_WRK_WS_OPRID").Set "CDW_BATCH"
		'End If

		'Set our time filter to minutes
		.PSFrame("Process Monitor").WebList("PMN_FILTER_WRK_PT_FILTERUNIT").Select "Minutes"

		'Set our time now that the Filter is set
		.PSFrame("Process Monitor").WebEdit("FilterValue").Set "30"

		'Make sure we're tracking the right job
		'.PSFrame("Process Monitor").WebList("PMN_FILTER_WRK_PRCSTYPE").Select "Application Engine"
		.PSFrame("Process Monitor").WebList("PMN_FILTER_WRK_PRCSTYPE").Select 0
		If GlobalDictionary("Process") <> "" Then
			Browser("PeopleSoft Browser").Page("Process Monitor").PSFrame("Process Monitor").WebEdit("Process").Set GlobalDictionary("Process")
		End If

		'Clear our run status in case it's filtered
		.PSFrame("Process Monitor").WebList("RunStatus").Select 0

		'Click refresh
		.PSFrame("Process Monitor").WebButton("Refresh").Click
	End With

	'Wait for process to complete
	With Browser("PeopleSoft Browser").Page("ProcessMonitorGeneric").PSFrame("Process Monitor")
		sValue = Trim(.WebElement("RunStatus").GetROProperty("innertext"))
	    i = 0
	    Reporter.Filter = rfDisableAll
		Do While sValue <> "Success" AND sValue <> "Warning" AND sValue <> "No Success"
			Wait 10
	        i = i + 1
			.WebButton("Refresh").Click
			Wait 1
			sValue = Trim(.WebElement("RunStatus").GetROProperty("innertext"))
	        If i = 60 Then
	            Exit Do
	        End If
		Loop
		Reporter.Filter = rfEnableAll

		'Confirm that our Run Status is success
		If sValue = "Success" Then
			WriteToReport micPass, functionName & " - Run Status", "Run status confirmed as Success", False
		Else
			WriteToReport micFail, functionName & " - Run Status", "Run status is not confirmed as Success - current run status is [" & sValue & "].", True
			ExitTest
		End If

		'Confirm that our Distribution Status is posted
		sValue = Trim(.WebElement("DistributionStatus").GetROProperty("innertext"))
        i = 0
		Do While sValue = "N/A" Or sValue = "Posting"
			Wait 20
            i = i + 1
			.WebButton("Refresh").Click
			Wait 1
			sValue = Trim(.WebElement("DistributionStatus").GetROProperty("innertext"))
            If i = 30 Then
                Exit Do
            End If
		Loop

		'Update to match test case criteria. Not all should pass.
		If sValue = "Posted" Then
			WriteToReport micPass, functionName & " - Distribution Status", "Distribution status confirmed as Posted", False
		Else
			WriteToReport micFail, functionName & " - Distribution Status", "Distribution status is not confirmed as Posted - current distribution status is " & sValue & "].", True
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Verify CORPORATELEDGER for Canadian BU
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>July 31, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user at the Add Journal page</startstate>
''' <endstate>CORPORATELEDGER Verified</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function SharedVerifyCORPORATELEDGER(functionName, negativeTest)
	Dim sAmount1, sAmount2, sBaseAmount1 , sBaseAmount2, sBaseCurrency1, sBaseCurrency2, sExchange1, sExchange2, sExpectedAmount1 , sExpectedAmount2

	'Use the Object Repository and cleaner code
	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Click the Lines tab 
		.WebTabStrip("WebTabStrip").Select "Lines"
		
		'Click on Secondary Lines 
		.Link("Secondary Lines").Click
		
		'Pull Foreign Amount to verify calculation
		sAmount1 = .WebElement("Foreign Amount Line 1").GetROProperty("innertext")
		sAmount2 = .WebElement("Foreign Amount Line 2").GetROProperty("innertext")
		
		sExchange1 = .WebEdit("Exchange Rate Line 1").GetROProperty("value")
		sExchange2 = .WebEdit("Exchange Rate Line 2").GetROProperty("value")
		
		sExpectedAmount1 = sAmount1 * sExchange1 
		sExpectedAmount2 = sAmount2 * sExchange2 
		
		sBaseAmount1 = .WebEdit("Base Amount Line 1").GetROProperty("value")
		sBaseAmount2 = .WebEdit("Base Amount Line 2").GetROProperty("value")
		
		sBaseCurrency1 = .WebElement("Base Currency Line 1").GetROProperty("innertext")
		sBaseCurrency2 = .WebElement("Base Currency Line 1").GetROProperty("innertext")		
		
		If sBaseCurrency1 = "USD" Then
			WriteToReport micPass, functionName & " - Line 1 Base Currency", "Line 1 Base Currency confirmed to be [USD]. ", False	
		Else
			WriteToReport micFail, functionName & " - Line 1 Base Currency", "Line 1 Base Currency was [" &sBaseCurrency1& "].", True							
		End If

		If sBaseCurrency2 = "USD" Then
			WriteToReport micPass, functionName & " - Line 2 Base Currency", "Line 2 Base Currency confirmed to be [USD]. ", False	
		Else
			WriteToReport micFail, functionName & " - Line 2 Base Currency", "Line 2 Base Currency was [" &sBaseCurrency2& "].", True							
		End If
		
		'If (CDbl(sBaseAmount1)) = FormatNumber(sExpectedAmount1, 2) Then
		If sBaseAmount1 = FormatNumber(sExpectedAmount1, 2) Then
			WriteToReport micPass, functionName & " - Line 1 Base Amount", "Line 1 Base Amount Confirmed calculated with exchange rate. ", False	
		Else
			WriteToReport micFail, functionName & " - Line 1 Base Amount", "Line 1 Base Amount Does not match what was calculated with exchange rate. ", True	
		End If

		'If (CDbl(sBaseAmount2)) = FormatNumber(sExpectedAmount2, 2) Then
		If sBaseAmount2 = FormatNumber(sExpectedAmount2, 2) Then
			WriteToReport micPass, functionName & " - Line 2 Base Amount", "Line 2 Base Amount Confirmed calculated with exchange rate. ", False	
		Else
			WriteToReport micFail, functionName & " - Line 2 Base Amount", "Line 2 Base Amount Does not match what was calculated with exchange rate. ", True	
		End If				

		'Go back to Primary Lines
		.Link("Back to Primary Lines").Click
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Create, submit, and deny a journal for approval that is over $25000
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>August 8, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Journal approved</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CreateSubmitAndDenyJournalOver25000	'2.05

	'Create our journal using the data in the spreadsheet(line 4586)
	SharedCreateAddJournal "CreateSubmitAndDenyJournalOver25000", False

	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Confirm we are on the Lines tab
		If Not .WebButton("Process").Exist(5) Then
			.Link("Lines").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Submit our journal for approval
		.WebList("Journal Process").Select "Submit Journal"

		'Click the Process button
		.WebButton("Process").Click
		Browser("PeopleSoft Browser").Sync

		'Check for an error message
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000 - Processing Journal", "Could not process journal. Exiting test.", True
			ExitTest
		Else
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000 - Processing Journal", "Successfully processed journal with ID: " & GlobalDictionary("JournalID"), False
		End If

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Check for the email
		If .WebElement("Pending").Exist(5) Then
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000 - Submitting Journal", "Successfully submitted journal for approval and sent email.", False
		Else
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000 - Submitting Journal", "Submitted journal for approval but email was not sent. Exiting test.", True
			ExitTest
		End If

		'Perform our manager approval steps
		SharedApprovejournal "CreateSubmitAndDenyJournalOver25000", True

		'Search for our newly approved journal
		SharedCreateEditUpdateJournalStart "CreateSubmitAndDenyJournalOver25000", False

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Validate we are on the Approval page
		If .WebButton("Submit").Exist(5) Then
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000 - Approval Page", "Successfully loaded approval page.", False
		Else
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000 - Approval Page", "Did not successfully load approval page. Exiting test.", True
			ExitTest
		End If

		'Check for deny status
		If .WebElement("Approved").Exist Then
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000 - Journal Approval", "Journal approved. Exiting test.", True
			ExitTest
		Else
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000 - Journal Approval", "Journal not approved.", False
		End If

		'Now that we have confirmed the denial, edit the journal. Log back in as our original user.
		Login(GlobalDictionary("SignInUser"))

		'Search for our journal
		SharedCreateEditUpdateJournalStart "CreateSubmitAndDenyJournalOver25000", False

		'Click on the Lines tab so we can edit it
		.WebTabStrip("WebTabStrip").Select "Lines"
		Browser("PeopleSoft Browser").Sync

		'Set our new amount
		.WebEdit("Foreign Amount").Set GlobalDictionary("Amount") + 500

		'Set our new amount on the second line
		.WebEdit("LINE2_FOREIGN_AMOUNT$1").Set "-" & GlobalDictionary("Amount") + 500

		'Select "Edit journal" from the process list
		.WebList("Journal Process").Select GlobalDictionary("Process_Status")

		'Click the Process button
		.WebButton("Process").Click
		Browser("PeopleSoft Browser").Sync

		'Certain processes require an extra confirmation
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("Yes").Exist(5) Then
			Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("Yes").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Look for journal Saved Message as sync due to Browser Sync causing Replay error
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebElement("JournalMessage").Exist(120) Then
			sMessage = Browser("PeopleSoft Browser").Page("Create/Update Journal").WebElement("JournalMessage").GetROProperty("innertext")
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000 - Journal Saved Message", sMessage, False
		End If

		'Click OK
		Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Click

		'Click Save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm our journal status	
		If Trim(.WebElement("Journal Status").GetROProperty("innertext")) = "V" Then
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000 - Journal Created", "Journal created with no errors", False
		Else
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000 - Journal Created", "Journal not created successfully. Status is " & .WebElement("Journal Status").GetROProperty("innertext") & ". Exiting test.", True
			ExitTest
		End If

		'Submit our journal for approval
		.WebList("Journal Process").Select "Submit Journal"

		'Click the Process button
		.WebButton("Process").Click

		'Check for an error message
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(60) Then
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000 - Journal Processed", "Could not process journal. Exiting test.", True
			ExitTest
		Else
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000 - Journal Processed", "Successfully processed journal with ID: " & GlobalDictionary("JournalID"), False
		End If

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Check for the email
		If .WebElement("Pending").Exist(5) Then
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000 - Journal Submitted", "Successfully submitted journal for approval and sent email.", False
		Else
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000 - Journal Submitted", "Submitted journal for approval but email was not sent. Exiting test.", True
			ExitTest
		End If

		'Perform our manager approval steps
		SharedApprovejournal "CreateSubmitAndDenyJournalOver25000", False

		'Search for our newly approved journal
		SharedCreateEditUpdateJournalStart "CreateSubmitAndDenyJournalOver25000", False

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Validate we are on the Approval page
		If .WebButton("Submit").Exist(5) Then
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000 - Approval Page", "Successfully loaded approval page.", False
		Else
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000 - Approval Page", "Did not successfully load approval page. Exiting test.", True
			ExitTest
		End If

		'Check for Approved status
		If .WebElement("Approved").Exist Then
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000 - Journal Approved", "Journal approved.", True
		Else
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000 - Journal Approved", "Journal not approved. Exiting test.", True
			ExitTest
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Create, submit, and deny a journal for approval that is over $25000 from the approval page
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>August 9, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Journal approved</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CreateSubmitAndDenyJournalOver25000FromApprovalPage	'2.06

	'Create our journal using the data in the spreadsheet(line 4586)
	SharedCreateAddJournal "CreateSubmitAndDenyJournalOver25000FromApprovalPage", False

	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Confirm we are on the Lines tab
		If Not .WebButton("Process").Exist(5) Then
			.Link("Lines").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Submit our journal for approval
		.WebList("Journal Process").Select "Submit Journal"

		'Click the Process button
		.WebButton("Process").Click
		Browser("PeopleSoft Browser").Sync

		'Check for an error message
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Processed", "Could not process journal. Exiting test.", True
			ExitTest
		Else
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Processed", "Successfully processed journal with ID: " & GlobalDictionary("JournalID"), False
		End If

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Check for the email
		If .WebElement("Pending").Exist(5) Then
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Submitted", "Successfully submitted journal for approval and sent email.", False
		Else
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Submitted", "Submitted journal for approval but email was not sent. Exiting test.", True
			ExitTest
		End If

		'Deny as our manager
		Login(GlobalDictionary("AdminUser"))

		'Search for our newly submitted journal
		SharedCreateEditUpdateJournalStart "CreateSubmitAndDenyJournalOver25000FromApprovalPage", False

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Validate we are on the Approval page
		If .WebButton("Submit").Exist(5) Then
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Approval Page", "Successfully loaded approval page.", False
		Else
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Approval Page", "Did not successfully load approval page. Exiting test.", True
			ExitTest
		End If

		'Deny
		.WebList("Approval Action").Select "Deny"
		.WebEdit("DenyCommentBox").Set "Test deny"
		.WebButton("Submit").Click
		Browser("PeopleSoft Browser").Sync

		'Check for our Denied object appearing
		If .WebElement("Denied").Exist Then
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Approved", "Journal not approved.", False
		Else
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Approved", "Journal still approved or pending. Exiting test.", True
			ExitTest
		End If

		'Now that we have confirmed the denial, edit the journal. Log back in as our original user
		Login(GlobalDictionary("SignInUser"))

		'Search for our journal
		SharedCreateEditUpdateJournalStart "CreateSubmitAndDenyJournalOver25000FromApprovalPage", False

		'Click on the Lines tab so we can edit it
		.WebTabStrip("WebTabStrip").Select "Lines"

		'Set our new amount
		.WebEdit("Foreign Amount").Set GlobalDictionary("Amount") + 500
		Wait 1

		'Set our new amount on the second line
		.WebEdit("LINE2_FOREIGN_AMOUNT$1").Set "-" & GlobalDictionary("Amount") + 500

		'Select "Edit journal" from the process list
		.WebList("Journal Process").Select GlobalDictionary("Process_Status")

		'Click the Process button
		.WebButton("Process").Click
		Browser("PeopleSoft Browser").Sync

		'Certain processes require an extra confirmation
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("Yes").Exist(5) Then
			Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("Yes").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Look for journal Saved Message as sync due to Browser Sync causing Replay error
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebElement("JournalMessage").Exist(120) Then
			sMessage = Browser("PeopleSoft Browser").Page("Create/Update Journal").WebElement("JournalMessage").GetROProperty("innertext")
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Saved Message", sMessage, False
		End If

		'Click OK
		Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Click

		'Click Save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm our journal status	
		If Trim(.WebElement("Journal Status").GetROProperty("innertext")) = "V" Then
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Created", "Journal created with no errors", False
		Else
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Created", "Journal not created successfully. Status is " & .WebElement("Journal Status").GetROProperty("innertext") & ". Exiting test.", True
			ExitTest
		End If

		'Submit our journal for approval
		.WebList("Journal Process").Select "Submit Journal"

		'Click the Process button
		.WebButton("Process").Click

		'Check for an error message
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(60) Then
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Processed", "Could not process journal. Exiting test.", True
			ExitTest
		Else
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Processed", "Successfully processed journal with ID: " & GlobalDictionary("JournalID"), False
		End If

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Check for the email
		If .WebElement("Pending").Exist(5) Then
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Submitted", "Successfully submitted journal for approval and sent email.", False
		Else
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Submitted", "Submitted journal for approval but email was not sent. Exiting test.", True
			ExitTest
		End If

		'Log back in as our manager to approve the journal from the Approval tab, not worklist
		Login(GlobalDictionary("AdminUser"))

		'Search for our newly submitted journal
		SharedCreateEditUpdateJournalStart "CreateSubmitAndDenyJournalOver25000FromApprovalPage", False

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Validate we are on the Approval page
		If .WebButton("Submit").Exist(5) Then
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Approval Page", "Successfully loaded approval page.", False
		Else
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Approval Page", "Did not successfully load approval page. Exiting test.", True
			ExitTest
		End If

		'Approve
		.WebList("Approval Action").Select "Approve"
		.WebButton("Submit").Click
		Browser("Peoplesoft Browser").Sync

		'Check for Approved status
		If .WebElement("Approved").Exist Then
			WriteToReport micPass, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Approved", "Journal approved.", True
		Else
			WriteToReport micFail, "CreateSubmitAndDenyJournalOver25000FromApprovalPage - Journal Approved", "Journal not approved. Exiting test.", True
			ExitTest
		End If

		'Log back in as our manager to approve the journal again
		'SharedApprovejournal "CreateSubmitAndDenyJournalOver25000FromApprovalPage", False

		'Post our journal now that it is approved
		SharedProcessJournal "CreateSubmitAndDenyJournalOver25000FromApprovalPage", False

		'Switch our user from CDW_Batch(logged in during SharedProcessJournal and back to our signinuser
		Login(GlobalDictionary("SignInUser"))

		'Search for our newly submitted journal
		SharedCreateEditUpdateJournalStart "CreateSubmitAndDenyJournalOver25000FromApprovalPage", False
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Create, submit, and edit a journal for approval that is over $25000
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>August 17, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Journal approved</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CreateSubmitAndEdtJournalOver25000	'2.07

	'Create our journal using the data in the spreadsheet(line 4586)
	SharedCreateAddJournal "CreateSubmitAndEdtJournalOver25000", False

	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Confirm we are on the Lines tab
		If Not .WebButton("Process").Exist(5) Then
			.Link("Lines").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Submit our journal for approval
		.WebList("Journal Process").Select "Submit Journal"

		'Click the Process button
		.WebButton("Process").Click
		Browser("PeopleSoft Browser").Sync

		'Check for an error message
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
			WriteToReport micFail, "CreateSubmitAndEdtJournalOver25000 - Journal Processed", "Could not process journal. Exiting test.", True
			ExitTest
		Else
			WriteToReport micPass, "CreateSubmitAndEdtJournalOver25000 - Journal Processed", "Successfully processed journal with ID: " & GlobalDictionary("JournalID"), False
		End If

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Check for the email
		If .WebElement("Pending").Exist(5) Then
			WriteToReport micPass, "CreateSubmitAndEdtJournalOver25000 - Journal Submitted", "Successfully submitted journal for approval and sent email.", False
		Else
			WriteToReport micFail, "CreateSubmitAndEdtJournalOver25000 - Journal Submitted", "Submitted journal for approval but email was not sent. Exiting test.", True
			ExitTest
		End If

		'log in as a manager to worklist>worklist and approve the journal
		SharedApprovejournal "CreateSubmitAndEdtJournalOver25000", False

		'Log back in as our original user
		Login(GlobalDictionary("SignInUser"))

		'Search for our journal
		SharedCreateEditUpdateJournalStart "CreateSubmitAndEdtJournalOver25000", False

		'Click on the Lines tab so we can edit it
		.WebTabStrip("WebTabStrip").Select "Lines"

		'Set our new amount
		.WebEdit("Foreign Amount").Set GlobalDictionary("Amount") + 500

		'Set our new amount on the second line
		.WebEdit("LINE2_FOREIGN_AMOUNT$1").Set "-" & GlobalDictionary("Amount") + 500

		'Select "Edit journal" from the process list
		.WebList("Journal Process").Select GlobalDictionary("Process_Status")

		'Click the Process button
		.WebButton("Process").Click
		Browser("PeopleSoft Browser").Sync

		'Certain processes require an extra confirmation
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("Yes").Exist(5) Then
			Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("Yes").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Look for journal Saved Message as sync due to Browser Sync causing Replay error
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebElement("JournalMessage").Exist(120) Then
			sMessage = Browser("PeopleSoft Browser").Page("Create/Update Journal").WebElement("JournalMessage").GetROProperty("innertext")
			WriteToReport micPass, "CreateSubmitAndEdtJournalOver25000 - Journal Saved Message", sMessage, False
		End If

		'Click OK
		Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Click

		'Click Save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm our journal status	
		If Trim(.WebElement("Journal Status").GetROProperty("innertext")) = "V" Then
			WriteToReport micPass, "CreateSubmitAndEdtJournalOver25000 - Journal Created", "Journal created with no errors", False
		Else
			WriteToReport micFail, "CreateSubmitAndEdtJournalOver25000 - Journal Created", "Journal not created successfully. Status is " & .WebElement("Journal Status").GetROProperty("innertext") & ". Exiting test.", True
			ExitTest
		End If

		'Submit our journal for approval
		.WebList("Journal Process").Select "Submit Journal"

		'Click the Process button
		.WebButton("Process").Click

		'Check for an error message
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(60) Then
			WriteToReport micFail, "CreateSubmitAndEdtJournalOver25000 - Journal Processed", "Could not process journal. Exiting test.", True
			ExitTest
		Else
			WriteToReport micPass, "CreateSubmitAndEdtJournalOver25000 - Journal Processed", "Successfully processed journal with ID: " & GlobalDictionary("JournalID"), False
		End If

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Check for the email
		If .WebElement("Pending").Exist(5) Then
			WriteToReport micPass, "CreateSubmitAndEdtJournalOver25000 - Journal Submitted", "Successfully submitted journal for approval and sent email.", False
		Else
			WriteToReport micFail, "CreateSubmitAndEdtJournalOver25000 - Journal Submitted", "Submitted journal for approval but email was not sent. Exiting test.", True
			ExitTest
		End If

		'Log back in as our manager to approve the journal again
		SharedApprovejournal "CreateSubmitAndEdtJournalOver25000", False

		'Post our journal now that it is approved
		SharedProcessJournal "CreateSubmitAndEdtJournalOver25000", False

		'Switch our user from CDW_Batch(logged in during SharedProcessJournal and back to our signinuser
		Login(GlobalDictionary("SignInUser"))

		'Search for our newly submitted journal
		SharedCreateEditUpdateJournalStart "CreateSubmitAndEdtJournalOver25000", False
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Approve journals from the Manage GL Journal Approval page
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>August 17, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Journals approved</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function ManageGlJournalApproval	'2.08
	Dim i
	Dim journalIDs
	Dim arrJournals
	journalIDs = ""

	'Create two journals for our admin to approve
	For i = 1 To 2
		SharedCreateAddJournal "ManageGlJournalApproval - Journal " & i, False
		
		With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

			'Confirm we are on the Lines tab
			If Not .WebButton("Process").Exist(5) Then
				.Link("Lines").Click
				Browser("PeopleSoft Browser").Sync
			End If

			'Submit our journal for approval
			.WebList("Journal Process").Select "Submit Journal"

			'Click the Process button
			.WebButton("Process").Click
			Browser("PeopleSoft Browser").Sync

			'Check for an error message
			If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
				WriteToReport micFail, "ManageGlJournalApproval - Journal " & i, "Could not process journal. Exiting test.", True
				ExitTest
			Else
				WriteToReport micPass, "ManageGlJournalApproval - Journal " & i, "Successfully processed journal with ID: " & GlobalDictionary("JournalID"), False
			End If

			'Go to the Approval page if we aren't already there
			If .Link("Approval").Exist(5) Then
				.Link("Approval").Click
				Browser("Peoplesoft Browser").Sync
			End If

			'Check for the email
			If .WebElement("Pending").Exist(5) Then
				WriteToReport micPass, "ManageGlJournalApproval - Journal " & i, "Successfully submitted journal for approval and sent email.", False
			Else
				WriteToReport micFail, "ManageGlJournalApproval - Journal " & i, "Submitted journal for approval but email was not sent. Exiting test.", True
				ExitTest
			End If
		End With
	Next

	'Login as our admin user
	login(GlobalDictionary("AdminUser"))

	'Navigate to the Manage GL Journal Approval page
	If SelectMainMenu1(GlobalDictionary("ApprovalSelection1")) = True Then
		WriteToReport micPass, "ManageGlJournalApproval - Post Journals Entries Page", "On the Post Journals Entries page.", False
	Else
		WriteToReport micFail, "ManageGlJournalApproval - Post Journals Entries Page", "Navigation to Post Journal Entries page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Manage Journal Approval").PSFrame("Manage GL Journal Approval")

		'Click the Clear button
		.WebButton("Clear").Click

		'Enter our business unit
		.WebEdit("JRNLAPR_BUSINESS_UNIT").Set GlobalDictionary("BusinessUnit")

		'Enter our requester name
		.WebEdit("JRNLAPR_REQUESTOR_ID").Set GlobalDictionary("SignInUser")

		'Click Search
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Check for the Approve button. It should show up once we have a search result. Otherwise, exit
		If .WebButton("Approve").Exist(5) Then
			WriteToReport micPass, "ManageGlJournalApproval - Journal Search", "Successfully found the journal for approval", False
		Else
			WriteToReport micFail, "ManageGlJournalApproval - Journal Search", "Did not find a journal for approval. Exiting test.", True
			ExitTest
		End If

		'Click Select All if the option exists
		If .Link("Select All / Deselect").Exist(5) Then
			.Link("Select All / Deselect").Click
			WriteToReport micPass, "ManageGlJournalApproval - Journal Selected", "Selected all journals for approval", False
		Else
			WriteToReport micFail, "ManageGlJournalApproval - Journal Selected", "Unable to selected any journals for approval", True
			ExitTest
		End If

		For i = 0 To Browser("PeopleSoft Browser").Page("Manage Journal Approval").PSFrame("Manage GL Journal Approval").WebTable("Approval Journals").GetROProperty("rows") - 1
			If journalIDs = "" Then
				journalIDs = Browser("PeopleSoft Browser").Page("Manage Journal Approval").PSFrame("Manage GL Journal Approval").WebTable("Approval Journals").Link("html id:=GL_JRNL_LNK\$" & i).Getroproperty("innertext")
			Else
				journalIDs = journalIDs & ";" & Browser("PeopleSoft Browser").Page("Manage Journal Approval").PSFrame("Manage GL Journal Approval").WebTable("Approval Journals").Link("html id:=GL_JRNL_LNK\$" & i).Getroproperty("innertext")
			End If
		Next
		GlobalDictionary("JournalID") = journalIDs

		'Click the Approve button
		.WebButton("Approve").Click
		Browser("PeopleSoft Browser").Sync

		'Check that the Approve button doesn't exist. Everything should reset now that the journal is approved.
		If NOT .WebButton("Approve").Exist(5) Then
			WriteToReport micPass, "ManageGlJournalApproval - Journal Approval", "Successfully approved the journal(s)!", False
		Else
			WriteToReport micFail, "ManageGlJournalApproval - Journal Approval", "Did not approve the journal. Please check the screenshot for any errors", True
			ExitTest
		End If
	End With

	'Post our recently approved journals
	SharedProcessJournal "ManageGlJournalApproval", False

	'Log out of cdw_batch and back in as our test user
	login(GlobalDictionary("SignInUser"))

	'Navigate to our journal search page and check that each new journal is posted and approved
	If InStr(1, GlobalDictionary("JournalID"), ";", vbTextCompare) Then
		arrJournals = Split(GlobalDictionary("JournalID"), ";")
		For i = 0 To UBound(arrJournals)
			GlobalDictionary("JournalID") = arrJournals(i)
			SharedCreateEditUpdateJournalStart "ManageGlJournalApproval", False
		Next
	ElseIf GlobalDictionary("JournalID") <> "" Then
		SharedCreateEditUpdateJournalStart "ManageGlJournalApproval", False
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the revaluation process
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 1, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>processes ran</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function SharedRunRevaluation(functionName, strBusinessUnit, strGroup)
	Dim i
	Dim arrBusinessUnit, arrTemp
	Dim sRunId, strTemp

	'Check our inputs for multiple rows
	If InStr(1, strBusinessUnit, ";", vbTextCompare) >= 1 Then
		arrBusinessUnit = Split(strBusinessUnit, ";")
	Else
		arrBusinessUnit = Array(strBusinessUnit)
	End If

	'As of now, both business units use the same group
	'	If InStr(1, strGroup, ";", vbTextCompare) >= 1 Then
	'		arrGroup = Split(strGroup, ";")
	'	Else
	'		arrGroup = strGroup
	'	End If

	'Navigate to General Ledger> Process Multi-Currency> Define and Process> Request Process 
	If SelectMainMenu1(GlobalDictionary("RequestProcess1")) = True Then
		WriteToReport micPass, functionName & " - Request Process Page", "On the Request Process page.", False
	Else
		WriteToReport micFail, functionName & " - Request Process Page", "Navigation to Request Process page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Request Process").PSFrame("TargetContent")

		'Click on Add A New Value
		.WebTabStrip("WebTabStrip").Select "Add a New Value"

		'Enter our run control ID
		sRunId = "Auto" & CLng(Timer)
	    WriteToReport micDone, functionName & " - Run control ID", sRunID, False
		.WebEdit("Run Control").Set sRunId

		'Click Add
		.WebButton("Add").Click

		'Fill out our row info, looping if needed
		For i = 0 To UBound(arrBusinessUnit)

			'Add a row
			If i >= 1 Then
				.WebButton("html id:=CURR_REQUEST\$new\$" & i - 1 & "\$\$0").Click			
			End If

			'Select our Frequency
			.WebList("Frequency" & i).Select GlobalDictionary("ProcessFrequency")

			'Enter our business unit and group
			.WebEdit("BusinessUnit" & i).Set arrBusinessUnit(i)
			.WebEdit("Group" & i).Set strGroup

			'Set our process and date
			.WebList("Request" & i).Select "As of Date"		'"Business Unit Process Date"

			'.WebEdit("AsOfDate" & i).Set FormatDateTime(Date(), vbShortDate)
			.WebEdit("AsOfDate" & i).Set DateSerial(Year(Now), 1 + Month(Now), 0)	'Go for the end of the month
		Next

		'Click the Save button
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Page("Request Process").Sync

		'Click the Run button
		.WebButton("Run").Click
	End With

	With Browser("PeopleSoft Browser").Page("Request Process")
		.Sync

		'Grab our process name
		strTemp = .PSFrame("Process Scheduler Request").WebElement("Process").GetROProperty("Innertext")
		If strTemp <> "" Then
			GlobalDictionary("Process") = strTemp
			WriteToReport micDone, functionName & " - Process Name", strTemp, False
		End If

		'Needs the Run/Ok button clicked from the popup. Might be a different PSFrame
		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		.Sync

		'Grab the Instance number of the new process
		strTemp = .WebElement("html id:=PRCSRQSTDLG_WRK_DESCR100").GetRoProperty("innertext")
		arrTemp = Split(strTemp, ":")
		GlobalDictionary("InstanceNumber") = arrTemp(1)
		WriteToReport micDone, functionName & " - Instance number", arrTemp(1), False

		'Needs the process monitor link clicked
		.PSFrame("Status Bar").Link("Process Monitor").Click
	End With

	'Call our shared ProcessMonitor function
	SharedProcessMonitor functionName
End Function

'**************************************************************************************************************
''' <summary> 
''' Run a query from the Query Viewer page
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>query ran</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function SharedRunQuery(functionName, strBusinessUnit, strGroup)
	Dim i, nResult
	Dim arrBusinessUnit, arrRecordValues, arrTemp()
	Dim sDate, sSQL

	'Use our business units and check for new journals
	If InStr(1, strBusinessUnit, ";", vbTextCompare) >= 1 Then
		arrBusinessUnit = Split(strBusinessUnit, ";")
	Else
		arrBusinessUnit = Array(strBusinessUnit)
	End If

	'Get the current date in yyyy-mm-dd format
	sDate = DatePart("yyyy", Now()) & "-" & DatePart("m", Now()) & "-" & DatePart("d", Now())

	'Search for a journal for each business unit we ran revaluation on
	For i = 0 To UBound(arrBusinessUnit)

		'Source = REV for Revaluation journals
		sSQL = "SELECT * FROM PS_JRNL_HEADER WHERE BUSINESS_UNIT = '" & arrBusinessUnit(i) & "' AND SOURCE = 'REV' " &_
			   "AND JOURNAL_DATE = '" & sDate & "'"
		WriteToReport micDone, functionName & " - SQL Query", "Query being used is " & sSQL, False

		'Get the first journal that meets our criteria, exit if none found
		arrRecordValues = dbGetFirstRecord(sSQL, "", arrTemp, functionName)
		nResult = -1

		On Error Resume Next
		nResult = UBound(arrRecordValues)
		On Error GoTo 0
		If nResult >= 0 Then
			WriteToReport micPass, functionName & " - SQL results", "There were " & nResult + 1 & " journal(s) found!", False
		Else
			WriteToReport micFail, functionName & " - SQL results", "There were 0 journals found. Exiting test.", False
			ExitTest
		End If

		'If still here, validate the journal on the webpage
		GlobalDictionary("BusinessUnit") = arrBusinessUnit(i)
		GlobalDictionary("JournalID") = arrRecordValues(1)
		SharedCreateEditUpdateJournalStart functionName, False
	Next

	'Navigate to Reporting Tools> Query> Query Viewer	- REPLACED. USING SQL, NOT QUERY VIEWER
'	With Browser("PeopleSoft Browser").Page("Query Viewer")
'		.PSFrame("Query Viewer").WebEdit("SearchText").Set "CDW_GL_REVAL"
'		.PSFrame("Query Viewer").WebButton("Search").Click
'		.PSFrame("Query Viewer").Link("HTML").Click
'		.PSFrame("Query Viewer").Link("Excel").Click
'		.PSFrame("Select a Tree (Fieldname").WebButton("Search").Click
'		.PSFrame("Select a Tree (Fieldname_2").WebButton("Search").Click
'		.PSFrame("Select a Tree (Fieldname_2").WebElement("win0divQRYCRIT5_WRK_QRYDESCR20").Click
'		.PSFrame("Select a Tree (Fieldname_2").Link("CATEGORY_CA").Click
'		.PSFrame("Display and Select TreeNodes").WebButton("OK").Drag 31,2
'		.PSFrame("Display and Select TreeNodes").WebButton("OK").Drop 31,-10
'		.PSFrame("Display and Select TreeNodes").WebElement("PSTREEVIEWWRK_MULTINODESELECTI").Drag 10,2
'		.PSFrame("Display and Select TreeNodes").WebElement("PSTREEVIEWWRK_MULTINODESELECTI").Drop 10,-8
'		.PSFrame("Display and Select TreeNodes").WebButton("OK").Drag 41,2
'		.PSFrame("Display and Select TreeNodes").WebButton("OK").Drop 41,-1
'	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Function to handle the revaluation test case(9.02)
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>9.01 test successfully ran so we have currency data</startstate>
''' <endstate>revaluation processes ran</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function Revaluation

	'Call our EnterMarketRates function as the precondition to the revaluation test
	EnterMarketRates

	'Account for multiple business units by taking the first one to create test data
	If GlobalDictionary("BusinessUnit") = "" Then
		GlobalDictionary("BusinessUnit") = GlobalDictionary("BusinessUnit1")	
	End If	

	'Call our shared journal creation code with our function name for reporting and a flag for negative testing
	SharedCreateAddJournal "Revaluation", False

	'Process our newly created journal
	SharedProcessJournal "Revaluation", False

	'Log out of cdw_batch and back in as our test user
	login(GlobalDictionary("SignInUser"))

	'Run the revaluation process
	SharedRunRevaluation "RevaluationTest", GlobalDictionary("Data"), GlobalDictionary("Group")

	'Account for multiple business units by taking the first one to create test data
	If GlobalDictionary("BusinessUnit") = "" Then
		GlobalDictionary("BusinessUnit") = GlobalDictionary("BusinessUnit1")
	End If

	'Run our query and check the status of the journals
	SharedRunQuery "RevaluationTest", GlobalDictionary("BusinessUnit"), GlobalDictionary("Group")
End Function

'**************************************************************************************************************
''' <summary> 
''' Shared code to run the consolidation processes
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>processes ran</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function SharedRunConsolidation(functionName)
	Dim i
	Dim sRunId, sValue
	Dim strBusinessUnit, strJournalID, strTemp
	Dim arrJournalID, arrTemp

	'Navigate to General Ledger> Consolidate Financial Data > Consolidation > Request Consolidation
	If SelectMainMenu1(GlobalDictionary("Consolidation1")) = True Then
		WriteToReport micPass, functionName, "On the Request Consolidation Control page.", False
	Else
		WriteToReport micFail, functionName, "Navigation to Request Consolidation Control page failed. Exiting test.", True
		ExitTest
	End If

	'Enter our data for consolidating
	With Browser("PeopleSoft Browser").Page("Request Consolidation").PSFrame("TargetContent")
		.WebTabStrip("WebTabStrip").Select "Add a New Value"

		'Enter a name for our run process ID
	    sRunId = "Auto" & CLng(Timer)
	    WriteToReport micDone, functionName & " - Run control ID", sRunID, False
		.WebEdit("RunID").Set sRunId
		.WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Main page
		If .WebRadioGroup("Frequency").Exist(5) Then
			WriteToReport micPass, functionName & " - Request Consolidation Page", "On the Request Consolidation page.", False
		Else
			WriteToReport micFail, functionName & " - Request Consolidation Page", "Navigation to Request Consolidation page failed. Exiting test.", True
			ExitTest
		End If

		'Enter our data stored in the excel file
		.WebRadioGroup("Frequency").Select GlobalDictionary("Frequency")
		.WebEdit("Currency").Set GlobalDictionary("Currency")
		.WebEdit("Tree Name").Set GlobalDictionary("TreeName")
		.WebEdit("ConsolSet").Set GlobalDictionary("ConsolSet")
		.WebButton("Run").Click
	End With

	With Browser("PeopleSoft Browser").Page("Request Consolidation")
		.Sync

		'Grab our process name
		strTemp = Browser("PeopleSoft Browser").Page("Request Process").PSFrame("Process Scheduler Request").WebElement("Process").GetROProperty("Innertext")
		If strTemp <> "" Then
			GlobalDictionary("Process") = strTemp
			WriteToReport micDone, functionName & " - Process Name", strTemp, False
		End If

		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		.Sync

		'Grab the Instance number of the new process
		'strTemp = .WebElement("innertext:=Process Instance:.*").GetRoProperty("innertext")
		strTemp = .WebElement("html id:=PRCSRQSTDLG_WRK_DESCR100").GetROProperty("innertext")
		arrTemp = Split(strTemp, ":")
		GlobalDictionary("InstanceNumber") = arrTemp(1)
		WriteToReport micDone, functionName & " - Instance Number", GlobalDictionary("InstanceNumber"), False

		.PSFrame("Status Bar").Link("Process Monitor").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Monitor our job execution status
	SharedProcessMonitor functionName

	With Browser("PeopleSoft Browser").Page("Request Process Monitor")
		.PSFrame("Process Monitor").Link("Details").Click

		'Determine the journal IDs
		.Sync
		.PSFrame("Process Detail").Link("Message Log").Click
		.Sync
		strTemp = .PSFrame("Message Log").WebElement("ResultsTable").GetROProperty("Innertext")
		arrJournalID = split(strTemp, "Journal ")

		'Usually there's only one journal listed, but we want to include handling if there are more
		strJournalID = ""
		strBusinessUnit = ""
		If UBound(arrJournalID) = 1 Then
			arrTemp = split(arrJournalID(1), " ")
			strJournalID = arrTemp(0)
			strBusinessUnit = arrTemp(5)
		Else
			For i = 1 To UBound(arrJournalID)
				arrTemp = split(arrJournalID(i), " ")
				If i = 1 Then
					strJournalID = arrTemp(0)
					strBusinessUnit = arrTemp(5)
				Else
					strJournalID = strJournalID & ";" & arrTemp(0)
					strBusinessUnit = strBusinessUnit & ";" & arrTemp(5)
				End If
			Next
		End If

		GlobalDictionary("BusinessUnits") = strBusinessUnit
		GlobalDictionary("JournalIDs") = strJournalID
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Shared code to validate the consolidation process
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>processes ran</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function SharedValidateConsolidatedJournal(functionName)
	Dim i
	Dim sCredits, sDebits

	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Current test steps in docx file say check one. We have a loop if we need to check all.
		'For i = 0 To UBound(arrIDs)

			'Search for a new journal/BU combination if more than one
'			If i > 0 Then
'
'				'Return to the search page
'				.WebButton("Return to Search").Click
'				Browser("PeopleSoft Browser").Page("Create/Update Journal").Sync
'
'				'Clear out our search fields
'				.WebButton("Clear").Click
'
'				'Set our Business Unit
'				.WebEdit("Journal Business Unit").Set arrBUs(i)
'
'				'Set our journal ID
'				.WebEdit("Journal ID").Set arrIDs(i)
'
'				'Click the search button 
'				.WebButton("Search").Click
'				Browser("PeopleSoft Browser").Page("Create/Update Journal").Sync
'
'				'Validate that we have search results. If we only have one journal result then it automatically takes us to that page. Otherwise there's a table.
'				If .Link("Journal Date").Exist(5) OR .WebElement("Journal ID").Exist(5) Then
'					WriteToReport micPass, functionName, "Journal found!", False
'				Else
'					WriteToReport micFail, functionName, "No journal found for " & arrIDs(i) & ". Exiting test.", True
'					ExitTest
'				End If
'			End If

			'Click on the Lines tab so we can edit it
			.WebTabStrip("WebTabStrip").Select "Lines"

			'Confirm our journal status	
			If Trim(.WebElement("Journal Status").GetROProperty("innertext")) = "V" Then
				WriteToReport micPass, functionName & " - Journal Created", "Journal created with no errors", False
			Else
				WriteToReport micFail, functionName & " - Journal Created", "Journal not created successfully. Status is " & .WebElement("Journal Status").GetROProperty("innertext") & ". Exiting test.", True
				ExitTest
			End If

			'Confirm our debits and credits
			sCredits = CDbl(.WebElement("TotalCredits").GetROProperty("InnerText"))
			sDebits = CDbl(.WebElement("TotalDebits").GetROProperty("InnerText"))
			If sDebits - sCredits = 0 Then
				WriteToReport micPass, functionName & " - Debits And Credits", "Debits and credits cancel out", False
			Else
				WriteToReport micFail, functionName & " - Debits And Credits", "Debits and credits do not cancel out for journal " & journalID & ". Debits are " & sDebits &_
				" and credits are " & sCredits & ". Exiting test.", True
				ExitTest
			End If
		'Next
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the consolidation process for Canadian business units
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate></endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function RunCADConsolidations
	Dim arrIDs, arrBUs

	'Process our Canadian Consolidation journals
	SharedRunConsolidation "RunCADConsolidations"

'	'Execute our SQL statement
'	nResult = 0
'	arrRecordValues = dbReturnConsolidatedJournals("CON")
'
'	'Confirm that we have results from our SQL query, exit otherwise
'    On Error Resume Next
'	nResult = UBound(arrRecordValues)
'	If nResult > 0 Then
'        WriteToReport micPass, "RunCADConsolidations", "SQL query successfully executed.", False
'    Else
'    	On Error Goto 0
'    	WriteToReport micFail, "RunCADConsolidations", "SQL query successfully executed. However, no values were returned and the test will stop.", False
'    	ExitTest
'	End If

	'Split our data so that we can search for each Journal ID and business unit combo
	arrBUs = Split(GlobalDictionary("BusinessUnits"), ";")
	arrIDs = Split(GlobalDictionary("JournalIDs"), ";")
	GlobalDictionary("BusinessUnit") = Left(arrBUs(0), 5)	'Make sure we don't get any trailing characters or commas
	GlobalDictionary("JournalID") = arrIDs(0)	'Not needed on Journals as those are always separate in the journal
	WriteToReport micDone, "RunCADConsolidations - Data", "Business unit is " & GlobalDictionary("BusinessUnit") & " and journal ID is " & GlobalDictionary("JournalID"), False

	'Search for our newly consolidated journal
	SharedCreateEditUpdateJournalStart "RunCADConsolidations", False

	SharedValidateConsolidatedJournal "RunCADConsolidations"
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the consolidation process for American business units
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate></endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function RunUSAConsolidations
	'Dim arrIDs, arrBUs,
	Dim arrRecordValues
	Dim nResult

	'Run our consolidation process
	SharedRunConsolidation "RunUSAConsolidations"

	'Execute our SQL statement
	nResult = 0
	arrRecordValues = dbReturnConsolidatedJournals("CON")

	'Confirm that we have results from our SQL query, exit otherwise
    On Error Resume Next
	nResult = UBound(arrRecordValues)
	If nResult > 0 Then
        WriteToReport micPass, "RunUSAConsolidations - SQL Query", "SQL query successfully executed.", False
    Else
    	On Error Goto 0
    	WriteToReport micFail, "RunUSAConsolidations - SQL Query", "SQL query successfully executed. However, no values were returned and the test will stop.", False
    	ExitTest
	End If

	'Split our data so that we can search for each Journal ID and business unit combo
	'arrBUs = Split(GlobalDictionary("BusinessUnits"), ";")
	'arrIDs = Split(GlobalDictionary("JournalIDs"), ";")
	GlobalDictionary("BusinessUnit") = Left(arrRecordValues(0), 5)	'arrBUs(0)
	GlobalDictionary("JournalID") = arrRecordValues(1)		'arrIDs(0)
	WriteToReport micDone, "RunUSAConsolidations - Data", "Business unit is " & GlobalDictionary("BusinessUnit") & " and journal ID is " & GlobalDictionary("JournalID"), False

	'Check for the first returned journal
	SharedCreateEditUpdateJournalStart "RunUSAConsolidations", False

	'If we're still here, we need to check the journal status for V, and also confirm that the credits and debits cancel each other out
	'Validate the entries(possibly multiple)
	SharedValidateConsolidatedJournal "RunUSAConsolidations"
End Function

'**************************************************************************************************************
''' <summary> 
''' Shared code to close ledgers. Currently out of scope.
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate></endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function SharedCloseLedger(functionName, arrParameters)
	Dim arrTemp
	Dim strTemp
	Dim sRunID

	'Navigate to General Ledger> Close Ledgers >  Request Ledger Close
	If SelectMainMenu1(GlobalDictionary("CloseLedgers1")) = True Then
		WriteToReport micPass, functionName & " - Request Consolidation Control Page", "On the Request Consolidation Control page.", False
	Else
		WriteToReport micFail, functionName & " - Request Consolidation Control Page", "Navigation to Request Consolidation Control page failed. Exiting test.", True
		ExitTest
	End If

	'Enter our data for consolidating
	With Browser("PeopleSoft Browser").Page("Request Ledger Close").PSFrame("TargetContent")

		'Add a new value
		.WebTabStrip("WebTabStrip").Select "Add a New Value"

		'Enter a name for our run process ID
	    sRunId = "Auto" & CLng(Timer)
	    WriteToReport micDone, functionName & " - Run control ID", sRunID, False
		.WebEdit("RunID").Set sRunId
		.WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Main page
		If .WebRadioGroup("Frequency").Exist(5) Then
			WriteToReport micPass, functionName & " - Request Consolidation Page", "On the Request Consolidation page.", False
		Else
			WriteToReport micFail, functionName & " - Request Consolidation Page", "Navigation to Request Consolidation page failed. Exiting test.", True
			ExitTest
		End If

		'Run frequency
		.WebRadioGroup("Frequency").Select arrParameters(0)

		'Set our processing type - this is hardcoded
		.WebList("ProcessRequest").Select "Close"
		
		'First business unit entry
		.WebEdit("BusniessUnit").Set arrParameters(1)

		'Fiscal Year
		.WebEdit("FiscalYear").Set DatePart("yyyy", Now())

		'Ledger Group
		.WebEdit("LedgerGroup").Set arrParameters(2)

		'Ledger
		.WebEdit("Ledger").Set arrParameters(3)

		'Closing Group
		.WebEdit("Group").Set arrParameters(4)

		'Bottom
		.WebEdit("Table_BusinessUnit").Set arrParameters(1)
 
		'Save
		.WebButton("Save").Click

		'Run
		Browser("Create/Update Journal").Page("Request Ledger Close").PSFrame("TargetContent").WebButton("Run").Click
	End With

	With Browser("Request Ledger Close").Page("Request Ledger Close")
		.PSFrame("Process Scheduler Request").WebCheckBox("PRCSRQSTDLG_WRK_SELECT_FLAG$0").Set "ON"
		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		.Sync
		
		'Grab the Instance number of the new process
		strTemp = .WebElement("html id:=PRCSRQSTDLG_WRK_DESCR100").GetRoProperty("innertext")
		arrTemp = Split(strTemp, ":")
		GlobalDictionary("InstanceNumber") = arrTemp(1)
		WriteToReport micDone, functionName & " - Instance Number", GlobalDictionary("InstanceNumber"), False
		.PSFrame("Status Bar").Link("Process Monitor").Click
	End With

	'Monitor our job status
	SharedProcessMonitor functionName

	'Examine our Details and Message logs
	With Browser("Request Ledger Close").Page("Request Ledger Close")
		.PSFrame("Process Monitor").Link("Details").Click
		.PSFrame("Process Detail").Link("Message Log").Click
		.PSFrame("Message Log").WebButton("Return").Click
		.PSFrame("Process Detail").WebElement("WebElement").Click
		.PSFrame("Process Monitor").Link("Go back to Request Ledger").Click
	End With

	'Close or Undo, this is what changes. So maybe set it first to ensure it's Close, and then Undo then process again?
	'Change close request to target content?
	With Browser("PeopleSoft Browser").Page("Request Ledger Close")

		'Change our process option
		.PSFrame("TargetContent").WebList("ProcessRequest").Select "Undo"

		.PSFrame("TargetContent").WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		.PSFrame("TargetContent").WebButton("Run").Click
		Browser("PeopleSoft Browser").Sync

		'Click the checkbox of the first process
		.PSFrame("Process Scheduler Request").WebCheckBox("FirstProcess").Set "ON"
		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync
		.PSFrame("TargetContent").Link("Process Monitor").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Processing our job again
	SharedProcessMonitor functionName

	'Should be same PSFrame. It's the same page. So.
	'Browser("Create/Update Journal").Page("Request Ledger Close").PSFrame("Status Bar").Link("Process Monitor").Click

	''These should all exist already. Might even copy and paste the function
	'Browser("Create/Update Journal").Page("Request Ledger Close").PSFrame("Process Monitor").WebButton("Refresh").Click
	'Browser("Create/Update Journal").Page("Request Ledger Close").PSFrame("Process Monitor").WebButton("Refresh").Click
	'Browser("Create/Update Journal").Page("Request Ledger Close").PSFrame("Process Monitor").Link("Details").Click
	'Browser("Create/Update Journal").Page("Request Ledger Close").PSFrame("Process Detail").Link("Message Log").Click
	'Browser("Create/Update Journal").Page("Request Ledger Close").PSFrame("Message Log").WebButton("Return").Click
	'Browser("Create/Update Journal").Page("Request Ledger Close").PSFrame("Process Detail").WebButton("OK").Click
	'Browser("Create/Update Journal").Page("Request Ledger Close").PSFrame("Process Monitor").WebElement("Process List").Click

	''Go back and change the process type
	'Browser("Create/Update Journal").Page("Request Ledger Close").PSFrame("Process Monitor").Link("Go back to Request Ledger").Click
	'Browser("Create/Update Journal").Page("Request Ledger Close").PSFrame("TargetContent").WebList("ProcessRequest").Select "Undo"
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the close ledgers test case. 9.06. Currently on hold.
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate></endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CloseLedgers
	Dim arrParameters()

	arrParameters(0) = GlobalDictionary("Frequency")
	arrParameters(1) = GlobalDictionary("BusinessUnit1")

	'Populate our array to pass values to our function
	SharedCloseLedger "CloseLedgers", arrParameters

	'Repeat but find values for a Canadian business unit
	'00017, RCRD_MULTI
	SharedCloseLedger "CloseLedgers", arrParameters
End Function

'**************************************************************************************************************
''' <summary> 
''' Run allocations test case - 9.07
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate></endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function RunAllocations
	Dim sRunId
	Dim strTemp
	Dim arrTemp

	'Navigate to Allocations> Define and Perform Allocations> Request Allocation
	If SelectMainMenu1(GlobalDictionary("RunAllocations1")) = True Then
		WriteToReport micPass, "RunAllocations - Request Allocation Start Page", "On the Request Allocation page.", False
	Else
		WriteToReport micFail, "RunAllocations - Request Allocation Start Page", "Navigation to Request Allocation page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Request Allocation")

		'Add a new value
		.PSFrame("TargetContent").WebTabStrip("WebTabStrip").Select "Add a New Value"

		'Enter a name for our run process ID
	    sRunId = "Auto" & CLng(Timer)
	    WriteToReport micDone, "RunAllocations - Run control ID", sRunID, False
		.PSFrame("TargetContent").WebEdit("RunID").Set sRunId
		.PSFrame("TargetContent").WebButton("Add").Click
		.Sync

		'Main page
		If .PSFrame("TargetContent").WebList("Frequency").Exist(5) Then
			WriteToReport micPass, "RunAllocations - Request Allocation Main Page", "On the Request Allocation page.", False
		Else
			WriteToReport micFail, "RunAllocations - Request Allocation Main Page", "Navigation to Request Allocation page failed. Exiting test.", True
			ExitTest
		End If

		'Set our Frequency
		.PSFrame("TargetContent").WebList("Frequency").Select "Always"

		'Select our Business Unit
		.PSFrame("TargetContent").WebButton("Business Unit").Click
		.Sync
		.PSFrame("Look Up Unit").Link("text:=" & GlobalDictionary("BusinessUnit")).Click

		'Select our Allocation Group
		.PSFrame("TargetContent").WebButton("Process Group").Click
		.Sync
		.PSFrame("Look Up Allocation Group").Link("text:=" & GlobalDictionary("Allocation")).Click

		'Select our date option
		.PSFrame("TargetContent").WebList("Date Request").Select "As-Of Date"

		'Select our output options
		.PSFrame("TargetContent").WebList("Output Options").Select "Create Calc Log and Output"

		'Save our information
		.PSFrame("TargetContent").WebButton("Save").Click
		.Sync

		'Click Run
		.PSFrame("TargetContent").WebButton("Run").Click
		.Sync

		'Click ok to close the scheduler popup window
		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		.Sync

		'Grab the Instance number of the new process
		strTemp = .WebElement("html id:=PRCSRQSTDLG_WRK_DESCR100").GetRoProperty("innertext")
		arrTemp = Split(strTemp, ":")
		GlobalDictionary("InstanceNumber") = arrTemp(1)
		WriteToReport micDone, "RunAllocations - Instance Number", GlobalDictionary("InstanceNumber"), False

		'Click the Process Monitor link to watch our process execution status
		.PSFrame("Status Bar").Link("Process Monitor").Click
	End With

	'Monitor our job status
	SharedProcessMonitor "RunAllocations"
End Function


'**************************************************************************************************************
''' <summary> 
''' Run the GL Transaction Posting test - 6.01
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate></endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function TransactionPostingReport
	Dim sFileName, sRunId
	Dim i, nRows, x
	Dim bFound, bFoundEmpty
	Dim oExcel, oWorkbook, oFile
	Dim firstTotal, secondTotal
	Dim strTemp
	Dim arrInstance, arrTemp

	'Navigate to General Ledger > CDW GL Reports > GL Transaction Posting Report
	If SelectMainMenu1(GlobalDictionary("TransactionPosting1")) = True Then
		WriteToReport micPass, "TransactionPostingReport - Transaction Posting Report Page", "On the Transaction Posting Report page.", False
	Else
		WriteToReport micFail, "TransactionPostingReport - Transaction Posting Report Page", "Navigation to Transaction Posting Report page failed. Exiting test.", True
		ExitTest
	End If

	'Using our OR
	With Browser("PeopleSoft Browser").Page("GL Transaction Posting").PSFrame("TargetContent")

		'Make sure we're on the Add A New Value tab
		.WebTabStrip("WebTabStrip").Select "Add a New Value"

		'Enter a name for our run process ID
	    sRunId = "GLTPR" & CLng(Timer)
	    WriteToReport micDone, "TransactionPostingReport - Run control ID", sRunID, False
		.WebEdit("RunID").Set sRunId
		.WebButton("Add").Click
		Browser("PeopleSoft Browser").Page("GL Transaction Posting").Sync

		'Set our search flags to single
		.WebCheckBox("SingleBusinessUnit").Set "ON"
		.WebCheckBox("SingleSource").Set "ON"

		'Set our business unit
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")

		'Set our Search group
		.WebEdit("Source").Set GlobalDictionary("Source")

		'Click Save and Run to start processing our report
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Page("GL Transaction Posting").Sync
		.WebButton("Run").Click
	End With

	With Browser("PeopleSoft Browser").Page("GL Transaction Posting").PSFrame("Process Scheduler Request")
		Browser("PeopleSoft Browser").Page("GL Transaction Posting").Sync
		.WebCheckBox("SelectFlag0").Set "ON"
		.WebCheckBox("SelectFlag1").Set "ON"

		'Grab the name of the process we're about to run
		GlobalDictionary("Process") = .WebElement("html id:=PRCSRQSTDLGLIST_PRCSNAME\$0").GetROProperty("InnerText")
		WriteToReport micDone, "TransactionPostingReport - Process Name", GlobalDictionary("Process"), False

		'Click the OK button to close the frame
		.WebButton("OK").Click
	End With

	'Grab the Instance number of the new process
	Browser("PeopleSoft Browser").Page("GL Transaction Posting").Sync
	strTemp = Browser("PeopleSoft Browser").Page("GL Transaction Posting").PSFrame("Status Bar").WebElement("Process").GetRoProperty("innertext")
	arrTemp = Split(strTemp, ":")
	If InStr(1, arrTemp(1), ",", vbTextCompare) >= 1 Then
		arrInstance = Split(arrTemp(1), ",")
	Else
		arrInstance = Array(arrTemp(1))
	End If

	For x = 0 To UBound(arrInstance)
		GlobalDictionary("InstanceNumber") = arrInstance(x)	'Temp(1)
		WriteToReport micDone, "TransactionPostingReport - Instance Number", GlobalDictionary("InstanceNumber"), False

		'Click the Process Monitor link to monitor our job status
		Browser("PeopleSoft Browser").Page("GL Transaction Posting").PSFrame("TargetContent").Link("Process Monitor").Click

		'Run our report process
		SharedProcessMonitor("TransactionPostingReport")

		'If still here(job successfully ran), bring up the results window
		With Browser("PeopleSoft Browser").Page("Process Monitor")
			.PSFrame("Process Monitor").Link("Details").Click
			Browser("PeopleSoft Browser").Sync
			.PSFrame("Process Detail").Link("View Log/Trace").Click
			Browser("PeopleSoft Browser").Sync

			'Get the name of the file created
			sFileName = .PSFrame("View Log/Trace").Link("Report Name").GetROProperty("Text")	'EG, "CDWAP004_11276758.csv"
			.PSFrame("View Log/Trace").Link("Report Name").Click
			Browser("PeopleSoft Browser").Sync
		End With

		If InStr(1, sFileName, "csv", vbTextCompare) >= 1  Then

			'Browser("PeopleSoft Browser NewTab").Dialog("Internet Explorer").WinButton("Open").Click
			Browser("PeopleSoft Browser").Dialog("Internet Explorer").WinButton("Save").Click
			Browser("PeopleSoft Browser").Sync
			'Wait 5
			'Browser("Process Requests").WinObject("Notification").WinButton("Open").Click

			Set oExcel = CreateObject("Excel.Application")
			oExcel.DisplayAlerts = False

			'Get all the data parameters and values to the Global Dictionary for future  use
			'Set oWorkBook = oExcel.Workbooks.Open("C:\Users\QATester1\Downloads\" & sFileName)
			Set oWorkBook = oExcel.Workbooks.Open("C:\Users\" & Environment.Value("UserName") & "\Downloads\" & sFileName)
			nRows = oExcel.ActiveSheet.UsedRange.Rows.Count
			bFound = False
			bFoundEmpty = False

			'Search for our totals line, exiting when found
			For i = 1 to nRows

				'Search for our total account line
				If Trim(oExcel.Cells(i, 1)) = "Total Act:" Then
					bFound = True
					Exit For
				End If
				
				If Trim(oExcel.Cells(i, 2)) = "Total Act:" Then
					bFound = True
					bFoundEmpty = True
					Exit For
				End  If
			Next

			'If there was an issue with the download or we're the wrong user, exit the test
			If Not bFound Then
				WriteToReport micFail, "TransactionPostingReport - Excel Total Line", "Unable to locate Total line. Please check Excel file manually.", False
				oWorkbook.Close
				oExcel.Quit
				Set oFile = CreateObject("Scripting.FileSystemObject")
				'oFile.DeleteFile("C:\Users\QATester1\Downloads\" & sFileName)
				oFile.DeleteFile("C:\Users\" & Environment.Value("UserName") & "\Downloads\" & sFileName)
				ExitTest
			End If

			WriteToReport micPass, "TransactionPostingReport - Excel Total Line", "Total line located.", False
			firstTotal = oExcel.Cells(i, 3) 
			secondTotal = oExcel.Cells(i, 11)

			'Cleanup our file usage
			oWorkbook.Close
			oExcel.Quit
			Set oFile = CreateObject("Scripting.FileSystemObject")
			'oFile.DeleteFile("C:\Users\QATester1\Downloads\" & sFileName)
			oFile.DeleteFile("C:\Users\" & Environment.Value("UserName") & "\Downloads\" & sFileName)

			If bFoundEmpty Then
				WriteToReport micPass, "TransactionPostingReport - Line Totals", "No totals for data, but job ran and file created.", False
			Else
				If firstTotal = secondTotal Then
					WriteToReport micPass, "TransactionPostingReport - Line Totals", "Totals match! Value is " & firstTotal & ".", False
				Else
					WriteToReport micFail, "TransactionPostingReport - Line Totals", "Totals do not match. First total is " & firstTotal & ", second is " & secondTotal & ".", False
					ExitTest
				End If
			End  If
		End If

		'Navigation and window cleanup if needed
		With Browser("Peoplesoft Browser").Page("Process Requests")
			If .PSFrame("View Log/Trace").WebButton("Return").Exist(5) Then
				.PSFrame("View Log/Trace").WebButton("Return").Click
				.Sync
				.PSFrame("Process Detail").WebButton("OK").Click
				.Sync
				.PSFrame("Process Monitor").Link("Go back").Click
				.Sync
			End If
		End With
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Create market rates for various business units, both CRRNT and AVG. 9.01
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Market rates created</endstate>
''' <returns type="NA"></returns>
'Precondition:	Only ran once a month
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function EnterMarketRates
	Dim i, j, newCount, rowCount
	Dim convertFrom, convertTo
	Dim arrRate(2)

	'Navigator> Main Menu> Set Up Financials/Supply Chain> Common Definitions> Market Rates> Market Rates
	If SelectMainMenu1(GlobalDictionary("MarketRates1")) = True Then
		WriteToReport micPass, "EnterMarketRates - Market Rates Page", "On the Market Rates page.", False
	Else
		WriteToReport micFail, "EnterMarketRates - Market Rates Page", "Navigation to Market Rates page failed. Exiting test.", True
		ExitTest
	End If

	'Populate our arrays
	convertFrom = GlobalDictionary("From1")
	convertTo = GlobalDictionary("To1")
	arrRate(0) = GlobalDictionary("Rate1")
	arrRate(1) = GlobalDictionary("Rate1")
	arrRate(2) = GlobalDictionary("Rate2")

	With Browser("PeopleSoft Browser").Page("Market Rates").PSFrame("TargetContent")
		For j = 0 To UBound(arrRate)
			.WebEdit("FromCurrency").Set convertFrom
			.WebEdit("ToCurrency").Set convertTo
			.WebEdit("RateType").Set arrRate(j)

			'Click Search
			.WebButton("Search").Click
			Browser("PeopleSoft Browser").Page("Market Rates").Sync

			'If this exists click it. If there's only result then we're on the next page already
			If .Link("Model").Exist(5) Then
				Link("Model").Click
				Browser("PeopleSoft Browser").Page("Market Rates").Sync
			End If

			'Confirm that we're on the new page
			If .WebButton("New").Exist(5) Then
				WriteToReport micPass, "EnterMarketRates - Rate Page", "On the Rate page", False
			Else
				WriteToReport micFail, "EnterMarketRates - Rate Page", "Rate page did not load. Exiting test.", True
				ExitTest
			End If

			'Check if a row exists with the last day of the month already, as we only need to set this once a month
			If Trim(.WebEdit("Date").GetROProperty("default value")) = CStr(DateSerial(Year(Now), 1 + Month(Now), 0)) Then
				WriteToReport micDone, "EnterMarketRates - Precondition", "This test was already ran once before, so we have rates for the month.", True
				Exit Function
			End If

			'Check our row count before modifying the page
			rowCount = .WebTable("NewRowWebTable").GetROProperty("rows")

			'Click the new button
			.WebButton("New").Click
			Wait 1

			'Check our row count after modifying the page
			newCount = .WebTable("NewRowWebTable").GetROProperty("rows")

			'Confirm that our row as added
			If newCount > rowCount Then
				WriteToReport micPass, "EnterMarketRates - Row Added", "Row added", False
			Else
				WriteToReport micFail, "EnterMarketRates - Row Added", "Unable to add row", True
				ExitTest
			End If

			If j = 0 Then

				'Enter the first day of the month as a CRRNT date
				.WebEdit("Date").Set DateSerial(Year(Now), Month(Now), 1)
			Else

				'Enter the last day of the month(for both CRRNT and AVG
				.WebEdit("Date").Set DateSerial(Year(Now), 1 + Month(Now), 0)
			End If

			'Click the Save button
			.WebButton("Save").Click
			Browser("PeopleSoft Browser").Page("Market Rates").Sync

			'Click the "Return to Search" button to repeat the steps(if needed)
			.WebButton("Return to Search").Click
		Next
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the Online Intercompany Journal test(1.09)
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate></endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function OnlineIntercompanyJournal

	'create data
	SharedCreateAddJournal "OnlineIntercompanyJournal", False

	'Use our OR for the remainder of the function
	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'After our Add function, navigate to the Errors tab if we aren't already there
		If .Link("Errors").Exist(5) Then

			'Click on the errors link
			.Link("Errors").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Check for Header errors
		If .Link("text:="& GlobalDictionary("BusinessUnit")).Exist(5) Then
			WriteToReport micFail, "OnlineIntercompanyJournal - Header Error", "Header error line for journal ID and business unit found.", True
			ExitTest
		Else
			WriteToReport micPass, "OnlineIntercompanyJournal - Header Error", "Header error line for journal ID and business unit not found.", False
		End If

		'Check for the Line errors table and specifically the first row existing 'and the first row not being blank
		If .WebElement("Line Error Line 1").Exist(5) Then
			WriteToReport micFail, "OnlineIntercompanyJournal - Line Error", "Line error line for journal ID and business unit found.", True
			ExitTest
		Else
			WriteToReport micPass, "OnlineIntercompanyJournal - Line Error", "Line error line for journal ID and business unit not found.", False
		End If

		'If no errors found, head over to the Lines tab
		If Not .WebButton("Process").Exist(5) Then
			.Link("Lines").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Submit our journal for approval now that it's been processed
		.WebList("Journal Process").Select "Submit Journal"

		'Click the Process button
		.WebButton("Process").Click
		Browser("PeopleSoft Browser").Sync

		'Check for an error message
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
			WriteToReport micFail, "OnlineIntercompanyJournal - Process Journal", "Could not process journal. Exiting test.", True
			ExitTest
		Else
			WriteToReport micPass, "OnlineIntercompanyJournal - Process Journal", "Successfully processed journal with ID: " & GlobalDictionary("JournalID"), False
		End If

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Check for the email
		If .WebElement("Pending").Exist(5) Then
			WriteToReport micPass, "OnlineIntercompanyJournal - Submit Journal", "Successfully submitted journal for approval and sent email.", False
		Else
			WriteToReport micFail, "OnlineIntercompanyJournal - Submit Journal", "Submitted journal for approval but email was not sent. Exiting test.", True
			ExitTest
		End If
	End With

	'Log back in as our manager to approve the journal again
	SharedApprovejournal "OnlineIntercompanyJournal", False

	'Post our journal now that it is approved
	SharedProcessJournal "OnlineIntercompanyJournal", False

	'Switch our user from CDW_Batch(logged in during SharedProcessJournal and back to our signinuser
	Login(GlobalDictionary("SignInUser"))

	'Search for our created journal
	SharedCreateEditUpdateJournalStart "OnlineIntercompanyJournal", False
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the Online Intercompany Reversing Journal test(1.10)
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate></endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function OnlineIntercompanyReversingJournal

	'create data
	SharedCreateAddJournal "OnlineIntercompanyReversingJournal", False

	'Use our OR for the remainder of the function
	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'After our Add function, navigate to the Errors tab if we aren't already there
		If .Link("Errors").Exist(5) Then

			'Click on the errors link
			.Link("Errors").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Check for Header errors
		If .Link("text:="& GlobalDictionary("BusinessUnit")).Exist(5) Then
			WriteToReport micFail, "OnlineIntercompanyReversingJournal - Header Error", "Header error line for journal ID and business unit found.", True
			ExitTest
		Else
			WriteToReport micPass, "OnlineIntercompanyReversingJournal - Header Error", "Header error line for journal ID and business unit not found.", False
		End If

		'Check for the Line errors table and specifically the first row existing 'and the first row not being blank
		If .WebElement("Line Error Line 1").Exist(5) Then
			WriteToReport micFail, "OnlineIntercompanyReversingJournal - Line Error", "Line error line for journal ID and business unit found.", True
			ExitTest
		Else
			WriteToReport micPass, "OnlineIntercompanyReversingJournal - Line Error", "Line error line for journal ID and business unit not found.", False
		End If
	End With

	'Post our journal
	GlobalDictionary("Process") = "GL_JP"
	WriteToReport micDone, "OnlineIntercompanyReversingJournal - Process Name", GlobalDictionary("Process"), False
	SharedProcessJournal "OnlineIntercompanyReversingJournal", False

	'Log out of cdw_batch and back in as our test user
	login(GlobalDictionary("SignInUser"))

	'Search for our recently processed journal
	SharedCreateEditUpdateJournalStart "CreateReverseJournal", False
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the Online Intercompany Journal OOB test(1.11)
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate></endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function OnlineIntercompanyJournalOOB

	'Create a journal with multiple business units and an error
	SharedCreateAddJournal "OnlineIntercompanyJournalOOB", True

	'Use our OR for the remainder of the function
	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'After our Add function, navigate to the Errors tab if we aren't already there
		If .Link("Errors").Exist(5) Then

			'Click on the errors link
			.Link("Errors").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Check for Header errors
		If .Link("text:="& GlobalDictionary("BusinessUnit")).Exist(5) Then
			WriteToReport micPass, "OnlineIntercompanyJournalOOB - Header Error", "Header error line for journal ID and business unit found.", False
		Else
			WriteToReport micFail, "OnlineIntercompanyJournalOOB - Header Error", "Header error line for journal ID and business unit not found.", False
		End If

		'Check for the Line errors table and specifically the first row existing 'and the first row not being blank
		If .WebElement("Line Error Line 1").Exist(5) Then 'And .WebElement("Line Error Line 1").GetROProperty("innertext") <> "" Then
			WriteToReport micPass, "OnlineIntercompanyJournalOOB - Line Error", "Line error line for journal ID and business unit found.", False
		Else
			WriteToReport micFail, "OnlineIntercompanyJournalOOB - Line Error", "Line error line for journal ID and business unit not found.", False
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Navigate to MarkToPost and Verify Results
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>16Oct2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function VerifyMarkToPost
	Dim sColumnNum, sInvoiceResult, sTodayDate
	Dim oTable

	'Navigate to Mark for Posting
	If SelectMainMenu1(GlobalDictionary("MarkToPost")) = True Then
		WriteToReport micPass, "VerifyMarkToPost - Mark For Posting Page", "On the Mark For Posting Page.", False
	Else
		WriteToReport micFail, "VerifyMarkToPost - Mark For Posting Page", "Navigation to Mark For Posting page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Mark Journals for Posting").PSFrame("Mark Journals for Post")

		.WebEdit("JRNL_MARK_WORK_BUSINESS_UNIT").Set GlobalDictionary("BusinessUnit")
		.WebEdit("JRNL_MARK_WORK_LEDGER_GROUP").Set GlobalDictionary("Ledger")

		'Populates Fiscal Year to Current Year, if not provided
		If GlobalDictionary("FiscalYear") = "" Then
			sTodayDate = Date
			GlobalDictionary("FiscalYear") = Year(sTodayDate)
		End If

		.WebEdit("JRNL_MARK_WORK_FISCAL_YEAR").Set GlobalDictionary("FiscalYear")

		'Populates AccountingPeriod to Month, if not provided
		If GlobalDictionary("AccountingPeriod") = "" Then
			sTodayDate = Date
			GlobalDictionary("AccountingPeriod") = Month(sTodayDate)
		End	If

		.WebEdit("JRNL_MARK_WORK_ACCOUNTING_PERI").Set GlobalDictionary("AccountingPeriod")
		.WebEdit("JRNL_MARK_WORK_JOURNAL_ID").Set GlobalDictionary("JournalID")

		'.PSFrame("Mark Journals for Post").WebEdit("JRNL_MARK_WORK_JRNL_DATE_FROM").Set 
		'.PSFrame("Mark Journals for Post").WebEdit("JRNL_MARK_WORK_JRNL_DATE_THRU").Set
		.WebButton("Search").Click
	End With

	Set oTable = Browser("PeopleSoft Browser").Page("Mark Journals for Posting").PSFrame("Mark Journals for Post").WebTable("Header")
	sColumnNum = GetColumn(oTable, "Journal ID")
	sInvoiceResult = Browser("PeopleSoft Browser").Page("Mark Journals for Posting").PSFrame("Mark Journals for Post").WebTable("Results").GetCellData(1,sColumnNum)

	'Add Validation for Negative Test
	If GlobalDictionary("Negative") = "Y" Then
		If TRIM(sInvoiceResult) = TRIM(GlobalDictionary("JournalID")) Then
			WriteToReport micFail, "VerifyMarkToPost", "Journal [" & GlobalDictionary("JournalID") & "] with a status of [" & GlobalDictionary("JournalStatus") & "] is displayed in results.", False
		Else
			WriteToReport micPass, "VerifyMarkToPost", "Journal [" & GlobalDictionary("JournalID") & "] with a status of [" & GlobalDictionary("JournalStatus") & "] is not displayed in results as expected.", True
		End If	
	Else
		If TRIM(sInvoiceResult) = TRIM(GlobalDictionary("JournalID")) Then
			WriteToReport micPass, "VerifyMarkToPost", "Journal is displayed in results.", False
		Else
			WriteToReport micFail, "VerifyMarkToPost", "Journal is not displayed in results.", True
		End If
	End If
End Function	

'**************************************************************************************************************
''' <summary> 
''' Verify Journals unable to MarkToPost
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>16Oct2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function NegVerifyMarkToPost	'1.04b

	'Pull in Status 1 to verify
	GlobalDictionary("JournalStatus") = GlobalDictionary("JournalStatus1")

	'Get Query Results for status of E
	dbGetJournalfromHeaderStatus(GlobalDictionary("JournalStatus"))

	VerifyMarkToPost

	'Pull in Status 2 to verify
	GlobalDictionary("JournalStatus") = GlobalDictionary("JournalStatus2")

	'Get Query Results for status of N
	dbGetJournalfromHeaderStatus(GlobalDictionary("JournalStatus"))
	VerifyMarkToPost

	'Pull in Journal Status 3 to verify
	GlobalDictionary("JournalStatus") = GlobalDictionary("JournalStatus3")

	'Get Query Results for Status of U
	dbGetJournalfromHeaderStatus(GlobalDictionary("JournalStatus"))

	VerifyMarkToPost
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the Journal Inbound test(10.06)
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate></endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function JournalInbound
	Dim sSQL
	Dim nResult
	Dim arrRecordValues, arrResults(), arrTemp
	Dim strOldInstance, strNewInstance, strTemp

	'SQL statement to search for cdw_jrnl history
	sSQL = "SELECT CDW_APPLIED_DATE, * FROM PS_CDW_INTFACE_CTL WHERE CDW_INTERFACE_NAME = 'JOURNAL_IN' AND CDW_LOAD_STAT_CTL = 'P' ORDER BY 1 DESC"
	nResult = -1
	arrRecordValues = dbGetFirstRecord(sSQL, "", arrResults, "JournalInbound")

	'Confirm that we have results from our SQL query, exit otherwise
    On Error Resume Next
	nResult = UBound(arrRecordValues)
	If nResult > 0 Then
        WriteToReport micPass, "JournalInbound - SQL Query Executed", "SQL query successfully executed.", False
    Else
    	On Error Goto 0
    	WriteToReport micFail, "JournalInbound - SQL Query Executed", "SQL query successfully executed. However, no values were returned and the test will stop.", False
    	ExitTest
	End If
	strOldInstance = arrRecordValues(2)	'Store the cdw_batch_id field

	'Login as our batch user
	'Login()	
	'logincdwbatch()

	'Navigate to the System Process Request page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection1")) = True Then
		WriteToReport micPass, "JournalInbound - System Process Request Page", "On the System Process Request page.", False
	Else
		WriteToReport micFail, "JournalInbound - System Process Request Page", "Navigation to System Process Request page failed. Exiting test.", True
		ExitTest
	End If

	'Run the process
	With Browser("PeopleSoft Browser").Page("CDW System Process Request")
		.PSFrame("TargetContent").WebTabStrip("WebTabStrip").Select "Add a New Value"
		Browser("PeopleSoft Browser").Sync
		.PSFrame("TargetContent").WebEdit("RunID").Set "Test" & CLng(Timer)
		.PSFrame("TargetContent").WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Click the RUN button to bring up our process list
		.PSFrame("TargetContent").WebButton("Run").Click
		If .PSframe("Process Scheduler Request").WebElement("CDW_JRNL").Exist(15) Then
			strTemp = .PSframe("Process Scheduler Request").WebElement("CDW_JRNL").GetROProperty("html id")
			arrTemp = split(strTemp, "$")
			.PSframe("Process Scheduler Request").WebCheckBox("html id:=PRCSRQSTDLG_WRK_SELECT_FLAG\$" & arrTemp(1)).Object.scrollIntoView
			.PSframe("Process Scheduler Request").WebCheckBox("html id:=PRCSRQSTDLG_WRK_SELECT_FLAG\$" & arrTemp(1)).Set "ON"
			GlobalDictionary("Process") = .PSframe("Process Scheduler Request").WebElement("CDW_JRNL").GetROProperty("Innertext")
			WriteToReport micDone, functionName & " - Process Name", GlobalDictionary("Process"), False
		Else
			WriteToReport micFail, "", "Unable to find the process listed on the page. Exiting test.", True
			ExitTest
		End If

		'Scroll down to the bottom to locate and click on the OK button
		.PSframe("Process Scheduler Request").WebButton("OK").Object.scrollIntoView
		.PSframe("Process Scheduler Request").WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync

		'Grab the Instance number of the new process
		strTemp = .WebElement("html id:=PRCSRQSTDLG_WRK_DESCR100").GetRoProperty("innertext")
		arrTemp = Split(strTemp, ":")
		GlobalDictionary("InstanceNumber") = arrTemp(1)
		WriteToReport micDone, functionName & " - Instance Number", GlobalDictionary("InstanceNumber"), False
		.PSFrame("TargetContent").Link("Process Monitor").Click
	End With

	'Process monitor
	SharedProcessMonitor "JournalInbound"

	'Run SQL again
	nResult = -1
	arrRecordValues = dbGetFirstRecord(sSQL, "", arrRecordValues, "JournalInbound_2")

	'Confirm that we have results from our SQL query, exit otherwise
    On Error Resume Next
	nResult = UBound(arrRecordValues)
	If nResult > 0 Then
        WriteToReport micPass, "JournalInbound - SQL Query Executed", "SQL query successfully executed.", False
    Else
    	On Error Goto 0
    	WriteToReport micFail, "JournalInbound - SQL Query Executed", "SQL query successfully executed. However, no values were returned and the test will stop.", False
    	ExitTest
	End If
	strNewInstance = arrRecordValues(2)	'Store the cdw_batch_id field

	'Confirm that our process ran
	If strNewInstance > strOldInstance Then
		WriteToReport micPass, "JournalInbound - Instance", "CDW_JRNL process ran.", False
    Else
    	WriteToReport micFail, "JournalInbound - Instance", "CDW_JRNL process did not run and show up in database. Exiting test.", False
    	ExitTest
	End If

	'Check for new journals
	ShraedCreateEditJournal "JournalInbound", False
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the Interface Department Outbound test(10.08)
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate></endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control:
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function InterfaceDeptOutbound
	Dim sSQL
	Dim nResult
	Dim arrRecordValues()
	Dim strOldInstance, strNewInstance

	'SQL statement to search for cdw_jrnl history
	sSQL = "SELECT CDW_EXTRACT_DATE, * FROM PS_CDW_INTFACE_CTL WHERE CDW_INTERFACE_NAME = 'DEPT_OUT' ORDER BY 3 DESC"
	nResult = -1
	arrRecordValues = dbGetFirstRecord(sSQL, "", arrRecordValues, "JournalInbound")

	'Confirm that we have results from our SQL query, exit otherwise
    On Error Resume Next
	nResult = UBound(arrRecordValues)
	If nResult > 0 Then
        WriteToReport micPass, "InterfaceDeptOutbound - SQL Query Executed", "SQL query successfully executed.", False
    Else
    	On Error Goto 0
    	WriteToReport micFail, "InterfaceDeptOutbound - SQL Query Executed", "SQL query successfully executed. However, no values were returned and the test will stop.", False
    	ExitTest
	End If

	strOldInstance = arrRecordValues(2)	'Store the cdw_batch_id field
	Login()

	'Navigate to the Query Manager page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection1")) = True Then
		WriteToReport micPass, "InterfaceDeptOutbound - Query Manager Page", "On the Query Manager page.", False
	Else
		WriteToReport micFail, "InterfaceDeptOutbound - Query Manager Page", "Navigation to Query Manager page failed. Exiting test.", True
		ExitTest
	End If

	'Run SQL again
	nResult = -1
	arrRecordValues = dbGetFirstRecord(sSQL, "", arrRecordValues, "JournalInbound_2")

	'Confirm that we have results from our SQL query, exit otherwise
    On Error Resume Next
	nResult = UBound(arrRecordValues)
	If nResult > 0 Then
        WriteToReport micPass, "InterfaceDeptOutbound - SQL Query Executed", "SQL query successfully executed.", False
    Else
    	On Error Goto 0
    	WriteToReport micFail, "InterfaceDeptOutbound - SQL Query Executed", "SQL query successfully executed. However, no values were returned and the test will stop.", False
    	ExitTest
	End If

	strNewInstance = arrRecordValues(2)	'Store the cdw_batch_id field

	'Confirm that our process ran
	If strNewInstance > strOldInstance Then
		WriteToReport micPass, "InterfaceDeptOutbound - Instance", "CDW_JRNL process ran.", False
    Else
    	WriteToReport micFail, "InterfaceDeptOutbound - Instance", "CDW_JRNL process did not run and show up in database. Exiting test.", False
    	ExitTest
	End If

	Browser("Query Manager").Page("Query Manager").PSFrame("Query Manager").WebEdit("QRYSELECT_WRK_QRYSEARCHTEXT254").Set "CDW_DEPT_STG"
	Browser("Query Manager").Page("Query Manager").PSFrame("Query Manager").WebButton("Search").Click
End Function

'**************************************************************************************************************
''' <summary> 
''' Creates Journal, Submits for Approval, Login as CDW_GL_MANAGER, run Edit journal and verify posts
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>16Oct2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function EditJournalOverideApproval
	Dim aProcessInstance, sJournalInfo, sProcessInstances, sTodayDate

	sTodayDate = Date

	'Create Journal and submit for approval
	SharedCreateAddJournal "CreateValidJournalover25000", False

	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Go to the Approval page if we aren't already there
		If .Link("Approval").Exist(5) Then
			.Link("Approval").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Submit our journal for approval
		.WebButton("Submit").Click
		Browser("Peoplesoft Browser").Sync

		'Check for a popup - if it exists, that means something went wrong in the approval process and we need to screenshot it and exit the test
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(5) Then
			WriteToReport micFail, "CreateValidJournalover25000 - Submit Journal", "Could not submit journal for approval. Exiting test.", True
		End If

		'Check for the email
		If .WebElement("Pending").Exist(5) Then
			WriteToReport micPass, "CreateValidJournalover25000 - Submit Journal", "Successfully submitted journal for approval and sent email.", False
		Else
			WriteToReport micFail, "CreateValidJournalover25000 - Submit Journal", "Submitted journal for approval but email was not sent. Exiting test.", True
			ExitTest
		End If
	End With	

	'Login as CDW_GL_MANAGER role
	login(GlobalDictionary("GLManager"))

	'Navigate to Mark for Posting
	If SelectMainMenu1(GlobalDictionary("EditJournal")) = True Then
		WriteToReport micPass, "EditJournalOverideApproval - Edit Journals Page", "On the Edit Journals Page.", False
	Else
		WriteToReport micFail, "EditJournalOverideApproval - Edit Journals Page", "Navigation to Edit Journals page failed. Exiting test.", True
		ExitTest
	End If

	'Enter Run Control ID
	Browser("PeopleSoft Browser").Page("Edit Journals").PSFrame("TargetContent").WebEdit("PRCSRUNCNTL_RUN_CNTL_ID").Set GlobalDictionary("RunControlID")

	'Click Search
	Browser("PeopleSoft Browser").Page("Edit Journals").PSFrame("TargetContent").WebButton("Search").Click

	With Browser("PeopleSoft Browser").Page("Edit Journals").PSFrame("TargetContent")

		'Verify on Edit Journals Request page
		If .WebElement("Edit Journals Request").Exist(10) Then
			WriteToReport micPass, "EditJournalOverideApproval - Edit Journals Request Page", "On the Edit Journals Request Page.", False
		Else
			WriteToReport micFail, "EditJournalOverideApproval - Edit Journals Request Page", "Edit Journals Request Page did not load.", True
			ExitTest
		End If

		'Select Process Frequency
		.WebRadioGroup("Process_Frequency").Select "O"

		'Enter BU, Source, Journal Id, Journal Date and Description
		.WebEdit("Business_Unit").Set GlobalDictionary("BusinessUnit")
		.WebEdit("Source").Set GlobalDictionary("Source")
		.WebEdit("Journal_ID_From").Set GlobalDictionary("JournalID")
		.WebEdit("JournalID_To").Set GlobalDictionary("JournalID")
		.WebEdit("Journal_Date_From").Set sTodayDate
		.WebEdit("Journal_Date_To").Set sTodayDate
		
        .WebEdit("Description").Set "Edit"

		'Select Checkboxes for Edit, Post, Re-Edit, ReEdit CC Adjustment Journals
		'Check to make sure it is not disabled (1 disabled, 0 not disabled)first, then check to see if checked (0 not checked, 1 checked)

		'Make Sure Edit box is checked if disabled, if not checked and not disabled, it is checked and if disabled and not checked fail
		If .WebCheckBox("Edit").GetROProperty("disabled") = 1 AND .WebCheckBox("Edit").GetROProperty("checked") = 1 Then
			WriteToReport MicPass, "EditJournalOverideApproval", "Edit box is disabled but checked. ", False
		ElseIf .WebCheckBox("Edit").GetROProperty("disabled") = 0 AND .WebCheckBox("Edit").GetROProperty("checked") = 0 Then
			.WebCheckBox("Edit").Set "ON"
			WriteToReport MicPass, "EditJournalOverideApproval", "Edit box is checked. ", False
		ElseIf .WebCheckBox("Edit").GetROProperty("disabled") = 1 AND .WebCheckBox("Edit").GetROProperty("checked") = 0 Then
			WriteToReport micFail, "EditJournalOverideApproval", "Unable to check Edit due to it being disabled and not checked.", True
			ExitTest
		End If

		'Make Sure Post box is checked if disabled, if not checked and not disabled, it is checked and if disabled and not checked fail
		If .WebCheckBox("Post").GetROProperty("disabled") = 1 AND .WebCheckBox("Post").GetROProperty("checked") = 1 Then
			WriteToReport MicPass, "EditJournalOverideApproval", "Post box is disabled but checked. ", False
		ElseIf .WebCheckBox("Post").GetROProperty("disabled") = 0 AND .WebCheckBox("Post").GetROProperty("checked") = 0 Then
			.WebCheckBox("Post").Set "ON"
			WriteToReport MicPass, "EditJournalOverideApproval", "Post box is checked. ", False
		ElseIf .WebCheckBox("Post").GetROProperty("disabled") = 1 AND .WebCheckBox("Post").GetROProperty("checked") = 0 Then
			WriteToReport micFail, "EditJournalOverideApproval", "Unable to check Post due to it being disabled and not checked.", True
			ExitTest
		End If

		'Make Sure ReEdit box is checked if disabled, if not checked and not disabled, it is checked and if disabled and not checked fail
		If .WebCheckBox("ReEdit").GetROProperty("disabled") = 1 AND .WebCheckBox("ReEdit").GetROProperty("checked") = 1 Then
			WriteToReport MicPass, "EditJournalOverideApproval", "ReEdit box is disabled but checked. ", False
		ElseIf .WebCheckBox("ReEdit").GetROProperty("disabled") = 0 AND .WebCheckBox("ReEdit").GetROProperty("checked") = 0 Then
			.WebCheckBox("ReEdit").Set "ON"
			WriteToReport MicPass, "EditJournalOverideApproval", "ReEdit box is checked. ", False
		ElseIf .WebCheckBox("ReEdit").GetROProperty("disabled") = 1 AND .WebCheckBox("ReEdit").GetROProperty("checked") = 0 Then
			WriteToReport micFail, "EditJournalOverideApproval", "Unable to check ReEdit due to it being disabled and not checked.", True
			ExitTest
		End If		

		'Make Sure ReEdit_CC_Adjustment_Journals box is checked if disabled, if not checked and not disabled, it is checked and if disabled and not checked fail
		If .WebCheckBox("ReEdit_CC_Adjustment_Journals").GetROProperty("disabled") = 1 AND .WebCheckBox("ReEdit_CC_Adjustment_Journals").GetROProperty("checked") = 1 Then
			WriteToReport MicPass, "EditJournalOverideApproval", "ReEdit_CC_Adjustment_Journals box is disabled but checked. ", False
		ElseIf .WebCheckBox("ReEdit_CC_Adjustment_Journals").GetROProperty("disabled") = 0 AND .WebCheckBox("ReEdit_CC_Adjustment_Journals").GetROProperty("checked") = 0 Then
			.WebCheckBox("ReEdit_CC_Adjustment_Journals").Set "ON"
			WriteToReport MicPass, "EditJournalOverideApproval", "ReEdit_CC_Adjustment_Journals box is checked. ", False
		ElseIf .WebCheckBox("ReEdit_CC_Adjustment_Journals").GetROProperty("disabled") = 1 AND .WebCheckBox("ReEdit_CC_Adjustment_Journals").GetROProperty("checked") = 0 Then
			WriteToReport micFail, "EditJournalOverideApproval", "Unable to check ReEdit_CC_Adjustment_Journals due to it being disabled and not checked.", True
			ExitTest
		End If

		'Click Run
		.WebButton("Run").Click
	End With

	'Select the processes
	With Browser("PeopleSoft Browser").Page("Edit Journals").PSFrame("Process Scheduler Request")

		.WebCheckBox("GL_JEDIT").Set "ON"
		.WebCheckBox("GLJEDERR").Set "ON"
		.WebButton("OK").Click
	End With

	'Grab the Process Instances to Verify with (2are usually displayed)
	sProcessInstances = Browser("PeopleSoft Browser").Page("Edit Journals").PSFrame("Status Bar").WebElement("ProcessInstances").GetROProperty("innertext")
	aProcessInstance = Split(sProcessInstances,",")
	aProcessInstance(0) = (Split(aProcessInstance(0),":")(1))
	Browser("PeopleSoft Browser").Page("Edit Journals").PSFrame("Status Bar").Link("Process Monitor").Click

	'GetStatus for first Process In stance
	getStatus Trim(aProcessInstance(0)), GlobalDictionary("GLManager")
	getStatus Trim(aProcessInstance(1)), GlobalDictionary("GLManager")

	'Pull info for Journal Status and fails if results are not returned
	 sJournalInfo = FindJournal(GlobalDictionary("JournalID"))
	If IsArrayEmpty(sJournalInfo) Then			
		WriteToReport micFail, "FindJournal DB", "DB query returned zero records ", False
		Exit Function
	End If

	'Verify Data is in Datatable, if so, then Journal is Posted
	If DataTable.Value("JOURNAL_ID","FindJournalByID") <> ""  Then
		If DataTable.Value("JRNL_HDR_STATUS","FindJournalByID") = "P" Then
			WriteToReport MicPass, "EditJournalOverideApproval", "Journal [" &DataTable.Value("JOURNAL_ID","FindJournalByID") & "] has a status of Posted. ", False	
		Else
			WriteToReport MicPass, "EditJournalOverideApproval", "Journal [" &DataTable.Value("JOURNAL_ID","FindJournalByID") & "] was not Posed, Check Results. ", False	
		End If
	Else
		WriteToReport MicPass, "EditJournalOverideApproval", "Journal [" &DataTable.Value("JOURNAL_ID","FindJournalByID") & "] was not Posed, Check Results. ", False				
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Add GL Account
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>23Oct2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Function AddGLAccount
	Dim  sAccount, sDate, sYY

	'Build Date

	'Get Year
	sYY = Year(Date)

	'Preset for first of year, just add Current Year
	sDate = "01/01/"&sYY

	'Navigate to ChartFieldValues Homepage
	If SelectMainMenu1(GlobalDictionary("AddCharfieldMenu")) = True Then
		WriteToReport micPass, "AddGLAccount", "On the ChartFieldValues Homepage.", False
	Else
		WriteToReport micFail, "AddGLAccount", "Navigation to ChartFieldValues Homepage failed. Exiting test.", True
		ExitTest
	End If

	'Click Account Link
	Browser("PeopleSoft Browser").Page("ChartField Values").PSFrame("ChartField Values Homepage").Link("Account").Click

	With Browser("PeopleSoft Browser").Page("ChartField Values").PSFrame("TargetContent")

		'Makes sure you are on 'Add a New Value tab
		.Link("Add a New Value").Click

		'Enters Account that currently does not exist
		.WebEdit("GL_Account").Set GlobalDictionary("Account") 

		'Adds
		.WebButton("Add").Click

		'Verify Page with Account creating is displayed
		If .WebElement("GL_ACCOUNT_TBL_ACCOUNT").Exist(10) Then
			sAccount = .WebElement("GL_ACCOUNT_TBL_ACCOUNT").GetROProperty("innertext")
			WriteToReport micPass, "AddGLAccount", "Account [" & sAccount & "] is displayed.", False		
		Else
			WriteToReport micFail, "AddGLAccount", "Account Page is not displayed.", True	
		End If

		'Needs to be First of Year
		.WebEdit("GL_Account_Effective_Date").Set sDate
		.WebEdit("GL_Account_Description").Set GlobalDictionary("AccountDescription") 
		.WebEdit("GL_Account_Short_Description").Set GlobalDictionary("AccountShortDescr")
		.WebList("GL_Account_Type").Select GlobalDictionary("AccountMonetaryType")
		.WebButton("Save").Click

		WriteToReport micPass, "AddGLAccount", "Account [" & sAccount & "] is created.", False	
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Add Dept
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>24Oct2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Function AddGLDept
	Dim  sDeptId, sDate, sYY

	'Build Date

	'Get Year
	sYY = Year(Date)

	'Preset for first of year, just add Current Year
	sDate = "01/01/"&sYY

	'Navigate to ChartFieldValues Homepage
	If SelectMainMenu1(GlobalDictionary("AddCharfieldMenu")) = True Then
		WriteToReport micPass, "AddGLDept", "On the ChartFieldValues Homepage.", False
	Else
		WriteToReport micFail, "AddGLDept", "Navigation to ChartFieldValues Homepage failed. Exiting test.", True
		ExitTest
	End If

	'Click Department Link
	Browser("PeopleSoft Browser").Page("ChartField Values").PSFrame("ChartField Values Homepage").Link("Department").Click

	With Browser("PeopleSoft Browser").Page("ChartField Values").PSFrame("TargetContent")

		'Makes sure you are on 'Add a New Value tab
		.Link("Add a New Value").Click

		'Enter DeptID
		.WebEdit("DeptID").Set GlobalDictionary("DeptID")

		'Adds
		.WebButton("Add").Click

		'Verify Page with DeptId creating is displayed
		If .WebElement("DEPT_TBL_DEPTID").Exist(10) Then
			sDeptId = .WebElement("DEPT_TBL_DEPTID").GetROProperty("innertext")
			WriteToReport micPass, "AddGLDeptt", "Department [" & sDeptId & "] is displayed.", False		
		Else
			WriteToReport micFail, "AddGLDept", "Department Page is not displayed.", True	
		End If	

		.WebEdit("Dept_Effective_Date").Set sDate
		.WebList("Dept_Effective_Status").Select GlobalDictionary("DeptStats")
		.WebEdit("Dept_Description").Set GlobalDictionary("DeptDescription")
		.WebEdit("Dept_Short_Description").Set GlobalDictionary("DeptShortDesc")
		.WebButton("Save").Click

		WriteToReport micPass, "AddGLDeptt", "Department [" & sDeptId & "] is created.", False		
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Verify Account is in tree
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>24Oct2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'	17JAN19		Brian B.		Increased Exist timer from 10 to 20 for Tre Link "Find".
'**************************************************************************************************************
Function VerifyGLAccount
	Dim aRange, sFirstItem

	'Navigate to Tree Manager
	If SelectMainMenu1(GlobalDictionary("TreeManagerMenu")) = True Then
		WriteToReport micPass, "VerifyGLAccountt", "On the Tree Manager page.", False
	Else
		WriteToReport micFail, "VerifyGLAccount", "Navigation to Tree Manager page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Tree Manager").PSFrame("TargetContent")

		'Makes sure it is on Find Existing
		If .Link("Find an Existing Tree").Exist(10) Then
			.Link("Find an Existing Tree").Click
		End If

		'Enter Search Criteria to find Tree
		.WebList("SearchBy").Select GlobalDictionary("TMSearchBy")
		.WebEdit("Tree_Search").Set GlobalDictionary("AccountTree")
		.WebButton("Search").Click

		If Not .Link("FirstTreeinResults").Exist(10) Then
			WriteToReport micFail, "VerifyGLAccount", "Results are not returned for Tree.", True
			ExitTest
		End If

		'Clicks first link in Results
		.Link("FirstTreeinResults").Click

		If Not .Link("Find").Exist(20)  Then
			WriteToReport micFail, "VerifyGLAccount", "Tree Manager page did not load.", True
			ExitTest			
		End If

		.Link("Find").Click
	End With

	With Browser("PeopleSoft Browser").Page("Tree Manager").PSFrame("Find Value")
		.WebEdit("Find_Detail").Set GlobalDictionary("Account")
		.WebEdit("Description").Set GlobalDictionary("AccountDescription")
		.WebButton("Find").Click
	End With

	'Verify Error Message is not displayed
	If Browser("PeopleSoft Browser").Page("Tree Manager").WebElement("LeafNotFound").Exist(30) Then
		WriteToReport micFail, "VerifyGLAccount", "Account ["& GlobalDictionary("Account") & "] was not found.", True
		ExitTest		
	End If

	'Pull first item found
	sFirstItem = Browser("PeopleSoft Browser").Page("Tree Manager").PSFrame("TargetContent").WebTree("tree").GetROProperty("first item")

	'Verify Account is within range of first item
	sFirstItem = Replace(sFirstItem,"[","")
	sFirstItem = Replace(sFirstItem,"]","")

	'Split for lower number to compare and upper number to compare
	aRange = Split(sFirstItem,"-")

	If (CDbl(GlobalDictionary("Account")) >= CDbl(aRange(0))) AND (CDbl(GlobalDictionary("Account"))<= CDbl(aRange(1))) Then
		WriteToReport micPass, "VerifyGLAccount", "Account ["& GlobalDictionary("Account") & "] was found within the leaf [" &sFirstItem &"].", False
	Else
		WriteToReport micFail, "VerifyGLAccount", "Account ["& GlobalDictionary("Account") & "] was not found within the leaf [" &sFirstItem &"].", True
	End If	 
End Function

'**************************************************************************************************************
''' <summary> 
''' Verify Dept is in tree
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>24Oct2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Function VerifyGLDept
	Dim aRange, sFirstItem 

	'Navigate to Tree Manager
	If SelectMainMenu1(GlobalDictionary("TreeManagerMenu")) = True Then
		WriteToReport micPass, "VerifyGLDept", "On the Tree Manager page.", False
	Else
		WriteToReport micFail, "VerifyGLDept", "Navigation Tree Manager page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Tree Manager").PSFrame("TargetContent")

		'Makes sure it is on Find Existing
		If .Link("Find an Existing Tree").Exist(10) Then
			.Link("Find an Existing Tree").Click
		End If

		'Enter Search Criteria to find Tree
		.WebList("SearchBy").Select GlobalDictionary("TMSearchBy")
		.WebEdit("Tree_Search").Set GlobalDictionary("DeptTree")
		.WebButton("Search").Click

		If Not .Link("FirstTreeinResults").Exist(10) Then
			WriteToReport micFail, "VerifyGLDept", "Results are not returned for Tree.", True
			ExitTest
		End If

		'Clicks first result for Tree
		.Link("FirstTreeinResults").Click		

		If Not .Link("Find").Exist(10)  Then
			WriteToReport micFail, "VerifyGLDept", "Tree Manager page did not load.", True
			ExitTest			
		End If

		.Link("Find").Click
	End With

	With Browser("PeopleSoft Browser").Page("Tree Manager").PSFrame("Find Value")
		.WebEdit("Find_Detail").Set GlobalDictionary("DeptID")
		.WebEdit("Description").Set GlobalDictionary("DeptDescription")
		.WebButton("Find").Click
	End With

	'Verify Error Message is not displayed
	If Browser("PeopleSoft Browser").Page("Tree Manager").WebElement("LeafNotFound").Exist(30) Then
		WriteToReport micFail, "VerifyGLDept", "DeptID ["& GlobalDictionary("DeptID") & "] was not found.", True
		ExitTest		
	End If

	'Pull first item found
	sFirstItem = Browser("PeopleSoft Browser").Page("Tree Manager").PSFrame("TargetContent").WebTree("tree").GetROProperty("first item")

	'Verify Account is within range of first item
	sFirstItem = Replace(sFirstItem,"[","")
	sFirstItem = Replace(sFirstItem,"]","")

	'Split for lower number to compare and upper number to compare
	aRange = Split(sFirstItem,"-")
	
	If (CDbl(GlobalDictionary("DeptID")) >= CDbl(aRange(0))) AND (CDbl(GlobalDictionary("DeptID"))<= CDbl(aRange(1))) Then
		WriteToReport micPass, "VerifyGLDept", "DeptID ["& GlobalDictionary("DeptID") & "] was found within the leaf [" &sFirstItem &"].", False
	Else
	 	WriteToReport micFail, "VerifyGLDept", "DeptID ["& GlobalDictionary("DeptID") & "] was not found within the leaf [" &sFirstItem &"].", True	 
	End If 
End Function

'**************************************************************************************************************
''' <summary> 
''' Verify Account and Dept do not show up in Combination Data until after Build Combination Data is ran
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>25Oct2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************		
Function ComboEdit
	Dim  aInstance, sDate, sYY

	'Build Date

	'Get Year
	sYY = Year(Date)

	'Preset for first of year, just add Current Year
	sDate = "01/01/"&sYY

	'Navigate to Review Combination Data
	If SelectMainMenu1(GlobalDictionary("ReviewCombinationDataMenu")) = True Then
		WriteToReport micPass, "ComboEdit", "On the Review Combination Data page.", False
	Else
		WriteToReport micFail, "ComboEdit", "Navigation Review Combination Data page failed. Exiting test.", True
		ExitTest
	End If

	'Check to make sure Account is not displayed in Combination Data
	With Browser("PeopleSoft Browser").Page("Review Combination Data").PSFrame("Combo Rules Inquiry")

		.WebEdit("SetID").Set GlobalDictionary("SetID")
		.WebEdit("Group").Set GlobalDictionary("BusinessUnit")
		.WebEdit("Account").Set GlobalDictionary("Account")
		.WebEdit("Dept").Set ""
		.WebButton("Search").Click	

		If .WebElement("RowsRetrieved").Exist(10) Then
			WriteToReport micFail, "ComboEdit", "Results are returned before Build Combination Data is ran for Account [" & GlobalDictionary("Account") &"].", True	
		Else
			WriteToReport micPass, "ComboEdit", "Combination Data does not exist for Account [" &GlobalDictionary("Account") & "].", False			
		End If
	End With

	'Check to make sure Dept is not displayed in Combination Data
	With Browser("PeopleSoft Browser").Page("Review Combination Data").PSFrame("Combo Rules Inquiry")

		.WebEdit("SetID").Set GlobalDictionary("SetID")		
		.WebEdit("Group").Set GlobalDictionary("BusinessUnit")
		.WebEdit("Account").Set ""
		.WebEdit("Dept").Set GlobalDictionary("DeptID")		
		.WebButton("Search").Click	

		If .WebElement("RowsRetrieved").Exist(10) Then
			WriteToReport micFail, "ComboEdit", "Results are returned before Build Combination Data is ran for Dept [" & GlobalDictionary("DeptID") &"].", True	
		Else
			WriteToReport micPass, "ComboEdit", "Combination Data does not exist for Dept [" &GlobalDictionary("DeptID") & "].", False			
		End If
	End With

	'Run Build Combination Data

	'Navigate to Build Combination Data
	If SelectMainMenu1(GlobalDictionary("BuildCombinationDataMenu")) = True Then
		WriteToReport micPass, "ComboEdit", "On the Build Combination Data page.", False
	Else
		WriteToReport micFail, "ComboEdit", "Navigation Build Combination Data page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Build Combination Data").PSFrame("TargetContent")

		.WebEdit("Control_ID").Set GlobalDictionary("RunControlID")	
		.WebButton("Search").Click

		If Not .WebList("Process_Frequency").Exist(10) Then		
			.Link("Add a New Value").Click
			.WebEdit("Control_ID").Set GlobalDictionary("RunControlID") 			
			Browser("PeopleSoft Browser").Page("Build Combination Data").PSFrame("TargetContent").WebButton("Add").Click
		End If

		.WebEdit("GL_PANELS_WRK_AS_OF_DATE").Set sDate
		.WebList("Process_Frequency").Select GlobalDictionary("Frequency")
		.WebEdit("Business_Unit").Set GlobalDictionary("BusinessUnit")
		.WebEdit("Ledger_Group").Set GlobalDictionary("Ledger")
		.WebList("BuiildOption").Select GlobalDictionary("BuildOption")
		.WebEdit("AsofDate").Set sDate
		.WebCheckBox("UseWildCardsinCombination").Set "OFF"
		.WebCheckBox("ActiveValuesOnly").Set "OFF"
		.WebButton("Run").Click
	End With

	Browser("PeopleSoft Browser").Page("Build Combination Data").PSFrame("Process Scheduler Request").WebCheckBox("FS_CEBD").Set "ON"	
	Browser("PeopleSoft Browser").Page("Build Combination Data").PSFrame("Process Scheduler Request").WebButton("OK").Click

	'Grab ProcessInstance
	aInstance = Split(Browser("PeopleSoft Browser").Page("Build Combination Data").PSFrame("Status Bar").WebElement("ProcessInstance").GetROProperty("innertext"),":")
	Browser("PeopleSoft Browser").Page("Build Combination Data").PSFrame("Status Bar").Link("Process Monitor").Click
	getStatus Trim(aInstance (1)), GlobalDictionary("SignInUser")

	'Navigate to Review Combination Data
	If SelectMainMenu1(GlobalDictionary("ReviewCombinationDataMenu")) = True Then
		WriteToReport micPass, "ComboEdit", "On the Review Combination Data page.", False
	Else
		WriteToReport micFail, "ComboEdit", "Navigation Review Combination Data page failed. Exiting test.", True
		ExitTest
	End If

	'Check to make sure Account is displayed in Combination Data
	With Browser("PeopleSoft Browser").Page("Review Combination Data").PSFrame("Combo Rules Inquiry")

		.WebEdit("SetID").Set GlobalDictionary("SetID")
		.WebEdit("Group").Set GlobalDictionary("BusinessUnit")
		.WebEdit("Account").Set GlobalDictionary("Account")
		.WebEdit("Dept").Set ""
		.WebButton("Search").Click

		If .WebElement("RowsRetrieved").Exist(10) Then
			WriteToReport micPass, "ComboEdit", "Results are returned before Build Combination Data is ran for Account [" & GlobalDictionary("Account") &"].", False
		Else
			WriteToReport micFail, "ComboEdit", "Combination Data does not exist for Account [" &GlobalDictionary("Account") & "].", True			
		End If
	End With

	'Check to make sure Dept is displayed in Combination Data
	With Browser("PeopleSoft Browser").Page("Review Combination Data").PSFrame("Combo Rules Inquiry")

		.WebEdit("SetID").Set GlobalDictionary("SetID")
		.WebEdit("Group").Set GlobalDictionary("BusinessUnit")
		.WebEdit("Account").Set ""
		.WebEdit("Dept").Set GlobalDictionary("DeptID")
		.WebButton("Search").Click

		If .WebElement("RowsRetrieved").Exist(10) Then
			WriteToReport micPass, "ComboEdit", "Results are returned before Build Combination Data is ran for Dept [" & GlobalDictionary("DeptID") &"].", False	
		Else
			WriteToReport micFail, "ComboEdit", "Combination Data does not exist for Dept [" &GlobalDictionary("DeptID") & "].", True			
		End If
	End With

	'Pull in Combo's based on Account and Dept created
	dbGetCombinations "Account", GlobalDictionary("Account")	
	GlobalDictionary("Account1") = GlobalDictionary("Account")
	GlobalDictionary("Dept1") = DataTable.Value("DEPTID",GlobalDictionary("DBsheetname"))

	'Pull in Combo's based on Account and Dept created
	dbGetCombinations "Dept", GlobalDictionary("DeptID")

	GlobalDictionary("Dept2") = GlobalDictionary("DeptID")
	GlobalDictionary("Account2") = DataTable.Value("ACCOUNT",GlobalDictionary("DBsheetname"))	
End Function

'**************************************************************************************************************
''' <summary> 
''' Delete an attachment on a Valid journal
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>October 29, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Attachment deleted</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function DeleteAttachmentsOnValidJournal	'GL 1.20
	Dim sAlert, sAttachments, aAttachments, sStartAttachments, sEndAttachments

	'Call Create Edit Update journal to find journal with attachments
	SharedCreateEditUpdateJournalStart "DeleteAttachemntsOnValidJournal", False

	With Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent")

		'Ensure that the journal results page loaded
		If .Link("Attachments").Exist(5) Then
			WriteToReport micPass, "DeleteAttachemntsOnValidJournal", "Journal results page loaded", False
		Else
			WriteToReport micFail, "DeleteAttachemntsOnValidJournal", "Journal results page did not load. Exiting test.", True
			ExitTest
		End If

		'Verify Attachments is greater than 0
		If .Link("Attachments").Exist(5) Then
			sAttachments = .Link("Attachments").GetROProperty("innertext")
			aAttachments = split(sAttachments,"(")
			sStartAttachments = Replace(aAttachments(1),")","")
			If sStartAttachments > 0 Then
				WriteToReport micPass, "DeleteAttachemntsOnValidJournal", "Attachment shows [" & sStartAttachments &"]." , False	
			Else
				WriteToReport micFail, "DeleteAttachemntsOnValidJournal", "Attachment shows [" & sStartAttachments &"]." , True				
			End If
		End If
		'Click on the Attachments link
		.Link("Attachments").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Attachment window opens
	With Browser("PeopleSoft Browser").Page("Create/Update Journal")

		'Confirm that the Delete Attachments button exists
		If .PSFrame("Journal Entry Attachments").WebButton("Delete Attachment").Exist(5) Then
			WriteToReport micPass, "DeleteAttachemntsOnValidJournal", "Delete Attachment button found.", False
		Else
			WriteToReport micFail, "DeleteAttachemntsOnValidJournal", "Delete Attachment button not found. Check page and object properties. Exiting test.", True
			ExitTest
		End If

		'Click "Delete Attachment" button
		.PSFrame("Journal Entry Attachments").WebButton("Delete Attachment").Click

		'Verify Delete Confirmation
		If .WebElement("Delete Confirmation").Exist(5) Then
			sAlert = Browser("PeopleSoft Browser").Page("Create/Update Journal").WebElement("Delete Confirmation").GetROProperty("innertext")
			WriteToReport micPass, "DeleteAttachemntsOnValidJournal", "Delete Confirmation is displayed. [" & sAlert &"]", False
		Else
			WriteToReport micFail, "DeleteAttachemntsOnValidJournal", "Delete Confirmation is not displayed.", True
			ExitTest		
		End If

		'Click the OK button
		.WebButton("Alert OK").Click

		'Click ok to close attachment window
		.PSFrame("Journal Entry Attachments").WebButton("OK").Click

		'Verify Attachments lowered by 1
		If .PSFrame("TargetContent").Link("Attachments").Exist(5) Then
			sAttachments = .PSFrame("TargetContent").Link("Attachments").GetROProperty("innertext")
			aAttachments = split(sAttachments,"(")
			sEndAttachments = Replace(aAttachments(1),")","")

			If CDbl(sEndAttachments) = (sStartAttachments - 1) Then
				WriteToReport micPass, "DeleteAttachemntsOnValidJournal", "Attachment shows [" & sEndAttachments &"]." , False	
			Else
				WriteToReport micFail, "DeleteAttachemntsOnValidJournal", "Attachment shows [" & sEndAttachments &"]." , True				
			End If
		End If

		'Click Save
		.PSFrame("TargetContent").WebButton("Save").Click

		'Clears Attachment GlobalDictionary value so when it searches it does not use Attachments
		GlobalDictionary("Attachment") = ""

		'Call Create Edit Update journal to find journal with attachments
		SharedCreateEditUpdateJournalStart "DeleteAttachemntsOnValidJournal", False

		'Verify Attachments is lowered by 1
		If .PSFrame("TargetContent").Link("Attachments").Exist(5) Then
			sAttachments = .PSFrame("TargetContent").Link("Attachments").GetROProperty("innertext")
			aAttachments = split(sAttachments,"(")
			sEndAttachments = Replace(aAttachments(1),")","")

			If CDbl(sEndAttachments) = (sStartAttachments - 1) Then
				WriteToReport micPass, "DeleteAttachemntsOnValidJournal", "Attachment shows [" & sEndAttachments &"]." , False	
			Else
				WriteToReport micFail, "DeleteAttachemntsOnValidJournal", "Attachment shows [" & sEndAttachments &"]." , True				
			End If
		End If	
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' ChartField Addition Request
''' </summary>
''' <author>Zach Apple</author>
''' <datecreated>25Oct2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'13May2019			Eric Trout		Updated to handle Multiple users
'**************************************************************************************************************
Function ChartFieldRequest 'GL 5.01-2
	Dim i
	Dim sAnswer, sTemp, sUsernames, sUserIDs
	Dim oAnswer
	Dim arrTemp, arrTemp1, arrTemp2
	Const NAME = 0
	Const ID = 1

	sUsernames = ""
	sUserIDs = ""

	'Navigate to the ChartField request page
	If SelectMainMenu1(GlobalDictionary("RequestChartField")) = True Then
		WriteToReport micPass, "ChartFieldRequest", "On the ChartField Request Page.", False
	Else
		WriteToReport micFail, "ChartFieldRequest", "Navigation to ChartField Request Page failed. Exiting test.", True
		ExitTest
	End If

	'Enter the information for the Request
	With Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request")

		If .WebEdit("SetID").GetROProperty("value") <> GlobalDictionary("SetID") Then
			.WebEdit("SetID").Set GlobalDictionary("SetID")
			WriteToReport micDone, "Set the SetID to " &GlobalDictionary("SetID"), "SetID Set Successfully", FALSE
		End If		
		.WebEdit("Field Name").Set GlobalDictionary("FieldName")
		WriteToReport micDone, "Set the Field Name to " &GlobalDictionary("FieldName"), "Field Name Set Successfully", FALSE
		.WebList("Field Action").Select GlobalDictionary("FieldAction")
		WriteToReport micDone, "Selected the Field Action " &GlobalDictionary("FieldAction"), "Field Action Selected Successfully", FALSE
		
		'First check that the stored GlobalDictionary Account number is not already used
		Call FindNewAccount

		.WebEdit("Field Value").Set GlobalDictionary("Account")
		WriteToReport micDone, "Set the Account to " &GlobalDictionary("Account"), "Account Set Successfully", FALSE
		.WebElement("Add").Click
		WriteToReport micDone, "Clicked the Add Button", "Add Button Clicked Successfully", FALSE

		If Browser("PeopleSoft Browser").Page("ChartField Request").WebElement("Alert Message").Exist(5) Then
			Browser("PeopleSoft Browser").Page("ChartField Request").WebElement("AlertOK").Click
			GlobalDictionary("Account") = GlobalDictionary("Account")+1
			WriteToReport micDone, "ChartFieldRequest", "Updated Account to: "&GlobalDictionary("Account"), FALSE
			.WebEdit("Field Value").Set GlobalDictionary("Account")
			.WebElement("Add").Click
		End If

		If Browser("PeopleSoft Browser").Page("ChartField Request").WebElement("Alert Message").Exist(5) Then
			WriteToReport micFail, "ChartFieldRequest", "Could not Find Account Number to Add.", FALSE
			Browser("PeopleSoft Browser").Page("ChartField Request").WebElement("AlertOK").Click
			ExitTest
		End If

		Browser("PeopleSoft Browser").Sync

		'Enter the information for the Account
		.WebEdit("Telephone").Set GlobalDictionary("Phone")
		WriteToReport micDone, "Set the Phone to " &GlobalDictionary("Phone"), "Phone Set Successfully", FALSE
		.WebEdit("Email ID").Set GlobalDictionary("EMAIL")
		WriteToReport micDone, "Set the Email ID to " &GlobalDictionary("EMAIL"), "Email Set Successfully", FALSE
		
		'Enter the information for the Core Information
		.WebEdit("Effective Date 1").Set GlobalDictionary("EffDate")
		WriteToReport micDone, "Set the Effective Date to " &GlobalDictionary("EffDate"), "Effective Date Set Successfully", FALSE

		.WebEdit("Monetary Account Type").Set GlobalDictionary("MonAccType")
		WriteToReport micDone, "Set the Monetary Account Type to " &GlobalDictionary("MonAccType"), "Monetary Account Type Set Successfully", FALSE

		.WebEdit("Description").Set GlobalDictionary("Desc")
		WriteToReport micDone, "Set the Description to " &GlobalDictionary("Desc"), "Description Set Successfully", FALSE

		.WebEdit("Short Description").Set GlobalDictionary("ShortDesc")
		WriteToReport micDone, "Set the Short Description to " &GlobalDictionary("ShortDesc"), "Short Description Set Successfully", FALSE
		
		'Enter the comment into the Request Comments box
		.WebElement("Request Comments").Click
		WriteToReport micDone, "Clicked the Request Comments tab to Expand" , "Request Comments Section Expanded Successfully", FALSE

		.WebEdit("Request Comments Box").Set GlobalDictionary("ReqComment")
		WriteToReport micDone, "Set the Request Comments to " &GlobalDictionary("ReqComment"), "Request Comments Set Successfully", FALSE
		
		'Insert the answers to the 10 Questions
		For i = 1 To 10
			.WebEdit("Answer_"&i).Set GlobalDictionary("Answer"&i)
			WriteToReport micDone, "Set the Answer to Question "& i & " to " &GlobalDictionary("Answer"&i), "Answer "&i&" Set Successfully", FALSE
		Next

		'Fill out the information for the Trees
		.WebEdit("Effective Date 2").Set GlobalDictionary("EffDate")
		WriteToReport micDone, "Set the Effective Date to " &GlobalDictionary("EffDate"), "Effective Date Set Successfully", FALSE
		.WebEdit("CDW_ACC_VALUE").Set GlobalDictionary("CDW_ACC_VALUE")
		WriteToReport micDone, "Set the First Tree Name to " &GlobalDictionary("CDW_ACC_VALUE"), "First Tree Name Set Successfully", FALSE
		.WebEdit("Effective Date 3").Set GlobalDictionary("EffDate")
		WriteToReport micDone, "Set the Effective Date to " &GlobalDictionary("EffDate"), "Effective Date Set Successfully", FALSE
		.WebEdit("AS400_ACC_VALUE").Set GlobalDictionary("AS400_ACC_VALUE")
		WriteToReport micDone, "Set the Second Tree Name to " &GlobalDictionary("AS400_ACC_VALUE"), "Second Tree Name Set Successfully", FALSE

		'Click the Save, make sure there is not an error popup
		.WebElement("Save").Click
		If Browser("PeopleSoft Browser").Page("ChartField Request").WebElement("Alert Message").Exist(15) Then
			WriteToReport micFail, "ChartFieldRequest", "An error occurred while setting a necessary field.", TRUE
			ExitTest
		Else
			WriteToReport micPass, "ChartFieldRequest", "Successfully saved the Request. Ready to submit.", FALSE
		End If

		Browser("PeopleSoft Browser").Sync

		'Select the Request Action 'Submit for Approval'
		If .WebList("Request Action").Exist(15) Then
			.WebList("Request Action").Select GlobalDictionary("ReqAct1")
		Else
			WriteToReport micFail, "ChartFieldRequest", "Could not locate the 'Request Action' dropdown.", TRUE
		End If

		'Click Go
		.WebButton("Go").Click
		WriteToReport micDone, "Clicked the Go Button", "Go Clicked Successfully", FALSE

		Browser("PeopleSoft Browser").Sync

		'Verify that the Link 'View Approval Flow' now exists
		If .Link("View Approval Flow").Exist(10) Then
			WriteToReport micPass, "ChartFieldRequest", "Successfuly Submitted the Request", FALSE
		Else
			WriteToReport micFail, "ChartFieldRequest", "View Approval Link not Found, Request Not Successfully Submitted", TRUE
			ExitTest
		End If

		'Grab the Request ID for later in the test
		If GlobalDictionary.Exists("ChartFieldRequestID") Then
			GlobalDictionary.Remove("ChartFieldRequestID")
		End If
		GlobalDictionary.Add "ChartFieldRequestID", .WebElement("ChartFieldRequestID").GetROProperty("innertext")

		WriteToReport micDone, "ChartFieldRequest", "The Request ID is: ["&GlobalDictionary("ChartFieldRequestID")&"]", FALSE

		'Get the user Ids and names that will be part of the Approval process
		.Link("View Approval Flow").Click
		WriteToReport micDone, "Clicked the View Approval Flow Link", "Clicked View Approval Link Successfully", FALSE
	End With

	With Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("Approval Flow")
		.Image("Expand").Click

		'Current user
		arrTemp = dbFetchUserFromId(GlobalDictionary("SignInUser"))
		sUsernames = arrTemp(NAME)

		'GL Supp user
		arrTemp = dbFetchUserId(Trim(.WebElement("GLSuppUser1").GetROProperty("innertext")))
		sUserIDs = arrTemp(ID)
		sUsernames = sUsernames & "," & .WebElement("GLSuppUser1").GetROProperty("innertext")
		WriteToReport micDone, "Found and Stored the GL Support User: " &.WebElement("GLSuppUser1").GetROProperty("innertext"), "GL Support User Stored Successfully", FALSE
		'Initial FinAcct user
		arrTemp = dbFetchUserId(Trim(.WebElement("InitFinAcctUser").GetROProperty("innertext")))
		sUserIDs = sUserIDs & "," & arrTemp(ID)
		sUsernames = sUsernames & "," & .WebElement("InitFinAcctUser").GetROProperty("innertext")
		WriteToReport micDone, "Found and Stored the Initial FinAcctg User: " &.WebElement("InitFinAcctUser").GetROProperty("innertext"), "Initial FinAcctg User Stored Successfully", FALSE
		'Hyperion Planner User
		arrTemp = dbFetchUserId(Trim(.WebElement("HyperionUser").GetROProperty("innertext")))
		sUserIDs = sUserIDs & "," & arrTemp(ID)
		sUsernames = sUsernames & "," & .WebElement("HyperionUser").GetROProperty("innertext")
		WriteToReport micDone, "Found and Stored the Hyperion Planner/ExtReporting User: " &.WebElement("HyperionUser").GetROProperty("innertext"), "Hyperion Planner/ExtReporting User Stored Successfully", FALSE
		'Final FinAcct user
		If NOT(InStr(1,.WebElement("FinalFinAcctUser").GetROProperty("innertext"),"No approvers found")>1) Then
		
			If Trim(.WebElement("FinalFinAcctUser").GetROProperty("innertext")) = "Multiple Approvers" Then
				'Click Multiple Approvers link
				.Link("Multiple Approvers").Click
				
				'Check for first approver, pull see if you can get OperID
				If Browser("CheckDisplay").Page("Approvers").WebTable("Approver1").Exist(10) Then
					sTemp = Browser("CheckDisplay").Page("Approvers").WebTable("Approver1").GetROProperty("text")
					arrTemp1 =Split(sTemp,"Name:")
					arrTemp2 = Split(arrTemp1(1),"Description:")
					arrTemp = dbFetchUserId(Trim(arrTemp2(0)))	
				End If
				
				Browser("CheckDisplay").Page("Approvers").WebButton("Close").Click

			Else
				arrTemp = dbFetchUserId(Trim(.WebElement("FinalFinAcctUser").GetROProperty("innertext")))	
			End If
			
			sUserIDs = sUserIDs & "," & arrTemp(ID)
			sUsernames = sUsernames & "," & .WebElement("FinalFinAcctUser").GetROProperty("innertext")
			WriteToReport micDone, "Found and Stored the Final FinAcctg User: " &.WebElement("FinalFinAcctUser").GetROProperty("innertext"), "Final FinAcctg User Stored Successfully", FALSE
		End If
		'GL Supp user
		arrTemp = dbFetchUserId(Trim(.WebElement("GLSuppUser2").GetROProperty("innertext")))
		sUserIDs = sUserIDs & "," & arrTemp(ID)
		sUsernames = sUsernames & "," & .WebElement("GLSuppUser2").GetROProperty("innertext")
		WriteToReport micDone, "Found and Stored the GL Support User: " &.WebElement("GLSuppUser2").GetROProperty("innertext"), "GL Support User Stored Successfully", FALSE

		'Store the strings for later in the test
		If GlobalDictionary.Exists("FromNames") Then
			GlobalDictionary.Remove("FromNames")
		End If
		GlobalDictionary.Add "FromNames", sUsernames

		If GlobalDictionary.Exists("Approvers") Then
			GlobalDictionary.Remove("Approvers")
		End If

		GlobalDictionary.Add "Approvers", sUserIDs
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' ChartField Addition Approval
''' </summary>
''' <author>Zach Apple</author>
''' <datecreated>26Oct2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'02/14/2019			Zach A.		Added db check for the user that is set to approve the request. Have had the case where it was reassigned silently
'**************************************************************************************************************		
Function ApproveChartfieldRequest 'GL 5.0X
	Dim arrayFromNames, arrayApproverIDs, arrTemp
	Dim oLink
	Dim i
	Dim sUser, sApproverCheck
	Const NAME = 0
	Const ID = 1

	'Build an array of names that will show as From on the Worklist page
	arrayFromNames = Split(GlobalDictionary("FromNames"),",")
	arrayApproverIDs = Split(GlobalDictionary("Approvers"),",")

	For i = 0 To UBound(arrayApproverIDs)
		'Sign out and sign in as the next person in line of the approval process
		sApproverCheck = dbCheckRequestApprover(GlobalDictionary("ChartFieldRequestID"))(9)
		If arrayApproverIDs(i) <> sApproverCheck Then
			WriteToReport micWarning, "Approver Has been Reassigned from ["&arrayApproverIDs(i)&"] to ["&sApproverCheck&"]", "Using the new Approver", FALSE
			arrayApproverIDs(i) = sApproverCheck
		End If
		Call login(arrayApproverIDs(i))

		'Navigate to the Worklist page
		If SelectMainMenu1(GlobalDictionary("MainMenuSelection3")) Then
			WriteToReport micPass, "ApproveChartFieldRequest", "Worklist Page is Loaded Successfully", FALSE
		Else
			WriteToReport micFail, "ApproveChartFieldRequest", "Worklist Page is not Loaded Successfully", TRUE
			ExitTest
		End If

		'Find the request from the previous user with the Request ID from the original Request
		Set oLink = Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist").WebElement("Link")
		'Call oLink.SetTOProperty("title", "from "&Trim(arrayFromNames(i)))
		WriteToReport micDone, "Looking for Request with ID ["&GlobalDictionary("ChartFieldRequestID")&"]", "", FALSE
		Call oLink.SetTOProperty("innertext", ".*"&GlobalDictionary("ChartFieldRequestID")&".*")
		oLink.RefreshObject
		If oLink.Exist(15) Then
			oLink.Click
			WriteToReport micPass, "ApproveChartFieldRequest", "Link for Approval from Previous User ("&Trim(arrayFromNames(i))&") and Request ID: ("&GlobalDictionary("ChartFieldRequestID")&") Successfuly Found and Clicked.", FALSE
		Else
			WriteToReport micFail, "ApproveChartFieldRequest", "Link for Approval from Previous User ("&Trim(arrayFromNames(i))&") and Request ID: ("&GlobalDictionary("ChartFieldRequestID")&") Not Found", TRUE
			ExitTest
		End If

		Browser("PeopleSoft Browser").Sync

		'Select the Request Action 'Approve'
		If Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebList("Request Action").Exist(15) Then
			Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebList("Request Action").Select GlobalDictionary("ReqAct2")
			WriteToReport micDone, "Selected from the Request Action Dropdown option " &GlobalDictionary("ReqAct2"), "Request Action Selected Successfully", FALSE
		Else
			WriteToReport micFail, "ChartFieldRequest", "Could not locate the 'Request Action' dropdown.", TRUE
		End If

		'Click Go
		Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebButton("Go").Click
		WriteToReport micDone, "Clicked the Go Button", "Go Button Clicked Successfully", FALSE

		Browser("PeopleSoft Browser").Sync

		'Verify the Updated By is the current user
		'Current user
		arrTemp = dbFetchUserFromId(arrayApproverIDs(i))
		sUser = Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebElement("Updated By").GetROProperty("innertext")
		If sUser = arrTemp(NAME) Then
			WriteToReport micpass, "ApproveChartfieldRequest", sUser&" Successfully Approved the Request from: " & arrayFromNames(i), FALSE
		End If
	Next	
End Function

'**************************************************************************************************************
''' <summary> 
''' ChartField Addition Denial by the Hyperion Planning User
''' </summary>
''' <author>Zach Apple</author>
''' <datecreated>31Oct2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************		
Function DenyChartfieldRequest 'GL 5.02
	Dim arrayFromNames, arrayApproverIDs, arrTemp
	Dim oLink
	Dim i
	Dim sUser
	Const NAME = 0
	Const ID = 1

	'Build an array of names that will show as From on the Worklist page
	arrayFromNames = Split(GlobalDictionary("FromNames"),",")
	arrayApproverIDs = Split(GlobalDictionary("Approvers"),",")

	For i = 0 To 1
		'Sign out and sign in as the next person in line of the approval process
		Call login(arrayApproverIDs(i))

		'Navigate to the Worklist page
		If SelectMainMenu1(GlobalDictionary("MainMenuSelection3")) Then
			WriteToReport micPass, "DenyChartfieldRequest", "Worklist Page is Loaded Successfully", FALSE
		Else
			WriteToReport micFail, "DenyChartfieldRequest", "Worklist Page is not Loaded Successfully", TRUE
			ExitTest
		End If

		'Find the request from the previous user with the Request ID from the original Request
		Set oLink = Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist").WebElement("Link")
		Call oLink.SetTOProperty("title", "from "&Trim(arrayFromNames(i)))
		Call oLink.SetTOProperty("innertext", ".*"&GlobalDictionary("ChartFieldRequestID")&".*")
		If oLink.Exist(5) Then
			oLink.Click
			WriteToReport micPass, "DenyChartfieldRequest", "Link for Approval from Previous User ("&Trim(arrayFromNames(i))&") and Request ID: ("&GlobalDictionary("ChartFieldRequestID")&") Successfuly Found and Clicked.", FALSE
		Else
			WriteToReport micFail, "DenyChartfieldRequest", "Link for Approval from Previous User ("&Trim(arrayFromNames(i))&") and Request ID: ("&GlobalDictionary("ChartFieldRequestID")&") Not Found", TRUE
			ExitTest
		End If

		Browser("PeopleSoft Browser").Sync

		'Select the Request Action 'Approve'
		If Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebList("Request Action").Exist(15) Then
			Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebList("Request Action").Select GlobalDictionary("ReqAct2")
			WriteToReport micDone, "Selected from the Request Action Dropdown option " &GlobalDictionary("ReqAct2"), "Request Action Selected Successfully", FALSE
		Else
			WriteToReport micFail, "ChartFieldRequest", "Could not locate the 'Request Action' dropdown.", TRUE
		End If

		'Click Go
		Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebButton("Go").Click
		WriteToReport micDone, "Clicked the Go Button", "Go Button Clicked Successfully", FALSE

		Browser("PeopleSoft Browser").Sync

		'Verify the Updated By is the current user
		sUser = Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebElement("Updated By").GetROProperty("innertext")
		If sUser = arrayFromNames(i) Then
			WriteToReport micPass, "DenyChartfieldRequest", sUser&" Successfully Approved the Request from: " & arrayApproverIDs(i), FALSE
		End If
	Next

	'Ensure i is now 2
	i = 2
	'Sign out and sign in as the Denier
	Call login(arrayApproverIDs(i))

	'Navigate to the Worklist page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection3")) Then
		WriteToReport micPass, "DenyChartfieldRequest", "Worklist Page is Loaded Successfully", FALSE
	Else
		WriteToReport micFail, "DenyChartfieldRequest", "Worklist Page is not Loaded Successfully", TRUE
		ExitTest
	End If

	'Find the request from the previous user with the Request ID from the original Request
	Set oLink = Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist").WebElement("Link")
	'Call oLink.SetTOProperty("title", "from "&Trim(arrayFromNames(i)))
	Call oLink.SetTOProperty("innertext", ".*"&GlobalDictionary("ChartFieldRequestID")&".*")
	oLink.RefreshObject
	If oLink.Exist(15) Then
		oLink.Click
		WriteToReport micPass, "DenyChartfieldRequest", "Link for Approval from Previous User ("&Trim(arrayFromNames(i))&") and Request ID: ("&GlobalDictionary("ChartFieldRequestID")&") Successfuly Found and Clicked.", FALSE
	Else
		WriteToReport micFail, "DenyChartfieldRequest", "Link for Approval from Previous User ("&Trim(arrayFromNames(i))&") and Request ID: ("&GlobalDictionary("ChartFieldRequestID")&") Not Found", TRUE
		ExitTest
	End If

	Browser("PeopleSoft Browser").Sync

	'Add a comment Denying the Request
	If Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebElement("Approval Comments").Exist(15) Then
		Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebElement("Approval Comments").Click
	Else
		WriteToReport micFail, "DenyChartfieldRequest", "Could not Expand the Approval Comments Box", TRUE
		ExitTest
	End If

	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebEdit("Approval Comments Box").Set GlobalDictionary("DenyComment")
	WriteToReport micDone, "Set Approval Commnets to " &GlobalDictionary("DenyComment"), "Approval Comment Set Successfully", FALSE

	'Select the Request Action 'Deny'
	If Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebList("Request Action").Exist(15) Then
		Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebList("Request Action").Select GlobalDictionary("ReqAct3")
		WriteToReport micDone, "Selected from the Request Action Dropdown option " &GlobalDictionary("ReqAct3"), "Request Action Selected Successfully", FALSE
	Else
		WriteToReport micFail, "DenyChartfieldRequest", "Could not locate the 'Request Action' dropdown.", TRUE
	End If

	'Click Go
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebButton("Go").Click
	WriteToReport micDone, "Clicked the Go Button", "Go Button Clicked Successfully", FALSE

	Browser("PeopleSoft Browser").Sync

	'Verify the Updated By is the current user
	arrTemp = dbFetchUserFromId(arrayApproverIDs(i))
	sUser = Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebElement("Updated By").GetROProperty("innertext")
	If sUser = arrTemp(NAME) Then
		WriteToReport micpass, "DenyChartfieldRequest", sUser&" Successfully Denied the Request from: " & arrayApproverIDs(i), FALSE
	End If

	If GlobalDictionary.Exists("DenierName") Then
		GlobalDictionary.Remove("DenierName")
	End If
	GlobalDictionary.Add "DenierName", sUser
End Function

'**************************************************************************************************************
''' <summary> 
''' ChartField Addition Resubmit
''' </summary>
''' <author>Zach Apple</author>
''' <datecreated>31Oct2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************		
Function UpdateAndResubmitChartfieldRequest 'GL 5.02
	Dim sComment, oLink
	Const TRAN_DENIED = "Transaction Denied"

	'Sign out and sign in as the Original requester
	Call login(GlobalDictionary("SignInUser"))

	'Navigate to the Worklist page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection3")) Then
		WriteToReport micPass, "UpdateAndResubmitChartfieldRequest", "Worklist Page is Loaded Successfully", FALSE
	Else
		WriteToReport micFail, "UpdateAndResubmitChartfieldRequest", "Worklist Page is not Loaded Successfully", TRUE
		ExitTest
	End If

	'Select Transaction Denied filter
	Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist").WebList("Worklist Filters").Select TRAN_DENIED
	WriteToReport micDone, "Filtered By "&TRAN_DENIED, "Filtered Successfully", FALSE

	'Click the View All Link
	If Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist").Link("View All").Exist(5) Then
		Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist").Link("View All").Click
		WriteToReport micDone, "Clicked the View All Link", "View All Link Clicked Successfully", FALSE
	End If

	'Find the request from the user that denied the request with the Request ID from the original Request
	Set oLink = Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist").WebElement("Link")
	Call oLink.SetTOProperty("title", "from "&GlobalDictionary("DenierName"))
	Call oLink.SetTOProperty("innertext", ".*"&GlobalDictionary("ChartFieldRequestID")&".*")
	If oLink.Exist(5) Then
		oLink.Click
		WriteToReport micPass, "UpdateAndResubmitChartfieldRequest", "Link for Denial from User ("&GlobalDictionary("DenierName")&") and Request ID: ("&GlobalDictionary("ChartFieldRequestID")&") Successfuly Found and Clicked.", FALSE
	Else
		WriteToReport micFail, "UpdateAndResubmitChartfieldRequest", "Link for Denial from User ("&GlobalDictionary("DenierName")&") and Request ID: ("&GlobalDictionary("ChartFieldRequestID")&") Not Found", TRUE
		ExitTest
	End If 

	Browser("PeopleSoft Browser").Sync

	'Click the View Approval Flow link
	If Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").Link("View Approval Flow").Exist(30) Then
		Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").Link("View Approval Flow").Click
		WriteToReport micPass, "UpdateAndResubmitChartfieldRequest", "Successfully Clicked the View Approval Flow Link", FALSE
	Else
		WriteToReport micFail, "UpdateAndResubmitChartfieldRequest", "Could not locate the View Approval Flow Link", TRUE
		ExitTest
	End If

	'Expand the request
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("Approval Flow").Image("Expand").Click

	'The above object changes, the 'alt' property is now "Collapse". 
	'When the Comments appear, this same object can be used to click to Expand Comments
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("Approval Flow").Image("Expand").Click

	'Find the comment from the Denier and verify it is the same
	Call Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("Approval Flow").WebElement("Comment").SetTOProperty("xpath", "//b[contains(text(),'"&GlobalDictionary("DenierName")&"')]/..")
	sComment = Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("Approval Flow").WebElement("Comment").GetROProperty("innertext")
	If InStr(1,sComment, GlobalDictionary("DenierName"), vbTextCompare) >0 Then
		If InStr(1, sComment, GlobalDictionary("DenyComment"), vbTextCompare)>0 Then
			WriteToReport micPass, "UpdateAndResubmitChartfieldRequest", "Found the Denial Comment ["&GlobalDictionary("DenyComment")&"] from: "&GlobalDictionary("DenierName"), FALSE
		Else
			WriteToReport micFail, "UpdateAndResubmitChartfieldRequest", "Did not Find the Comment ["&GlobalDictionary("DenyComment")&"]", TRUE
			ExitTest
		End If
	Else
		WriteToReport micFail, "UpdateAndResubmitChartfieldRequest", "Did not Find the Comment From: "&GlobalDictionary("DenierName"), TRUE
		ExitTest
	End If

	'Click Return to close the Approval Flow popup
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("Approval Flow").WebButton("Return").Click

	'Change a Field to make an update
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebEdit("Short Description").Set GlobalDictionary("ShortDescUpdate")
	WriteToReport micDone, "Updated the Short Description to "&GlobalDictionary("ShortDescUpdate"), "Short Description Updated Successfully", FALSE

	'Hit the Save Button
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebElement("Save").Click
	WriteToReport micDone, "Clicked the Save Button", "Save Button Clicked Successfully", FALSE

	'Select the Request Action 'Submit for Approval'
	If Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebList("Request Action").Exist(15) Then
		Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebList("Request Action").Select GlobalDictionary("ReqAct1")
		WriteToReport micDone, "Selected from the Request Action Dropdown option " &GlobalDictionary("ReqAct1"), "Request Action Selected Successfully", FALSE
	Else
		WriteToReport micFail, "ChartFieldRequest", "Could not locate the 'Request Action' dropdown.", TRUE
	End If

	'Click Go
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebButton("Go").Click
	WriteToReport micDone, "Clicked the Go Button", "Go Button Clicked Successfully", FALSE

	Browser("PeopleSoft Browser").Sync
End Function

'**************************************************************************************************************
''' <summary> 
''' ChartField Addition Update as the GL Support User
''' </summary>
''' <author>Zach Apple</author>
''' <datecreated>31Oct2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'	18JAN19		Brian B.		Added timeouts to help with timing issues.
'**************************************************************************************************************	
Function UpdateChartFieldRequest 'GL 5.03
	Dim oLink
	Dim sUser, sUsernames, sUserIDs
	Dim nRow
	Dim arrSearchValues, arrTemp
	Const APPROVED = "Approved"
	Const NAME = 0
	Const ID = 1

	'Navigate to the ChartField request page
	If SelectMainMenu1(GlobalDictionary("RequestChartField")) = True Then
		WriteToReport micPass, "UpdateChartFieldRequest", "On the ChartField Request Page.", False
	Else
		WriteToReport micFail, "UpdateChartFieldRequest", "Navigation to ChartField Request Page failed. Exiting test.", True
		ExitTest
	End If

	'Check if the Account Starting point exists, else try to find one within 20 Numerical positions
	Call FindExistingAccount

	Browser("PeopleSoft Browser").Sync
	
	'Click the Find an Existing Value tab
	If Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebElement("FindAnExistingValue").Exist(10) Then
		WriteToReport micDone, "Objects Loaded on Page", "Objects finished loading on the page.", FALSE
	End If
	
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebElement("FindAnExistingValue").Click
	WriteToReport micDone, "Clicked the Find an Existing Value Tab", "Find an Existing Value Tab Clicked Successfully", FALSE

	'Click the Clear Button
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebButton("Clear").Click
	WriteToReport micDone, "Clicked the Clear Button", "Clear Button Clicked Successfully", FALSE

	'Enter the Search criteria
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebEdit("RequestIDBeginsWith").Set GlobalDictionary("BeginsWith")
	WriteToReport micDone, "Set the Request ID Begins With Field to "&GlobalDictionary("BeginsWith"), "Request ID Begins With Field Set Successfully", FALSE

	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebEdit("SetID_Search").Set GlobalDictionary("SetID")
	WriteToReport micDone, "Set the SetID Field to "&GlobalDictionary("SetID"), "SetID Field Set Successfully", FALSE

	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebEdit("Field Name_Search").Set GlobalDictionary("FieldName")
	WriteToReport micDone, "Set the Field Name Search Field to "&GlobalDictionary("FieldName"), "Field Name Search Field Set Successfully", FALSE

	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebEdit("Field Value_Search").Set GlobalDictionary("Account")
	WriteToReport micDone, "Set the Field Value Search Field to "&GlobalDictionary("Account"), "Field Value Search Field Set Successfully", FALSE

	'Click the Search Button
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebButton("Search").Click
	WriteToReport micDone, "Clicked the Search Button", "Search Button Clicked Successfully", FALSE

	'Find the row of an Approved Request for the given Account
	arrSearchValues = Array(APPROVED, GlobalDictionary("Account"))
	nRow = FindRowWithText(Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebTable("Requests"), arrSearchValues)

	'Click the Link found in the first column of the nRow
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebTable("Requests").ChildItem(nRow, 1, "Link", 0).Click
	WriteToReport micDone, "Clicked the Link for an Approved Request to Copy and Update Located on Row: "&nRow, "Found an Approved Request Successfully", FALSE

	'Click the Copy Button
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebButton("Copy").Click
	WriteToReport micDone, "Clicked the Copy Button", "Copy Button Clicked Successfully", FALSE

	'Select the Field Action item to Update
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("Request Copy").WebList("Field Action").Select GlobalDictionary("ReqAct3")
	WriteToReport micDone, "Selected from the Request Action Dropdown option " &GlobalDictionary("ReqAct3"), "Request Action Selected Successfully", FALSE

	'Set the Account into the Field Value
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("Request Copy").WebEdit("Field Value").Set GlobalDictionary("Account")
	WriteToReport micDone, "Set the RAccount to "&GlobalDictionary("Account"), "Account Set Successfully", FALSE

	'Click the OK button
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("Request Copy").WebButton("OK").Click
	WriteToReport micDone, "Clicked the OK Button", "OK Button Clicked Successfully", FALSE

	'Update the Short Desc field
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebEdit("Short Description").Set GlobalDictionary("ShortDescUpdate")
	WriteToReport micDone, "Updated the Short Description to "&GlobalDictionary("ShortDescUpdate"), "Short Description Updated Successfully", FALSE

	'Click the Save Button
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebElement("Save").Click
	WriteToReport micDone, "Clicked the Save Button", "Save Button Clicked Successfully", FALSE

	'Submit for Approval
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebList("Request Action").Select GlobalDictionary("ReqAct1")
	WriteToReport micDone, "Selected from the Request Action Dropdown option " &GlobalDictionary("ReqAct1"), "Request Action Selected Successfully", FALSE
	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebButton("Go").Click
	WriteToReport micDone, "Clicked the Go Button", "Go Button Clicked Successfully", FALSE

	Browser("PeopleSoft Browser").Sync

	'Verify that the Link 'View Approval Flow' now exists
	If Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").Link("View Approval Flow").Exist(10) Then
		WriteToReport micPass, "UpdateChartFieldRequest", "Successfully Submitted the Request", FALSE
	Else
		WriteToReport micFail, "UpdateChartFieldRequest", "View Approval Link not Found, Request Not Successfully Submitted", TRUE
		ExitTest
	End If

	Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").Link("View Approval Flow").Click
	WriteToReport micDone, "Clicked the View Approval Flow Link", "Clicked View Approval Link Successfully", FALSE

	With Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("Approval Flow")
		.Image("Expand").Click

		'Current user
		arrTemp = dbFetchUserFromId(GlobalDictionary("SignInUser"))
		sUsernames = arrTemp(NAME)

		'GL Supp user
		arrTemp = dbFetchUserId(Trim(.WebElement("GLSuppUser1").GetROProperty("innertext")))
		sUserIDs = arrTemp(ID)
		sUsernames = sUsernames & "," & .WebElement("GLSuppUser1").GetROProperty("innertext")
		WriteToReport micDone, "Found and Stored the GL Support User: " &.WebElement("GLSuppUser1").GetROProperty("innertext"), "GL Support User Stored Successfully", FALSE
		'Initial FinAcct user
		arrTemp = dbFetchUserId(Trim(.WebElement("InitFinAcctUser").GetROProperty("innertext")))
		sUserIDs = sUserIDs & "," & arrTemp(ID)
		sUsernames = sUsernames & "," & .WebElement("InitFinAcctUser").GetROProperty("innertext")
		WriteToReport micDone, "Found and Stored the Initial FinAcctg User: " &.WebElement("InitFinAcctUser").GetROProperty("innertext"), "Initial FinAcctg User Stored Successfully", FALSE
		'Hyperion Planner User
		arrTemp = dbFetchUserId(Trim(.WebElement("HyperionUser").GetROProperty("innertext")))
		sUserIDs = sUserIDs & "," & arrTemp(ID)
		sUsernames = sUsernames & "," & .WebElement("HyperionUser").GetROProperty("innertext")
		WriteToReport micDone, "Found and Stored the Hyperion Planner/ExtReporting User: " &.WebElement("HyperionUser").GetROProperty("innertext"), "Hyperion Planner/ExtReporting User Stored Successfully", FALSE
		'Final FinAcct user
		If NOT(InStr(1,.WebElement("FinalFinAcctUser").GetROProperty("innertext"),"No approvers found")>1) Then
			arrTemp = dbFetchUserId(Trim(.WebElement("FinalFinAcctUser").GetROProperty("innertext")))
			sUserIDs = sUserIDs & "," & arrTemp(ID)
			sUsernames = sUsernames & "," & .WebElement("FinalFinAcctUser").GetROProperty("innertext")
			WriteToReport micDone, "Found and Stored the Final FinAcctg User: " &.WebElement("FinalFinAcctUser").GetROProperty("innertext"), "Final FinAcctg User Stored Successfully", FALSE
		End If
		'GL Supp user
		arrTemp = dbFetchUserId(Trim(.WebElement("GLSuppUser2").GetROProperty("innertext")))
		sUserIDs = sUserIDs & "," & arrTemp(ID)
		sUsernames = sUsernames & "," & .WebElement("GLSuppUser2").GetROProperty("innertext")
		WriteToReport micDone, "Found and Stored the GL Support User: " &.WebElement("GLSuppUser2").GetROProperty("innertext"), "GL Support User Stored Successfully", FALSE

		'Store the strings for later in the test
		If GlobalDictionary.Exists("FromNames") Then
			GlobalDictionary.Remove("FromNames")
		End If

		GlobalDictionary.Add "FromNames", sUsernames
		If GlobalDictionary.Exists("Approvers") Then
			GlobalDictionary.Remove("Approvers")
		End If

		GlobalDictionary.Add "Approvers", sUserIDs
	End With

	'Grab the Request ID for later in the test
	If GlobalDictionary.Exists("ChartFieldRequestID") Then
		GlobalDictionary.Remove("ChartFieldRequestID")
	End If

	GlobalDictionary.Add "ChartFieldRequestID", Browser("PeopleSoft Browser").Page("ChartField Request").PSFrame("ChartField Request").WebElement("ChartFieldRequestID").GetROProperty("innertext")
	WriteToReport micDone, "UpdateChartFieldRequest", "The Request ID is: ["&GlobalDictionary("ChartFieldRequestID")&"]", FALSE
End Function

'**************************************************************************************************************
''' <summary> 
''' Verify Online Ledger Search
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>07Nov2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'	02JAN19		Brian B.		Added code to handle when the current month is January.
'**************************************************************************************************************	
Function OnlineLedgerInquiry
	'GL 6.08
	Dim aJournals, aTransactionsReturned, i
	Dim sBaseAmount, sBaseTotal, sLabeledBaseTotal, sLabelTransActionCurrency , sJournals, sPeriod, sTodayDate, sTransactionsReturned, sTransAmount, sTransTotal, sYY

	'Get Year
	sYY = Year(Date)
	sTodayDate = Date
	sPeriod = Month(sTodayDate)

	'go back one month from current to ensure data
	sPeriod = sPeriod - 1

	' Handles January.
	If sPeriod = 0 Then
		sYY = sYY - 1
		sPeriod = 12
	End If

	'Clear out Totals
	sBaseTotal = 0
	sTransTotal = 0

	'Navigate to the ChartField request page
	If SelectMainMenu1(GlobalDictionary("LedgerInquiry")) = True Then
		WriteToReport micPass, "OnlineLedgerInquiry", "On the Ledger Page.", False
	Else
		WriteToReport micFail, "OnlineLedgerInquiry", "Navigation to Ledger Page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Ledger").Frame("TargetContent")

		If .WebEdit("Inquiry").Exist(20) Then	
			.WebEdit("Inquiry").Set GlobalDictionary("Inquiry")
			.WebButton("Search").Click
		Else
			WriteToReport micFail, "OnlineLedgerInquiry", "Navigation to Ledger Page failed. Exiting test.", True
			ExitTest			
		End If

		If NOT .WebEdit("Business_Unit").Exist(10) Then
			.Link("Add a New Value").Click
			.WebEdit("Inquiry").Set GlobalDictionary("Inquiry")
			.WebButton("Add").Click
		End If

		If NOT .WebEdit("Business_Unit").Exist(10) Then
			WriteToReport micFail, "OnlineLedgerInquiry", "Navigation to Ledger Page failed. Exiting test.", True
			ExitTest	
		End If

		.WebEdit("Business_Unit").Set GlobalDictionary("BusinessUnit")
		.WebEdit("Ledger").Set GlobalDictionary("Ledger")
		.WebEdit("Fiscal_Year").Set sYY
		.WebEdit("Period_From").Set sPeriod
		.WebEdit("Period_To").Set sPeriod
		.WebEdit("Account").Set GlobalDictionary("Account")
		.WebEdit("Dept").Set GlobalDictionary("Dept")
		.WebButton("Search").Click	

		If .WebList("TransactionsReturned").Exist(60) Then
			sTransactionsReturned = Browser("PeopleSoft Browser").Page("Ledger").Frame("TargetContent").WebList("TransactionsReturned").GetROProperty("Value")
			aTransactionsReturned = Split(sTransactionsReturned ," of ")
			WriteToReport micPass, "OnlineLedgerInquiry", "[" &aTransactionsReturned(1) & "] transactions were returned.", False					
		Else
			WriteToReport micFail, "OnlineLedgerInquiry", "No Results Returned.  Verify Data.", True
			ExitTest			
		End If

		'Pull out number of Journals to go thru
		sJournals = .WebList("JournalsReturned").GetROProperty("Value")
		aJournals = Split(sJournals," of ")
		WriteToReport micPass, "OnlineLedgerInquiry", "[" &aJournals(1) & "] Journals are displayed.", False

		'Get TotalBase amount in Tables
		For i = 0 to aJournals(1) - 1

			'Set html id property so it reads the correct row		
			.WebElement("BaseAmount").SetTOProperty "html id", "MONETARY_AMOUNT$" & i
			sBaseAmount = .WebElement("BaseAmount").GetROProperty("innertext")
			sBaseTotal = sBaseTotal + SBaseAmount
			sBaseAmount = 0

			'Set html id property so it reads the correct row
			.WebElement("ForeignAmount").SetToProperty "html id", "FOREIGN_AMOUNT$" & i
			sTransAmount = .WebElement("ForeignAmount").GetROProperty("innertext")
			sTransTotal = sTransTotal + sTransAmount
			sTransAmount = 0
		Next

		'Get Base Total and compare to sBaseTotal from Journals
		sLabeledBaseTotal = .WebElement("BaseTotalAmount").GetROProperty("innertext")
		If CDbl(sLabeledBaseTotal) = CDBL(FormatNumber(sBaseTotal,2)) Then
			WriteToReport micPass, "OnlineLedgerInquiry", "[" & CDBL(FormatNumber(sBaseTotal,2)) & "] matches total from Journals displayed for Amount (in Base Currency) ", False	
		Else
			WriteToReport micFail, "OnlineLedgerInquiry", "[" & CDBL(FormatNumber(sBaseTotal,2)) & "] is total from Journals displayed and does not match Amount (in Base Currency) totals given of ["&sLabeledBaseTotal &"]", False			
		End If

		'Get totals from Journal and compare to total amount displayed for Transaction Currency
		sLabelTransActionCurrency = .WebElement("TransactionTotalAmount").GetROProperty("innertext")
		If CDbl(sLabelTransActionCurrency) = CDbl(FormatNumber(sTransTotal,2)) Then
			WriteToReport micPass, "OnlineLedgerInquiry", "[" & CDbl(FormatNumber(sTransTotal,2))  & "] matches total from Journals displayed and what is displayed for Amount (in Transaction Currency)", False	
		Else
			WriteToReport micFail, "OnlineLedgerInquiry", "[" & CDbl(FormatNumber(sTransTotal,2)) & "] is total from Journals displayed and does not match Amount (in Transaction Currency) totals given of ["&sLabelTransActionCurrency&"]", False			
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Test driver for the 1.22 GL test case
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>November 4, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter: FunctionName - the name of the function calling this so we can have accurate reporter statements
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CanadianFixedAssetJournal

	'Create our journal using the data in the spreadsheet(line 4586)
	SharedCreateAddJournal "CanadianFixedAssetJournal", False

	'Verify our corporate values and currency
	SharedVerifyCORPORATELEDGER "CanadianFixedAssetJournal", False

	'Submit journal for approval
	SharedSubmitForApproval "CanadianFixedAssetJournal", False

	'Log back in as our manager to approve the journal again
	SharedApprovejournal "CanadianFixedAssetJournal", False

	'Post our journal now that it is approved
	SharedProcessJournal "CanadianFixedAssetJournal", False

	'Switch our user from CDW_Batch(logged in during SharedProcessJournal and back to our signinuser
	Login(GlobalDictionary("SignInUser"))

	'Search for our created journal
	SharedCreateEditUpdateJournalStart "CanadianFixedAssetJournal", False
End Function

'**************************************************************************************************************
''' <summary> 
''' Test driver for the 1.23 GL test case
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>June 21, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter: FunctionName - the name of the function calling this so we can have accurate reporter statements
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CanadianAffiliateJournal

	'Create our journal using the data in the spreadsheet(line 4586)
	SharedCreateAddJournal "CanadianFixedAssetJournal", False

	'Verify our corporate values and currency
	SharedVerifyCORPORATELEDGER "CanadianFixedAssetJournal", False

	'Submit journal for approval
	SharedSubmitForApproval "CanadianFixedAssetJournal", False

	'Log back in as our manager to approve the journal again
	SharedApprovejournal "CanadianAffiliateJournal", False
	GlobalDictionary("Process") = "GL_JP"

	'Post our journal now that it is approved
	SharedProcessJournal "CanadianAffiliateJournal", False

	'Switch our user from CDW_Batch(logged in during SharedProcessJournal and back to our signinuser
	Login(GlobalDictionary("SignInUser"))

	'Search for our created journal
	SharedCreateEditUpdateJournalStart "CanadianAffiliateJournal", False
End Function

'**************************************************************************************************************
''' <summary> 
''' Test driver for the 1.25 GL test case
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>June 21, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter: FunctionName - the name of the function calling this so we can have accurate reporter statements
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function AddOnlineJournal
	Dim strCredits, strDebits

	'Create our journal using the data in the spreadsheet
	SharedCreateAddJournal "AddOnlineJournal", False

	With Browser("PeopleSoft Browser").Page("Create/Update Journal")
		.PSframe("TargetContent").Link("Projected Balance").Click
		.Sync

		'Check for our new frame
		If .PSFrame("ProjectedBalance").WebElement("Debit Amount").Exist(20) Then
			WriteToReport micPass, "AddOnlineJournal - Totals Frame", "New frame loaded using Projected Balance link", False
		Else
			WriteToReport micFail, "AddOnlineJournal - Totals Frame", "New frame did not load using Projected Balance link. Exiting test.", True
			ExitTest
		End If

		'Grab our posted debits value
		strDebits = .PSFrame("ProjectedBalance").WebElement("Debit Amount").GetROProperty("Innertext")
		.PSFrame("ProjectedBalance").WebButton("Return").Click
		.Sync

		.PSframe("TargetContent").Link("Projected Balance 2").Click
		.Sync

		'Grab our posted credits value
		strCredits = .PSFrame("ProjectedBalance").WebElement("Credit Amount").GetROProperty("Innertext")

		'Compare our debits and credits
		If CDbl(strCredits) + CDbl(strDebits) = 0 Then
			WriteToReport micPass, "AddOnlineJournal - Amount Validation", "Debits and credits cancel out!", False
		Else
			WriteToReport micFail, "AddOnlineJournal - Amount Validation", "Debits: " & strDebits & " and credits: " & strCredits & " do not cancel out.", True
			ExitTest
		End If

		'Close our frame
		.PSFrame("ProjectedBalance").WebButton("Return").Click
		.Sync
	End With

	'Submit journal for approval
	SharedSubmitForApproval "AddOnlineJournal", False

	'Log back in as our manager to approve the journal again
	SharedApprovejournal "AddOnlineJournal", False
	GlobalDictionary("Process") = "GL_JP"

	'Post our journal now that it is approved
	SharedProcessJournal "AddOnlineJournal", False

	'Switch our user from CDW_Batch(logged in during SharedProcessJournal and back to our signinuser
	Login(GlobalDictionary("SignInUser"))

	'Search for our created journal
	SharedCreateEditUpdateJournalStart "AddOnlineJournal", False
End Function

'**************************************************************************************************************
''' <summary> 
''' Test driver for the 6.02 GL test case
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>June 21, 2018</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter: FunctionName - the name of the function calling this so we can have accurate reporter statements
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function RunGLTransactionReports
	Dim i
	Dim arrInstance, arrTemp
	Dim sRunID
	Dim strProcess

	'Navigate to the General Ledger > CDW GL Reports > GL Transaction Report page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection1")) = True Then
		WriteToReport micPass, "RunGLTransactionReports - GL Transaction Report Page", "On the GL Transaction Report page.", False
	Else
		WriteToReport micFail, "RunGLTransactionReports - GL Transaction Report Page", "Navigation to GL Transaction Report page failed. Exiting test.", True
		ExitTest
	End If

	'Enter our process information
	With Browser("PeopleSoft Browser").Page("GL Transaction Report").PSFrame("TargetContent")
		.WebTabStrip("WebTabStrip").Select "Add a New Value"

		'Enter our run control ID
	    sRunID = "Auto" & CLng(Timer)
	    WriteToReport micDone, "RunGLTransactionReports - Run control ID", sRunID, False
		.WebEdit("Control ID").Set sRunID
		.WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Set our flags to ALL
		.WebCheckBox("AllUnits").Set "ON"
		.WebCheckBox("AllDepts").Set "ON"
		WriteToReport micDone, "RunGLTransactionReports - Run units", "All units and all departments selected", False
		
		'Enter the fiscal year and period(s) we will be running
		.WebEdit("FiscalYear").Set GlobalDictionary("Year")
		.WebEdit("PeriodFrom").Set GlobalDictionary("FromPeriod")
		.WebEdit("PeriodTo").Set GlobalDictionary("ToPeriod")
		WriteToReport micDone, "RunGLTransactionReports - Time", "From period - " & GlobalDictionary("FromPeriod") & ", To period - " & GlobalDictionary("ToPeriod") & ", Year - " & GlobalDictionary("Year"), False

		'Enter our accounts. This is necessary for the job to finish
		.WebEdit("FromAccount").Set GlobalDictionary("FromAccount")
		.WebEdit("ToAccount").Set GlobalDictionary("ToAccount")
		WriteToReport micDone, "RunGLTransactionReports - Accounts", "From account - " & GlobalDictionary("FromAccount") & ", To Account - " & GlobalDictionary("ToAccount"), False

		'Click run to start the batch job
		.WebButton("Run").Click
	End With

	With Browser("PeopleSoft Browser").Page("GL Transaction Report")
		.Sync
		.PSFrame("Process Scheduler Request").WebCheckBox("Process 1").Set "ON"
		.PSFrame("Process Scheduler Request").WebCheckBox("Process 2").Set "ON"
		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		.Sync

		strProcess = .PSFrame("Status Bar").WebElement("Instance Number").GetROProperty("Innertext")
		arrTemp = Split(strProcess, ":")
	End With

	'Capture our instance number, splitting out the input string if we have more than one report to run
	If InStr(1, arrTemp(1), ",", vbTextcompare) >= 1 Then
		arrInstance = Split(arrTemp(1), ",")
	Else
		arrInstance = Array(arrTemp(1))
	End If

	For i = 0 To UBound(arrInstance)

		'Click on the process monitor link
		If Browser("PeopleSoft Browser").Page("GL Transaction Report").PSFrame("Status Bar").Link("Process Monitor").Exist(5) Then
			Browser("PeopleSoft Browser").Page("GL Transaction Report").PSFrame("Status Bar").Link("Process Monitor").Click
		Else
			Browser("PeopleSoft Browser").Page("GL Transaction Report").PSFrame("name:=TargetContent").Link("html id:=PRCSRQSTDLG_WRK_LOADPRCSMONITORPB").Click
		End If

		GlobalDictionary("InstanceNumber") = arrInstance(i)
		WriteToReport micDone, "RunGLTransactionReports - Instance Number", GlobalDictionary("InstanceNumber"), False

		'Monitor the process
		SharedProcessMonitor "RunGLTransactionReports"

		'If still here(job successfully ran), bring up the results window
		With Browser("PeopleSoft Browser").Page("Process Monitor")
			.PSFrame("Process Monitor").Link("Details").Click
			.Sync
			.PSFrame("Process Detail").Link("View Log/Trace").Click
			.Sync

			'Get the name of the file created
			'sFileName = .PSFrame("View Log/Trace").Link("Report Name").GetROProperty("Text")	'EG, "CDWAP004_11276758.csv"
			.PSFrame("View Log/Trace").Link("Report Name").Click
			ReadAndVerifyPDFFile("Account: " & CStr(GlobalDictionary("FromAccount")))
		End With

		'Navigation and window cleanup if needed
		With Browser("Peoplesoft Browser").Page("Process Requests")
			If .PSFrame("View Log/Trace").WebButton("Return").Exist(5) Then
				.PSFrame("View Log/Trace").WebButton("Return").Click
				.Sync
				.PSFrame("Process Detail").WebButton("OK").Click
				.Sync
			End If
		End With

		'Return to the GL page
		Browser("PeopleSoft Browser").Page("GL Transaction Report").PSFrame("Process Monitor").Link("Go Back").Click
		Browser("PeopleSoft Browser").Sync
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Makes sure screen is setup
''' </summary>
''' <author>Zach Apple</author>
''' <datecreated></datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Change Control: 
'Date of Change 	Author 			Description of change
'14May2019			Eric Trout		Updated due to errors for My Preferences
'______________________________________________________ 
'**************************************************************************************************************
Function FixUserScreenView
	Const SCREEN_READER_OFF = "Screen reader mode off"
	Call login(GlobalDictionary("CheckUserScreen"))
	Browser("PeopleSoft Browser").Page("PSFGeneric").WebButton("Action List Button").Click
	'Setting.WebPackage("ReplayType") = 2 '2-Runs mouse operations using the mouse
	If Browser("PeopleSoft Browser").Page("PSFGeneric").WebElement("My Preferences").Exist(10) Then
		wait 2
		Browser("PeopleSoft Browser").Page("PSFGeneric").WebElement("My Preferences").highlight
		Browser("PeopleSoft Browser").Page("PSFGeneric").Link("My Preferences").Click
		Browser("PeopleSoft Browser").Sync
'		Wait 2' Page loads but objects inside aren't finished.
	Else
		WriteToReport micFail, "FixUserScreenView", "My Preferences Failed to appear, Check objects and code. Exiting test.", True
		ExitTest
	End If
	If Browser("PeopleSoft Browser").Page("My Preferences").WebList("Accessibility Layout").Exist(10) Then
		WriteToReport micDone, "Screen Reader Objects Loaded", "Objects completely loaded on the page.", FALSE
	Else	
		WriteToReport micFail, "FixUserScreenView", "My Preferences Failed to appear, Check objects and code. Exiting test.", True
		ExitTest
	End If
	
	If Browser("PeopleSoft Browser").Page("My Preferences").WebList("Accessibility Layout").GetROProperty("Selection") <> SCREEN_READER_OFF Then
		Browser("PeopleSoft Browser").Page("My Preferences").WebList("Accessibility Layout").Select SCREEN_READER_OFF
		Browser("PeopleSoft Browser").Page("My Preferences").WebButton("Save").Click
		Browser("PeopleSoft Browser").Page("My Preferences").WebButton("OK").Exist(10) ' Takes time to show up.
		Browser("PeopleSoft Browser").Page("My Preferences").WebButton("OK").Click
	End If
	Setting.WebPackage("ReplayType") = 1 '1 returns to default
	WriteToReport micDone, "Screen Reader View if Off for User: "&GlobalDictionary("CheckUserScreen"), "Screen View is Off", FALSE
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the Transaction Posting Summary process and validate the results in the PDF file. GL 6.03
''' </summary>
''' <author>Stephen King</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control:
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function TransactionPostingSummary
	Dim arrTemp
	Dim sRunID
	Dim strInstance, strProcess

	'Navigate to the General Ledger > CDW GL Reports > Transaction Posting Summary page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection1")) = True Then
		WriteToReport micPass, "TransactionPostingSummary - Transaction Posting Summary Page", "On the Transaction Posting Summary page.", False
	Else
		WriteToReport micFail, "TransactionPostingSummary - Transaction Posting Summary Page", "Navigation to Transaction Posting Summary page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Transaction Posting Summary").PSFrame("TargetContent")
		Browser("PeopleSoft Browser").Sync

		'click to create a new value for our custom run
		.WebTabStrip("WebTabStrip").Select "Add a New Value"
		Browser("PeopleSoft Browser").Sync

		'Enter our run control ID
	    sRunID = "GLTPS_" & CLng(Timer)
	    WriteToReport micDone, "Run control ID", sRunID, False
		.WebEdit("Run ID").Set sRunID
		.WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Set our flags to ALL
		.WebCheckBox("All Business Units").Set "ON"
		.WebCheckBox("All Source").Set "ON"

		'select the ledger(CORPORATE by default)
		.WebButton("Ledger Prompt").Click
		If GlobalDictionary("Ledger") = "" Then
			Browser("PeopleSoft Browser").Page("Transaction Posting Summary").PSFrame("Look Up Ledger").Link("CORPORATE").Click
		Else
			Browser("PeopleSoft Browser").Page("Transaction Posting Summary").PSFrame("Look Up Ledger").Link("Text:=" & GlobalDictionary("Ledger")).Click
		End If

		'Enter the fiscal year and period(s) we will be running
		.WebEdit("Fiscal Year").Set "2018"
		.WebList("Date Criteria").Select "Jrnl Dt"	'.Select ""	'.Select "Period"
		.WebEdit("From Date").Set "01/01/2018"
		.WebEdit("Thru Date").Set "01/31/2018"

		'Enter our Account Range
		.WebCheckBox("Account Range").Set "ON"
		.WebEdit("From Value").Set GlobalDictionary("FromAccount")	'EG, "20000"
		.WebEdit("To Value").Set GlobalDictionary("ToAccount")	'EG, "20000"

		'Save our information
		.WebButton("Save").Click

		'Click run to start the batch job
		.WebButton("Run").Click
	End With

	With Browser("PeopleSoft Browser").Page("Transaction Posting Summary")
		.Sync

		'Store our process name
		GlobalDictionary("Process") =  .PSFrame("Process Scheduler Request").WebElement("html id:=PRCSRQSTDLGLIST_PRCSNAME\$0").GetROProperty("InnerText")
		WriteToReport micDone, "TransactionPostingSummary - Process Name", "The process name is " & GlobalDictionary("Process"), False
		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		.Sync

		'Store our instance number
		strProcess = .PSFrame("Status Bar").WebElement("Process Instance").GetROProperty("Innertext")
		arrTemp = Split(strProcess, ":")
		GlobalDictionary("InstanceNumber") = arrTemp(1)
		WriteToReport micDone, "TransactionPostingSummary - Instance Number", "The instance number is " & GlobalDictionary("InstanceNumber"), False

		'Head over to the Process Monitor page
		.PSFrame("Status Bar").Link("Process Monitor").Click
		.Sync
	End With

	'Run our report process
	SharedProcessMonitor "TransactionPostingSummary"

	With Browser("PeopleSoft Browser").Page("Transaction Posting Summary")
		.PSFrame("Process Monitor").Link("Details").Click
		.Sync
		.PSFrame("Process Detail").Link("View Log/Trace").Click
		.Sync
		.PSFrame("View Log/Trace").Link("First Link").Click
		.Sync
	End With

	'Validate the PDF file - we don't need to check totals, just that it's our data
'	Bus. Unit: ALL
'	Ledger: CORPORATE -- Actuals stated in USD
'	For Fiscal Year 2018 Period 1 to 12
'	Account: 20000 to 20000 Currency Code: USD
'	Source: ALL
	ReadAndVerifyPDFFile("Account: " & CStr(GlobalDictionary("FromAccount")) & " to " & CStr(GlobalDictionary("ToAccount")))
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the CDWGLR01 process and validate the results in the open PDF file in a new tab. GL 6.05
''' </summary>
''' <author>Stephen King</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control:
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function GLReportsID
	Dim arrTemp
	Dim sRunID
	Dim strInstance, strProcess, strTemp

	'Navigate to the General Ledger > CDW GL Reports > Transaction Posting Summary page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection1")) = True Then
		WriteToReport micPass, "GLReportsID - ID Receipts Page", "On the ID Receipts page.", False
	Else
		WriteToReport micFail, "GLReportsID - ID Receipts Page", "Navigation to ID Receipts page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("CDW GL report to ID receipts").PSFrame("TargetContent")
		.WebTabStrip("WebTabStrip").Select "Add a New Value"
		Browser("PeopleSoft Browser").Sync

		'Enter our run control ID
	    sRunID = "GLTPS_" & CLng(Timer)
	    WriteToReport micDone, "Run control ID", sRunID, False
		.WebEdit("RunID").Set sRunID
		.WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'set our business unit
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")

		'Enter our search dates, if any
		strTemp = Month(Date)
		If Len(StrTemp) < 2 Then
			strTemp = "0" & strTemp
		End If

		If GlobalDictionary("FromDate") <> "" Then
			.WebEdit("FromDate").Set GlobalDictionary("FromDate")
		Else
			.WebEdit("FromDate").Set strTemp & "/01/2018"
		End If

		If GlobalDictionary("ToDate") <> "" Then
			.WebEdit("ToDate").Set GlobalDictionary("ToDate")
		Else
			.WebEdit("ToDate").Set Date	'"01/31/2018"
		End If

		'Enter our account
		.WebEdit("Account").Set GlobalDictionary("Account")

		'Click save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Click run
		.WebButton("Run").Click
		Browser("PeopleSoft Browser").Sync
	End With

	With Browser("PeopleSoft Browser").Page("CDW GL report to ID receipts")
		.Sync

		'Store our process name
		GlobalDictionary("Process") = .PSFrame("Process Scheduler Request").WebElement("ProcessName").GetROProperty("InnerText")
		WriteToReport micDone, "GLReportsID - Process Name", "The process name is " & GlobalDictionary("Process"), False
		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		.Sync

		'Store our instance number
		strProcess = .PSFrame("Status Bar").WebElement("InstanceNumber").GetROProperty("Innertext")
		arrTemp = Split(strProcess, ":")
		GlobalDictionary("InstanceNumber") = arrTemp(1)
		WriteToReport micDone, "GLReportsID - Instance Number", "The instance number is " & GlobalDictionary("InstanceNumber"), False

		'Head over to the Process Monitor page
		.PSFrame("Status Bar").Link("Process Monitor").Click
		.Sync

		'Run our process - takes a while. 20 minutes or so.
		SharedProcessMonitor "GLReportsID"

		.PSFrame("Process Monitor").Link("Details").Click
		Browser("PeopleSoft Browser").Sync
		.PSFrame("Process Detail").Link("View Log/Trace").Click
		Browser("PeopleSoft Browser").Sync
		.PSFrame("View Log/Trace").Link("FirstLink").Click
		Browser("PeopleSoft Browser").Sync
	End With

	ReadAndVerifyPDFFile("Account: " & CStr(GlobalDictionary("Account")))
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the Mass Open Period Updates process to open periods in bulk. GL 9.05
''' </summary>
''' <author>Stephen King</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control:
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function OpenPeriodUpdates
	Dim strTemp
	Dim i
	Dim arrDates(1, 1)

	'Set our dates, from the sheet and from the current date
	arrDates(0, 0) = GlobalDictionary("ToYear")
	arrDates(0, 1) = GlobalDictionary("ToPeriod")
	arrDates(1, 0) = CStr(Year(Date))
	arrDates(1, 1) = CStr(Month(Date))

	'Navigate to the open periods mass update page - Set Up Financials/Supply Chain> Business Unit Related> General Ledger> Open Periods> Open Periods Mass Update
	If SelectMainMenu1(GlobalDictionary("MassUpdate")) = True Then
		WriteToReport micPass, "OpenPeriodUpdates - Open Period Mass Updates Page", "On the Open Period Mass Updates page.", False
	Else
		WriteToReport micFail, "OpenPeriodUpdates - Open Period Mass Updates Page", "Navigation to Open Period Mass Updates page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Open Periods Mass Update").PSFrame("Open/Close Periods")
		Browser("PeopleSoft Browser").Sync
		.WebEdit("Product").Set GlobalDictionary("Product")	'"GL"
		.WebEdit("CalendarID").Set GlobalDictionary("Calendar")	'"01"
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")	'"00000"
		.WebEdit("LedgerGroup").Set GlobalDictionary("LedgerGroup")	'"RECORDING"
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Highlight all of the results if more than one
		If .Link("Select All").Exist(10) Then
			.Link("Select All").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Loop through this twice so that we revert to the original dates
		For i = 0 To UBound(arrDates, 1)
			.WebEdit("ToYear").Set arrDates(i, 0)	'GlobalDictionary("ToYear")	'"2018"
			.WebEdit("ToPeriod").Set arrDates(i, 1)	'GlobalDictionary("ToPeriod")	'"11"
			.WebButton("Apply").Click
			Browser("PeopleSoft Browser").Sync

			'Check ToYear and ToPeriod and confirm that they match. Depending on test we should compare it to the data we input, as they might already be updated
			strTemp = Trim(.WebElement("OpenYear").GetROProperty("Innertext"))
			If strTemp = arrDates(i, 0) Then
				If i = 0 Then
					WriteToReport micPass, "OpenPeriodUpdates - Year - All", "Open period Year was updated!", False
				Else
					WriteToReport micPass, "OpenPeriodUpdates - Year - All", "Open period Year was reverted!", False
				End If
			Else
				WriteToReport micFail, "OpenPeriodUpdates - Year - All", "Open period Year was not updated. Exiting test.", True
				ExitTest
			End If

			strTemp = Trim(.WebElement("OpenPeriod").GetROProperty("Innertext"))
			If strTemp = arrDates(i, 1) Then
				If i = 0 Then
					WriteToReport micPass, "OpenPeriodUpdates - Period - All", "Open period was updated!", False
				Else
					WriteToReport micPass, "OpenPeriodUpdates - Period - All", "Open period was reverted!", False
				End If
			Else
				WriteToReport micFail, "OpenPeriodUpdates - Period - All", "Open period was not updated. Exiting test.", True
				ExitTest
			End If
		Next

		'If still here(so the fields updated correctly), then save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Open up individual updates - Set Up Financials/Supply Chain> Business Unit Related> General Ledger> Open Periods> Open Period Update
	If SelectMainMenu1(GlobalDictionary("PeriodUpdate")) = True Then
		WriteToReport micPass, "OpenPeriodUpdates - Open Period Update Page", "On the Open Period Update page.", False
	Else
		WriteToReport micFail, "OpenPeriodUpdates - Open Period Update Page", "Navigation to Open Period Update page failed. Exiting test.", True
		ExitTest
	End If

	'Enter our criteria
	With Browser("PeopleSoft Browser").Page("Open Period Update").PSFrame("TargetContent")
		Browser("PeopleSoft Browser").Sync
		.WebEdit("Product").Set GlobalDictionary("Product")	'"GL"
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")	'"00000"
		.WebEdit("LedgerGroup").Set GlobalDictionary("LedgerGroup")	'"RECORDING"
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'If we don't go to the next page instantly, then click the first result
		If .Link("html id:=SEARCH_RESULT1").Exist(10) Then
			.Link("html id:=SEARCH_RESULT1").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Check that we are on the right page
		If .WebEdit("ToYear").Exist(5) Then
			WriteToReport micPass, "OpenPeriodUpdates - Search Results Page", "Confirmed that we are on the search results page.", True
		Else
			WriteToReport micFail, "OpenPeriodUpdates - Search Results Page", "Unable to confirm that we are on the correct page. Exiting test.", True
			ExitTest
		End If

		For i = 0 To UBound(arrDates, 1)
			.WebEdit("ToYear").Set arrDates(i, 0)	'GlobalDictionary("ToYear")	'"12"
			Browser("PeopleSoft Browser").Sync
			.WebEdit("ToPeriod").Set arrDates(i, 1)	'GlobalDictionary("ToPeriod")	'"12"
			Browser("PeopleSoft Browser").Sync

			strTemp = Trim(.WebEdit("ToYear").GetROProperty("Default Value"))
			If strTemp = arrDates(i, 0) Then
				If i = 0 Then
					WriteToReport micPass, "OpenPeriodUpdates - Year - Single", "Open period Year was updated!", False
				Else
					WriteToReport micPass, "OpenPeriodUpdates - Year - Single", "Open period Year was reverted!", False
				End If
			Else
				WriteToReport micFail, "OpenPeriodUpdates - Year - Single", "Open period Year was not updated. Exiting test.", True
				ExitTest
			End If

			strTemp = Trim(.WebEdit("ToPeriod").GetROProperty("Default Value"))
			If strTemp = arrDates(i, 1) Then
				If i = 0 Then
					WriteToReport micPass, "OpenPeriodUpdates - Period - Single", "Open period was updated!", False
				Else
					WriteToReport micPass, "OpenPeriodUpdates - Period - Single", "Open period was reverted!", False
				End If
			Else
				WriteToReport micFail, "OpenPeriodUpdates - Period - Single", "Open period was not updated. Exiting test.", True
				ExitTest
			End If
		Next

		'Click Save
		.WebButton("Save").Click
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Finds a Recent Suspended Journal and Corrects it
''' </summary>
''' <author>Zach Apple</author>
''' <datecreated>09Nov2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************	
Function CorrectSuspensedJournal
	Dim nRow, i
	Dim sJournalID, sDate, sSource, sAccount, sDept, sJournalStatus, sLedgerGroup, sContent
	Const ACCOUNT_FIELDVALUE = 10001
	Const ACCOUNT_CHANGETO = 10002
	Const ACCOUNT_SELECTED = "ON"
	Const ACCOUNT_COL = 3
	Const DEPT_COL = 4
	Const EDIT_JOURNAL = "Edit Journal"
	'Navigate to the Correct Suspense Entries page
	If SelectMainMenu1(GlobalDictionary("CorrectSuspenseEntries")) = True Then
		WriteToReport micPass, "CorrectSuspensedJournal", "On the Correct Suspense Entries Page.", False
	Else
		WriteToReport micFail, "CorrectSuspensedJournal", "Navigation to Correct Suspense Entries Page failed. Exiting test.", True
		ExitTest
	End If

	'Click the clear button
	Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").WebButton("Clear").Click
	WriteToReport micDone, "Clicked the Clear Button", "Successfully Clicked the Clear Button", FALSE

	'Enter the BusinessUnit
	Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").WebEdit("Business Unit").Set GlobalDictionary("BusinessUnit")
	WriteToReport micDone, "Set the Business Unit to "& GlobalDictionary("BusinessUnit"), "Successfully Set the BusinessUnit", FALSE

	'Click Search
	Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").WebButton("Search").Click
	WriteToReport micDone, "Clicked the Search Button", "Successfully Clicked the Search Button", FALSE

	'Click the Journal Date header twice to sort by Descending
	Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").WebElement("Journal Date Col").Click
	Wait 2
	Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").WebElement("Journal Date Col").Click
	'Verify
	If Instr(1,Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").WebElement("Journal Date Col").GetROProperty("title"), "Click to sort ascending") > 0 Then
		WriteToReport micPass, "Sorted by Journal Date in Descending Order", "Successfully Sorted by Journal Date", FALSE
	Else
		WriteToReport micFail, "Did Not Sort by Journal Date in Descending Order", "Failed to Sort by Journal Date", TRUE
		ExitTest
	End If

	'Click the first entry of the table
	Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").WebTable("Results").ChildItem(2, 2, "Link", 0).Click
	WriteToReport micDone, "Clicked the First Journal in the Search Results Table", "Successfully clicked the first Journal in the Results", FALSE

	'Make sure there are Errors on the Journal that was opened
	sContent = Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").WebTable("ErrorsTable").ChildItem(1,1,"WebElement",0).GetROProperty("innertext")
	Do Until sContent <> ""
		Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").WebButton("Next in List").Click
	Loop

	'Grab the JournalID, Date, and Source
	sJournalID = Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").WebElement("JournalID").GetROProperty("innertext")
	WriteToReport micDone, "The Journal ID is: "&sJournalID, "Successfully Stored the Journal ID", FALSE
	If GlobalDictionary.Exists("JournalID") Then
		GlobalDictionary.Remove("JournalID")
	End If
	GlobalDictionary.Add "JournalID", sJournalID

	sDate = Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").WebElement("Date").GetROProperty("innertext")
	WriteToReport micDone, "The Journal Date is: "&sDate, "Successfully Stored the Journal Date", FALSE
	If GlobalDictionary.Exists("JournalDate") Then
		GlobalDictionary.Remove("JournalDate")
	End If
	GlobalDictionary.Add "JournalDate", sDate

	sSource = Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").WebElement("Source").GetROProperty("innertext")
	WriteToReport micDone, "The Journal Source is: "&sSource, "Successfully Stored the Journal Source", FALSE
	If GlobalDictionary.Exists("Source") Then
		GlobalDictionary.Remove("Source")
	End If
	GlobalDictionary.Add "Source", sSource

	'Change the Date to today
	Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").WebEdit("Date").Set date()
	WriteToReport micDone, "Set the Journal Date to Today ["&date()&"]", "Successfully Set the Journal Date to Today", FALSE

	'Click the Change ChartField Values Link
	Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").Link("Change ChartField Values").Click
	WriteToReport micDone, "Clicked the Change ChartField Values Link", "Successfully Clicked the Change ChartField Values Link", FALSE

	'Enter 10001 into the Account 'Field Value', enter 10002 into the Account 'Change to', select the checkbox for 'Selected'
	Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("Change Chartfield Values").WebEdit("Account - Field Value").Set ACCOUNT_FIELDVALUE
	WriteToReport micDone, "Set the Account - 'Field Value' Field to "&ACCOUNT_FIELDVALUE, "Successfully Set the 'Field Value' field", FALSE

	Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("Change Chartfield Values").WebEdit("Account - Change to").Set ACCOUNT_CHANGETO
	WriteToReport micDone, "Set the Account - 'Change to' Field to "&ACCOUNT_CHANGETO, "Successfully Set the 'Change to' field", FALSE

	Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("Change Chartfield Values").WebCheckBox("Account - Selected").Set ACCOUNT_SELECTED
	WriteToReport micDone, "Set the Account - 'Selected' Checkbox to "&ACCOUNT_SELECTED, "Successfully Checked the 'Selected' checkbox", FALSE

	'Click OK
	Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("Change Chartfield Values").WebButton("OK").Click
	WriteToReport micDone, "Clicked the OK Button", "Successfully Clicked the OK Button", FALSE

	If Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").Link("Correct ChartField Errors").Exist(5) Then
		Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").Link("Correct ChartField Errors").Click
		For i=2 To Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("Journal ChartField Errors").WebTable("Error Count").RowCount
			Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("Journal ChartField Errors").WebTable("Error Count").ChildItem(i, 4, "WebEdit", 0).Set "01620"
			Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("Journal ChartField Errors").WebTable("Error Count").ChildItem(i, 4, "WebCheckBox", 0).Click
		Next
		Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("Journal ChartField Errors").WebButton("OK").Click
	End If

	'Click Save
	Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").WebButton("Save").Click
	WriteToReport micDone, "Clicked the Save Button", "Successfully Clicked the Save Button", FALSE

	'Click the Go to Jrnl Entry [Correction] link'
	Browser("PeopleSoft Browser").Page("Correct Suspense Entries").PSFrame("TargetContent").Link("Go to Jrnl Entry [Correction]").Click
	WriteToReport micDone, "Clicked the Go to Jrnl Entry [Correction] Link", "Successfully Clicked the Go to Jrnl Entry [Correction] link", FALSE
	
	'The Link opens up in a new tab, close the original tab
	Browser("CreationTime:=0").Close

	'Find the first row in the table that is NOT errored out, and store the correct 'Account' and 'Dept' values to use to correct the errored lines
	nRow = -1
	For i=1 To Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebTable("Lines - Select/Line").RowCount
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebTable("Lines - Select/Line").ChildItem(i, 1, "WebCheckBox", 0).GetROProperty("disabled") = 1 Then
			nRow = i
			Exit For
		End If
	Next
	If nRow <> -1 Then
		WriteToReport micDone, "Found a Row without Errors; Row Number: "& nRow, "Found a Row without errors to use for Correcting Account and Dept", FALSE
	Else
		WriteToReport micFail, "Did Not Find a Row Without Errors", " Did not find a Row without errors to use for Correcting Account and Dept", TRUE
		ExitTest
	End If

	sAccount = Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebTable("Lines - Cols Unit->End").ChildItem(nrow, ACCOUNT_COL, "WebElement", 0).GetROProperty("innertext")
	WriteToReport micDone, "Account Found For Use in Correction with Value: "&sAccount, "Found Account for use in correction", FALSE

	sDept = Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebTable("Lines - Cols Unit->End").ChildItem(nrow, DEPT_COL, "WebElement", 0).GetROProperty("innertext")
	WriteToReport micDone, "Dept Found For Use in Correction with Value: "&sDept, "Found Dept for use in correction", FALSE

	'Correct the errors with the found Account and Dept
	For i=1 To Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebTable("Lines - Select/Line").RowCount
		If Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebTable("Lines - Select/Line").ChildItem(i, 1, "WebCheckBox", 0).GetROProperty("disabled") = 0 Then
			Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebTable("Lines - Cols Unit->End").ChildItem(i, ACCOUNT_COL, "WebEdit", 0).Set sAccount
			Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebTable("Lines - Cols Unit->End").ChildItem(i, DEPT_COL, "WebEdit", 0).Set sDept
			WriteToReport micDone, "Changed the Account and Dept for Row: "&i, "Made the Correction the Account and Dept", FALSE
		End If
	Next
	'Make sure the Process is "Edit Journal"
	Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebList("Journal Process").Select EDIT_JOURNAL
	WriteToReport micDone, "Selected "&EDIT_JOURNAL&" From the Process Dropdown List", "Successfully Made a Selection from the Process Dropdown List", FALSE

	'Click Process
	Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebButton("Process").Click
	WriteToReport micDone, "Clicked the Process Button", "Successfully Clicked the Process Button", FALSE

	'Click OK to dismiss the Message Popup
	If Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Exist(90) Then
		WriteToReport micPass, "Successfully Saved the Correction", "The Saved Message Appeared", FALSE
		Browser("PeopleSoft Browser").Page("Create/Update Journal").WebButton("OK").Click
		WriteToReport micDone, "Clicked the OK Button", "Successfully Clicked the OK Button", FALSE
	Else
		WriteToReport micFail, "Did not Successfully Save the Correction", "The Correction was not saved", TRUE
		ExitTest
	End If

	'Update the JournalID
	sJournalID = Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebElement("Journal ID").GetROProperty("innertext")
	WriteToReport micDone, "The Journal ID is now: "&sJournalID, "Successfully Updated the Journal ID", FALSE
	If GlobalDictionary.Exists("JournalID") Then
		GlobalDictionary.Remove("JournalID")
	End If
	GlobalDictionary.Add "JournalID", sJournalID

	'Check that the Journal Status is now "V"
	sJournalStatus = Trim(Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebElement("Journal Status").GetROProperty("innertext"))
	If sJournalStatus = "V"	Then
		WriteToReport micPass, "Successfully Corrected the Journal [" & sJournalID & "], Journal Status is now Valid", "Journal is now Valid", FALSE
		WriteToReport micPass, "CorrectSuspensedJournal", "Successfully Corrected the Journal", FALSE
	Else
		WriteToReport micFail, "Did not Successfully Correct the Journal ["&sJournalID&"], Journal Status is Instead: "&sJournalStatus, "Journal is still Invalid", TRUE
		ExitTest 
	End If

	'Grab the Ledger Group
	Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebElement("HeaderTab").Click
	WriteToReport micDone, "Moved to the Header Tab", "Successfully moved the the Header Tab", FALSE
	sLedgerGroup = Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebEdit("Ledger Group").GetROProperty("value")
	If GlobalDictionary.Exists("Ledger") Then
		GlobalDictionary.Remove("Ledger")
	End If
	GlobalDictionary.Add "Ledger", sLedgerGroup
	WriteToReport micDone, "Stored the Ledger Group: "&sLedgerGroup, "Successfully stored the Ledger Group", FALSE

	'Make sure the Journal Shows up
	Call SharedCreateEditUpdateJournalStart("CorrectSuspensedJournal", False)

	'Process the Journal
	Call SharedProcessJournal("CorrectSuspensedJournal", False)
End Function

'**************************************************************************************************************
''' <summary> 
'''Looks for Journal that was Suspended (Negative looks for the lack of the Journal)
''' </summary>
''' <author>Zach Apple</author>
''' <datecreated>12Nov2018</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************	
Function QuerySuspendedJournal
	Dim oLink, bFound, i
	Const SUSPENSE_QUERY = "CDW_GL_SUSPENSE"
	bFound = FALSE
	Call login(GlobalDictionary("QueryUser"))

	'Navigate to the Query Manager page
	If SelectMainMenu1(GlobalDictionary("QueryManager")) = True Then
		WriteToReport micPass, "QuerySuspendedJournal", "On the Query Manager Page.", False
	Else
		WriteToReport micFail, "QuerySuspendedJournal", "Navigation to Query Manager Page failed. Exiting test.", True
		ExitTest
	End If

	'Enter CDW_GL_SUSPENSE into the 'begins with' field
	Browser("Peoplesoft Browser").Page("Query Manager").PSFrame("Query Manager").WebEdit("SearchText").Set SUSPENSE_QUERY
	WriteToReport micDone, "Set the Search to "&SUSPENSE_QUERY, "Successfully set the Search for the Query", FALSE

	'Click Search
	Browser("Peoplesoft Browser").Page("Query Manager").PSFrame("Query Manager").WebButton("Search").Click
	WriteToReport micpass, "Clicked the Search Button", "Successfully Clicked the Search Button", FALSE

	'Click the HTML Link for CDW_GL_SUSPENSE

	'//span[text()='CDW_GL_SUSPENSE']/../../../td[7]/div/span/a[text()='HTML']
	Set oLink = Browser("Peoplesoft Browser").Page("Query Manager").PSFrame("Query Manager").Link("RunToHTML")
	Call oLink.SetTOProperty("xpath", "//span[text()='"&SUSPENSE_QUERY&"']/../../../td[7]/div/span/a[text()='HTML']")
	If oLink.Exist(5) Then
		oLink.Click
		WriteToReport micPass, "Found the Run to HTML Link for Query: "&SUSPENSE_QUERY, "Clicked the Link", FALSE
	Else
		WriteToReport micFail, "Did not Find the Run to HTML Link for Query: "&SUSPENSE_QUERY, "Could not Click the Link", TRUE
		ExitTest
	End If

	'The Link opens up in a new tab, close the original tab
	Browser("CreationTime:=0").Close

	'Set the Source
	Browser("PeopleSoft Browser").Page("Query").WebEdit("Source").Set GlobalDictionary("Source")
	WriteToReport micDone, "Set the Source to Search For: "&GlobalDictionary("Source"), "Successfully set the Source", FALSE

	'Click View Results
	Browser("PeopleSoft Browser").Page("Query").WebButton("View Results").Click
	WriteToReport micDone, "Clicked View Results", "Successfully clicked View Results", FALSE

	Browser("PeopleSoft Browser").Sync

	'Click View All
	If Browser("PeopleSoft Browser").Page("Query").WebTable("Results").Exist(90) Then
		If Browser("PeopleSoft Browser").Page("Query").Link("View All").Exist(15) Then
			Browser("PeopleSoft Browser").Page("Query").Link("View All").Click
			WriteToReport micDone, "Clicked View All", "Successfully clicked View All", FALSE
		End If
	End If

	Browser("PeopleSoft Browser").Sync

	'Look for JournalID
	If Browser("PeopleSoft Browser").Page("Query").WebTable("Results").Exist(90) Then
		'Skip the header row
		For i=2 To Browser("PeopleSoft Browser").Page("Query").WebTable("Results").RowCount
			If Browser("PeopleSoft Browser").Page("Query").WebTable("Results").ChildItem(i, 3, "Link", 0).GetROProperty("innertext") = GlobalDictionary("JournalID") Then
				bFound = TRUE
				WriteToReport micDone, "Found the Journal ID ["&GlobalDictionary("JournalID")&"] on Row: "&i, "Journal Found", FALSE
				Exit For
			End If
		Next
	End If
	

	'Determine if negative testing 
	If GlobalDictionary("NegativeTesting") = "TRUE" Then
	'Should not have found it
		If bFound Then
			WriteToReport micFail, "Found Journal ["&GlobalDictionary("JournalID")&"] in Suspense Status and Should Not Have", "Journal Still Suspended", TRUE
			ExitTest
		Else 			
			WriteToReport micPass, "Did Not Find Journal ["&GlobalDictionary("JournalID")&"]", "Journal No Longer Suspended", FALSE 
		End If
	Else
	'Should have found it
		If bFound Then
			WriteToReport micPass, "Found Journal ["&GlobalDictionary("JournalID")&"] in Suspense Status", "Journal Is Suspended", TRUE
		Else
			WriteToReport micFail, "Did Not Find Journal ["&GlobalDictionary("JournalID")&"] in Suspense Status and Should Have", "Journal Not Found", TRUE
			ExitTest
		End If
	End If
End Function

Public Function ReviewJournalStatus

	'Navigate to General Ledger>Journals>Process Journals > Review Journal Status
	If SelectMainMenu1(GlobalDictionary("ReviewStatus")) = True Then
		WriteToReport micPass, "ReviewJournalStatus", "On the Review Journal Status page.", False
	Else
		WriteToReport micFail, "ReviewJournalStatus", "Navigation to Review Journal Status page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Review Journal Status").PSFrame("TargetContent")

		'Enter our search criteria
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")
		.WebEdit("JournalID").Set GlobalDictionary("JournalID")

		'click search
		.WebButton("Search").Click

		'Confirm that our table exists
		If .WebTable("ResultsTable").Exist(5) Then
			WriteToReport micPass, "ReviewJournalStatus", "Results table found.", False

			'If our webtable exists, search it for results
			For i = 0 To .WebTable("ResultsTable").GetROProperty("rows") - 1
				If .Link("html id:=RESULT1\$" & i).GetROProperty("innertext") = GlobalDictionary("JournalID") Then

					If .Link("html id:=RESULT5\$" & i).GetROProperty("innertext") = "Posted" Then
						WriteToReport micPass, "ReviewJournalStatus", "Journal Header status is 'Posted'", False
					Else
						WriteToReport micFail, "ReviewJournalStatus", "Journal Header status is " & .Link("html id:=RESULT5\$" & i).GetROProperty("innertext"), True
					End If

					If .Link("html id:=RESULT6\$" & i).GetROProperty("innertext") = "Valid" Then
						WriteToReport micPass, "ReviewJournalStatus", "Budget Header status is 'Valid'", False
					Else
						WriteToReport micFail, "ReviewJournalStatus", "Budget Header status is " & .Link("html id:=RESULT6\$" & i).GetROProperty("innertext"), True
					End  If
				End If
			Next

		'Confirm if we're on a single result page
		ElseIf .WebElement("JournalHeader").Exist(5) Then
			If .WebElement("JournalHeader").GetROProperty("innertext") = "Posted" Then
				WriteToReport micPass, "ReviewJournalStatus", "Journal Header status is 'Posted'", False
			Else
				WriteToReport micFail, "ReviewJournalStatus", "Journal Header status is " & .WebElement("JournalHeader").GetROProperty("innertext"), True
			End If

			If .WebElement("BudgetHeader").GetROProperty("innertext") = "Valid" Then
				WriteToReport micPass, "ReviewJournalStatus", "Budget Header status is 'Valid'", False
			Else
				WriteToReport micFail, "ReviewJournalStatus", "Budget Header status is " & .WebElement("BudgetHeader").GetROProperty("innertext"), True
			End  If
		Else
			WriteToReport micFail, "ReviewJournalStatus", "Unable to verify journal " & GlobalDictionary("JournalID") & ". Please check data. Exiting test.", True
			ExitTest
		End If
	End With
End Function
'**************************************************************************************************************
''' <summary> 
''' Extend Open Period for given PeopleSoft Product to End of Month, One Year Out
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function ExtendOpenPeriodForProduct
	Dim oDeviceReplay
	Const ENTER = 28
	'Navigate to Open Period Update
	If SelectMainMenu1(GlobalDictionary("GLPeriodUpdate")) Then
		WriteToReport micPass, "Open Period Update Page", "On the Open Period Update page.", FALSE
	Else
		WriteToReport micFail, "Open Period Update Page", "Navigation to Open Period Update page failed. Exiting test.", TRUE
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Open Period Update").PSFrame("TargetContent")
		'Set Product
		.WebEdit("Product").Set GlobalDictionary("Product")
		WriteToReport micDone, "Set PeopleSoft Product: "&GlobalDictionary("Product"), "Product Set", FALSE

		'Set BU
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set Business Unit: "&GlobalDictionary("BusinessUnit"), "BU Set", FALSE

		'Set Ledger Group
		If GlobalDictionary("LedgerGroup") <> "" Then
			.WebEdit("LedgerGroup").Set GlobalDictionary("LedgerGroup")
			WriteToReport micDone, "Set Ledger Group: "&GlobalDictionary("LedgerGroup"), "Ledger Group Set", FALSE
		End If

		'Click Search
		.WebButton("Search").Click
		WriteToReport micDone, "Clicked the Search Button", "Button Clicked", FALSE

		'Set To Year
		.WebEdit("ToYear").Set Year(Now)+1
		WriteToReport micDone, "Set the To Year: "&Year(Now)+1, "To Year Set", FALSE

		'Set To Period
		.WebEdit("ToPeriod").Set Month(Now)
		WriteToReport micDone, "Set the To Period: "&Month(Now), "To Period Set", FALSE

		'Hit Enter Key
		Set oDeviceReplay = CreateObject("Mercury.DeviceReplay")
		oDeviceReplay.PressKey ENTER
		Wait 1

		'Set Last Open Date, if not already determined
		If .WebEdit("LastOpen").GetROProperty("value") <> AnyDateLeadingZeros(DateSerial(Year(Now)+1, Month(Now)+1, 0)) Then
			.WebEdit("LastOpen").Set AnyDateLeadingZeros(DateSerial(Year(Now)+1, Month(Now)+1, 0))
		End If
		WriteToReport micDone, "Last Open Date Set To: "&.WebEdit("LastOpen").GetROProperty("value"), "Last Open Date Set", FALSE

		'Click Save
		.WebButton("Save").Click
		WriteToReport micDone, "Clicked the Save Button", "Button Clicked", FALSE

		'Accept Warning
		If Browser("PeopleSoft Browser").Page("Open Period Update").WebElement("LastOpenWarning").Exist(10) Then
			WriteToReport micDone, "Warning that the Last Open Date is later than the Last Open Date for the same GL BU Last Open Date Appeared", "", TRUE
			Browser("PeopleSoft Browser").Page("Open Period Update").WebButton("OK").Click
			WriteToReport micDone, "Clicked OK to Dismiss the Warning", "Warning Dismissed", FALSE
		End If
	End With
End Function


'**************************************************************************************************************
''' <summary> 
''' Controller for Extending Open Periods for Multiple Products
''' Uses ExtendOpenPeriodForProduct multiple times with different data
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function ExtendMultipleProductPeriods
	Dim arrProducts, arrLedgerGroups, i
	arrProducts = Split(GlobalDictionary("Products"), ";")
	arrLedgerGroups = Split(GlobalDictionary("LedgerGroups"), ";")
	For i=0 To UBound(arrProducts)
		GlobalDictionary("Product") = arrProducts(i)
		GlobalDictionary("LedgerGroup") = arrLedgerGroups(i)
		Call ExtendOpenPeriodForProduct
	Next
End Function
