'==========================================================
'PSFIN Expenses Function Library
'Contains commonly used functions for Expenses in the PSFin application.
'Changelog: 
'Date			Author					Description

'______________________________________________________ 

Option Explicit
'**************************************************************************************************************
''' <summary> 
''' 	Creates expense report in PSFIN.
''' </summary>
''' <author>Brian Buckhana</author>
''' <startstate>Expenses page visible with Employee ID auto-populated.</startstate>
''' <endstate>Approval History is displayed showing who else needs to approve the expense sheet.</endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________________________
'	14NOV18		Brian B.		Added object cleanup, remaining steps comments, and remaining if statements for setting fields.
'	28JAN19		Brian B.		Increased .Exist times to "20" for the objects checking if the "Add Attachments" link was clicked.
'	02MAY19		Zach A.			Changed clicking the Refresh Approval Status to a loop, as it takes longer now
'______________________________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function CreateExpenseReport
	Dim arrBusinessPurpose, arrReportDescription, arrExpenseDate, arrExpenseType, arrExpenseDescription
	Dim	arrExpensePaymentType, arrAmount, arrSelectALocation, arrNonPreferredVendorValue, arrGLUnit, arrExpenseDept
	Dim arrGLUnitVerify, arrExpenseDeptVerify, arrExpenseAmount, arrExpReportID, arrReportStatus, aET_Replace, arrCurrency
	Dim sEmployeeID, sBusinessPurpose, sReportDescription, sExpenseDate, sExpenseType, sExpenseDescription, sMA_ErrorMessage
	Dim	sExpensePaymentType, sExpenseAmount, sSelectALocation, sNonPreferredVendorValue, sGLUnit, sExpenseDept
	Dim	sMessage, sStatus, sExpReportID, sCurrency, sActualMessage
	Dim sGLUnitVerify, sExpenseDeptVerify, sCurrentValue, sUsernames
	Dim oPage
	Dim i, nCERunMax, nCERunCounter, nNumOfNights

	If SelectMainMenu1(GlobalDictionary("AddExpenseReport")) = True Then
		WriteToReport micPass, "Create/Modify Expense Page", "On the Create/Modify Expense page.", False
	Else
		WriteToReport micFail, "Create/Modify Expense Page", "Navigation to Create/Modify Expense page failed. Exiting test.", True
		ExitTest
	End If

	sBusinessPurpose = GlobalDictionary("BusinessPurpose")
	sReportDescription = GlobalDictionary("ReportDescription")

	' NOTES:  To use below in data sheets, enter "Value1;Value2;Value3...ValueX" | Value can be "*SKIP_ITERATION*" to represent a skip; i.e: Value1;*SKIP_ITERATION*;Value3.
	arrExpenseDate = Split(GlobalDictionary("ExpenseDateValue"), ";")
	arrExpenseType = Split(GlobalDictionary("ExpenseType"), ";")
	arrExpenseDescription = Split(GlobalDictionary("ExpenseDescription"), ";")
	arrExpensePaymentType = Split(GlobalDictionary("ExpensePaymentType"), ";")
	arrExpenseAmount = Split(GlobalDictionary("ExpenseAmount"), ";")
	If GlobalDictionary.Exists("Currency") Then
		arrCurrency = Split(GlobalDictionary("Currency"))
	End If
	arrSelectALocation = Split(GlobalDictionary("SelectALocation"), ";")
	arrNonPreferredVendorValue = Split(GlobalDictionary("NonPreferredVendorValue"), ";")
	arrGLUnit = Split(GlobalDictionary("GLUnit"), ";")
	arrExpenseDept = Split(GlobalDictionary("ExpenseDept"), ";")
	arrGLUnitVerify = Split(GlobalDictionary("GLUnitVerify"), ";")
	arrExpenseDeptVerify = Split(GlobalDictionary("ExpenseDeptVerify"), ";")
	
	'Verify Employee ID is auto-filled. 
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Employee ID").Exist(10) Then
		Call WriteToReport(micPass, "Successfully Navigated to Expense Report Page", "Successfully navigated to Expense Report page after using navigation function.", True)
		
		sEmployeeID = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Employee ID").GetROProperty("value")
		
		If NOT(sEmployeeID = "") OR NOT(isEmpty(sEmployeeID)) Then
			Call WriteToReport(micPass, "Employee ID Successfully Auto-Populated", "Employee ID [" & sEmployeeID & "] successfully auto-populated after navigating to Expense Report page.", True)
		Else
			Call WriteToReport(micFail, "Employee ID Failed to Auto-Populate", "Employee ID [" & sEmployeeID & "] failed to auto-populate after navigating to Expense Report page.", True)
		End If
	Else
		Call WriteToReport(micFail, "Failed to Navigate to Expense Report Page", "Failed to navigate to Expense Report page after using navigation function.", True)
	End If

	Browser("PeopleSoft Browser").Sync
	
	' Click the "Add" button to create a new expense report.
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Add").Exist(10) Then
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Add").Click
		WriteToReport micDone, "Clicked the Add Button", "Successfully clicked the Add Button", FALSE
	Else
		WriteToReport micFail, "Failed to Find the 'Add' Button", "Failed to click the 'Add' button to create a new expense report.", TRUE
		ExitTest
	End If
	
	Browser("PeopleSoft Browser").Sync

	' Verify page navigation.
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("Business Purpose").Exist(30) Then
		Call WriteToReport(micPass, "Successfully Navigated to Create Expense Page", "Successfully navigated to Create Expense page after clicking the 'Add' button.", FALSE)
	Else
		Call WriteToReport(micFail, "Failed to Navigate to Create Expense Page", "Failed to navigate to Create Expense page after clicking the 'Add' button.", True)
		ExitTest
	End If

	' BUSINESS PURPOSE
	If NOT(sBusinessPurpose = "*SKIP_ITERATION*") Then
		If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("Business Purpose").Exist(5) Then
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("Business Purpose").Select sBusinessPurpose
			
			' Verify value was entered correctly.
			sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("Business Purpose").GetROProperty("value")
			If sCurrentValue = sBusinessPurpose Then
				Call WriteToReport(micPass, "Successfully Selected Business Purpose [" & sCurrentValue & "]", "Successfully selected Business Purpose [" & sCurrentValue & "] with input [" & sBusinessPurpose & "].", True)
			Else
				Call WriteToReport(micFail, "Failed to Select Business Purpose [" & sBusinessPurpose & "]", "Expected Value / Input [" & sBusinessPurpose & "] | Current Value in Field [" & sCurrentValue & "].", True)
			End If
		Else
			Call WriteToReport(micFail, "Failed to Select Business Purpose [" & sBusinessPurpose & "]", "Field was not visible in time.", True)
		End If
	End If
	
	' REPORT DESCRIPTION
	If NOT(sReportDescription = "*SKIP_ITERATION*") Then
		If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Report Description").Exist(5) Then
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Report Description").Set sReportDescription
			
			' Verify value was entered correctly.
			sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Report Description").GetROProperty("value")
			If sCurrentValue = sReportDescription Then
				Call WriteToReport(micPass, "Successfully Set Report Description [" & sCurrentValue & "]", "Successfully set Report Description [" & sCurrentValue & "] with input [" & sReportDescription & "].", True)
			Else
				Call WriteToReport(micFail, "Failed to Set Report Description [" & sReportDescription & "]", "Expected Value / Input [" & sReportDescription & "] | Current Value in Field [" & sCurrentValue & "].", True)
			End If
		Else
			Call WriteToReport(micFail, "Failed to Set Report Description [" & sReportDescription & "]", "Field was not visible in time.", True)
		End If
	End If

	' Fill out the fields.
	For i = 0 To UBound(arrExpenseDate)
		sExpenseDate = CStr(arrExpenseDate(i))
		sExpenseType = CStr(arrExpenseType(i))
		sExpenseDescription = CStr(arrExpenseDescription(i))
		sExpensePaymentType = CStr(arrExpensePaymentType(i))
		sExpenseAmount = CStr(arrExpenseAmount(i))
		If IsArray(arrCurrency) Then
			sCurrency = CStr(arrCurrency(i))
		End If
		sSelectALocation = CStr(arrSelectALocation(i))
		sNonPreferredVendorValue = CStr(arrNonPreferredVendorValue(i))
		sGLUnit = CStr(arrGLUnit(i))
		sGLUnitVerify = CStr(arrGLUnitVerify(i))
		sExpenseDept = CStr(arrExpenseDept(i))
		sExpenseDeptVerify = CStr(arrExpenseDeptVerify(i))
		
		' EXPENSE DATE
		If NOT(sExpenseDate = "*SKIP_ITERATION*") Then
			Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Date").SetTOProperty("name", "TRANS_DATE$"&i)
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Date").Exist(5) Then
				' Use today's date if it says "TODAY".
				If sExpenseDate = "TODAY" Then
					sExpenseDate = CStr(date())' mm/dd/ccyy is the default format.
				ElseIf sExpenseDate = "Add_MinusDAYS" Then
					nNumOfNights = CInt(GlobalDictionary("Add_MinusDays"))
					sExpenseDate = CStr(DateAdd("d", nNumOfNights, date()))
				End If
					Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Date").Set sExpenseDate
					
				' Verify value was entered correctly.
				sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Date").GetROProperty("value")
				sCurrentValue = FormatDateTime(sCurrentValue, 2)
				If CStr(sCurrentValue) = sExpenseDate Then
					Call WriteToReport(micPass, "Successfully Set Expense Date [" & sCurrentValue & "]", "Successfully set Expense Date [" & sCurrentValue & "] with input [" & sExpenseDate & "].", True)
				Else
					Call WriteToReport(micFail, "Failed to Set Expense Date [" & sExpenseDate & "]", "Expected Value / Input [" & sExpenseDate & "] | Current Value in Field [" & sCurrentValue & "].", True)
				End If
			Else
				Call WriteToReport(micFail, "Failed to Set Expense Date [" & sExpenseDate & "]", "Field was not visible in time.", True)
			End If
		End If
		
		' EXPENSE TYPE
		If NOT(sExpenseType = "*SKIP_ITERATION*") Then
			Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("Expense Type").SetTOProperty("name", "EXPENSE_TYPE$"&i)
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("Expense Type").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("Expense Type").Select sExpenseType
				
				' Verify value was entered correctly.
				sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("Expense Type").GetROProperty("value")
				If CStr(sCurrentValue) = sExpenseType Then
					Call WriteToReport(micPass, "Successfully Selected Expense Type [" & sCurrentValue & "]", "Successfully selected Expense Type [" & sCurrentValue & "] with input [" & sExpenseType & "].", True)
				Else
					Call WriteToReport(micFail, "Failed to Select Expense Type [" & sExpenseType & "]", "Expected Value / Input [" & sExpenseType & "] | Current Value in Field [" & sCurrentValue & "].", True)
				End If
			Else
				Call WriteToReport(micFail, "Failed to Select Expense Type [" & sExpenseType & "]", "Field was not visible in time.", True)
			End If
			
'			' If Expense Type is Hotel related, start Itemization Hotel Bill.
'			If GlobalDictionary.Exists("ITH_Date") Then
'				Call ItemizeHotelBill()
'			End If
		End If

		' EXPENSE DESCRIPTION
		If NOT(sExpenseDescription = "*SKIP_ITERATION*") Then
			Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Description").SetTOProperty("name", "DESCR$"&i)
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Description").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Description").Set sExpenseDescription
				
				' Verify value was entered correctly.
				sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Description").GetROProperty("value")
				If CStr(sCurrentValue) = sExpenseDescription Then
					Call WriteToReport(micPass, "Successfully Set Expense Description [" & sCurrentValue & "]", "Successfully set Expense Description [" & sCurrentValue & "] with input [" & sExpenseDescription & "].", True)
				Else
					Call WriteToReport(micFail, "Failed to Set Expense Description [" & sExpenseDescription & "]", "Expected Value / Input [" & sExpenseDescription & "] | Current Value in Field [" & sCurrentValue & "].", True)
				End If
			Else
				Call WriteToReport(micFail, "Failed to Set Expense Description [" & sExpenseDescription & "]", "Field was not visible in time.", True)
			End If
		End If
		
		' EXPENSE PAYMENT TYPE
		If NOT(sExpensePaymentType = "*SKIP_ITERATION*") Then
			Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("Expense Payment Type").SetTOProperty("name", "PAYMENT_TYPE$"&i) 
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("Expense Payment Type").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("Expense Payment Type").Select sExpensePaymentType
				
				' Verify value was entered correctly.
				sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("Expense Payment Type").GetROProperty("value")
				If CStr(sCurrentValue) = sExpensePaymentType Then
					Call WriteToReport(micPass, "Successfully Selected Expense Payment Type [" & sCurrentValue & "]", "Successfully selected Expense Payment Type [" & sCurrentValue & "] with input [" & sExpensePaymentType & "].", True)
				Else
					Call WriteToReport(micFail, "Failed to Select Expense Payment Type [" & sExpensePaymentType & "]", "Expected Value / Input [" & sExpensePaymentType & "] | Current Value in Field [" & sCurrentValue & "].", True)
				End If
			Else
				Call WriteToReport(micFail, "Failed to Select Expense Payment Type [" & sExpensePaymentType & "]", "Field was not visible in time.", True)
			End If
		End If
		
		' EXPENSE AMOUNT
		If NOT(sExpenseAmount = "*SKIP_ITERATION*") Then
			Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Amount").SetTOProperty("name", "TRANS_AMT1$"&i) 
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Amount").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Amount").Set sExpenseAmount
				
				' Verify value was entered correctly.
				sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Amount").GetROProperty("value")
				If CStr(sCurrentValue) = sExpenseAmount Then
					Call WriteToReport(micPass, "Successfully Set Expense Amount [" & sCurrentValue & "]", "Successfully set Expense Amount [" & sCurrentValue & "] with input [" & sExpenseAmount & "].", True)
				Else
					Call WriteToReport(micFail, "Failed to Set Expense Amount [" & sExpenseAmount & "]", "Expected Value / Input [" & sExpenseAmount & "] | Current Value in Field [" & sCurrentValue & "].", True)
				End If
			Else
				Call WriteToReport(micFail, "Failed to Set Expense Amount [" & sExpenseAmount & "]", "Field was not visible in time.", True)
			End If
		End If

		' CURRENCY
		If NOT(sCurrency = "") AND NOT(sCurrency = "*SKIP_ITERATION*") Then
			Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Currency").SetTOProperty("name", "EX_SHEET_LINE_TXN_CURRENCY_CD$"&i)
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Currency").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Currency").Set sCurrency

				'Verify value was entered correctly.
				sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Currency").GetROProperty("value")
				If CStr(sCurrentValue) = sCurrency Then
					WriteToReport micPass, "Successfully Set the Currency ["& sCurrentValue &"]", "Successfully Set a Currency ["&sCurrentValue&"] with input ["&sCurrency&"]", FALSE
				Else
					WriteToReport micFail, "Failed to Set the Currency ["&sCurrency&"]", "Expected Value / Input ["&sCurrency&"] | Current Value in Field ["&sCurrentValue&"].", TRUE
				End If
			Else
				WriteToReport micFail, "Failed to Set the Currency ["&sCurrency&"]", "Field was not visible in time.", TRUE
			End If
			Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Exchange Rate").SetTOProperty("name", "EXCHANGE_RATE$"&i)
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Exchange Rate").Exist(5) Then
				sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Exchange Rate").GetROProperty("value")
				If GlobalDictionary.Exists("ExchangeRate") Then
		        	GlobalDictionary.Remove("ExchangeRate")
			    End If
			    GlobalDictionary.Add "ExchangeRate", sCurrentValue
			    WriteToReport micDone, "Stored the Exchange Rate as ["&sCurrentValue&"]", "Exchange Rate Stored", FALSE
			Else
				WriteToReport micFail, "Failed to Find the Exchange Rate", "Field was not visible in time.", TRUE
			End If
		End If
		
		' SELECT A LOCATION
		If NOT(sSelectALocation = "*SKIP_ITERATION*") Then
			Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Select A Location").SetTOProperty("name", "EX_LOCATION_VW6_DESCR$"&i) 
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Select A Location").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Select A Location").Set sSelectALocation
				
				' Verify value was entered correctly.
				sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Select A Location").GetROProperty("value")
				If CStr(sCurrentValue) = sSelectALocation Then
					Call WriteToReport(micPass, "Successfully Selected A Location [" & sCurrentValue & "]", "Successfully selected a location [" & sCurrentValue & "] with input [" & sSelectALocation & "].", True)
				Else
					Call WriteToReport(micFail, "Failed to Select A Location [" & sSelectALocation & "]", "Expected Value / Input [" & sSelectALocation & "] | Current Value in Field [" & sCurrentValue & "].", True)
				End If
			Else
				Call WriteToReport(micFail, "Failed to Select A Location [" & sSelectALocation & "]", "Field was not visible in time.", True)
			End If
		End If
		
		' NON PREFERRED VENDOR VALUE
		If NOT(sNonPreferredVendorValue = "*SKIP_ITERATION*") Then
			Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebRadioGroup("Non Preferred Vendor").SetTOProperty("name", "EX_LINE_WRK_PREF_MERCHANT$"&i)
			'Check if NON PREFERRED VENDOR radio button is selected.  Change if not selected.
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebRadioGroup("Non Preferred Vendor").GetROProperty("checked") = 1 Then '1 is checked, 0 is cleared
				WriteToReport micDone, "Non Preferred Vendor Radio Already Checked", "Already checked, no need to click", FALSE
			Else
				Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebRadioGroup("Non Preferred Vendor").Click
				WriteToReport micDone, "Clicked the Non Preferred Vendor Radio Button", "Clicked the button", FALSE
			End If
			
			Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Non Preferred Vendor Value").SetTOProperty("name", "MERCHANT$"&i)
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Non Preferred Vendor Value").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Non Preferred Vendor Value").Set sNonPreferredVendorValue
				
				' Verify value was entered correctly.
				sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Non Preferred Vendor Value").GetROProperty("value")
				If CStr(sCurrentValue) = sNonPreferredVendorValue Then
					Call WriteToReport(micPass, "Successfully Set Non Preferred Vendor Value [" & sCurrentValue & "]", "Successfully set Non Preferred Vendor Value [" & sCurrentValue & "] with input [" & sNonPreferredVendorValue & "].", True)
				Else
					Call WriteToReport(micFail, "Failed to Set Non Preferred Vendor Value [" & sNonPreferredVendorValue & "]", "Expected Value / Input [" & sNonPreferredVendorValue & "] | Current Value in Field [" & sCurrentValue & "].", True)
				End If
			Else
				Call WriteToReport(micFail, "Failed to Set Non Preferred Vendor Value [" & sNonPreferredVendorValue & "]", "Field was not visible in time.", True)
			End If
		End If
		
		' Expand Accounting Details to make objects visible.
		Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("GLUnit").SetTOProperty("name", "EX_SHEET_DIST_BUSINESS_UNIT_GL$"&i)
		If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("GLUnit").Exist(5) Then
			Call WriteToReport(micInfo, "Accounting Details Already Expanded for GL Unit", "GL Unit is Visible.", True)
		Else
			Call WriteToReport(micInfo, "Accounting Details Not Expanded for GL Unit", "Expanding Accounting Details.", True)
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Image("Expand Accounting Details").Click
		End If
		
		If GlobalDictionary("SplitExpense") = "TRUE" Then
			Call SplitExpenses(i)
		Else

			' GL UNIT / GL BU
			If NOT(sGLUnit = "*SKIP_ITERATION*") Then				
				If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("GLUnit").Exist(5) Then
					' Verify the current value in the field and/or edit it.
					sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("GLUnit").GetROProperty("value")
					Select Case UCase(sGLUnitVerify)
						Case "VERIFY"
							' Verify value matches correctly.
							If CStr(sCurrentValue) = sGLUnit Then
								Call WriteToReport(micPass, "GL Unit [" & sCurrentValue & "] Matches Expected Value", "GL Unit [" & sCurrentValue & "] macthes expected value [" & sGLUnit & "].", True)
							Else
								Call WriteToReport(micFail, "GL Unit [" & sGLUnit & "] Does Not Match Expected Value", "Expected Value / Input [" & sGLUnit & "] does not match Current Value in field [" & sCurrentValue & "].", True)
							End If
						Case "EDIT"
							Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("GLUnit").Set sGLUnit
							
							' Verify value was entered correctly.
							If CStr(sCurrentValue) = sGLUnit Then
								Call WriteToReport(micPass, "Successfully Set GL Unit [" & sCurrentValue & "]", "Successfully set GL Unit [" & sCurrentValue & "] with input [" & sGLUnit & "].", True)
							Else
								Call WriteToReport(micFail, "Failed to Set GL Unit [" & sGLUnit & "]", "Expected Value / Input [" & sGLUnit & "] | Current Value in field [" & sCurrentValue & "].", True)
							End If
						Case "VERIFYANDEDIT"
							' Verify value matches correctly.
							If CStr(sCurrentValue) = sGLUnit Then
								Call WriteToReport(micPass, "GL Unit [" & sCurrentValue & "] Matches Expected Value", "GL Unit [" & sCurrentValue & "] macthes expected value [" & sGLUnit & "].", True)
							Else
								Call WriteToReport(micWarning, "GL Unit [" & sGLUnit & "] Does Not Match Expected Value", "Expected Value / Input [" & sGLUnit & "] does not match Current Value in field [" & sCurrentValue & "].", True)
								
								Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("GLUnit").Set sGLUnit
								sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("GLUnit").GetROProperty("value")
								' Verify value was entered correctly.
								If CStr(sCurrentValue) = sGLUnit Then
									Call WriteToReport(micPass, "Successfully Set GL Unit [" & sCurrentValue & "]", "Successfully set GL Unit [" & sCurrentValue & "] with input [" & sGLUnit & "].", True)
								Else
									Call WriteToReport(micFail, "Failed to Set GL Unit [" & sGLUnit & "]", "Expected Value / Input [" & sGLUnit & "] | Current Value in field [" & sCurrentValue & "].", True)
								End If
							End If
						Case "*SKIP_ITERATION*"
							Call WriteToReport(micInfo, "Skipping Verify/Edit for GL Unit [" & sGLUnit & "]", "Verify/Edit setting was [" & sGLUnitVerify & "] for GL Unit [" & sGLUnit & "].", True)
						Case Else
							Call WriteToReport(micFail, "GL Unit Verify/Edit Case Does Not Exist For Value [" & sGLUnitVerify & "]", "Check the cases or your input.", True)
					End Select
				Else
					Call WriteToReport(micFail, "Failed to Set GL Unit [" & sGLUnit & "]", "Field was not visible in time.", True)
				End If
			End If
			
			' EXPENSE DEPARTMENT
			If NOT(sExpenseDept = "*SKIP_ITERATION*") Then	
				Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Dept").SetTOProperty("name", "EX_SHEET_DIST_DEPTID$"&i)
				' Expand Accounting Details to make objects visible.
				If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Dept").Exist(5) Then
					Call WriteToReport(micInfo, "Accounting Details Already Expanded for Expense Dept", "Expense Dept is Visible.", True)
				Else
					Call WriteToReport(micInfo, "Accounting Details Not Expanded for Expense Dept", "Expanding Accounting Details.", True)
					Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Image("Expand Accounting Details").Click
				End If
				
				If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Dept").Exist(5) Then
					' Verify the current value in the field and/or edit it.
					sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Dept").GetROProperty("value")
					Select Case UCase(sExpenseDeptVerify)
						Case "VERIFY"
							' Verify value matches correctly.
							If CStr(sCurrentValue) = sExpenseDept Then
								Call WriteToReport(micPass, "Expense Dept [" & sCurrentValue & "] Matches Expected Value", "Expense Dept [" & sCurrentValue & "] macthes expected value [" & sExpenseDept & "].", True)
							Else
								Call WriteToReport(micFail, "Expense Dept [" & sExpenseDept & "] Does Not Match Expected Value", "Expected Value / Input [" & sExpenseDept & "] does not match Current Value in field [" & sCurrentValue & "].", True)
							End If
						Case "EDIT"
							Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Dept").Set sExpenseDept
							Wait 2
							
							' Verify value was entered correctly.
							If CStr(sCurrentValue) = sExpenseDept Then
								Call WriteToReport(micPass, "Successfully Set Expense Dept [" & sCurrentValue & "]", "Successfully set Expense Dept [" & sCurrentValue & "] with input [" & sExpenseDept & "].", True)
							Else
								Call WriteToReport(micFail, "Failed to Set Expense Dept [" & sExpenseDept & "]", "Expected Value / Input [" & sExpenseDept & "] | Current Value in field [" & sCurrentValue & "].", True)
							End If
						Case "VERIFYANDEDIT"
							' Verify value matches correctly.
							If CStr(sCurrentValue) = sExpenseDept Then
								Call WriteToReport(micPass, "Expense Dept [" & sCurrentValue & "] Matches Expected Value", "Expense Dept [" & sCurrentValue & "] macthes expected value [" & sExpenseDept & "].", True)
							Else
								Call WriteToReport(micWarning, "Expense Dept [" & sCurrentValue & "] Does Not Match Expected Value", "Expected Value / Input [" & sExpenseDept & "] does not match Current Value in field [" & sCurrentValue & "].", True)
								
								Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Dept").Set sExpenseDept
								Wait 2
								sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Dept").GetROProperty("value")
								' Verify value was entered correctly.
								If CStr(sCurrentValue) = sExpenseDept Then
									Call WriteToReport(micPass, "Successfully Set Expense Dept [" & sCurrentValue & "]", "Successfully set Expense Dept [" & sCurrentValue & "] with input [" & sExpenseDept & "].", True)
								Else
									Call WriteToReport(micFail, "Failed to Set Expense Dept [" & sExpenseDept & "]", "Expected Value / Input [" & sExpenseDept & "] | Current Value in field [" & sCurrentValue & "].", True)
								End If
							End If
						Case "*SKIP_ITERATION*"
							Call WriteToReport(micInfo, "Skipping Verify/Edit for Expense Dept [" & sExpenseDept & "]", "Verify/Edit setting was [" & sExpenseDeptVerify & "] for Expense Dept [" & sExpenseDept & "].", True)
						Case Else
							Call WriteToReport(micFail, "Expense Dept Verify/Edit Case Does Not Exist For Value [" & sExpenseDeptVerify & "]", "Check the cases or your input.", True)
					End Select
				Else
					Call WriteToReport(micFail, "Failed to Set Expense Dept [" & sExpenseDept & "]", "Field was not visible in time.", True)
				End If
			End If
		End If
		
		' If Expense Type is Hotel related, start Itemization Hotel Bill.
			If GlobalDictionary.Exists("ITH_Date") Then
				Call ItemizeHotelBill()
			End If

		' Add attachment
		If GlobalDictionary("AddAttachment") = "TRUE" Then
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("Header Attachments").Click
			WriteToReport micDone, "Clicked Header Attachments Link", "Successfully clicked the link", FALSE
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Expense Report Attachments").WebButton("Add Attachment").Exist(20) Then
				'Adds attachment
				Call AddAttachment(GlobalDictionary("FileLocation"), GlobalDictionary("FileName"), i + 1)
				
				'Click OK after attachment added
				Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Expense Report Attachments").WebButton("OK").Click
			Else
				WriteToReport micFail, "Failed to Click the Attachments Link", "Could not add attachment", TRUE
			End If
		ElseIf GlobalDictionary("AddAttachment_Function") = "TRUE" Then ' TODO: Replace above when more time.
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("Header Attachments").Click
			WriteToReport micDone, "Clicked Attachments Link", "Successfully clicked the link", FALSE
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Expense Report Attachments").WebButton("Add Attachment").Exist(20) Then
				Call AddAttachment(GlobalDictionary("FileLocation"), GlobalDictionary("FileName"), i + 1)
				
				'Click OK
				Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Expense Report Attachments").WebButton("OK").Click
			Else
				WriteToReport micFail, "Failed to Click the Attachments Link", "Could not add attachment", TRUE
			End If
		End If
		
		'Add Line Attachment
		If GlobalDictionary("LineAttachment") = "TRUE" Then
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Line Attatchment").Click
			WriteToReport micPass, "Attachment", "Line Attachment Link was clicked.", False		
			AddAttachment GlobalDictionary("FileLocation"), GlobalDictionary("FileName"), i+1
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Expense Report Attachments").WebButton("OK").Click
		End If
		' Add another line.
		If NOT(i = UBound(arrExpenseDate)) Then
			Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Add Expense Line +").SetTOProperty("html id", "EX_LINE_WRK_EX_INSERT_LNPB$"&i)
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Add Expense Line +").Click
			WriteToReport micDone, "Clicked Add Expense Line +", "Added another line", TRUE
		End If
	Next
	
	' Verify Expense Lines
	If GlobalDictionary.Exists("VerifyNumOfExpenseLines") Then
		Call VerifyExpenseLines(CInt(GlobalDictionary("VerifyNumOfExpenseLines")))
	End If
	
	' Add Attendees
	If GlobalDictionary("ExpenseType") = "02 Customer Meal" AND NOT(GlobalDictionary.Exists("CA_InputBlocker")) Then
		Call AddAttendees()
	End If
	
	' Click on the "Save for Later" hyperlink
	If GlobalDictionary("SaveForLater") = "TRUE" Then
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("Save for Later").Click
		
		'Pull out Expense Report ID and status
		If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("ExpenseReportID").Exist(20) Then
			sMessage =  Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("ExpenseReportID").GetROProperty("innertext")
			arrExpReportID = Split(sMessage,"    ")		
			sExpReportID = arrExpReportID(0)
			sStatus = arrExpReportID(1)	
			WriteToReport micPass, "Expense Report", "Expense Report [" & sExpReportID & "] has been created and Saved for Later and has a status of [" & sStatus & "].", False
			
			' Export ID to Global Dictionary
			If GlobalDictionary.Exists("ExpenseReportID") Then
				GlobalDictionary.Remove("ExpenseReportID")
			End If
			
			GlobalDictionary.Add "ExpenseReportID", sExpReportID
		Else
			WriteToReport micFail, "Expense Report", "Expense Report failed to Save.", True
			ExitTest			
		End If
		
		Exit Function
	End If
	
	' Click on the Summary and Submit hyperlink	| Create Expense Report - Totals page is displayed
	Call ClickSummaryAndSubmit()
	
	' Handle Multiple Attendees Error Message
	If GlobalDictionary.Exists("MultAttendeesErrorMessage") Then
		nCERunCounter = GlobalDictionary("CE_RunCounter")
		nCERunMax = CInt(GlobalDictionary("CE_RunMax"))
		sMA_ErrorMessage = Trim(GlobalDictionary("MultAttendeesErrorMessage"))
		aET_Replace = Split(GlobalDictionary("ExpenseType_Replace"), ";")
		
		' Verify the error message.
		If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").WebElement("MultipleAttendees_ErrorMessage").Exist(5) Then
			sActualMessage = Trim(Browser("PeopleSoft Browser").Page("Create/Modify Expenses").WebElement("MultipleAttendees_ErrorMessage").GetROProperty("innerText"))
			If Instr(1, sActualMessage, sMA_ErrorMessage, VBTextCompare) > 0 Then
				WriteToReport micPass, "Multiple Attendees Error Message Matches", "Error messages match: Expected [" & sMA_ErrorMessage & "] | Actual [" & sActualMessage & "]", FALSE
			Else
				WriteToReport micFail, "Multiple Attendees Error Message Does Not Match", "Error messages do not match: Expected [" & sMA_ErrorMessage & "] | Actual [" & sActualMessage & "]", TRUE
			End If
		Else
			WriteToReport micFail, "Multiple Attendees Error Message Popup Not Displayed", "Error message popup is not displayed after clicking 'Summary and Submit' button.", TRUE
		End If
		
		' Swap values so that a new expense type can be tested.
		If nCERunCounter = nCERunMax Then
			GlobalDictionary.Remove("MultAttendeesErrorMessage")
			GlobalDictionary.Remove("CA_InputBlocker")
			
			' Go back and add attendees to fix error.
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("Expense Details").Click

			' Add attendees.
			Call AddAttendees()
			
			' Finish out Expense report.
			Call ClickSummaryAndSubmit()
		Else
			GlobalDictionary.Remove("ExpenseType")
			GlobalDictionary.Add "ExpenseType", Trim(aET_Replace(nCERunCounter))
			
			nCERunCounter = nCERunCounter + 1
			GlobalDictionary.Remove("CE_RunCounter")
			GlobalDictionary.Add "CE_RunCounter", nCERunCounter
			Exit Function
		End If
	End If
	
	Browser("PeopleSoft Browser").Sync

	' Click on the OK button | Expense Report is saved and submitted for approval and the Expense sheet # is assigned
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Expense Report Submit Confirm").WebButton("OK").Exist(90) Then
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Expense Report Submit Confirm").WebButton("OK").Click
		WriteToReport micDone, "Clicked the OK Button", "Successfully clicked OK", FALSE
	Else
		WriteToReport micDone, "Failed to Find the OK Button", "Could not click the OK button", TRUE
	End If
	
	Browser("PeopleSoft Browser").Sync

	If GlobalDictionary.Exists("ExpenseReportID") Then
		GlobalDictionary.Remove("ExpenseReportID")
	End If
	GlobalDictionary.Add "ExpenseReportID", Trim(Split(Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("ExpenseReportID").GetROProperty("innertext"), "Submission")(0))

	' Click on the Refresh Approval Status button |Approval History is displayed showing who else needs to approval the expense sheet to be able to submit it for payment Based on Approver List/Approver Profile configuration
	Do While Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebButton("Refresh Approval Status").Exist(5)
		Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebButton("Refresh Approval Status").Click
		Wait 30
	Loop
	WriteToReport micDone, "Clicked the Refresh Approval Status Button", "Successfully clicked Refresh Approval Status", FALSE
	
	arrReportStatus = Split(Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("ExpenseReportID").GetROProperty("innertext"),"    ")

	If arrReportStatus(0) = GlobalDictionary("ExpenseReportID")  Then
		WriteToReport micPass, "Expense Report ID and Status", "Report Id is [" & arrReportStatus(0) & "], with a status of [" &arrReportStatus(1) &"].", FALSE
	End If

	If Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").Exist(90) Then
		WriteToReport micPass, "The Approval History Table Appeared", "Found the Approval Flow", FALSE
	Else
		WriteToReport micFail, "The Approval History Did Not Appear", "The Approval Flow Table took too long to appear", TRUE
		ExitTest
	End If

	'Build a ; delimited string of the user IDs needed to approve from the Approval Flow
	If Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ReceiptVerifier").Exist Then
		If InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ReceiptVerifier").GetROProperty("innertext"),"Verifier")(1)),"Pooled") >0 Then
			sUsernames = Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ReceiptVerifier").GetROProperty("innertext"),"Verifier")(1))
		Else
			sUsernames = dbFetchUserId(Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ReceiptVerifier").GetROProperty("innertext"),"Verifier")(1)))(1)
		End If
		WriteToReport micDone, "The Receipt Verifier is "&Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ReceiptVerifier").GetROProperty("innertext"),"Verifier")(1)), "Found the Receipt Verifier", FALSE
	Else
		sUsernames = "NoReceiptVerifier" 'Add a placeholder
	End If

	'One of the users is Robert, but listed as Bob in the DB
	If InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("HRSupervisor").GetROProperty("innertext"),"Supervisor")(1)), "Robert Swanson") > 0 Then
		sUsernames = sUsernames &";"& dbFetchUserId("Bob Swanson")(1)
	ElseIf InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("HRSupervisor").GetROProperty("innertext"),"Supervisor")(1)), "Steven Moeykens") > 0 Then
		sUsernames = sUsernames &";"& dbFetchUserId("Steve Moeykens")(1)
	ElseIf InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("HRSupervisor").GetROProperty("innertext"),"Supervisor")(1)), "Kayleen Ivers") > 0 Then
		sUsernames = sUsernames &";"& dbFetchUserId("Kayleen M Ivers")(1)
	ElseIf InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("HRSupervisor").GetROProperty("innertext"),"Supervisor")(1)), "Domonique Micou") > 0 Then
		sUsernames = sUsernames &";"& dbFetchUserId("Domonique Hinton")(1)
	Else
		sUsernames = sUsernames &";"& dbFetchUserId(Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("HRSupervisor").GetROProperty("innertext"),"Supervisor")(1)))(1)
	End If
	WriteToReport micDone, "The HR Supervisor is "&Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("HRSupervisor").GetROProperty("innertext"),"Supervisor")(1)), "Found the HR Supervisor", FALSE
	
	If Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseManager").Exist Then
		If InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseManager").GetROProperty("innertext"),"Manager")(1)),"Multiple") > 0 Then
			sUsernames = sUsernames &";"& Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseManager").GetROProperty("innertext"),"Manager")(1))
		ElseIf InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseManager").GetROProperty("innertext"),"Manager")(1)),"Robert Swanson") > 0 Then
			sUsernames = sUsernames &";"& dbFetchUserId("Bob Swanson")(1)
		ElseIf InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseManager").GetROProperty("innertext"),"Manager")(1)), "Kayleen Ivers") > 0 Then
			sUsernames = sUsernames &";"& dbFetchUserId("Kayleen M Ivers")(1)
		ElseIf InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseManager").GetROProperty("innertext"),"Manager")(1)), "Domonique Micou") > 0 Then
			sUsernames = sUsernames &";"& dbFetchUserId("Domonique Hinton")(1)
		Else
			sUsernames = sUsernames &";"& dbFetchUserId(Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseManager").GetROProperty("innertext"),"Manager")(1)))(1)
		End If
		WriteToReport micDone, "The Expense Manager is "&Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseManager").GetROProperty("innertext"),"Manager")(1)), "Found the Expense Manager", FALSE
	ElseIf Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseSRManager").Exist Then
		If InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseSRManager").GetROProperty("innertext"),"Manager")(1)),"Multiple") > 0 Then
			sUsernames = sUsernames &";"& Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseSRManager").GetROProperty("innertext"),"Manager")(1))
		ElseIf InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseSRManager").GetROProperty("innertext"),"Manager")(1)),"Robert Swanson") > 0 Then
			sUsernames = sUsernames &";"& dbFetchUserId("Bob Swanson")(1)
		ElseIf InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseSRManager").GetROProperty("innertext"),"Manager")(1)), "Kayleen Ivers") > 0 Then
			sUsernames = sUsernames &";"& dbFetchUserId("Kayleen M Ivers")(1)
		ElseIf InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseSRManager").GetROProperty("innertext"),"Manager")(1)), "Domonique Micou") > 0 Then
			sUsernames = sUsernames &";"& dbFetchUserId("Domonique Hinton")(1)
		Else
			sUsernames = sUsernames &";"& dbFetchUserId(Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseSRManager").GetROProperty("innertext"),"Manager")(1)))(1)
		End If
		WriteToReport micDone, "The Expense Manager is "&Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseSRManager").GetROProperty("innertext"),"Manager")(1)), "Found the Expense Sr Manager", FALSE
	ElseIf Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseDirector").Exist Then
		If InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseDirector").GetROProperty("innertext"),"Director")(1)),"Multiple") > 0 Then
			sUsernames = sUsernames &";"& Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseDirector").GetROProperty("innertext"),"Director")(1))
		ElseIf InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseDirector").GetROProperty("innertext"),"Director")(1)),"Robert Swanson") > 0 Then
			sUsernames = sUsernames &";"& dbFetchUserId("Bob Swanson")(1)
		ElseIf InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseDirector").GetROProperty("innertext"),"Director")(1)), "Kayleen Ivers") > 0 Then
			sUsernames = sUsernames &";"& dbFetchUserId("Kayleen M Ivers")(1)
		ElseIf InStr(1,Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseDirector").GetROProperty("innertext"),"Director")(1)), "Domonique Micou") > 0 Then
			sUsernames = sUsernames &";"& dbFetchUserId("Domonique Hinton")(1)
		Else
			sUsernames = sUsernames &";"& dbFetchUserId(Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseDirector").GetROProperty("innertext"),"Director")(1)))(1)
		End If
		WriteToReport micDone, "The Expense Director is "&Trim(Split(Browser("PeopleSoft Browser").Page("View Expense Report").PSFrame("TargetContent").WebTable("Approval Flow").WebElement("ExpenseDirector").GetROProperty("innertext"),"Director")(1)), "Found the Expense Director", FALSE
	End If

	If GlobalDictionary.Exists("Approvers") Then
		GlobalDictionary.Remove("Approvers")
	End If
	GlobalDictionary.Add "Approvers", sUsernames
	WriteToReport micDone, "Stored the Approvers as: "&sUsernames, "Stored the users to sign in as during Approval", FALSE

	' Cleanup
	If IsObject(oPage) Then Set oPage = Nothing
	If IsArray (arrBusinessPurpose) Then Erase arrBusinessPurpose
	If IsArray (arrReportDescription) Then Erase arrReportDescription
	If IsArray (arrExpenseDate) Then Erase arrExpenseDate
	If IsArray (arrExpenseType) Then Erase arrExpenseType
	If IsArray (arrExpenseDescription) Then Erase arrExpenseDescription
	If IsArray (arrExpensePaymentType) Then Erase arrExpensePaymentType
	If IsArray (arrExpenseAmount) Then Erase arrExpenseAmount
	If IsArray (arrSelectALocation) Then Erase arrSelectALocation
	If IsArray (arrNonPreferredVendorValue) Then Erase arrNonPreferredVendorValue
	If IsArray (arrGLUnit) Then Erase arrGLUnit
	If IsArray (arrExpenseDept) Then Erase arrExpenseDept
	If IsArray (arrGLUnitVerify) Then Erase arrGLUnitVerify
	If IsArray (arrExpenseDeptVerify) Then Erase arrExpenseDeptVerify
	If IsArray (arrExpReportID) Then Erase arrExpReportID
	If IsArray (aET_Replace) Then Erase aET_Replace
End Function

'**************************************************************************************************************
''' <summary> 
''' 	Add attendees for expense report in PSFIN.
''' </summary>
''' <author>Brian Buckhana</author>
''' <startstate>Details page of expense report.</startstate>
''' <endstate>Details page of expense report with attendees added.</endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function AddAttendees()
	Dim aAttendees, aAttendee
	Dim sName, sCompany, sTitle
	Dim i
	
	aAttendees = Split(GlobalDictionary("CustomerAttendees"), ";")
	
	With Browser("PeopleSoft Browser").Page("Create/Modify Expenses")
		' Click hyperlink.
		If .PSFrame("TargetContent").Link("Attendees").Exist(5) Then
			.PSFrame("TargetContent").Link("Attendees").Click
		Else
			WriteToReport micFail, "'Add Attendees' Hyperlink is Not Visible", "Hyperlink not visible after navigating to the Expense Report details page.", TRUE
		End If
		
		' Verify popup appears.
		If .PSFrame("Attendees").Exist(5) Then
			WriteToReport micPass, "'Add Attendees' Popup Window Is Visible", "Window is visible after clicking 'Add Attendees' hyperlink.", FALSE
		Else
			WriteToReport micFail, "'Add Attendees' Popup Window Is Not Visible", "Window is not visible after clicking 'Add Attendees' hyperlink.", TRUE
		End If
		
		' Add Attendees
		For i = 0 To UBound(aAttendees)
			aAttendee = Split(aAttendees(i), "|")
			sName = aAttendee(0)
			sCompany = aAttendee(1)
			sTitle = aAttendee(2)
			
			' Name
			If NOT(sName = "") Then 
				.PSFrame("Attendees").WebEdit("Name").SetTOProperty "html id", "EX_SHEET_ATT_NAME$" & i
				.PSFrame("Attendees").WebEdit("Name").Set sName
			End If
			
			' Company
			If NOT(sCompany = "") Then
				.PSFrame("Attendees").WebEdit("Company").SetTOProperty "html id", "EX_SHEET_ATT_ATTENDEE_COMPANY$" & i
				.PSFrame("Attendees").WebEdit("Company").Set sCompany
			End If
			
			' Title
			If NOT(sTitle = "") Then
				.PSFrame("Attendees").WebEdit("Title").SetTOProperty "html id", "EX_SHEET_ATT_TITLE$" & i
				.PSFrame("Attendees").WebEdit("Title").Set sTitle
			End If
			
			' Add another row.
			If NOT(i = UBound(aAttendees)) Then	
				.PSFrame("Attendees").WebButton("AddAttendee").Click
			End If
		Next
		
		' Close popup with "OK" button.
		.PSFrame("Attendees").WebButton("OK").Click
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' 	Submit expense report in PSFIN.
''' </summary>
''' <author>Brian Buckhana</author>
''' <startstate>Details page of expense report.</startstate>
''' <endstate>Approval History is displayed showing who else needs to approve the expense sheet.</endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________________________
'	28JAN19		Brian B.		Added navigation confirmation.
'
'______________________________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function ClickSummaryAndSubmit()
	' Click on the Summary and Submit hyperlink	| Create Expense Report - Totals page is displayed
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("SummaryAndSubmit").Click
	WriteToReport micDone, "Clicked the Summary and Submit Link", "Successfully clicked Summary and Submit", FALSE
		
	' Confirm Navigation
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebCheckBox("ByCheckingThis").Exist(15) Then
		WriteToReport micDone, "Successfully Navigated to Summary and Submit Page", "Successfully navigated after clicking the summary and submit link.", FALSE
	Else
		WriteToReport micDone, "Did Not Navigate to Summary and Submit Page", "Did not navigate after clicking the summary and submit link.", TRUE
		ExitTest
	End If
	
	' Check the "By checking this box" checkbox | The Submit Expense Report button is now active 
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebCheckBox("ByCheckingThis").GetROProperty("checked") = 1 Then '1 is checked
		WriteToReport micDone, "Checkbox next to the phrase starting ""By checking this box..."" is Already Checked", "Checkbox is already checked.", FALSE
	Else
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebCheckBox("ByCheckingThis").Click
		If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebCheckBox("ByCheckingThis").GetROProperty("checked") = 1 Then 
			WriteToReport micDone, "Clicked the Checkbox next to the phrase starting ""By checking this box...""", "Successfully clicked the checkbox", FALSE
		Else
			WriteToReport micFail, "Failed to click the Checkbox next to the phrase starting ""By checking this box...""", "Failed to click the checkbox", TRUE
			ExitTest
		End If
	End If

	' Click on the Submit Expense Report button | Expense Report Submit Confirm page is displayed 
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Submit Expense Report").Click
	WriteToReport micDone, "Clicked the Submit Expense Report Button", "Successfully clicked Submit Expense Report", FALSE
End Function

'**************************************************************************************************************
''' <summary> 
''' 	View or Modify expense report in PSFIN.
''' </summary>
''' <author>Brian Buckhana</author>
''' <startstate>Home PSFT screen or recently saved expense report.</startstate>
''' <endstate>Approval History is displayed showing who else needs to approve the expense sheet.</endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function ViewOrModifyExpenseReport()
	Dim sExpReportID, sMessage, sFileLocation, sStatus
	Dim bExpectedStatus, bActualStatus
	Dim aExpReportID, aHeaderAttachments, aLineAttachments, aHeaderAttachmentNames, aLineAttachmentNames
	Dim i 
	Dim nRunCounter
	
	' Grab the run counter that tells how many times this function has run during runtime.
	nRunCounter = GlobalDictionary("ViewOrModifyExpenseReport_RunCounter")
	
	' Grab Expense Report ID to View/Modify.
	sExpReportID = GlobalDictionary("ExpenseReportID")
	
	' Navigation
	If SelectMainMenu1(GlobalDictionary("ViewOrModifyExpenseReport")) = True Then
		WriteToReport micPass, "Expsense Reports Navigation", "Successfully Navigated to Expense Reports page.", False
	Else
		WriteToReport micFail, "Expsense Reports Navigation", "Navigation to Expsense Reports page failed. Exiting test.", True
		ExitTest
	End If
	
	With Browser("PeopleSoft Browser").Page("Create/Modify Expenses")
		' If Search Shows, Set Search Parameters and Search for Expense Report.
		If .PSFrame("TargetContent").WebElement("Find an Existing Value").Exist(10) Then
			WriteToReport micInfo, "Expsense Reports Search Navigation", "Successfully Navigated to Expense Reports Search page.", True
			.PSFrame("TargetContent").WebElement("Find an Existing Value").Click
			
			If .PSFrame("TargetContent").WebEdit("Report ID Search").Exist(10) Then
				.PSFrame("TargetContent").WebEdit("Report ID Search").Set sExpReportID
			ElseIf .PSFrame("TargetContent").WebEdit("Report ID").Exist(10) Then
				.PSFrame("TargetContent").WebEdit("Report ID").Set sExpReportID
			End If
			
			.PSFrame("TargetContent").WebButton("Search").Click
		Else
			WriteToReport micInfo, "Expsense Report With ID [" & sExpReportID & "] Already Open", "Expense report with ID [" & sExpReportID & "] is already open after navigating.", True
		End If
		
		If .PSFrame("TargetContent").WebElement("ExpenseReportID").Exist(20) Then
			sMessage = Trim(.PSFrame("TargetContent").WebElement("ExpenseReportID").GetROProperty("innertext"))
		ElseIf .PSFrame("TargetContent").WebElement("Expense Report Summary ID").Exist(20) Then
			sMessage = Trim(.PSFrame("TargetContent").WebElement("Expense Report Summary ID").GetROProperty("innertext"))
		End If

'		aExpReportID = Split(sMessage,"    ")
		
		If sMessage = sExpReportID Then
			WriteToReport micPass, "View/Modify Expense Report", "Expense Report [" & sExpReportID & "] is displayed.", False	
		End If
		
		' Click Expense Details hyperlink.
		If .PSFrame("TargetContent").Link("Find an Existing Value").Exist(10) Then
			.PSFrame("TargetContent").Link("Find an Existing Value").Click
		End If
	
		' Check if Attachment Header Exists
		If GlobalDictionary.Exists("AttachmentHeaderExists_" & nRunCounter) Then
			bExpectedStatus = CBool(GlobalDictionary("AttachmentHeaderExists"))
			bActualStatus = .PSFrame("TargetContent").Link("Header Attachments").Exist(10)
			
			If bExpectedStatus = bActualStatus Then
				WriteToReport micPass, "Attachment Header Status", "Header Attachment Link Exist Status [" & bActualStatus & "] Matches Expected Status [" & bExpectedStatus & "].", False
			Else
				WriteToReport micFail, "Attachment Header Status", "Header Attachment Link Exist Status [" & bActualStatus & "] Does Not Match Expected Status [" & bExpectedStatus & "].", True
			End If
		End If

		' View
		If GlobalDictionary("ViewOrModifyExpense_" & nRunCounter) = "VIEW" Then
			' Click on Type of Attachment
			If GlobalDictionary("AttachmentType_ViewOrModify_" & nRunCounter) = "Header" Then
				.PSFrame("TargetContent").Link("Header Attachments").Click
				WriteToReport micPass, "Attachment", "Header Attachment Link was clicked.", False
			ElseIf GlobalDictionary("AttachmentType_ViewOrModify_" & nRunCounter) = "Line" Then
				.PSFrame("TargetContent").Link("Line Attachment").Click 
				WriteToReport micPass, "Attachment", "Line Attachment Link was clicked.", False
			End If
			
			If .PSFrame("Expense Report Attachments").Exist(20) Then
				WriteToReport micPass, "Attachment", "Attachment window is displayed.", False	
			Else
				WriteToReport micFail, "Attachment", "Attachment window did not appear.", True				
				ExitTest
			End If
		
			' Check if Add Attachment Button Exists
			If GlobalDictionary.Exists("SheetLineAddAttachmentExists_" & nRunCounter) Then
				bExpectedStatus = CBool(GlobalDictionary("SheetLineAddAttachmentExists_" & nRunCounter))
				bActualStatus = .PSFrame("Expense Report Attachments").WebButton("Add Attachment").Exist(10)
				If bExpectedStatus = bActualStatus Then
					WriteToReport micPass, "Sheet Line Add Attachment Status", "Sheet Line Add Attachment Status Link Exist Status [" & bActualStatus & "] Matches Expected Status [" & bExpectedStatus & "].", False
				Else
					WriteToReport micFail, "Sheet Line Add Attachment Status", "Sheet Line Add Attachment Status Link Exist Status [" & bActualStatus & "] Does Not Match Expected Status [" & bExpectedStatus & "].", True
				End If
			End If
		ElseIf GlobalDictionary("ViewOrModifyExpense_" & nRunCounter) = "MODIFY" Then ' MODIFY
			'Add/Remove attachments.
			sFileLocation = GlobalDictionary("FileLocation_Modify")
			If Not(GlobalDictionary("FileName_Modify_Headers_" & nRunCounter) = "") Then
				.PSFrame("TargetContent").Link("Header Attachments").Click
				WriteToReport micPass, "Attachment", "Header Attachment Link was clicked.", False
				
				aHeaderAttachments = Split(GlobalDictionary("FileName_Modify_Headers_" & nRunCounter), ";")
				For i = 0 To UBound(aHeaderAttachments)
					Call AddAttachment(sFileLocation, aHeaderAttachments(i), i + 1)
				Next
				
				' Click OK to close window.
				.PSFrame("Expense Report Attachments").WebButton("OK").Click
			End If
			
			If Not(GlobalDictionary("FileName_Modify_Lines_" & nRunCounter) = "") Then
				.PSFrame("TargetContent").WebButton("Line Attatchment").Click
				WriteToReport micPass, "Attachment", "Line Attachment Link was clicked.", False
				
				aLineAttachments = Split(GlobalDictionary("FileName_Modify_Lines_" & nRunCounter), ";")
				For i = 0 To UBound(aLineAttachments)
					Call AddAttachment(sFileLocation, aLineAttachments(i), i + 1)
				Next
				
				' Click OK to close window.
				.PSFrame("Expense Report Attachments").WebButton("OK").Click
			End If
		Else ' "VERIFY"
			aHeaderAttachmentNames = Split(GlobalDictionary("VerifyHeaderAttachmentOpens_" & nRunCounter), ";")
			aLineAttachmentNames = Split(GlobalDictionary("VerifyLineAttachmentOpens_" & nRunCounter), ";")
			
			' Header Attachments
			For i = 0 To UBound(aHeaderAttachmentNames)
				If i = 0 Then
					.PSFrame("TargetContent").Link("Header Attachments").Click
					WriteToReport micPass, "Attachment", "Header Attachment Link was clicked.", False
	
					If .PSFrame("Expense Report Attachments").Exist(20) Then
						WriteToReport micPass, "Attachment Window", "Header Attachment window is displayed.", False	
					Else
						WriteToReport micFail, "Attachment Window", "Header Attachment window did not appear.", True				
						ExitTest
					End If
				End If
				
				'Verify files can open.
				.PSFrame("Expense Report Attachments").Link("Attachment document link").SetTOProperty "html id", "VIEWBUTTON$" & i 
				.PSFrame("Expense Report Attachments").Link("Attachment document link").Click
					
				If Browser("PeopleSoft Browser NewTab").WinObject("AVPageView").Exist(20) Then
					WriteToReport micPass, "Attachment Opened", "Header Attachment [" & aHeaderAttachmentNames(i) & "] opened.", False	
					Browser("PeopleSoft Browser NewTab").Close
				Else
					WriteToReport micFail, "Attachment Did Not Open", "Header Attachment [" & aHeaderAttachmentNames(i) & "] did not open.", True				
					ExitTest		
				End If
			Next
			
			' Click OK to close window.
			If .PSFrame("Expense Report Attachments").WebButton("OK").Exist(5) Then
				.PSFrame("Expense Report Attachments").WebButton("OK").Click
			End If
			
			' Lines Attachments
			For i = 0 To UBound(aLineAttachmentNames)
				If i = 0 Then
					.PSFrame("TargetContent").WebButton("Line Attatchment").Click
					WriteToReport micPass, "Attachment", "Line Attachment Link was clicked.", False
					
					If .PSFrame("Expense Report Attachments").Exist(20) Then
						WriteToReport micPass, "Attachment Window", "Line Attachment window is displayed.", False
										
					Else
						WriteToReport micFail, "Attachment Window", "Line Attachment window did not appear.", True				
						ExitTest
					End If
				End If
				
				'Verify files can open.
				.PSFrame("Expense Report Attachments").Link("Attachment document link").SetTOProperty "html id", "VIEWBUTTON$" & i 
				.PSFrame("Expense Report Attachments").Link("Attachment document link").Click
					
				If Browser("PeopleSoft Browser NewTab").WinObject("AVPageView").Exist(20) Then
					WriteToReport micPass, "Attachment Opened", "Line Attachment [" & aLineAttachmentNames(i) & "] opened.", False
					Browser("PeopleSoft Browser NewTab").Close							
				Else
					WriteToReport micFail, "Attachment Did Not Open", "Line Attachment [" & aLineAttachmentNames(i) & "] did not open.", True				
					ExitTest		
				End If
			Next
		End If
		
		' Click OK to close window.
		If .PSFrame("Expense Report Attachments").WebButton("OK").Exist(5) Then
			.PSFrame("Expense Report Attachments").WebButton("OK").Click
		End If
	
		' Click on the "Save for Later" hyperlink
		If GlobalDictionary("SaveForLater_Modify_" & nRunCounter) = "TRUE" Then
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("Save for Later").Click
			
			'Pull out Expense Report ID and status
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("ExpenseReportID").Exist(20) Then
				sMessage =  Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("ExpenseReportID").GetROProperty("innertext")
				aExpReportID = Split(sMessage,"    ")		
				sExpReportID = aExpReportID(0)
				sStatus = aExpReportID(1)	
				WriteToReport micPass, "Expense Report", "Expense Report [" & sExpReportID & "] has been created and Saved for Later and has a status of [" & sStatus & "].", False
				
				' Export ID to Global Dictionary
				If GlobalDictionary.Exists("ExpenseReportID") Then
					GlobalDictionary.Remove("ExpenseReportID")
				End If
				
				GlobalDictionary.Add "ExpenseReportID", sExpReportID
			Else
				WriteToReport micFail, "Expense Report", "Expense Report failed to Save.", True
				ExitTest			
			End If
		End If
	End With
	' Raise run counter and export.
	If GlobalDictionary.Exists("ViewOrModifyExpenseReport_RunCounter") Then
		GlobalDictionary.Remove("ViewOrModifyExpenseReport_RunCounter")
	End If
	
	GlobalDictionary.Add "ViewOrModifyExpenseReport_RunCounter", nRunCounter + 1
	
	' Cleanup 	
	If IsArray (aExpReportID) Then Erase aExpReportID
	If IsArray (aHeaderAttachments) Then Erase aHeaderAttachments
	If IsArray (aLineAttachments) Then Erase aLineAttachments
	If IsArray (aHeaderAttachmentNames) Then Erase aHeaderAttachmentNames
	If IsArray (aLineAttachmentNames) Then Erase aLineAttachmentNames
End Function

'**************************************************************************************************************
''' <summary> 
''' Cycles thru approvals for an Expense Report in PSFIN.
''' </summary>
''' <author>Eric Trout</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'19Mar2019			Eric Trout	Updated so Approver is found via SQL due to not all approvers show in flow shown in Expense Report
'**************************************************************************************************************
Public Function ApproveExpenseReport
	Dim aApprovers(20), arrResult
	Dim bSkip, bArray
	Dim i

	i = 0
	bArray = False

	Do While bArray = FALSE
	
		bSkip = FALSE
	
		'use Query to get user
		    arrResult = dbExpApprover(GlobalDictionary("ExpenseReportID"))

			On Error Resume Next
			bArray = IsArrayEmpty(arrResult)
			
			If bArray = FALSE Then
				On Error Goto 0
				WriteToReport micPass, "Expense Approver", "SQL query successfully executed. Values were returned with query.", False
			Else
				On Error Goto 0
				'WriteToReport micFail, "Expense Approver", "SQL query unsuccessfully executed. No values were returned with query and the test will stop.", False
				'ExitTest 
				Exit Do
			End If
			
			aApprovers(i) = arrResult(2)
		
		wait(2)
		If i <> 0 Then 
			If aApprovers(i) = aApprovers(i-1) Then
				WriteToReport micDone, "The Previous UserID is the same as the Current ["&aApprovers(i)&"], and Auto-approved the Expense", "Skipping User", FALSE
				bSkip = TRUE
			End If
		End If
		
		If NOT bSkip Then
			Call Login(aApprovers(i))
			
			'Navigate to the Travel and Expense>Approve Transactions>Approve Transactions
			If SelectMainMenu1(GlobalDictionary("ApproveExpenseReport")) = True Then
				WriteToReport micPass, "ApproveTransactions Page", "On the Approve Transactions page.", False
			Else
				WriteToReport micFail, "ApproveTransactions Page", "Navigation to Approve Transactions page failed. Exiting test.", True
				ExitTest
			End If	
			If Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebElement("Search Pending Transactions").Exist(30) Then
				Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebElement("Search Pending Transactions").Click
				WriteToReport micDone, "Clicked the Search Pending Transactions Dropdown", "Clicked Search Pending Transactions", FALSE
			Else
				WriteToReport micFail, "Could Not Locate Search Pending Transactions Dropwdown", "Could not click Search Pending Transactions", TRUE
				ExitTest
			End If

			Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebList("COLUMN NAME").Select "Transaction ID"
			Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebList("EXPRESSION").Select "="
			Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebEdit("Criteria").Set GlobalDictionary("ExpenseReportID")
			Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebButton("Search").Click
			Wait 2
			Browser("PeopleSoft Browser").Sync

			'Check to see if result was returned, if not link will not exist and fail test
			If Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").Link("Transaction ID First Row").Exist(30) Then
				Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").Link("Transaction ID First Row").Click
			Else
				WriteToReport micFail, "Transactions", "Could not find Expense Report [" &GlobalDictionary("ExpenseReportID")&"], check to make sure the correct user is being used.  [" & aApprovers(i) &"] ", TRUE
				ExitTest
			End If
			
			
			If i=0 Then
				Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Expense Report").WebButton("Verify Receipt").Click
				WriteToReport micDone, "Clicked the Verify Receipt Button", "Successfully clicked Verify Receipt", FALSE
			Else
				Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Expense Report").WebButton("Approve").Click
				WriteToReport micDone, "Clicked the Approve Button", "Successfully clicked Approve", FALSE
			End If

			If Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Save Confirmation").WebButton("OK").Exist(90) Then
				Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Save Confirmation").WebButton("OK").Click
				WriteToReport micDone, "Clicked the OK Button after Verifying the Receipt", "Successfully Clicked OK", FALSE
			End If
		End If
			
			wait(20)  'system needs time to update Approver
			arrResult = dbExpApprover(GlobalDictionary("ExpenseReportID"))

			On Error Resume Next
			bArray = IsArrayEmpty(arrResult)
				If bArray = FALSE Then
					'On Error Goto 0
					'WriteToReport micPass, "Expense Approver", "SQL query successfully executed. Values were returned with query.", False
				Else
					On Error Goto 0
					'WriteToReport micFail, "Expense Approver", "SQL query unsuccessfully executed. No values were returned with query and the test will stop.", False
					'ExitTest 
					Exit Do
				End If
				i=i+1

	Loop
	'Check the database for the expense report and that it is approved
	Wait 5
	If IsArray(dbFindApprovedExpense(GlobalDictionary("ExpenseReportID"), aApprovers(i))) Then
		If dbFindApprovedExpense(GlobalDictionary("ExpenseReportID"), aApprovers(i))(2) = "APR" OR dbFindApprovedExpense(GlobalDictionary("ExpenseReportID"), aApprovers(i))(2) = "AUT" Then
			WriteToReport micPass, "Found Expense Report ["&GlobalDictionary("ExpenseReportID")&"] Approved in the Database", "Found Approved Expense", FALSE
		Else
			WriteToReport micFail, "Did Not Find Expense Report ["&GlobalDictionary("ExpenseReportID")&"] Approved in the Database", "Could not find Approved Expense", FALSE
		End If
	Else
		WriteToReport micFail, "Did Not Find Expense Report ["&GlobalDictionary("ExpenseReportID")&"] With Approver ["&aApprovers(i)&"] in the Database", "Could not find Expense", FALSE
	End If
End Function

'EX 17.06
Private Function SplitExpenses(iteration) 
	Dim arrExpenses,arrGLUnit,arrGLUnitVerify,arrExpenseDept,arrExpenseDeptVerify
	Dim j
	Dim sGLUnit, sGLUnitVerify,	sExpenseDept,sExpenseDeptVerify,sSplitAmount, sCurrentValue
	arrExpenses = Split(GlobalDictionary("Splits"&iteration),";")
	arrGLUnit = Split(GlobalDictionary("GLUnit"), ";")
	arrExpenseDept = Split(GlobalDictionary("ExpenseDept"), ";")
	arrGLUnitVerify = Split(GlobalDictionary("GLUnitVerify"), ";")
	arrExpenseDeptVerify = Split(GlobalDictionary("ExpenseDeptVerify"), ";")

	For j=0 To UBound(arrExpenses)
		sGLUnit = arrGLUnit(j)
		sGLUnitVerify = arrGLUnitVerify(j)
		sExpenseDept = arrExpenseDept(j)
		sExpenseDeptVerify = arrExpenseDeptVerify(j)
		sSplitAmount = arrExpenses(j)

		' Split Amount
		Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("SplitExpense").SetTOProperty("name", "EX_SHEET_DIST_TXN_AMOUNT$"&j+(iteration*(1+UBound(arrExpenses))))
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("SplitExpense").Set sSplitAmount

		' GL UNIT / GL BU
			If NOT(sGLUnit = "") Then
				Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("GLUnit").SetTOProperty("name", "EX_SHEET_DIST_BUSINESS_UNIT_GL$"&j+(iteration*(1+UBound(arrExpenses))))
				' Expand Accounting Details to make objects visible.
				If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("GLUnit").Exist(5) Then
					Call WriteToReport(micInfo, "Accounting Details Already Expanded for GL Unit", "GL Unit is Visible.", True)
				Else
					Call WriteToReport(micInfo, "Accounting Details Not Expanded for GL Unit", "Expanding Accounting Details.", True)
					Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Image("Expand Accounting Details").Click
				End If
				
				If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("GLUnit").Exist(5) Then
					' Verify the current value in the field and/or edit it.
					sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("GLUnit").GetROProperty("value")
					Select Case UCase(sGLUnitVerify)
						Case "VERIFY"
							' Verify value matches correctly.
							If CStr(sCurrentValue) = sGLUnit Then
								Call WriteToReport(micPass, "GL Unit [" & sCurrentValue & "] Matches Expected Value", "GL Unit [" & sCurrentValue & "] macthes expected value [" & sGLUnit & "].", True)
							Else
								Call WriteToReport(micFail, "GL Unit [" & sGLUnit & "] Does Not Match Expected Value", "Expected Value / Input [" & sGLUnit & "] does not match Current Value in field [" & sCurrentValue & "].", True)
							End If
						Case "EDIT"
							Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("GLUnit").Set sGLUnit
							
							' Verify value was entered correctly.
							If CStr(sCurrentValue) = sGLUnit Then
								Call WriteToReport(micPass, "Successfully Set GL Unit [" & sCurrentValue & "]", "Successfully set GL Unit [" & sCurrentValue & "] with input [" & sGLUnit & "].", True)
							Else
								Call WriteToReport(micFail, "Failed to Set GL Unit [" & sGLUnit & "]", "Expected Value / Input [" & sGLUnit & "] | Current Value in field [" & sCurrentValue & "].", True)
							End If
						Case "VERIFYANDEDIT"
							' Verify value matches correctly.
							If CStr(sCurrentValue) = sGLUnit Then
								Call WriteToReport(micPass, "GL Unit [" & sCurrentValue & "] Matches Expected Value", "GL Unit [" & sCurrentValue & "] macthes expected value [" & sGLUnit & "].", True)
							Else
								Call WriteToReport(micWarning, "GL Unit [" & sGLUnit & "] Does Not Match Expected Value", "Expected Value / Input [" & sGLUnit & "] does not match Current Value in field [" & sCurrentValue & "].", True)
								
								Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("GLUnit").Set sGLUnit
								sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("GLUnit").GetROProperty("value")
								' Verify value was entered correctly.
								If CStr(sCurrentValue) = sGLUnit Then
									Call WriteToReport(micPass, "Successfully Set GL Unit [" & sCurrentValue & "]", "Successfully set GL Unit [" & sCurrentValue & "] with input [" & sGLUnit & "].", True)
								Else
									Call WriteToReport(micFail, "Failed to Set GL Unit [" & sGLUnit & "]", "Expected Value / Input [" & sGLUnit & "] | Current Value in field [" & sCurrentValue & "].", True)
								End If
							End If
						Case ""
							Call WriteToReport(micInfo, "Skipping Verify/Edit for GL Unit [" & sGLUnit & "]", "Verify/Edit setting was [" & sGLUnitVerify & "] for GL Unit [" & sGLUnit & "].", True)
						Case Else
							Call WriteToReport(micFail, "GL Unit Verify/Edit Case Does Not Exist For Value [" & sGLUnitVerify & "]", "Check the cases or your input.", True)
					End Select
				Else
					Call WriteToReport(micFail, "Failed to Set GL Unit [" & sGLUnit & "]", "Field was not visible in time.", True)
				End If
			End If
			
			' EXPENSE DEPARTMENT
			If NOT(sExpenseDept = "") Then	
				Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Dept").SetTOProperty("name", "EX_SHEET_DIST_DEPTID$"&j+(iteration*(1+UBound(arrExpenses))))
				If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Dept").Exist(5) Then
					Call WriteToReport(micInfo, "Accounting Details Already Expanded for Expense Dept", "Expense Dept is Visible.", True)
				Else
					Call WriteToReport(micInfo, "Accounting Details Not Expanded for Expense Dept", "Expanding Accounting Details.", True)
					Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Image("Expand Accounting Details").Click
				End If
				
				If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Dept").Exist(5) Then
					' Verify the current value in the field and/or edit it.
					sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Dept").GetROProperty("value")
					Select Case UCase(sExpenseDeptVerify)
						Case "VERIFY"
							' Verify value matches correctly.
							If CStr(sCurrentValue) = sExpenseDept Then
								Call WriteToReport(micPass, "Expense Dept [" & sCurrentValue & "] Matches Expected Value", "Expense Dept [" & sCurrentValue & "] macthes expected value [" & sExpenseDept & "].", True)
							Else
								Call WriteToReport(micFail, "Expense Dept [" & sExpenseDept & "] Does Not Match Expected Value", "Expected Value / Input [" & sExpenseDept & "] does not match Current Value in field [" & sCurrentValue & "].", True)
							End If
						Case "EDIT"
							Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Dept").Set sExpenseDept
							Wait 2
							
							' Verify value was entered correctly.
							If CStr(sCurrentValue) = sExpenseDept Then
								Call WriteToReport(micPass, "Successfully Set Expense Dept [" & sCurrentValue & "]", "Successfully set Expense Dept [" & sCurrentValue & "] with input [" & sExpenseDept & "].", True)
							Else
								Call WriteToReport(micFail, "Failed to Set Expense Dept [" & sExpenseDept & "]", "Expected Value / Input [" & sExpenseDept & "] | Current Value in field [" & sCurrentValue & "].", True)
							End If
						Case "VERIFYANDEDIT"
							' Verify value matches correctly.
							If CStr(sCurrentValue) = sExpenseDept Then
								Call WriteToReport(micPass, "Expense Dept [" & sCurrentValue & "] Matches Expected Value", "Expense Dept [" & sCurrentValue & "] macthes expected value [" & sExpenseDept & "].", True)
							Else
								Call WriteToReport(micWarning, "Expense Dept [" & sCurrentValue & "] Does Not Match Expected Value", "Expected Value / Input [" & sExpenseDept & "] does not match Current Value in field [" & sCurrentValue & "].", True)
								
								Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Dept").Set sExpenseDept
								Wait 2
								sCurrentValue = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Dept").GetROProperty("value")
								' Verify value was entered correctly.
								If CStr(sCurrentValue) = sExpenseDept Then
									Call WriteToReport(micPass, "Successfully Set Expense Dept [" & sCurrentValue & "]", "Successfully set Expense Dept [" & sCurrentValue & "] with input [" & sExpenseDept & "].", True)
								Else
									Call WriteToReport(micFail, "Failed to Set Expense Dept [" & sExpenseDept & "]", "Expected Value / Input [" & sExpenseDept & "] | Current Value in field [" & sCurrentValue & "].", True)
								End If
							End If
						Case ""
							Call WriteToReport(micInfo, "Skipping Verify/Edit for Expense Dept [" & sExpenseDept & "]", "Verify/Edit setting was [" & sExpenseDeptVerify & "] for Expense Dept [" & sExpenseDept & "].", True)
						Case Else
							Call WriteToReport(micFail, "Expense Dept Verify/Edit Case Does Not Exist For Value [" & sExpenseDeptVerify & "]", "Check the cases or your input.", True)
					End Select
				Else
					Call WriteToReport(micFail, "Failed to Set Expense Dept [" & sExpenseDept & "]", "Field was not visible in time.", True)
				End If
			End If
		If j <>UBound(arrExpenses) Then
			Call Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Split Expense +").SetTOProperty("name", "EX_SHEET_DIST_$new"&j+(iteration*(1+UBound(arrExpenses)))&"$$0")
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Split Expense +").Click
		End If
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Creates Pending Expense Report, Adds 2 Header or 2 Line Attachment, Deletes 1 Attachment and adds another, then verifies attachments can be opened.
''' </summary>
''' <author>Eric Trout</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'	24JAN19		Brian B.		Employee ID auto populated pass incorrectly said "failed".  Fixed.
'**************************************************************************************************************
Public Function PendingExpenseAttachHDRorLine

Dim aExpReportID, aNumAttachments
Dim i 
Dim sEmployeeID, sExpReportID, sFileName, sMessage, sNumAttachments, sStatus 

				
	'Navigate to the Employee Self-Service>Travel and Expenses>Expense Reports>Create/Modify page
	If SelectMainMenu1(GlobalDictionary("AddExpenseReport")) = True Then
		WriteToReport micPass, "Expense Report Page", "On the Expense Report page.", False
	Else
		WriteToReport micFail, "Expense Report Page", "Navigation to Expense Report page failed. Exiting test.", True
		ExitTest
	End If	
	
	With Browser("PeopleSoft Browser").Page("Create/Modify Expenses")

		'Verify Employee ID is auto-filled. 
		If .PSFrame("TargetContent").WebEdit("Employee ID").Exist(10) Then
			sEmployeeID = .PSFrame("TargetContent").WebEdit("Employee ID").GetROProperty("value")
			If NOT(sEmployeeID = "") OR NOT(isEmpty(sEmployeeID)) Then
				WriteToReport micPass, "Employee ID Successfully Auto-Populated", "Employee ID [" & sEmployeeID & "] was auto-populated after navigating to Expense Report page.", False
			Else
				WriteToReport micFail, "Employee ID Failed to Auto-Populate", "Employee ID [" & sEmployeeID & "] failed to auto-populate after navigating to Expense Report page.", True
				ExitTest
			End If
		Else
			WriteToReport micFail, "Expense Report Page", "Navigation to Expense Report page failed to load. Exiting test.", True
		End If
		
		' Click the "Add" button to create a new expense report.
		If .PSFrame("TargetContent").WebButton("Add").Exist(10) Then
			.PSFrame("TargetContent").WebButton("Add").Click
		Else
			WriteToReport micFail, "Expense Report Page", "Navigation to Expense Report page failed to load. Exiting test.", True
			ExitTest
		End If
		
		' Verify page navigation.
		If .PSFrame("TargetContent").WebList("Business Purpose").Exist(20) Then
			WriteToReport micPass, "Create Expense Report Page", "On the Create Expense Report page.", False
		Else
			WriteToReport micFail, "Create Expense Report Page", "Create Expense Report page failed to load. Exiting Test", True
			ExitTest
		End  If
		
		.PSFrame("TargetContent").WebList("Business Purpose").Select GlobalDictionary("BusinessPurpose")
		.PSFrame("TargetContent").WebEdit("Report Description").Set GlobalDictionary("ReportDescription")
		.PSFrame("TargetContent").WebEdit("Expense Date").Set Date()
		.PSFrame("TargetContent").WebList("Expense Type").Select GlobalDictionary("ExpenseType")
		.PSFrame("TargetContent").WebEdit("Expense Description").Set GlobalDictionary("ExpenseDescription")
		.PSFrame("TargetContent").WebList("Expense Payment Type").Select GlobalDictionary("ExpensePaymentType")
		.PSFrame("TargetContent").WebEdit("Expense Amount").Set GlobalDictionary("ExpenseAmount")
		.PSFrame("TargetContent").WebEdit("Select A Location").Set GlobalDictionary("SelectALocation")
		.PSFrame("TargetContent").WebEdit("Non Preferred Vendor Value").Set GlobalDictionary("NonPreferredVendorValue")
		
		'Add Type of Attachment
		If GlobalDictionary("AttachmentType") = "Header" Then
			.PSFrame("TargetContent").Link("Header Attachments").Click
			WriteToReport micPass, "Attachment", "Header Attachment Link was clicked.", False
		ElseIF GlobalDictionary("AttachmentType") = "Line" Then
			.PSFrame("TargetContent").WebButton("Line Attatchment").Click
			WriteToReport micPass, "Attachment", "Line Attachment Link was clicked.", False
		End If
	
		If .PSFrame("Expense Report Attachments").Exist(30) Then
			WriteToReport micPass, "Attachment", "Attachment window is displayed.", False	
		Else
			WriteToReport micFail, "Attachment", "Attachment window did not appear.", True				
			ExitTest
		End If
	
		'Add Two Attachments	
	
			sFileName = GlobalDictionary("FileName1") 
			AddAttachment GlobalDictionary("FilePath"), sFileName, 1

			sFileName = GlobalDictionary("FileName2") 
			AddAttachment GlobalDictionary("FilePath"), sFileName, 2
		
		'Delete second file and verify Delete Confirmation 
		RemoveAttachment "2"
			
		'Add another attachment **Attatchment 3**
		
			sFileName = GlobalDictionary("FileName3") 
			AddAttachment GlobalDictionary("FilePath"), sFileName, "2"

		'Exit Attatchments
		.PSFrame("Expense Report Attachments").WebButton("OK").Click
		
		.PSFrame("TargetContent").Link("Save for Later").Click
		
		If .PSFrame("TargetContent").WebElement("ExpenseReportID").Exist(20) Then
			'Pull out Expense Report ID and status
			sMessage = .PSFrame("TargetContent").WebElement("ExpenseReportID").GetROProperty("innertext")
			aExpReportID = Split(sMessage,"    ")		
			sExpReportID = aExpReportID(0)
			sStatus = aExpReportID(1)	
			WriteToReport micPass, "Expense Report", "Expense Report [" & sExpReportID & "] has been created and Saved for Later and has a status of [" &sStatus &"].", False
		Else
			WriteToReport micFail, "Expense Report", "Expense Report failed to Save.", True
			ExitTest			
		End If
				
		'Add Type of Attachment
		If GlobalDictionary("AttachmentType") = "Header" Then
			sNumAttachments = .PSFrame("TargetContent").Link("Header Attachments").GetROProperty("innertext")
						
		ElseIF GlobalDictionary("AttachmentType") = "Line" Then
			.PSFrame("TargetContent").WebButton("Line Attatchment").Click
			sNumAttachments= .PSFrame("TargetContent").Image("Line Attachment").GetROProperty("alt")
		End If

			aNumAttachments = Split(sNumAttachments,"(")	
			sNumAttachments = Replace(aNumAttachments(1),")","")


		'Add Type of Attachment
		If GlobalDictionary("AttachmentType") = "Header" Then
			If sNumAttachments = "2" Then
				WriteToReport micPass, "Header Attachments", "[" & sNumAttachments & "] are displayed in the Header Attachments link.", False
			Else 
				WriteToReport micFail, "Header Attachments", "Header Attachments are not displayed in the Header Attachments Link.", True
				ExitTest	
			End If
		ElseIF GlobalDictionary("AttachmentType") = "Line" Then
			.PSFrame("TargetContent").WebButton("Line Attatchment").Click
		End If		

		'Navigate to the Employee Self-Service>Travel and Expenses>Expense Reports>Create/Modify page
	If SelectMainMenu1(GlobalDictionary("AddExpenseReport")) = True Then
		WriteToReport micPass, "Expense Report Page", "On the Expense Report page.", False
	Else
		WriteToReport micFail, "Expense Report Page", "Navigation to Expense Report page failed. Exiting test.", True
		ExitTest
	End If	
	
		.PSFrame("TargetContent").Link("Find an Existing Value").Click
	
		.PSFrame("TargetContent").WebEdit("Report ID").Set sExpReportID
	
		.PSFrame("TargetContent").WebButton("Search").Click

		If .PSFrame("TargetContent").WebElement("ExpenseReportID").Exist(20) Then
			sMessage = .PSFrame("TargetContent").WebElement("ExpenseReportID").GetROProperty("innertext")
		End If

		aExpReportID = Split(sMessage,"    ")
		
		If aExpReportID(0) = sExpReportID Then
			WriteToReport micPass, "Expense Report", "Expense Report [" &sExpReportID & "] is displayed.", False	
		End If
		
		'Click on Type of Attachment
		If GlobalDictionary("AttachmentType") = "Header" Then
			.PSFrame("TargetContent").Link("Header Attachments").Click
			WriteToReport micPass, "Attachment", "Header Attachment Link was clicked.", False
		ElseIF GlobalDictionary("AttachmentType") = "Line" Then
			.PSFrame("TargetContent").WebButton("Line Attatchment").Click
			WriteToReport micPass, "Attachment", "Line Attachment Link was clicked.", False
		End If
	
		If .PSFrame("Expense Report Attachments").Exist(60) Then
			WriteToReport micPass, "Attachment", "Attachment window is displayed.", False	
		Else
			WriteToReport micFail, "Attachment", "Attachment window did not appear.", True				
			ExitTest
		End If
		
		sFileName = GlobalDictionary("FileName1") 
		VerifyAttachment sFileName,"1","True" 

		
		sFileName = GlobalDictionary("FileName3")
		VerifyAttachment sFileName,"2","True" 

	
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Verifies the Receipt of an Expense Report as the Receipt Verifier
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function VerifyReceipt
	Dim aApprovers
	Dim sVerifier

	aApprovers = Split(GlobalDictionary("Approvers"), ";")
	sVerifier = aApprovers(0)

	If sVerifier = "(Pooled)" Then
		sVerifier = GlobalDictionary("PooledLogin")
	End If

	Call Login(sVerifier)

	'Navigate to the Travel and Expense>Approve Transactions>Approve Transactions
	If SelectMainMenu1(GlobalDictionary("ApproveExpenseReport")) = True Then
		WriteToReport micPass, "ApproveTransactions Page", "On the Approve Transactions page.", False
	Else
		WriteToReport micFail, "ApproveTransactions Page", "Navigation to Approve Transactions page failed. Exiting test.", True
		ExitTest
	End If

	If Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebElement("Search Pending Transactions").Exist(30) Then
		Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebElement("Search Pending Transactions").Click
		WriteToReport micDone, "Clicked the Search Pending Transactions Dropdown", "Clicked Search Pending Transactions", FALSE
	Else
		WriteToReport micFail, "Could Not Locate Search Pending Transactions Dropwdown", "Could not click Search Pending Transactions", TRUE
		ExitTest
	End If

	Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebList("COLUMN NAME").Select "Transaction ID"

	Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebList("EXPRESSION").Select "="

	Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebEdit("Criteria").Set GlobalDictionary("ExpenseReportID")

	Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebButton("Search").Click

	Wait 2

	Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").Link("Transaction ID First Row").Click

	Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Expense Report").WebButton("Verify Receipt").Click
	WriteToReport micDone, "Clicked the Verify Receipt Button", "Successfully clicked Verify Receipt", FALSE

	If Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Save Confirmation").WebButton("OK").Exist(90) Then
		Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Save Confirmation").WebButton("OK").Click
		WriteToReport micDone, "Clicked the OK Button after Verifying the Receipt", "Successfully Clicked OK", FALSE
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Signs in at the Manager level and goes through the Worklist to approve expense reports. 
''' A Receipt must have been verified by a Receipt Verifier or attached
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'22Mar2019			Eric Trout	Updated so Approver is found via SQL due to not all approvers show in flow shown in Expense Report
'**************************************************************************************************************
Public Function WorkListApproveExpense 'EX 17.x
	Dim aApprovers(20), arrTemp, bArray, arrResult, aApprovers_Exp 
	Dim sVerifier
	Dim i
	Dim bSkip
	Dim oLink

	i = 0
	bArray = FALSE

	'Needed due to auto approvals
	wait(20)
	
	'Approval is after verifying the receipt (index 0)
	Do While bArray = FALSE
		bSkip = FALSE
	
		'use Query to get user
		arrResult = dbExpApprover(GlobalDictionary("ExpenseReportID"))

		On Error Resume Next
		bArray = IsArrayEmpty(arrResult)
		
		If bArray = FALSE Then
			On Error Goto 0
			WriteToReport micPass, "Expense Approver", "SQL query successfully executed. Values were returned with query.", False
		Else
			On Error Goto 0
			Exit Do
		End If
		
		aApprovers(i) = arrResult(2)

		wait(2)
		If i <> 0 Then 
			If aApprovers(i) = aApprovers(i-1) Then
				WriteToReport micDone, "The Previous UserID is the same as the Current ["&aApprovers(i)&"], and Auto-approved the Expense", "Skipping User", FALSE
				bSkip = TRUE
			End If
		End If

		If NOT bSkip Then
			Call Login(aApprovers(i))
			'Navigate to the Worklist>Worklist page
			If SelectMainMenu1(GlobalDictionary("Worklist")) = True Then
				WriteToReport micPass, "Worklist Page", "On the Worklist page.", False
			Else
				WriteToReport micFail, "Worklist Page", "Navigation to Worklist page failed. Exiting test.", True
				ExitTest
			End If

			'Sort the Worklist table by 'Date From' in descending order
			If Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist").Link("DateFrom").Exist(15) Then
				Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist").Link("DateFrom").Click
				Wait 5
				Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist").Link("DateFrom").Click
				WriteToReport micDone, "Clicked the Date From Column Header Twice", "Successfully sorted the Worklist items in descending order by Date", FALSE
			Else
				WriteToReport micFail, "Could Not Find the 'Date From' Column Header", "Did not Click the 'Date From' link", TRUE
				ExitTest
			End If
			
			'Find the Expense Report ID and click it
			Set oLink = Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist").WebElement("Link")
			Call oLink.SetTOProperty("innertext", ".*"&GlobalDictionary("ExpenseReportID")&".*")
			If oLink.Exist(15) Then
				oLink.Click
				WriteToReport micDone, "Found and Clicked the Expense Report: "&GlobalDictionary("ExpenseReportID"),"Opened the Expense Report", FALSE
			Else
				WriteToReport micFail, "Did Not Find the Expense Report: "&GlobalDictionary("ExpenseReportID"), "Failed to find the Expense Report", TRUE
				ExitTest
			End If

			'Check for attachment, if any
			If GlobalDictionary("HasAttachment") = "TRUE" Then
				Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Expense Report").Link("Attachments").Click
				WriteToReport micDone, "Clicked Attachments Link", "Successfully clicked Attachments", FALSE
				Set oLink = Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Expense Report Attachments").Link("Attachment")
				arrTemp = Split(GlobalDictionary("FileName"), "\")
				Call oLink.SetTOProperty("innertext", arrTemp(UBound(arrTemp))) 
				If oLink.Exist(5) Then
					WriteToReport micPass, "Found Attached File: "&GlobalDictionary("FileName"), "Successfully found attached file as Expected", FALSE
				Else
					WriteToReport micFail, "Could Not Locate Expected File: "&GlobalDictionary("FileName"), "File not Found", TRUE
					ExitTest
				End If
				Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Expense Report Attachments").WebButton("Cancel").Click
				WriteToReport micDone, "Clicked the Cancel Button", "Successfully Clicked Cancel", FALSE
			End If

			'Approve
			If Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Expense Report").WebButton("Approve").Exist(10) Then
				Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Expense Report").WebButton("Approve").Click
				WriteToReport micDone, "Clicked the Approve Button", "Successfully clicked Approve", FALSE
			Else
				WriteToReport micFail, "did Not Find the Approve Button", "Failed to Approve the Expense Report", TRUE
				ExitTest
			End If

			If Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Save Confirmation").WebButton("OK").Exist(90) Then
				Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Save Confirmation").WebButton("OK").Click
				WriteToReport micDone, "Clicked the OK Button after Verifying the Receipt", "Successfully Clicked OK", FALSE
			Else
				WriteToReport micFail, "Did Not Find the OK Button", "The OK Button took too long to appear", TRUE
				ExitTest
			End If
		End If
		
		wait(20)  'system needs time to update Approver
		arrResult = dbExpApprover(GlobalDictionary("ExpenseReportID"))

		On Error Resume Next
		bArray = IsArrayEmpty(arrResult)
		
		If bArray = FALSE Then
			'On Error Goto 0
			'WriteToReport micPass, "Expense Approver", "SQL query successfully executed. Values were returned with query.", False
		Else
			On Error Goto 0
			'WriteToReport micFail, "Expense Approver", "SQL query unsuccessfully executed. No values were returned with query and the test will stop.", False
			'ExitTest 
			Exit Do
		End If
		i=i+1
		
	Loop
	'Check the database for the expense report
	Wait 5
	If IsArray(dbFindApprovedExpense(GlobalDictionary("ExpenseReportID"), aApprovers(i))) Then
		If dbFindApprovedExpense(GlobalDictionary("ExpenseReportID"), aApprovers(i))(2) = "APR" OR dbFindApprovedExpense(GlobalDictionary("ExpenseReportID"), aApprovers(i))(2) = "AUT" Then
			WriteToReport micPass, "Found Expense Report ["&GlobalDictionary("ExpenseReportID")&"] Approved in the Database", "Found Approved Expense", FALSE
		Else
			WriteToReport micFail, "Did Not Find Expense Report ["&GlobalDictionary("ExpenseReportID")&"] Approved in the Database", "Could not find Approved Expense", FALSE
		End If
	Else
		WriteToReport micFail, "Did Not Find Expense Report ["&GlobalDictionary("ExpenseReportID")&"] With Approver ["&aApprovers(i)&"] in the Database", "Could not find Expense", FALSE
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Attempts to Find and Approve an expense report created by the same user
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function NegativeTestSelfApprove 'EX 17.09

	'Navigate to the Travel and Expense>Approve Transactions>Approve Transactions
	If SelectMainMenu1(GlobalDictionary("ApproveExpenseReport")) = True Then
		WriteToReport micPass, "ApproveTransactions Page", "On the Approve Transactions page.", False
	Else
		WriteToReport micFail, "ApproveTransactions Page", "Navigation to Approve Transactions page failed. Exiting test.", True
		ExitTest
	End If

	If Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebElement("Search Pending Transactions").Exist(30) Then
		Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebElement("Search Pending Transactions").Click
		WriteToReport micDone, "Clicked the Search Pending Transactions Dropdown", "Clicked Search Pending Transactions", FALSE
	Else
		WriteToReport micFail, "Could Not Locate Search Pending Transactions Dropwdown", "Could not click Search Pending Transactions", TRUE
		ExitTest
	End If

	Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebList("COLUMN NAME").Select "Transaction ID"

	Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebList("EXPRESSION").Select "="

	Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebEdit("Criteria").Set GlobalDictionary("ExpenseReportID")

	Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebButton("Search").Click

	Wait 2

	If Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").Link("Transaction ID First Row").Exist Then
		WriteToReport micFail, "Found Own Expense Report: "&GlobalDictionary("ExpenseReportID"), "Found Own Expense Report to Approve", TRUE
		ExitTest
	Else
		WriteToReport micPass, "Did Not Find Own Expense Report: "&GlobalDictionary("ExpenseReportID"), "Did not find own expense report to approve", FALSE
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Attach a receipt to a given report without one. 1.01
''' </summary>
''' <author>Stephen King</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function AttachReceipts

	'Navigate to Travel and Expenses>Process Expenses>Verify Receipts>Attach Receipts
	If SelectMainMenu1(GlobalDictionary("EXAttachReceipts")) = True Then
		WriteToReport micPass, "AttachReceipts - Attach Receipts Page", "On the Attach Receipts page.", False
	Else
		WriteToReport micFail, "AttachReceipts - Attach Receipts Page", "Navigation to Attach Receipts page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Attach Receipts")

		'Make sure we are searching for receipts without attachments
		.PSFrame("TargetContent").WebList("AttachExists").Select "No"
		.PSFrame("TargetContent").WebButton("Search").Click
		.Sync

		'Click the first result if it exists, otherwise exit the test
		If .PSFrame("TargetContent").Link("FirstResult").Exist(10) Then
			WriteToReport micPass, "AttachReceipts - Results", "Search results found.", False
			.PSFrame("TargetContent").Link("FirstResult").Click
		Else
			WriteToReport micFail, "AttachReceipts - Results", "No search results found. Exiting test.", True
		End If

		'Confirm that we are on a new page, otherwise exit the test
		If .PSFrame("TargetContent").WebButton("Add Attachment").Exist(10) Then
			WriteToReport micPass, "AttachReceipts - Results Page", "On the results page.", False
		Else
			WriteToReport micFail, "AttachReceipts - Results Page", "Not on the results page. Exiting test.", True
		End If
		
		'Add Attachment
		AddAttachment GlobalDictionary("FilePath"), GlobalDictionary("FileName"), "1"		
		Browser("PeopleSoft Browser").Sync

		'Set our description
		.PSFrame("TargetContent").WebEdit("Description").Set "EX_01_01_Attach Receipt Test"

		'Add Deletion of Attatchment and verify it is not shown before saving. Then exit Function
		If GlobalDictionary("Delete") = "Yes"  Then
			RemoveAttachment("1")
			Exit Function
		End If
		
		'Click save
		.PSFrame("TargetContent").WebButton("Save").Click
		WriteToReport micPass, "AttachReceipts - Attachment", "Attachment added and saved.", False
		.Sync

		'store Report ID
		GlobalDictionary("ReportID") = .PSFrame("TargetContent").WebElement("ReportID").GetROProperty("Innertext")
		WriteToReport micDone, "AttachReceipts - Report ID", "Report ID is " & GlobalDictionary("ReportID"), False
	End With

	'Navigate to Travel and Expenses>Expense Report > View
	If SelectMainMenu1(GlobalDictionary("EXViewReports")) = True Then
		WriteToReport micPass, "AttachReceipts - View Page", "On the View page.", False
	Else
		WriteToReport micFail, "AttachReceipts - View Page", "Navigation to View page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("View")
		.PSFrame("TargetContent").WebEdit("ReportID").Set GlobalDictionary("ReportID")	'"0000777404"
		.PSFrame("TargetContent").WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Validate our attachment link exists and has the correct amount in it
		If .PSFrame("TargetContent").Link("Attachments (1)").Exist(10) Then
			If InStr(1, .PSFrame("TargetContent").Link("Attachments (1)").GetROProperty("Innertext"), GlobalDictionary("Attachment"), vbTextCompare) >= 1 Then
				WriteToReport micPass, "AttachReceipts - Attachments Link", "Attachments Link found.", False
			Else
				WriteToReport micFail, "AttachReceipts - Attachments Link", "Attachments Link found, but does not contain the correct attachment number: " & GlobalDictionary("Attachment"), True
			End If
		Else
			WriteToReport micFail, "AttachReceipts - Attachments Link", "Attachments Link not found. Check report ID and/or attachment process.", True
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Restore a wallet. 1.06
''' </summary>
''' <author>Stephen King</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'05/13/2019			Zach A.		Updated to use non-static dates for From/To
'**************************************************************************************************************
Public Function ReinstateWallet
	Dim arrTemp
	Dim bFound
	Dim i
	Dim strAmount, strDate, strID, strMerchant, strTemp

	'Navigate to Employee Self Service>Travel & Expenses>My Wallet Restore
	If SelectMainMenu1(GlobalDictionary("EXWalletRestore")) = True Then
		WriteToReport micPass, "ReinstateWallet - Wallet Restore Page", "On the Wallet Restore page.", False
	Else
		WriteToReport micFail, "ReinstateWallet - Wallet Restore Page", "Navigation to Wallet Restore page failed. Exiting test.", True
		ExitTest
	End If

	'Added merchant and value to OR. Gonna need to save those from first page for validations.
	With Browser("PeopleSoft Browser").Page("My Wallet Restore").PSFrame("My Wallet Restore")
		.WebEdit("FromDate").Set AnyDateLeadingZeros(DateSerial(Year(Now)-3, Month(Now), Day(Now)))	'MM/DD/YYYY format
		.WebEdit("ToDate").Set AnyDateLeadingZeros(DateSerial(Year(Now), Month(Now), Day(Now)))	
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm we have search results
		If .WebCheckBox("Status").Exist(10) Then
			WriteToReport micPass, "ReinstateWallet - Search Results", "Search results found using our From and To Date!", False
		Else
			WriteToReport micFail, "ReinstateWallet - Search Results", "No search results found. Check search criteria. Exiting test.", True
			ExitTest
		End If

		'Set the status of our first result to on
		.WebCheckBox("Status").Set "ON"	'"OFF"

		'Save our wallet data from the first result in the proper format
		strAmount = Trim(.WebElement("Amount").GetROProperty("InnerText"))
		strAmount = Left(strAmount, Len(strAmount) - 1)	'Strip off the last 0 - has 3 decimal places. Currency needs 2.
		strDate = Trim(.WebElement("Date").GetROProperty("InnerText"))
		
		If strDate = "" Then
			WriteToReport micFail, "ReinstateWallet - Search Results", "No search results found. Check search criteria. Exiting test.", True
			ExitTest		
		End If
		arrTemp = Split(strDate, "-")
		strDate = arrTemp(1) & "/" & arrTemp(2) & "/" & arrTemp(0)
		strMerchant = Trim(.WebElement("Merchant").GetROProperty("InnerText"))
		.WebButton("Save1").Click
		Browser("PeopleSoft Browser").Sync
		WriteToReport micDone, "ReinstateWallet - Transaction selected", "First row in transactions table selected. Data stored.", False
		
		'Click the Return To Search button
		.WebButton("Return to Search").Click
		Browser("PeopleSoft Browser").Sync

		'Store our Employee ID
		strID = Trim(.WebEdit("EmployeeID").GetROProperty("default value"))
		WriteToReport micDone, "ReinstateWallet - Employee ID", "Employee ID stored - " & strID, False
	End With

	'Navigate to Employee Self-Service>Travel and Expenses>Expense Reports>Create/Modify
	If SelectMainMenu1(GlobalDictionary("EXCreateModify")) = True Then
		WriteToReport micPass, "ReinstateWallet - Create/Modify Page", "On the Create/Modify page.", False
	Else
		WriteToReport micFail, "ReinstateWallet - Create/Modify Page", "Navigation to Create/Modify page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Create/Modify").PSFrame("TargetContent")
		.WebEdit("EmployeeID").Set strID	'Use SQL or Return to Search to grab ID
		.WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Validate that we have a wallet search result
		If .Link("Wallet").Exist(10) Then
			WriteToReport micPass, "ReinstateWallet - Wallet Search Results", "Search results found!", False
		Else
			WriteToReport micFail, "ReinstateWallet - Wallet Search Results", "No search results found. Check search criteria. Exiting test.", True
			ExitTest
		End If

		'Click our wallet link
		.Link("Wallet").Click
		Browser("PeopleSoft Browser").Sync

		bFound = VerifyWalletResults(ReinstateWallet, strMerchant, strAmount, strDate)
		If bFound Then
			WriteToReport micPass, "ReinstateWallet - Validation", "Wallet validation passed.", False
		Else
			WriteToReport micFail, "ReinstateWallet - Validation", "Merchant not found - " & strMerchant, True
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Restore a transaction to a wallet from an admin perspective. 1.07
''' </summary>
''' <author>Stephen King</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'05/13/2019			Zach A.		Updated to use non-static dates for From/To
'**************************************************************************************************************
Public Function AdminReinstateWallet
	Dim arrTemp
	Dim bFound
	Dim i
	Dim strAmount, strDate, strID, strMerchant, strTemp

	
	'Navigate to Employee Self-Service>Travel and Expense>My Wallet
	If SelectMainMenu1(GlobalDictionary("EXWalletRestore")) = True Then
		WriteToReport micPass, "AdminReinstateWallet - My Wallet Page", "On the My Wallet page.", False
	Else
		WriteToReport micFail, "AdminReinstateWallet - My Wallet Page", "Navigation to My Wallet page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("My Wallet Restore").PSFrame("My Wallet Restore")
		.WebEdit("FromDate").Set AnyDateLeadingZeros(DateSerial(Year(Now)-3, Month(Now), Day(Now)))	'MM/DD/YYYY format
		.WebEdit("ToDate").Set AnyDateLeadingZeros(DateSerial(Year(Now), Month(Now), Day(Now)))	
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm we have search results
		If .WebCheckBox("Status").Exist(10) Then
			WriteToReport micPass, "AdminReinstateWallet - Search Results", "Search results found!", False
		Else
			WriteToReport micFail, "AdminReinstateWallet - Search Results", "No search results found. Check search criteria. Exiting test.", True
			ExitTest
		End If

		'Set the status of our first result to on
		.WebCheckBox("Status").Set "ON"

		'Save our wallet data
		strAmount = Trim(.WebElement("Amount").GetROProperty("InnerText"))
		strDate = Trim(.WebElement("Date").GetROProperty("InnerText"))
		strMerchant = Trim(.WebElement("Merchant").GetROProperty("InnerText"))

		'Needed depending on format(like My Wallet Restore page vs My Wallet)
		strAmount = Left(strAmount, Len(strAmount) - 1)	'Strip off the last 0
		arrTemp = Split(strDate, "-")
		strDate = arrTemp(1) & "/" & arrTemp(2) & "/" & arrTemp(0)
		.WebButton("Save1").Click
		Browser("PeopleSoft Browser").Sync
		WriteToReport micDone, "AdminReinstateWallet - Transaction selected", "First row in transactions table selected. Data stored.", False

		'Go back a page to grab and store our Employee ID
		.WebButton("Return to Search").Click
		Browser("PeopleSoft Browser").Sync
		strID = Trim(.WebEdit("EmployeeID").GetROProperty("default value"))
		WriteToReport micDone, "AdminReinstateWallet - Employee ID", "Employee ID stored - " & strID, False
	End With

	'Start the wallet approval process
	'Log in as an admin user(originally FRANDVO)
	Login(GlobalDictionary("AdminUser"))

	'Navigate to Travel and Expense>My Wallet Update
	If SelectMainMenu1(GlobalDictionary("EXWalletUpdate")) = True Then
		WriteToReport micPass, "AdminReinstateWallet - CDW Wallet Update Page", "On the CDW Wallet Update page.", False
	Else
		WriteToReport micFail, "AdminReinstateWallet - CDW Wallet Update Page", "Navigation to CDW Wallet Update page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("CDW Wallet Update").PSFrame("TargetContent")

		'Search for results using our Employee ID
		.WebEdit("EmployeeID").Set strID
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Exit the test if there are no results(something went wrong in the first part of the test maybe?)
		If .WebEdit("FromDate").Exist(5) Then
			WriteToReport micPass, "AdminReinstateWallet - Wallet", "Wallet found using Employee ID", False
		Else
			WriteToReport micFail, "AdminReinstateWallet - Wallet", "Wallet not found using Employee ID. Exiting test.", True
			ExitTest
		End If

		'Use the search date from our wallet entry
		.WebEdit("FromDate").Set strDate
		.WebEdit("ToDate").Set strDate
		.WebList("TransactionStatus").Select "All Transaction Statuses"
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync
	End With

	With Browser("PeopleSoft Browser").Page("CDW Wallet Update")
	
		'Confirm that we have search results for our transaction
		If .PSFrame("TargetContent").WebTable("MarkForDelete").Exist(5) Then
			WriteToReport micPass, "AdminReinstateWallet - Table Results", "Results found using saved transaction info", False
		Else
			WriteToReport micFail, "AdminReinstateWallet - Table Results", "Results not found using saved transaction info. Exiting test.", True
			ExitTest
		End If

		'search for our merchant in the table
		bFound = False
		For i = 1 To .PSFrame("TargetContent").WebTable("MarkForDelete").GetROProperty("rows")
			If Trim(.PSFrame("TargetContent").WebElement("html id:=CDW_EX_TRANS_VW_MERCHANT\$" & i - 1).GetROProperty("Innertext")) = strMerchant Then
				WriteToReport micDone, "AdminReinstateWallet - Merchant", "Merchant found", False

				''Confirm our amount matches
				If Trim(.PSFrame("TargetContent").WebElement("html id:=CDW_EX_TRANS_VW_MONETARY_AMOUNT\$" & i-1).GetROProperty("Innertext")) = strAmount Then
					WriteToReport micDone, "AdminReinstateWallet - Monetary Amount", "Monetary Amount found", False

					'Last check, otherwise we exit the if statements and start a new loop
					If Trim(.PSFrame("TargetContent").WebElement("html id:=CDW_EX_TRANS_VW_TRANS_DT\$" & i-1).GetROProperty("Innertext")) = strDate Then
						WriteToReport micDone, "AdminReinstateWallet - Date", "Date found", False
						bFound = True
						Exit For
					Else
						WriteToReport micDone, "AdminReinstateWallet - Date", "Date not found - " & strDate, True
					End If
				Else
					WriteToReport micDone, "AdminReinstateWallet - Monetary Amount", "Monetary Amount not found - " & strAmount, True
				End If
			Else
				WriteToReport micDone, "AdminReinstateWallet - Merchant", "Merchant " & strMerchant & " not found. Going to next row.", False
			End If
		Next

		'Pass/fail reporting
		If bFound Then
			WriteToReport micPass, "AdminReinstateWallet - Receipt Validation", "Wallet receipt found.", False
		Else
			WriteToReport micFail, "AdminReinstateWallet - Receipt Validation", "Wallet receipt  not found - " & strMerchant & ", exiting test.", True
			ExitTest
		End If

		'If still here, use our row number(i) to fill out fields so we can clear the receipt
		.PSFrame("TargetContent").WebButton("html id:=CDW_EX_TRANS_VW_SHEET_ID\$prompt\$" & i-1).Click
		.PSFrame("Look Up ID").Link("FirstResult").Click
		Browser("PeopleSoft Browser").Sync

		.PSFrame("TargetContent").WebButton("html id:=CDW_EX_TRANS_VW_LINE_NBR\$prompt\$" & i-1).Click
		.PSFrame("Look Up Line").Link("FirstResult").Click
		.PSFrame("TargetContent").WebButton("Save").Click

		'Confirm that our status for the row is set to "OFF"
		If .PSFrame("TargetContent").WebCheckBox("html id:=CDW_EX_TRANS_VW_TXN_STATUS\$" & i -1).GetROProperty("Checked") = 0 Then
			WriteToReport micPass, "AdminReinstateWallet - Receipt Cleared", "Wallet receipt cleared.", False
		Else
			WriteToReport micFail, "AdminReinstateWallet - Receipt Cleared", "Wallet receipt  not cleared. Exiting test.", True
			ExitTest
		End If
	End With

	'Log back in as RAYSHIN
	Login(GlobalDictionary("SignInUser"))

	'Navigate back to Employee Self-Service>Travel and Expense>My Wallet
	If SelectMainMenu1(GlobalDictionary("EXWallet")) = True Then
		WriteToReport micPass, "AdminReinstateWallet - My Wallet Page", "On the My Wallet page.", False
	Else
		WriteToReport micFail, "AdminReinstateWallet - My Wallet Page", "Navigation to My Wallet page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet")

		'Search for our specific entry
		.WebEdit("FromDate").Set strDate
		.WebEdit("ToDate").Set strDate
		.WebList("TransactionStatus").Select "All Transaction Statuses"
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm we have search results
		If .WebCheckBox("Status").Exist(10) Then
			WriteToReport micPass, "AdminReinstateWallet - My Wallet Page - Search Results", "Search results found!", False
		Else
			WriteToReport micFail, "AdminReinstateWallet - My Wallet Page - Search Results", "No search results found. Check search criteria. Exiting test.", True
			ExitTest
		End If

		'Validate our wallet data that should now be restored
		'search for our merchant in the table
		bFound = VerifyWalletResults("AdminReinstateWallet", strMerchant, strAmount, strDate)
		If bFound Then
			WriteToReport micPass, "AdminReinstateWallet - My Wallet Page - Wallet restored", "Entry found. Wallet receipt successfully restored.", False
		Else
			WriteToReport micFail, "AdminReinstateWallet - My Wallet Page - Wallet not restored", "Entry not found.", True
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Confirm the ability to restore unassigned transactions. 1.08
''' </summary>
''' <author>Stephen King</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function LinkWalletItem
	Dim strAmount, strDate, strMerchant
	Dim bFound

	'Navigate to Travel and Expense>My Wallet Update
	If SelectMainMenu1(GlobalDictionary("EXWalletUpdate")) = True Then
		WriteToReport micPass, "LinkWalletItem - CDW Wallet Update Page", "On the CDW Wallet Update page.", False
	Else
		WriteToReport micFail, "LinkWalletItem - CDW Wallet Update Page", "Navigation to CDW Wallet Update page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("CDW Wallet Update").PSFrame("TargetContent")
	
		'Search by a given Employee ID
		.WebEdit("EmployeeID").Set GlobalDictionary("EmployeeID")
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Use the search date from our wallet entry
		.WebEdit("FromDate").Set GlobalDictionary("FromDate")
		.WebEdit("ToDate").Set GlobalDictionary("ToDate")
		.WebList("TransactionStatus").Select "Unassigned"
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync
	End With

	With Browser("PeopleSoft Browser").Page("CDW Wallet Update")

		'Click on the first row result, reporting our data
		If Trim(.PSFrame("TargetContent").WebElement("Merchant").GetROProperty("Innertext")) <> "" Then
			strMerchant = .PSFrame("TargetContent").WebElement("Merchant").GetROProperty("Innertext")
			WriteToReport micDone, "LinkWalletItem - Merchant", "Merchant name is " & strMerchant, False
			strAmount = .PSFrame("TargetContent").WebElement("MonetaryAmount").GetROProperty("Innertext")
			WriteToReport micDone, "LinkWalletItem - Monetary Amount", "Monetary Amount is " & strAmount, False
			strDate = .PSFrame("TargetContent").WebElement("TransactionDate").GetROProperty("Innertext")
			WriteToReport micDone, "LinkWalletItem - Date", "Date is " & strDate, False
		Else
			WriteToReport micDone, "LinkWalletItem - Merchant", "No results found. Exiting test.", False
			ExitTest
		End If

		'Validate that we have an account ID to add
		.PSFrame("TargetContent").WebButton("html id:=CDW_EX_TRANS_VW_SHEET_ID\$prompt\$0").Click
		Browser("PeopleSoft Browser").Sync
		If .PSFrame("Look Up ID").Link("FirstResult").Exist(5) Then
			.PSFrame("Look Up ID").Link("FirstResult").Click
			WriteToReport micPass, "LinkWalletItem - ID Entry", "ID entry added.", False
			Browser("PeopleSoft Browser").Sync
		Else
			WriteToReport micFail, "LinkWalletItem - ID Entry", "ID entry not added.", True
			ExitTest
		End If

		'Validate that we have a sheet number to add.
		.PSFrame("TargetContent").WebButton("html id:=CDW_EX_TRANS_VW_LINE_NBR\$prompt\$0").Click
		Browser("PeopleSoft Browser").Sync
		If .PSFrame("Look Up Line").Link("FirstResult").Exist(5) Then
			.PSFrame("Look Up Line").Link("FirstResult").Click
			WriteToReport micPass, "LinkWalletItem - Line Entry", "Line entry added.", False
		Else
			WriteToReport micFail, "LinkWalletItem - Line Entry", "Line entry not added.", True
			ExitTest
		End If

		'Click save
		.PSFrame("TargetContent").WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm that our status for the row is set to "OFF"
		If .PSFrame("TargetContent").WebCheckBox("html id:=CDW_EX_TRANS_VW_TXN_STATUS\$0").GetROProperty("Checked") = 0 Then
			WriteToReport micPass, "LinkWalletItem - Fields added", "All entries added.", False
		Else
			WriteToReport micFail, "LinkWalletItem - Fields not added", "All entries not added.", True
		End If
	End With

	'Validate that the item was added back to our wallet
	'Log out of user current user and log in as the user we were modifying
	Login(GlobalDictionary("ValidationEmployee"))

	'Navigate to the My Wallet page
	If SelectMainMenu1(GlobalDictionary("EXWallet")) = True Then
		WriteToReport micPass, "LinkWalletItem - My Wallet", "On the My Wallet page.", False
	Else
		WriteToReport micFail, "LinkWalletItem - My Wallet", "Navigation to My Wallet page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet")

		'Search for our specific entry
		.WebEdit("FromDate").Set strDate
		.WebEdit("ToDate").Set strDate
		.WebList("TransactionStatus").Select "All Transaction Statuses"
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm we have search results
		If .WebCheckBox("Status").Exist(10) Then
			WriteToReport micPass, "LinkWalletItem - My Wallet Page - Search Results", "Search results found!", False
		Else
			WriteToReport micFail, "LinkWalletItem - My Wallet Page - Search Results", "No search results found. Check search criteria. Exiting test.", True
			ExitTest
		End If

		'Validate our wallet data that should now be restored
		'search for our merchant in the table
		bFound = VerifyWalletResults("LinkWalletItem", strMerchant, strAmount, strDate)
		If bFound Then
			WriteToReport micPass, "LinkWalletItem - My Wallet Page - Wallet restored", "Entry found. Wallet receipt successfully restored.", False
		Else
			WriteToReport micFail, "LinkWalletItem - My Wallet Page - Wallet not restored", "Entry not found.", True
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Adds Attachments
''' </summary>
''' <author>Brian Buckhana</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
' 24JAN19			Brian B.		Increased exist timer of File Attachment window.
'**************************************************************************************************************
Public Function AddAttachment(sFileLocation, sFileName, nUploadPosition)
	Dim sAttachment
	
	With Browser("PeopleSoft Browser").Page("Create/Modify Expenses")
	
		If .PSFrame("Expense Report Attachments").WebButton("Add Attachment").Exist(10) Then
			.PSFrame("Expense Report Attachments").WebButton("Add Attachment").Click	
		ElseIf Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").WebButton("Add Attachment").Exist(10)	Then	
			Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").WebButton("Add Attachment").Click
		End If

		If .PSFrame("File Attachment").Exist(30)  Then
			WriteToReport micPass, "Attachment", "File Attachment window is displayed.", False	
		Else
			WriteToReport micFail, "Attachment", "File Attachment window did not appear.", True				
			ExitTest
		End If		
	
		.PSFrame("File Attachment").WebFile("Browse").Set sFileLocation & "\" & sFileName
		wait(20)			 
		.PSFrame("File Attachment").WebButton("Upload").Click		
		Browser("PeopleSoft Browser").Sync

		If .PSFrame("Expense Report Attachments").exist(10) Then
			'Sets object for correct area
			.PSFrame("Expense Report Attachments").WebEdit("Description").SetTOProperty "name", "PV_ATTACH_WRK_ATTACH_DESCR$"& nUploadPosition - 1
			If .PSFrame("Expense Report Attachments").WebEdit("Description").Exist(60) Then
				WriteToReport micPass, "Attachment Upload", "File uploaded", False			
				.PSFrame("Expense Report Attachments").WebEdit("Description").Set sFileName
			Else
				WriteToReport micFail, "Attachment Upload", "File did not upload.", True				
				ExitTest			
			End If	
		
			.PSFrame("Expense Report Attachments").Link("Attachment document link").SetTOProperty "html id", "VIEWBUTTON$" & nUploadPosition - 1
		
			If .PSFrame("Expense Report Attachments").Link("Attachment document link").Exist(20) Then
				sAttachment = .PSFrame("Expense Report Attachments").Link("Attachment document link").GetROProperty("innertext")			
			End If
		ElseIf Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").WebEdit("Description").Exist(20) Then
				Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").WebEdit("Description").SetTOProperty "name", "PV_ATTACH_WRK_ATTACH_DESCR$"& nUploadPosition - 1
			If Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").WebEdit("Description").Exist(60) Then
				WriteToReport micPass, "Attachment Upload", "File uploaded", False			
				Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").WebEdit("Description").Set sFileName
			Else
				WriteToReport micFail, "Attachment Upload", "File did not upload.", True				
				ExitTest			
			End If	

			Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").Link("Attachment document link").SetTOProperty "html id", "VIEWBUTTON$" & nUploadPosition - 1
				If Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").Link("Attachment document link").Exist(20) Then
				sAttachment = Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").Link("Attachment document link").GetROProperty("innertext")			
			End If
		End If
		
			If sFileName = sAttachment Then
				WriteToReport micPass, "Attachment Upload", "The File ["& sAttachment &"] was attached.", False
			Else
				WriteToReport micFail, "Attachment Upload", "The File ["& sAttachment &"] was displayed,  expected [" & sFileName &"].", True				
				ExitTest								
			End If	

	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Removes Attachments
''' </summary>
''' <author>Brian Buckhana</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function RemoveAttachment(nAttachmentRow)
	Dim sMessage
	
	With Browser("PeopleSoft Browser").Page("Create/Modify Expenses")
		'Delete second file and verify Delete Confirmation - html id PAYMENT_ATT$delete$1$$0
		If .PSFrame("Expense Report Attachments").Exist(10) Then
			.PSFrame("Expense Report Attachments").WebButton("Delete Attachment").SetTOProperty "html id", "PAYMENT_ATT$delete$" & nAttachmentRow - 1 & "$$0"
			.PSFrame("Expense Report Attachments").WebButton("Delete Attachment").Click
			'Accomodate for Attach Receipts Page
		ElseIf Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").Exist(10) Then
			Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").WebButton("Delete Attachment").SetTOProperty "html id", "PAYMENT_ATT$delete$" & nAttachmentRow - 1 & "$$0"
			Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").WebButton("Delete Attachment").Click		
		End If


		'Verify Delet Confirmation Message is displayed and put in Reporter 
		If .WebElement("Delete Message").Exist(20) Then
			sMessage =.WebElement("Delete Message").GetROProperty("innertext")
			WriteToReport micPass, "Delete Confirmation", "The following message is displayed: [" &sMessage & "]", False	
		Else
			WriteToReport micFail, "Delete Confirmation", "Confimration did not display.", True				
			ExitTest			
		End If
		
		.WebButton("OK to Delete").Click
		
		If .PSFrame("Expense Report Attachments").Exist(10) Then		
			If .PSFrame("Expense Report Attachments").Link("Attachment document link").Exist(10) Then
				WriteToReport micFail, "Delete Attachment", "The File at row [" & nAttachmentRow &"] was not deleted.", True				
				ExitTest								
			Else				
				WriteToReport micPass, "Delete Attachment", "The File at row ["& nAttachmentRow &"] was deleted.", True										
			End If	
		ElseIF Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").Exist(10) Then
			If Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").Link("Attachment document link").Exist(10) Then
				WriteToReport micFail, "Delete Attachment", "The File at row [" & nAttachmentRow &"] was not deleted.", True				
				ExitTest								
			Else				
				WriteToReport micPass, "Delete Attachment", "The File at row ["& nAttachmentRow &"] was deleted.", True										
			End If
		End If	
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Checks that a user can only update the Expense Type and Description of an approved expense
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function CheckOnlyUpdateExpenseTypeDescMyWallet
	Dim nCurrent, sCurrent
	Call Login(dbFindUserWithExpenseReport()(0))
	'Navigate to the My Wallet page
	If SelectMainMenu1(GlobalDictionary("EXMyWallet")) = True Then
		WriteToReport micPass, "My Wallet Page", "On the My Wallet page.", False
	Else
		WriteToReport micFail, "My Wallet Page", "Navigation to My Wallet page failed. Exiting test.", True
		ExitTest
	End If

	'Change the From Date
	If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebEdit("From Date").Exist(5) Then
	 	Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebEdit("From Date").Set GlobalDictionary("FromDate")
	 	WriteToReport micDone, "Set the From Date to: "&GlobalDictionary("FromDate"), "Successfully Set the From Date", FALSE
	Else
		WriteToReport micFail, "Could Not Locate the From Date Field", "From Date not set", TRUE
		ExitTest
	End If

	'Change the Receipt Data Source
	If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Receipt Data Source").Exist(5) Then
		Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Receipt Data Source").Select GlobalDictionary("ReceiptDataSource")
		WriteToReport micDone, "Selected the Receipt Data Source: "&GlobalDictionary("ReceiptDataSource"), "Successfully set the Receipt Data Source", FALSE
	Else
		WriteToReport micFail, "Could Not Locate the Receipt Data Source Dropdown", "Receipt Data Source not Updated", TRUE
	End If

	'Change the Transaction Status
	If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Transaction Status").Exist(5) Then
		Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Transaction Status").Select GlobalDictionary("TransactionStatus")
		WriteToReport micDone, "Selected the Transaction Status: "&GlobalDictionary("TransactionStatus"), "Successfully set the Transaction Status", FALSE
	Else
		WriteToReport micFail, "Could Not Locate the Transaction Status Dropdown", "Transaction Status not Updated", TRUE
	End If

	'Add an attachment to the first result in the table
	If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details").Image("FirstResultAttach").Exist(5) Then
		Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details").Image("FirstResultAttach").Click
		WriteToReport micDone, "Clicked the Attachments Icon for the First Entry of the Details Table", "Successfully Clicked the Attachments Icon", FALSE
	Else
		WriteToReport micFail, "Could not Locate the Attachments Icon for the First Entry", "Attachments Icon not Clicked", TRUE
		ExitTest
	End If
	If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet Attachments").WebButton("Add Attachment").Exist(5) Then
		Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet Attachments").WebButton("Add Attachment").Click
		WriteToReport micDone, "Clicked the Add Attachments Button", "Successfully clicked Add Attachments", FALSE
	Else
		WriteToReport micFail, "Could not Locate the Add Attachments Button", "Add Attachments not Clicked", TRUE
		ExitTest
	End If
	If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("File Attachment").WebFile("Browse").Exist(5) Then
		Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("File Attachment").WebFile("Browse").Set GlobalDictionary("FileName")
		'Call Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("File Attachment").WebFile("Browse").WaitProperty("value", GlobalDictionary("FileName"), 30000)
		WriteToReport micDone, "Uploaded the File: "&GlobalDictionary("FileName"), "", FALSE
	Else
		WriteToReport micFail, "Could Not Locate the Browse option", "File not uploaded", TRUE
		ExitTest
	End If
	Wait 15
	If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("File Attachment").WebButton("Upload").Exist(5) Then
		Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("File Attachment").WebButton("Upload").Click
		WriteToReport micDone, "Clicked the Upload Button", "Successfully Clicked Upload", FALSE
	Else
		WriteToReport micFail, "Could not Locate the Upload Button", "File Not Uploaded", TRUE
		ExitTest
	End If
	If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet Attachments").WebButton("OK").Exist(5) Then
		Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet Attachments").WebButton("OK").Click
		WriteToReport micDone, "Clicked the OK Button", "Successfully Clicked OK", FALSE
	Else
		WriteToReport micFail, "Could Not Locate the OK Button", "OK not clicked", TRUE
		ExitTest
	End If

	'Open the first result in the table
	If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details").WebElement("FirstResult").Exist(5) Then
		Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details").WebElement("FirstResult").Click
		WriteToReport micDone, "Clicked the First Entry in the Details Table", "Successfully ", FALSE
	Else
		WriteToReport micFail, "Could Not Locate the First Entry in the Details Table", "Entry not opened", TRUE
		ExitTest
	End If

	Browser("PeopleSoft Browser").Sync

	'Make sure the following objects are disabled/cannot be edited
		'Transaction Date
		If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebEdit("Transaction Date").GetROProperty("disabled") = 1 Then
			WriteToReport micPass, "Transaction Date is Disabled", "Verified Transaction Date is disabled", FALSE
		Else
			WriteToReport micFail, "Transaction Date is Enabled", "Field Enabled when it should be disabled", TRUE
			ExitTest
		End If
		'Payment Type
		If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Payment Type").GetROProperty("disabled") = 1 Then
			WriteToReport micPass, "Payment Type is Disabled", "Verified Payment Type is disabled", FALSE
		Else
			WriteToReport micFail, "Payment Type is Enabled", "Field Enabled when it should be disabled", TRUE
			ExitTest
		End If
		'Cardmember Number (if applicable)
		If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Cardmember Number").Exist Then
			If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Cardmember Number").GetROProperty("disabled") = 1 Then
				WriteToReport micPass, "Cardmember Number is Disabled", "Verified Cardmember Number is disabled", FALSE
			Else
				WriteToReport micFail, "Cardmember Number is Enabled", "Field Enabled when it should be disabled", TRUE
				ExitTest
			End If
		End If
		
		'Merchant Description, if Non-Preferred
		If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebRadioGroup("Non-Preferred").GetROProperty("checked") = 1 Then
			If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebEdit("Merchant Type").GetROProperty("disabled") = 1 Then
				WriteToReport micPass, "Merchant Type is Disabled", "Verified Merchant Type is disabled", FALSE
			Else
				WriteToReport micFail, "Merchant Type is Enabled", "Field Enabled when it should be disabled", TRUE
				ExitTest
			End If
		End If		
		'Transaction Amount
		If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebEdit("Transaction Amount").GetROProperty("disabled") = 1 Then
			WriteToReport micPass, "Transaction Amount is Disabled", "Verified Transaction Amount is disabled", FALSE
		Else
			WriteToReport micFail, "Transaction Amount is Enabled", "Field Enabled when it should be disabled", TRUE
			ExitTest
		End If
		'Currency
		If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebEdit("Currency").GetROProperty("disabled") = 1 Then
			WriteToReport micPass, "Currency is Disabled", "Verified Currency is disabled", FALSE
		Else
			WriteToReport micFail, "Currency is Enabled", "Field Enabled when it should be disabled", TRUE
			ExitTest
		End If
		'Exchange Rate
		If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebEdit("Exchange Rate").GetROProperty("disabled") = 1 Then
			WriteToReport micPass, "Exchange Rate is Disabled", "Verified Exchange Rate is disabled", FALSE
		Else
			WriteToReport micFail, "Exchange Rate is Enabled", "Field Enabled when it should be disabled", TRUE
			ExitTest
		End If
		'Base Currency Amount
		If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebElement("Base Currency Amount").GetROProperty("class") = "PSEDITBOX_DISPONLY" Then
			WriteToReport micPass, "Base Currency Amount is Disabled", "Verified Base Currency Amount is disabled", FALSE
		Else
			WriteToReport micFail, "Base Currency Amount is Enabled", "Field Enabled when it should be disabled", TRUE
			ExitTest
		End If
		'Add Expense Type Dropdown
		If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Add Expense Type").GetROProperty("disabled") = 1 Then
			WriteToReport micPass, "Add Expense Type is Disabled", "Verified Add Expense Type is disabled", FALSE
		Else
			WriteToReport micFail, "Add Expense Type is Enabled", "Field Enabled when it should be disabled", TRUE
			ExitTest
		End If

	'Change the Expense Type to any other value than the current
	nCurrent = Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Expense Type").Object.SelectedIndex
	'To prevent overflow on the index, use modulus division to make sure it is in the proper index range
	nCurrent = (nCurrent+1) Mod Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Expense Type").Object.Length
	Call Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Expense Type").Select("#"&nCurrent)

	sCurrent = Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Expense Type").GetROProperty("value")

	'Set the Expense Description to "Test"
	Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebEdit("Description").Set GlobalDictionary("ExpenseDesc")
	WriteToReport micDone, "Set the Description to: "&GlobalDictionary("ExpenseDesc"), "Successfully Set the Description", FALSE

	'Click Save
	Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebButton("Save").Click
	WriteToReport micDone, "Clicked the Save Button", "Successfully Clicked Save", FALSE

	'Return to the My Wallet page
	Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").Link("ReturnToMyWallet").Click
	WriteToReport micDone, "Clicked Link [Return to My Wallet]", "Successfully clicked Link", FALSE
	Browser("PeopleSoft Browser").Sync

	'Check that the entry has the updated Expense Type and Description
	If sCurrent = Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details").WebElement("FirstResult").GetROProperty("innertext") Then
		WriteToReport micPass, "Entry Updated as Expected to: "&sCurrent, "Entry's Expense Type successfully updated", FALSE
	Else
		WriteToReport micFail, "Entry Not Updated; Value is: "&Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details").WebElement("FirstResult").GetROProperty("innertext"), "Entry not updated", TRUE
	End If

	If GlobalDictionary("ExpenseDesc") = Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details").WebElement("FirstResultAdditionalDetails").GetROProperty("innertext") Then
		WriteToReport micPass, "Entry Updated as Expected to: "&GlobalDictionary("ExpenseDesc"), "Entry's Additional Details match updated Description", FALSE
	Else
		WriteToReport micFail, "Entry Not Updated; Value is: "&Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details").WebElement("FirstResultAdditionalDetails").GetROProperty("innertext"), "Entry not updated", TRUE
	End If


End Function

'**************************************************************************************************************
''' <summary> 
''' Checks/Gives Authorization to a User to View Another Users Expense Report
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function AuthorizeExpenseUsers
	Dim arrTemp(0), i, sTemp, oTableChild, oAuthUserID
	Const AUTH_LEVEL = "Edit & Submit"
	Call Login(GlobalDictionary("AuthPermissionsUser"))

	'Navigate to the Authorize Expense Users page
	If SelectMainMenu1(GlobalDictionary("EXAuthorizeExpUsers")) = True Then
		WriteToReport micPass, "Authorize Expense Users Page", "On the Authorize Expense Users page.", False
	Else
		WriteToReport micFail, "Authorize Expense Users Page", "Navigation to Authorize Expense Users page failed. Exiting test.", True
		ExitTest
	End If
	'Make sure the EmployeeID Radio Button is clicked
	If Browser("PeopleSoft Browser").Page("Authorize Expense Users").PSFrame("TargetContent").WebRadioGroup("EmployeeID").GetROProperty("checked") = 1 Then
		WriteToReport micDone, "EmployeeID Radio Button Already Clicked", "EmployeeID Selected", FALSE
	Else
		Browser("PeopleSoft Browser").Page("Authorize Expense Users").PSFrame("TargetContent").WebRadioGroup("EmployeeID").Click
		WriteToReport micDone, "EmployeeID Radio Button Clicked", "EmployeeID Selected", FALSE	
	End If

	'Set the user you want to give authorization to
	Browser("PeopleSoft Browser").Page("Authorize Expense Users").PSFrame("TargetContent").WebEdit("SearchValue").Set dbFindEMPLIDByOPRID(GlobalDictionary("UserToAuth"))(0)

	'Click search
	Browser("PeopleSoft Browser").Page("Authorize Expense Users").PSFrame("TargetContent").WebButton("Search").Click

	'Loop through the users you are giving the authorization of
	For i= 1 To GlobalDictionary("NumOfUsers")
		'Build an array with one item, the name to look for
		arrTemp(0) = GlobalDictionary("Auth"&i)
		'Call the function to search the table. If found, do not re-add authorization
		Set oAuthUserID = Browser("PeopleSoft Browser").Page("Authorize Expense Users").PSFrame("TargetContent").WebTable("AuthorizedUsers").WebEdit("AuthUserID")
		Call oAuthUserID.SetTOProperty("xpath","//input[@value='"&GlobalDictionary("Auth"&i)&"']")

		If oAuthUserID.Exist(5) Then
			WriteToReport micDone, "User: "&GlobalDictionary("UserToAuth")&" Already Authorized to View "&GlobalDictionary("Auth"&i)&"'s Expense Reports", "User Already Authorized", FALSE
		Else
			'Click the add button on the first row to add authorization to current user to view another's expense report
			Browser("PeopleSoft Browser").Page("Authorize Expense Users").PSFrame("TargetContent").WebTable("AuthorizedUsers").ChildItem(1,4,"WebButton",0).Click
			
			Browser("PeopleSoft Browser").Page("Authorize Expense Users").PSFrame("TargetContent").WebTable("AuthorizedUsers").RefreshObject

			'Set the OPRID of the user on the second row that appears after the previous step
			sTemp = GlobalDictionary("Auth"&i)
			Set oTableChild = Browser("PeopleSoft Browser").Page("Authorize Expense Users").PSFrame("TargetContent").WebTable("AuthorizedUsers").ChildItem(2,1,"WebEdit",0)
			oTableChild.Set sTemp

			'Set the Auth level
			Browser("PeopleSoft Browser").Page("Authorize Expense Users").PSFrame("TargetContent").WebTable("AuthorizedUsers").ChildItem(2,3,"WebList",0).Select AUTH_LEVEL

			WriteToReport micPass, "Added Authorization for "&GlobalDictionary("UserToAuth")&" to View Expense Reports of "&GlobalDictionary("Auth"&i), "Gave authorization to view another user", FALSE
		End If
	Next
	'Click Save
	Browser("PeopleSoft Browser").Page("Authorize Expense Users").PSFrame("TargetContent").WebButton("Save").Click
	WriteToReport micPass, "Clicked Save", "Saved the authorizations", FALSE
End Function

'**************************************************************************************************************
''' <summary> 
''' Views Expense Reports as the signed in user. If they are authorized to view other users, they can see more than just their own.
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function ViewAuthorizedExpenseReports
	Dim i, j
	Dim sTemp
	For i=1 To GlobalDictionary("UserIterations")
		Call Login(GlobalDictionary("TestUser"&i))
		'Navigate to the View Expense Reports page
		If SelectMainMenu1(GlobalDictionary("EXViewReportsAlt")) Then
			WriteToReport micPass, "View Expense Reports Page", "On the View Expense Reports page.", False
		Else
			WriteToReport micFail, "View Expense Reports Page", "Navigation to View Expense Reports page failed. Exiting test.", True
			ExitTest
		End If
		'Clear all fields
		Browser("PeopleSoft Browser").Page("View").PSFrame("TargetContent").WebButton("Clear").Click

		'Click search
		Browser("PeopleSoft Browser").Page("View").PSFrame("TargetContent").WebButton("Search").Click

		'Check for one or more entries in the table
		If Browser("PeopleSoft Browser").Page("View").PSFrame("TargetContent").WebTable("SearchResults").Exist(30) Then
			If Browser("PeopleSoft Browser").Page("View").PSFrame("TargetContent").WebTable("SearchResults").RowCount() <= 1 Then
				WriteToReport micFail, "No Expenses Found in the Table", "Must create at least one expense report for the user or any user this user is authorized to view.", TRUE
				ExitTest
			End If
		Else
			WriteToReport micFail, "Could Not Locate the Search Results Table", "The table did not appear within the time frame", TRUE
			ExitTest
		End If

		'Skip the header column row
		For j = 2 To Browser("PeopleSoft Browser").Page("View").PSFrame("TargetContent").WebTable("SearchResults").RowCount()
			sTemp = Browser("PeopleSoft Browser").Page("View").PSFrame("TargetContent").WebTable("SearchResults").ChildItem(j,3,"Link",0).GetROProperty("innertext")
			'Check if the user can view more than themselves if TRUE, or only themselves if FALSE
			If GlobalDictionary("CanView"&i) = "TRUE" Then
				If InStr(1,GlobalDictionary("SearchString"&i),sTemp) = 0 Then
					WriteToReport micWarning, "Unexpected User's Expense Report Found: "&sTemp, "Please add this user to the expected list", FALSE
				End If
			Else
				'Make sure they can only find their own expense reports
				If InStr(1, GlobalDictionary("SearchString"&i),sTemp) = 0 Then
					WriteToReport micFail, "Unexpected User's Expense Report Found: "&sTemp, "Found an expense report for a user other than the logged in user.", TRUE
					ExitTest
				End If
			End If
		Next
		'If the test reaches this point, it has passed
		WriteToReport micPass, "Only Valid Expenses Shown for User ["&GlobalDictionary("TestUser"&i)&"]", "Only Authorized Expense Reports Shown", FALSE
	Next
	

End Function

'**************************************************************************************************************
''' <summary> 
''' Deletes an item from the My Wallet page
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function DeleteMyWalletEntry 'ST11
	Dim sUser
	Dim arrSearch(3)
	Dim nResult
	sUser = dbFindUserWithExpenseReport()(0)
	Call Login(sUser)
	'Navigate to the My Wallet page
	If SelectMainMenu1(GlobalDictionary("EXMyWallet")) = True Then
		WriteToReport micPass, "My Wallet Page", "On the My Wallet page.", False
	Else
		WriteToReport micFail, "My Wallet Page", "Navigation to My Wallet page failed. Exiting test.", True
		ExitTest
	End If

	'Change the From Date
	If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebEdit("From Date").Exist(5) Then
	 	Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebEdit("From Date").Set GlobalDictionary("FromDate")
	 	WriteToReport micDone, "Set the From Date to: "&GlobalDictionary("FromDate"), "Successfully Set the From Date", FALSE
	Else
		WriteToReport micFail, "Could Not Locate the From Date Field", "From Date not set", TRUE
		ExitTest
	End If

	'Change the Receipt Data Source
	If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Receipt Data Source").Exist(5) Then
		Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Receipt Data Source").Select GlobalDictionary("ReceiptDataSource")
		WriteToReport micDone, "Selected the Receipt Data Source: "&GlobalDictionary("ReceiptDataSource"), "Successfully set the Receipt Data Source", FALSE
	Else
		WriteToReport micFail, "Could Not Locate the Receipt Data Source Dropdown", "Receipt Data Source not Updated", TRUE
	End If

	'Change the Transaction Status
	If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Transaction Status").Exist(5) Then
		Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("Transaction Status").Select GlobalDictionary("TransactionStatus")
		WriteToReport micDone, "Selected the Transaction Status: "&GlobalDictionary("TransactionStatus"), "Successfully set the Transaction Status", FALSE
	Else
		WriteToReport micFail, "Could Not Locate the Transaction Status Dropdown", "Transaction Status not Updated", TRUE
	End If

	'Click the checkbox on the first entry to mark it for deletion
	If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details").WebCheckBox("FirstResultMarkDelete").Exist(5) Then
		Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details").WebCheckBox("FirstResultMarkDelete").Click
		WriteToReport micDone, "Marked the First Entry in the User's My Wallet for Deletion", "First entry marked for deletion", FALSE
	Else
		WriteToReport micFail, "No Entry found in My Wallet for User ["&sUser&"]", "Expected entry not found", TRUE
		ExitTest
	End If

	'Gather the information of the entry to look for after it is deleted
	'date, expense type, merchant, amount
	arrSearch(0) = Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details").WebElement("FirstResult").GetROProperty("innertext")
	arrSearch(1) = Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details").WebElement("FirstResultDate").GetROProperty("innertext")
	arrSearch(2) = Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details").WebElement("FirstResultMerchant").GetROProperty("innertext")
	arrSearch(3) = Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details").WebElement("FirstResultAmount").GetROProperty("innertext")

	'Click Save to delete the entry
	Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebButton("Save").Click

	Browser("PeopleSoft Browser").Sync

	'Look for a row that contains all of the above seearch data. If deleted, should return -1
	nResult = FindRowWithText(Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebTable("Details"),arrSearch)
	If nResult <> -1 Then
		WriteToReport micFail, "Found the Entry that was Marked for Deletion Still in the Table", "Entry not Deleted", TRUE
		ExitTest
	Else
		WriteToReport micPass, "Entry No Longer Found in the Table", "Successfully deleted the entry", FALSE
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Removes an Approver from the list, and then Adds them back
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function RemoveAddApprover 'ST07
	Dim sUserID, sDeptFrom, sDeptTo, oTemp
	'Navigate to Approver Assignments
	If SelectMainMenu1(GlobalDictionary("EXTandEAdminCenter")) Then
		WriteToReport micPass, "T and E Admin Center Page", "On the T and E Admin Center page.", False
	Else
		WriteToReport micFail, "T and E Admin Center Page", "Navigation to T and E Admin Center page failed. Exiting test.", True
		ExitTest
	End If

	Browser("PeopleSoft Browser").Sync
	
	'Click Manage Approvals
	Browser("PeopleSoft Browser").Page("T and E Admin Center").Link("Manage Approvals").Click
	WriteToReport micDone, "Clicked the Manage Approvals Link", "Successfully Clicked Manage Approvals", FALSE

	'Click Approver Assignment
	Browser("PeopleSoft Browser").Page("T and E Admin Center").Link("Approver Assignment").Click
	WriteToReport micDone, "Clicked the Approver Assignment Link", "Successfully Clicked Approver Assignment", FALSE
	
	Browser("PeopleSoft Browser").Sync

	'Set the GLUnit and Approver Profile
	Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebEdit("GLBusinessUnit").Set GlobalDictionary("BusinessUnit")
	WriteToReport micDone, "Set the Business Unit to: "&GlobalDictionary("BusinessUnit"), "Successfully set the Business Unit", FALSE
	Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebEdit("ApproverProfile").Set GlobalDictionary("ApproverProfile")
	WriteToReport micDone, "Set the Approver Profile to: "&GlobalDictionary("ApproverProfile"), "Successfully set the Approver Profile", FALSE
	
	'Click Search
	Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebButton("Search").Click
	WriteToReport micDone, "Clicked the Search Button", "Successfully Clicked Search", FALSE
	
	Browser("PeopleSoft Browser").Sync

	'Store the information from the first row
	sUserID = Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebTable("Assignments").WebEdit("FirstRowUserID").GetROProperty("value")
	WriteToReport micDone, "Saved User ID ["&sUserID&"] to Add Back After Deletion", "User ID Stored", FALSE

	sDeptFrom = Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebTable("Assignments").WebEdit("FirstRowDeptFrom").GetROProperty("value")
	WriteToReport micDone, "Saved Department From Value ["&sDeptFrom&"]", "Dept From Stored", FALSE

	sDeptTo = Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebTable("Assignments").WebEdit("FirstRowDeptTo").GetROProperty("value")
	WriteToReport micDone, "Saved Department To Value ["&sDeptTo&"]", "Dept To Stored", FALSE

	'Delete the First Row
	Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebTable("Assignments").WebButton("FirstRowDelete").Click
	WriteToReport micDone, "Clicked the Delete [-] Button on the First Row", "First Row Deleted", FALSE

	'Click OK
	Browser("PeopleSoft Browser").Page("Approver Assignment").WebButton("OK").Click
	WriteToReport micDone, "Clicked the OK Button", "Successfully clicked OK", FALSE

	'Click Save
	Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebButton("Save").Click
	WriteToReport micDone, "Clicked the Save Button", "Successfully clicked Save", FALSE

	'Click the Add button on the First Row
	Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebTable("Assignments").WebButton("FirstRowAdd").Click
	WriteToReport micDone, "Clicked the Add [+] Button on the First Row", "New Row Added", FALSE
	
	Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebTable("Assignments").RefreshObject

	'Set the User ID, DeptFrom, and DeptTo for the new row as the approver that was deleted
	Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebTable("Assignments").WebEdit("SecondRowUserID").Set sUserID
	WriteToReport micDone, "Set the User ID to Add back as ["&sUserID&"]", "User ID Set", FALSE

	Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebTable("Assignments").WebEdit("SecondRowDeptFrom").Set sDeptFrom
	WriteToReport micDone, "Set the Department From as ["&sDeptFrom&"]", "Dept From Set", FALSE

	Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebTable("Assignments").WebEdit("SecondRowDeptTo").Set sDeptTo
	WriteToReport micDone, "Set the Department To as ["&sDeptTo&"]", "Dept To Set", FALSE

	'Click Save
	Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebButton("Save").Click
	WriteToReport micDone, "Clicked the Save Button", "Successfully clicked Save", FALSE

	'Check that the Approver Assignment is now there, on the second row
	If sUserID = Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebTable("Assignments").WebEdit("SecondRowUserID").GetROProperty("value") Then
		WriteToReport micPass, "Found UserID on Row 2", "User is on the second row", FALSE
	Else
		WriteToReport micFail, "Did Not Find the User on Row 2", "Row 2 did not have the added user", TRUE
		ExitTest
	End If

	If sDeptFrom = Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebTable("Assignments").WebEdit("SecondRowDeptFrom").GetROProperty("value") Then
		WriteToReport micPass, "Found the Dept From on Row 2", "Dept From is on the second row", FALSE
	Else
		WriteToReport micFail, "Did Not Find the Dept From on Row 2", "Row 2 did not have the added Dept From", TRUE
		ExitTest
	End If

	If sDeptTo = Browser("PeopleSoft Browser").Page("Approver Assignment").PSFrame("TargetContent").WebTable("Assignments").WebEdit("SecondRowDeptTo").GetROProperty("value") Then
		WriteToReport micPass, "Found the Dept To on Row 2", "Dept To is on the second row", FALSE
	Else
		WriteToReport micFail, "Did Not Find the Dept To on Row 2", "Row 2 did not have the added Dept To", TRUE
		ExitTest
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' US Bank Visa Load Interface. 3.01
''' </summary>
''' <author>Stephen King</author>
''' <startstate>Unique files for processing after the database refresh</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function USBankVisaLoad

	SharedFileLoadAndProcess "USBankVisaLoad"
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the Post Liabilities process for the EX20 Expense Processing test. 20.04
''' </summary>
''' <author>Stephen King</author>
''' <startstate>ExpPostPayments sucessfully ran</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function ExpPostLiabilities

	'Call our shared processing function for this test
	SharedExpenseProcessingPost "ExpPostLiabilities"
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the Transactions process for the EX20 Expense Processing test. 20.02
''' </summary>
''' <author>Stephen King</author>
''' <startstate>ExpStagePayments test successfully ran</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'	29JAN19		Brian B.		Merged in Steve K.'s missing changes.
'**************************************************************************************************************
Public Function ExpTransactions
	Dim strDate, strNewDate, strTemp

	'Navigate to Accounts Payable > Payments > Pay cycle Processing > Payment Selection Criteria
	If SelectMainMenu1(GlobalDictionary("PaymentCriteria")) = True Then
		WriteToReport micPass, "ExpTransactions", "On the Payment Selection Criteria page.", False
	Else
		WriteToReport micFail, "ExpTransactions", "Not on the Payment Selection Criteria page.", True
		ExitTest
	End If

	'Run Refresh
	With Browser("Peoplesoft Browser").Page("Payment Selection Criteria").PSFrame("TargetContent")
	
		'Create a random 6 run control with a max length of 6. So ideally MMDDYY
		strTemp = Month(Date) & Day(Date) & Right(Year(Date), 2)
		
		'Month sometimes returns M and not MM for single digits, so pad a zero just in case
		If Len(strTemp) = 5 Then
			strTemp = "0" & strTemp
		End If

		'Navigate to the Add Run Control tab
		.Link("innertext:=Add a New Value").Click
		Browser("Peoplesoft Browser").Sync
		.WebEdit("html id:=PYCYCL_PAY_CYCLE").Set strTemp
		.WebButton("html id:=#ICSearch").Click

		'.WebEdit("RunID").Set "WED3" '"FRI3"	'"WED3"
		'.WebButton("Search").Click
		Browser("Peoplesoft Browser").Sync

'		'Error handling if the period is closed
'		If Browser("Peoplesoft Browser").Page("Payment Selection Criteria").WebButton("OK").Exist(5) Then
'			Browser("Peoplesoft Browser").Page("Payment Selection Criteria").WebButton("OK").Click
'			.WebButton("Return To Search").Click
'			Browser("Peoplesoft Browser").Sync
'
'			RunPayCycleReset "ExpTransactions"
'		End If
	'End With

		'enter the information for our test run
		'strDate = GlobalDictionary("Date")	'DD/MM/YYYY format
		strDate = Date
		strNewDate = DateAdd("ww", 1, strDate)
		'strNewDate = Date
		'strDate = DateAdd("ww", -1, strNewDate)
		WriteToReport micDone, "ExpTransactions", "Running transactions for date range between " & strDate & " and " & strNewDate, False

		'Use our current date on the following fields
		.WebEdit("PayThrough").Set strDate
		.WebEdit("PaymentDate").Set strDate
		.WebEdit("AccountingDate").Set strDate
		.WebEdit("WithholdingDate").Set strDate

		'Calculate the date a week from today
		.WebEdit("NextPayThrough").Set strNewDate
		.WebEdit("NextPayment").Set strNewDate

		'Click the Pay Cycle Manager link
		.Link("Pay Cycle Manager").Click
		Browser("Peoplesoft Browser").Sync
		
		'Data check for our new run ID
		If Browser("Peoplesoft Browser").Page("Payment Selection Criteria").WebButton("html id:= #ICOK").Exist(10) Then

			'Click OK
			Browser("Peoplesoft Browser").Page("Payment Selection Criteria").WebButton("html id:= #ICOK").Click
			
			' Click Yes
			Browser("Peoplesoft Browser").Page("Payment Selection Criteria").WebButton("html id:=#ALERTYES").Click

			'Enter our bank and account info
'			With Browser("Peoplesoft Browser").Page("Payment Selection Criteria").PSFrame("Payment Selection Criteria")
			With Browser("Peoplesoft Browser").Page("Payment Selection Criteria").PSFrame("TargetContent")
				.WebEdit("Bank").Set GlobalDictionary("Bank")
				.WebEdit("Account").Set GlobalDictionary("Account")
				.Link("Dates").Click
				Browser("Peoplesoft Browser").Sync
			End With

			'Click our Pay Cycle Manager link to continue
			.Link("Pay Cycle Manager").Click
			Browser("Peoplesoft Browser").Sync
		End If
	End With

	With Browser("Peoplesoft Browser").Page("Payment Selection Criteria").PSFrame("PayCycleManager")

		'Click the Payment Selection & Creation button
		.WebButton("Process").Click
		Browser("PeopleSoft Browser").Sync

		'Click the process monitor link
		.Link("Process Monitor").Click
		Browser("PeopleSoft Browser").Sync

		'ProcessName =  AP_APY2015. Hardcoded. No popup to pull it from
		GlobalDictionary("Process") = "AP_APY2015"
		SharedProcessMonitor "ExpTransactions"
	End With

	'Navigate back to our pay cycle page
	Browser("PeopleSoft Browser").Page("Process Monitor").PSFrame("Process Monitor").Link("Go Back").Click
	WriteToReport micDone, "ExpTransactions - Go Back to Pay Cycle Manager", "Go Back to Pay Cycle Manager link clicked", False
	Browser("PeopleSoft Browser").Sync

	'Reenter our run ID if it exists
	With Browser("Peoplesoft Browser").Page("Payment Selection Criteria").PSFrame("TargetContent")
		If .WebEdit("RunID").Exist(5) Then
			.WebEdit("RunID").Set strTemp	'"WED3"	'"FRI3"	'"WED3"
			.WebButton("Search").Click
		ElseIf .WebEdit("PayCycle").Exist(5) Then
			.WebEdit("PayCycle").Set strTemp
			.WebButton("Search").Click
		End If
		
		Browser("Peoplesoft Browser").Sync
	End With

	'validate that we have a details link we can click on and search results(if any)
	With Browser("PeopleSoft Browser").Page("Process Monitor")
		If .PSFrame("TargetContent").Link("Details").Exist(5) Then
			WriteToReport micPass, "ExpTransactions - Details", "Details link exists. Job ran and records processed.", False
		Else
			WriteToReport micFail, "ExpTransactions - Details", "Details link doesn't exist. Check input data and business unit(s).", True
			ExitTest
		End If

		'Click the Details link
		.PSFrame("TargetContent").Link("Details").Click
		Browser("Peoplesoft Browser").Sync

		'Validate we're on the new page with the results table
		If .PSFrame("Pay Cycle Data Requirements").WebTabStrip("WebTabStrip").Exist(5) Then
			.PSFrame("Pay Cycle Data Requirements").WebTabStrip("WebTabStrip").Select "Payment Details"
			WriteToReport micPass, "ExpTransactions - Payment Details", "Payment Details link clicked. Results table exists.", False
		Else
			WriteToReport micFail, "ExpTransactions - Payment Details", "Payment Details link doesn't exist.", True
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the Stage Payments process for the EX20 Expense Processing test. 20.01
''' </summary>
''' <author>Stephen King</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function ExpStagePayments

	'Call our shared processing function for EX20
	SharedExpenseProcessingPost "ExpStagePayments"
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the Post Payments process for the EX20 Expense Processing test. 20.03
''' </summary>
''' <author>Stephen King</author>
''' <startstate>ExpTransactions test successfully ran</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function ExpPostPayments

	'Call our shared processing function for EX20
	SharedExpenseProcessingPost "ExpPostPayments"
End Function

'**************************************************************************************************************
''' <summary> 
''' Shared function to run the processes for the EX20 tests
''' </summary>
''' <author>Stephen King</author>
''' <startstate></startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
''' <param>functionName - name of the function calling this. Used for reporting.</param>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function SharedExpenseProcessingPost(functionName)
	Dim strDate, strTemp
	Dim arrTemp
	Dim oldNum, newNum
	Dim nResult, sSQL, arrRecordValues, arrSqlTemp()

	'Navigate to Travel and Expenses > Process Expenses > Expense Processing
	If SelectMainMenu1(GlobalDictionary("ExpenseProcessing")) = True Then
		WriteToReport micPass, functionName, "On the Expense Processing page.", False
	Else
		WriteToReport micFail, functionName, "Not on the Expense Processing page.", True
		ExitTest
	End If

	With Browser("Peoplesoft Browser").Page("Expense Processing").PSFrame("TargetContent")

		'Use an existing run id
		.WebEdit("RunID").Set "ACReport"
		.WebButton("Search").Click
		Browser("Peoplesoft Browser").Sync
		WriteToReport micDone, functionName & " - Run Control", "Run control used - ACReport", False

		'Check if our run ID got erased
		If .WebEdit("RunID").Exist(5) Then
			'click Add New Value linke
			.Link("Add a New Value").Click

			'Click "Add" button. Run ID is carried over, no need to enter it again
			.WebButton("AddNewValue").Click
			Browser("Peoplesoft Browser").Sync
			WriteToReport micDone, functionName & " - Run Control", "Run control used - ACReport", False
		End If

		'Popup handling, sometimes appears due to business units
		If Browser("Peoplesoft Browser").Page("Expense Processing").WebButton("OK").Exist(10) Then
			Browser("Peoplesoft Browser").Page("Expense Processing").WebButton("OK").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Confirm we're on the correct page
		If .WebTabStrip("WebTabStrip").Exist(5) Then
			WriteToReport micPass, functionName & " - Expense Processing Page", "On Expense Processing page", False
		Else
			WriteToReport micFail, functionName & " - Expense Processing Page", "Not on Expense Processing page. Exiting test.", False
			ExitTest
		End If

		'Set up our business units for the test
		'Enter our data
		.WebTabStrip("WebTabStrip").Select "Selected Business Units"
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")
		.WebButton("Add").Click
		.WebButton("Save").Click
		Browser("Peoplesoft Browser").Sync
		WriteToReport micPass, functionName & " - Business Unit", "Business Unit " & GlobalDictionary("BusinessUnit") & " entered.", False

		'Return back to the previous page
		.Link("Expense Processes").Click
		Browser("Peoplesoft Browser").Sync

		'Clear any processing options
		.WebButton("Deselect All").Click

		''Select the chosen process, and store the expense report count
		Select Case UCase(GlobalDictionary("SelectProcess"))
			Case "STAGE"
				.WebCheckBox("Stage").Set "ON"
				oldNum = .WebElement("StageCount").GetROProperty("Innertext")
				WriteToReport micPass, functionName & " - Process", "Test option Stage Payments set.", False

			Case "LIABILITIES"
				.WebCheckBox("PostLiabilities").Set "ON"
				oldNum = .WebElement("LiabilitiesCount").GetROProperty("Innertext")
				WriteToReport micPass, functionName & " - Process", "Test option Post Liabilities set.", False

			Case "PAYMENTS"
				.WebCheckBox("PostPayment").Set "ON"
				oldNum = .WebElement("PaymentCount").GetROProperty("Innertext")
				WriteToReport micPass, functionName & " - Process", "Test option Post Payments set.", False

			Case Else
				WriteToReport micFail, functionName, "No process or incorrect value for SelectProcess in data sheet. Expecting Stage, Liabilities, or Payments. Exiting test."
				ExitTest
		End Select

		.WebButton("Save").Click
		Browser("Peoplesoft Browser").Sync

		'Start the process 
		.WebButton("Run").Click
		Browser("Peoplesoft Browser").Sync
	End With

	'Process popup window
	With Browser("Peoplesoft Browser").Page("Expense Processing").PSFrame("Process Scheduler Request")
		.WebCheckBox("ProcessFlag").Set "ON"

		'Grab our process name
		strTemp = .WebElement("ProcessName").GetROProperty("Innertext")
		If strTemp <> "" Then
			GlobalDictionary("Process") = strTemp
			WriteToReport micDone, functionName & " - Process Name", strTemp, False
		End If

		'Click OK
		.WebButton("OK").Click
		Browser("Peoplesoft Browser").Sync
	End With

	'Return to the main screen
	With Browser("Peoplesoft Browser").Page("Expense Processing").PSFrame("Status Bar")

		'Grab the Instance number of the new process
		strTemp = .WebElement("InstanceNumber").GetRoProperty("innertext")
		arrTemp = Split(strTemp, ":")
		GlobalDictionary("InstanceNumber") = arrTemp(1)
		WriteToReport micDone, functionName & " - Instance number", arrTemp(1), False

		'Needs the process monitor link clicked
		.Link("Process Monitor").Click
	End With

	'Run the process
	GlobalDictionary("ClearName") = True
	SharedProcessMonitor functionName

	'Return back to the original screen
	Browser("Peoplesoft Browser").Page("Process Monitor").PSFrame("Process Monitor").Link("Go back").Click

	'Close the Save popup in case it appears
	If Browser("Peoplesoft Browser").Page("Process Monitor").WebButton("No").Exist Then
		Browser("Peoplesoft Browser").Page("Process Monitor").WebButton("No").Click
		Browser("Peoplesoft Browser").Sync
	End If

	With Browser("Peoplesoft Browser").Page("Expense Processing").PSFrame("Expenses Transaction Process")

		'Store the new expense report count and compare
		Select Case UCase(GlobalDictionary("SelectProcess"))
			Case "STAGE"
				newNum = .WebElement("StageCount").GetROProperty("Innertext")

			Case "LIABILITIES"
				newNum = .WebElement("LiabilitiesCount").GetROProperty("Innertext")

			Case "PAYMENTS"
				newNum = .WebElement("PaymentCount").GetROProperty("Innertext")

			Case Else
				WriteToReport micFail, functionName, "No process or incorrect value for SelectProcess in data sheet. Expecting Stage, Liabilities, or Payments. Exiting test."
				ExitTest
		End Select
	End With

	'Compare our numbers after processing
	If oldNum >= newNum Then
		WriteToReport micPass, functionName & " - Expense Report count", "Current report count is " & newNum & ", previous was " & oldNum, False
	Else
		WriteToReport micFail, functionName & " - Expense Report count", "Current report count is " & newNum & ", previous was " & oldNum, True
	End If

	'Sql validations - optional. Needed for Payments and Liabilities.
	If GlobalDictionary("SQL") <> "" Then

		'sSQL = GlobalDictionary("SQL") & GlobalDictionary("Date") & "'"
		'strDate = DateAdd("ww", -1, Date)
		sSQL = GlobalDictionary("SQL") & Date & "'"

		'Execute our SQL query
		WriteToReport micDone, functionName & " - SQL Query", "Query being used is " & sSQL, False

		'Get the first journal that meets our criteria, exit if none found
		arrRecordValues = dbGetFirstRecord(sSQL, "", arrSqlTemp, functionName)
		nResult = -1

		'Confirm we have results
		On Error Resume Next
		nResult = UBound(arrRecordValues)
		On Error GoTo 0
		If nResult >= 0 Then
			WriteToReport micPass, functionName & " - SQL results", "Results found!", False
		Else
			WriteToReport micFail, functionName & " - SQL results", "No results found.", False
		End If

		'Compare to our original value
		If oldNum = arrRecordValues(0) Then
			WriteToReport micPass, functionName & " - Processing validation", "SQL results matches the original number", False
		Else
			WriteToReport micFail, functionName & " - Processing validation", "SQL results " & arrRecordValues(0) & " doesn't match " & oldNum, False
		End If
	End If
End Function

'Might not need. Waiting to delete until a regression run.
Public Function RunPayCycleReset
	'Navigate to the Pay Cycle Manager page
	If SelectMainMenu1(GlobalDictionary("PayCycleManager")) = True Then
		WriteToReport micPass, functionName, "On the Pay Cycle Manager page.", False
	Else
		WriteToReport micFail, functionName, "Not on the Pay Cycle Manager page.", True
		ExitTest
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' This Function "Sends Back" an Expense report that is in the "Approve" section.
''' </summary>
''' <author>Brian Buckhana</author>
''' <datecreated>10DEC18</datecreated>
''' <startstate>Login screen</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function SendBackExpenseReport()
	Dim aApprovers
	Dim bSkip
	Dim sExpectedStatus, sActualStatus

	aApprovers = Split(GlobalDictionary("Approvers"), ";")
	sExpectedStatus = "Pending"
	
	If aApprovers(0) = "(Pooled)" Then
		aApprovers(0) = GlobalDictionary("SendBackLogin")
	
		Call Login(aApprovers(0))
		
		'Navigate to the Travel and Expense>Approve Transactions>Approve Transactions
		If SelectMainMenu1(GlobalDictionary("SendBackExpenseReport")) = True Then
			WriteToReport micPass, "ApproveTransactions Page", "On the Approve Transactions page.", False
		Else
			WriteToReport micFail, "ApproveTransactions Page", "Navigation to Approve Transactions page failed. Exiting test.", True
			ExitTest
		End If	
		
		' Search
		If Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebElement("Search Pending Transactions").Exist(30) Then
			Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebElement("Search Pending Transactions").Click
			WriteToReport micDone, "Clicked the Search Pending Transactions Dropdown", "Clicked Search Pending Transactions", FALSE
		Else
			WriteToReport micFail, "Could Not Locate Search Pending Transactions Dropwdown", "Could not click Search Pending Transactions", TRUE
			ExitTest
		End If

		Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebList("COLUMN NAME").Select "Transaction ID"

		Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebList("EXPRESSION").Select "="

		Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebEdit("Criteria").Set GlobalDictionary("ExpenseReportID")

		Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").WebButton("Search").Click

		Wait 2

		Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Transactions").Link("Transaction ID First Row").Click

		' Verify "Comments required" Message box appears.
		If Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Expense Report").WebButton("Send Back").Exist(10) Then
			Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Expense Report").WebButton("Send Back").Click
			WriteToReport micDone, "Clicked the 'Send Back' Button", "Successfully Clicked the 'Send Back' button after search.", FALSE
		Else
			WriteToReport micFail, "Failed to Click the 'Send Back' Button", "Failed to click the 'Send Back' button after search.", FALSE
		End If

		If Browser("PeopleSoft Browser").Page("Approve Transactions").WebButton("CommentRequiredOK").Exist(10) Then
			WriteToReport micPass, "'Comments Required' Error Message Appeared Successfully", "'Comments Required' Error Message Appeared Successfully after clicking the 'Send Back' button.", True
			Browser("PeopleSoft Browser").Page("Approve Transactions").WebButton("CommentRequiredOK").Click
			WriteToReport micDone, "Clicked the OK Button after Verifying the Receipt", "Successfully Clicked OK", FALSE
		Else
			WriteToReport micFail, "'Comments Required' Error Message Did Not Appear", "'Comments Required' Error Message Did Not Appear after clicking the 'Send Back' button.", True
			ExitTest
		End If
		
		' Fill out 'Comments' box and click 'Send Back' again.
		Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Expense Report").WebEdit("Comments").Set GlobalDictionary("SendBackComments")
		Browser("PeopleSoft Browser").Page("Approve Transactions").PSFrame("Approve Expense Report").WebButton("Send Back").Click
		
		If Browser("PeopleSoft Browser").Page("Approve Transactions").WebElement("SendBackConfirmation").Exist(5) Then
			WriteToReport micPass, "Send Back Confirmation Appeared Successfully", "Send Back Confirmation Appeared Successfully after entering comments and clicking the 'Send Back' button.", False
			Browser("PeopleSoft Browser").Page("Approve Transactions").WebButton("SendBackOK").Click
		Else
			WriteToReport micFail, "Send Back Confirmation Did Not Appear", "Send Back Confirmation Did Not Appear after entering comments and clicking the 'Send Back' button.", True
			ExitTest
		End If
		
'		' Verify "Status".
'		'Navigate to the Travel and Expense>Approve Transactions>Approve Transactions
'		If SelectMainMenu1(GlobalDictionary("VerifySendBack")) = True Then
'			WriteToReport micPass, "View Expense Report Page", "On the View Expense Report page.", False
'		Else
'			WriteToReport micFail, "View Expense Report Page", "Navigation to View Expense Report page failed. Exiting test.", True
'			ExitTest
'		End If
'		
'		If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Report ID Search").Exist(10) Then
'			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Report ID Search").Set GlobalDictionary("ExpenseReportID")
'		ElseIf Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Report ID").Exist(10) Then
'			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Report ID").Set GlobalDictionary("ExpenseReportID")
'		End If
'		
'		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Search").Click
'		
'		If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Report Status").Exist(20) Then
'			sActualStatus = Trim(Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Report Status").GetROProperty("innertext"))
'		Else
'			ExitTest
'		End If
'		
'		If sExpectedStatus = sActualStatus Then
'			WriteToReport micPass, "Status of Report Matches", "Expected Status [" & sExpectedStatus & "] | Actual Status [" & sActualStatus & "].", False
'		Else
'			WriteToReport micFail, "Status of Report Does Not Match", "Expected Status [" & sExpectedStatus & "] | Actual Status [" & sActualStatus & "].", True
'		End If
	End If
	
	' Cleanup
	If IsArray(aApprovers) Then Erase aApprovers 
End Function

'**************************************************************************************************************
''' <summary> 
''' This Function verifies the status of an expense report.  "Pending" for a Send Back for example.
''' </summary>
''' <author>Brian Buckhana</author>
''' <datecreated>03JAN19</datecreated>
''' <startstate>Login screen</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function VerifyExpenseStatus()
	Dim sUser, sExpectedStatus, sActualStatus, sNavigation, sExpenseReportID

	sUser = GlobalDictionary("VES_Login")
	sExpectedStatus = GlobalDictionary("VES_ExpectedStatus")
	sNavigation = GlobalDictionary("VES_Navigation")
	sExpenseReportID = GlobalDictionary("ExpenseReportID")

	Call Login(sUser)

	' Verify "Status".
	'Navigate to the Travel and Expense>Approve Transactions>Approve Transactions
	If SelectMainMenu1(sNavigation) = True Then
		WriteToReport micPass, "View Expense Report Page", "On the View Expense Report page.", False
	Else
		WriteToReport micFail, "View Expense Report Page", "Navigation to View Expense Report page failed. Exiting test.", True
		ExitTest
	End If

	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Report ID Search").Exist(10) Then
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Report ID Search").Set sExpenseReportID
	ElseIf Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Report ID").Exist(10) Then
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Report ID").Set sExpenseReportID
	End If

	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Search").Click

	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Report Status").Exist(20) Then
		sActualStatus = Trim(Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Report Status").GetROProperty("innertext"))
	Else
		ExitTest
	End If
	
	If sExpectedStatus = sActualStatus Then
		WriteToReport micPass, "Status of Report Matches", "Expected Status [" & sExpectedStatus & "] | Actual Status [" & sActualStatus & "].", False
	Else
		WriteToReport micFail, "Status of Report Does Not Match", "Expected Status [" & sExpectedStatus & "] | Actual Status [" & sActualStatus & "].", True
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Find Expense Report with Attachment,  Delete Attachment, exit and view Expense Report and verify Attachment is still not available
''' </summary>
''' <author>Eric Trout</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function AttachReceiptDeleteAttachment

	Dim sFileName, aNumberofAttachments
	'Navigate to Travel and Expenses>Process Expenses>Verify Receipts>Attach Receipts
	If SelectMainMenu1(GlobalDictionary("EXAttachReceipts")) = True Then
		WriteToReport micPass, "AttachReceipts - Attach Receipts Page", "On the Attach Receipts page.", False
	Else
		WriteToReport micFail, "AttachReceipts - Attach Receipts Page", "Navigation to Attach Receipts page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Attach Receipts")

		'Make sure we are searching for receipts without attachments
		.PSFrame("TargetContent").WebList("AttachExists").Select "Yes"
		.PSFrame("TargetContent").WebButton("Search").Click
		.Sync

		'Click the first result if it exists, otherwise exit the test
		If .PSFrame("TargetContent").Link("FirstResult").Exist(10) Then
			.PSFrame("TargetContent").Link("FirstResult").Click
			WriteToReport micPass, "AttachReceipts - Results", "Search results found.", False
		Else
			WriteToReport micFail, "AttachReceipts - Results", "No search results found. Exiting test.", True
		End If

		GlobalDictionary("ExpReport") = .PSFrame("TargetContent").WebElement("ReportID").GetRoProperty("innertext")
		
		WriteToReport micDone, "Expense Report", "Expense Report [" & GlobalDictionary("ExpReport")  & "] is displayed.", False

		'Confirm that we are on a new page, otherwise exit the test
		If .PSFrame("TargetContent").WebButton("Add Attachment").Exist(10) Then
			WriteToReport micPass, "AttachReceipts - Results Page", "On the results page.", False
		Else
			WriteToReport micFail, "AttachReceipts - Results Page", "Not on the results page. Exiting test.", True
		End If
		
		'Check to see how many attachments
		aNumberofAttachments = Split(.PSFrame("TargetContent").WebElement("Number of Attachments").GetROProperty("innertext")," of ")
		
		WriteToReport micDone, "Attachments", "There are [" & aNumberofAttachments(1) & "] attachments shown.", False

		'Pull FileName of last one
		.PSFrame("TargetContent").Link("Attachment document link").SetTOProperty "html id", "VIEWBUTTON$" & aNumberofAttachments(1) - 1
		
		sFileName = Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").Link("Attachment document link").GetROProperty("innertext")

		'Delete last one
		RemoveAttachment(aNumberofAttachments(1))
		
		'Click Save
		Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").WebButton("Save").Click
		
		'Pull FileName of last one
		.PSFrame("TargetContent").Link("Attachment document link").SetTOProperty "html id", "VIEWBUTTON$" & aNumberofAttachments(1) - 1


		If .PSFrame("TargetContent").Link("Attachment document link").Exist(10) Then
			If .PSFrame("TargetContent").Link("Attachment document link").GetROProperty("innertext") <> sFileName Then
				WriteToReport micPass, "Attachment", "Attachment with File [" & sFileName & "] was removed.", False
			Else
				WriteToReport micFail, "Attachments", "Attachmentwith File [" & sFileName & "]  was not removed.", True
			End If
		Else
			'If Link does not exist then there are no attachments
			WriteToReport micPass, "Attachment", "Attachment with File [" & sFileName & "] was removed.", False		
		End If

		'Navigate back
			'Navigate to Travel and Expenses>Process Expenses>Verify Receipts>Attach Receipts
		If SelectMainMenu1(GlobalDictionary("EXAttachReceipts")) = True Then
			WriteToReport micPass, "AttachReceipts - Attach Receipts Page", "On the Attach Receipts page.", False
		Else
			WriteToReport micFail, "AttachReceipts - Attach Receipts Page", "Navigation to Attach Receipts page failed. Exiting test.", True
			ExitTest
		End If

		'Click Clear
		.PSFrame("TargetContent").WebButton("Clear").Click

		'Search for Expense Report
		.PSFrame("TargetContent").WebEdit("Report ID").Set GlobalDictionary("ExpReport")

		.PSFrame("TargetContent").WebButton("Search").Click

		'Verify on correct Expense Report
		If	GlobalDictionary("ExpReport") = .PSFrame("TargetContent").WebElement("ReportID").GetRoProperty("innertext") Then	
			WriteToReport micDone, "Expense Report", "Expense Report [" & GlobalDictionary("ExpReport")  & "] is displayed.", False
		Else
			WriteToReport micFail, "Expense Report", "Expense Report [" & GlobalDictionary("ExpReport")  & "] is not displayed.", True
			ExitTest			
		End If	


		'Verify Attachment is still gone
		'Check to see how many attachments
		aNumberofAttachments = Split(.PSFrame("TargetContent").WebElement("Number of Attachments").GetROProperty("innertext")," of ")

		'Pull FileName of last one
		.PSFrame("TargetContent").Link("Attachment document link").SetTOProperty "html id", "VIEWBUTTON$" & aNumberofAttachments(1) - 1


		If .PSFrame("TargetContent").Link("Attachment document link").Exist(10) Then
			If .PSFrame("TargetContent").Link("Attachment document link").GetROProperty("innertext") <> sFileName Then
				WriteToReport micPass, "Attachment", "Attachment with File [" & sFileName & "] was removed.", False
			Else
				WriteToReport micFail, "Attachments", "Attachmentwith File [" & sFileName & "]  was not removed.", True
			End If
		Else
			'If Link does not exist then there are no attachments
			WriteToReport micPass, "Attachment", "Attachment with File [" & sFileName & "] was removed.", False		
		End If

	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Shared file loading and executing. Currently used for 3.01 and pcard 9.01
''' </summary>
''' <author>Stephen King</author>
''' <startstate>Unique files for processing after the database refresh</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'''<param>functionName - name of the function calling it. Used for reporting.</param>
'Change Control:
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function SharedFileLoadAndProcess(functionName)
	Dim sSQL
	Dim arrProperties, arrRecordValues, arrTemp()
	Dim f, i
	Dim nResult
	Dim strDate, strDirectoryPath, strTemp, strTime
	Dim objFiles, objFolder, objFSO
	Dim oFile

	'Perform our SQL query
	sSQL = "SELECT D.CDW_EXPENSE_DIR, F.CDW_VISA_FILENAME, D.CDW_ARCH_FILENAME FROM PS_CDW_BNK_DIR D, PS_CDW_BNK_FILE F " &_
		   "WHERE D.SETID = 'SHARE' AND D.SETID = F.SETID AND F.BANK_CD = 'USB'"
	WriteToReport micDone, functionName & " - Filepath SQL Query", "Query being used is " & sSQL, False

   'Get the first journal that meets our criteria, exit if none found
	arrRecordValues = dbGetFirstRecord(sSQL, "", arrTemp, functionName)
	nResult = -1

	On Error Resume Next
	nResult = UBound(arrRecordValues)
	On Error GoTo 0
	If nResult >= 0 AND arrRecordValues(0) <> "" Then
		WriteToReport micPass, functionName & " - SQL results", "There were " & nResult + 1 & " result(s) found!", False
	Else
		WriteToReport micFail, functionName & " - SQL results", "There were 0 results found. Exiting test.", False
		ExitTest
	End If

	'store our original file path
	strDirectoryPath = GlobalDictionary("OriginalFilePath")	'"\\rmsearch\PSFN\FNREG\BackupProdfiles\"	'FNPROD\Expenses\Inbound\Processed\"	'Requested to make a copy and not use FNPROD

	'Create our object for interacting with files
	Set objFSO = CreateObject("Scripting.FileSystemObject")

	'Assign the working directory to an object
	Set objFolder = objFSO.GetFolder(strDirectoryPath)

	'Get a list of the files in our directory
	Set objFiles = objFolder.Files
	For Each f in objFiles

		'Ensure that we are working on a file specific to this test. First is usually VCF_ or VDF_, second is usually PGP or TXT
		If InStr(1, f.Name, GlobalDictionary("FileName"), vbTextCompare) >= 1 AND InStr(1, f.Name, GlobalDictionary("FileType"), vbTextCompare) >= 1 Then
			strTemp = Mid(f.DateCreated, 2, Len(f.DateCreated) - 1) 
			arrProperties = Split(strTemp, " ")

			'If this is our first file, we will use it as a baseline
			If strDate = "" Then
				strDate = arrProperties(0)
				strTime = arrProperties(1) & arrProperties(2)
				Set oFile = f

			'If our file is an older date than our previous one, use that. No need to compare the timestamp here
			ElseIf (CStr(arrProperties(0)) < strDate) = True Then
				strDate = arrProperties(0)
				strTime = arrProperties(1) & arrProperties(2)
				Set oFile = f

			'If they're the same date, then we move to compare times and update if we have an older one
			ElseIf (CStr(arrProperties(0)) = strDate) = True AND (CStr(arrProperties(1) & arrProperties(2)) < strTime) = True Then
				strDate = arrProperties(0)
				strTime = arrProperties(1) & arrProperties(2)
				Set oFile = f
			End If
		End If
	Next

	'Exit our test run if we don't have a file to work with
	If oFile <> "" Then
		WriteToReport micPass, functionName & " - " & UCase(GlobalDictionary("FileName")) & " file found", "Ready to start processing " & UCase(GlobalDictionary("FileName")) & " file " & oFile.Name & " in location " & strDirectoryPath & ", copying it to " & arrRecordValues(0) & ".", False
	Else
		WriteToReport micFail, functionName & " - No " & UCase(GlobalDictionary("FileName")) & " file found to process", "Unable to find a " & UCase(GlobalDictionary("FileName")) & " file to process in location " & strDirectoryPath & ".", False
		ExitTest
	End If

	'Copy the file from the start location to the new one, as well as backing it up in the olddata folder, then deleting it so we don't process it again
	'strDirectoryPath - initial(hardcoded) pgp file path
	'oFile.Name - most recent file in that folder
	'arrRecordValues(0) - path from the SQL query
	'New file name. "" uses the same as before.
	CopyFSO strDirectoryPath, oFile.Name, arrRecordValues(0), ""
	CopyFSO strDirectoryPath, oFile.Name, strDirectoryPath & "olddata\", ""
	DeleteFile strDirectoryPath & oFile.Name

	'Navigate to the process monitor page
	If SelectMainMenu1(GlobalDictionary("ProcessMonitor1")) = True Then
		WriteToReport micPass, functionName & " - Process Monitor Page", "On the Process Monitor page.", False
	Else
		WriteToReport micFail, functionName & " - Process Monitor Page", "Navigation to Process Monitor page failed. Exiting test.", True
		ExitTest
	End If

	'New SQL query to start the daemon process(if not already)
	'FYI - if this ever stops working, use CDW_USB_DMN as the name and follow the steps in function VerifyGLDaemonProcesses(PSFIN_AR_BI.qfl)
	sSQL = "UPDATE PS_CDW_DMN_CONTROL SET ACTIVE_FLAG = 'A' WHERE AE_APPLID = 'CDW_USB_DMN'"
	WriteToReport micDone, functionName & " - Daemon Control SQL Query", "Query being used is " & sSQL, False

	'Execute our SQL statement
	dbExecuteStatement sSQL

	'Clear our login name, as the process is ran by someone else
	GlobalDictionary("ClearName") = True

	'Monitor our process - name is known for each one, no Run window to take it from. 
	SharedProcessMonitor functionName

	'Execute SQL to check results of process
	'Get today's date in YYYY-MM-DD format"
	strDate = DatePart("yyyy", Now()) & "-" & DatePart("m", Now()) & "-" & DatePart("d", Now())
	sSQL = "SELECT * FROM PS_EX_TRANS WHERE TXN_LOAD_DATE = '" & strDate & "'"
	WriteToReport micDone, functionName & " - Process Results SQL Query", "Query being used is " & sSQL, False

	'Get the first journal that meets our criteria, exit if none found
	arrRecordValues = dbGetFirstRecord(sSQL, "", arrTemp, "USBankVisaLoad")
	nResult = -1

	On Error Resume Next
	nResult = UBound(arrRecordValues)
	On Error GoTo 0
	If nResult >= 0 AND arrRecordValues(0) <> "" Then
		WriteToReport micPass, functionName & " - SQL results", "There were " & nResult + 1 & " result(s) found!", False
	Else
		WriteToReport micFail, functionName & " - SQL results", "There were 0 results found. Exiting test.", False
		ExitTest
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' PCard VDF file load. 9.01
''' </summary>
''' <author>Stephen King</author>
''' <startstate>Unique files for processing after the database refresh</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function PCardFileLoad

	SharedFileLoadAndProcess "PCardFileLoad"
End Function

'**************************************************************************************************************
''' <summary> 
''' This Function fills out the itemized hotel bill.
''' </summary>
''' <author>Brian Buckhana</author>
''' <datecreated>11DEC18</datecreated>
''' <startstate>Itemized Hotel hyperlink visible</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function ItemizeHotelBill()
	Dim sDate, sPaymentType, sBillingType
	Dim nNights, nAmountSpent, nNumOfNights
	Dim bRoomCharge, bRoomService, bTelephone_Internet, bParking, bLaundry, bMiscCharges
	
	' Required Fields
	sDate = GlobalDictionary("ITH_Date")
	sPaymentType = GlobalDictionary("ITH_PaymentType")
	sBillingType = GlobalDictionary("ITH_BillingType")
	nNights = GlobalDictionary("ITH_NumberOfNights")
	nAmountSpent = GlobalDictionary("ITH_AmountSpent")
	
	' Optional Fields
	If GlobalDictionary.Exists("ITH_RoomService") Then bRoomService = CBool(GlobalDictionary("ITH_RoomService"))
	If GlobalDictionary.Exists("ITH_RoomCharge") Then bRoomCharge = CBool(GlobalDictionary("ITH_RoomCharge"))
	If GlobalDictionary.Exists("ITH_Telephone_Internet") Then bTelephone_Internet = CBool(GlobalDictionary("ITH_Telephone_Internet"))
	If GlobalDictionary.Exists("ITH_Parking") Then bParking = CBool(GlobalDictionary("ITH_Parking"))
	If GlobalDictionary.Exists("ITH_Laundry") Then bLaundry = CBool(GlobalDictionary("ITH_Laundry"))
	If GlobalDictionary.Exists("ITH_MiscCharges") Then bMiscCharges = CBool(GlobalDictionary("ITH_MiscCharges"))
	
	' Click hyperlink to bring up the page.
	With Browser("PeopleSoft Browser").Page("Create/Modify Expenses")
		If .PSFrame("TargetContent").Link("Itemize Hotel Bill").Exist(10) Then
			.PSFrame("TargetContent").Link("Itemize Hotel Bill").Click
		ElseIf .PSFrame("TargetContent").Link("ItemizeHotelBill").Exist(10) Then ' Create Expenses
			.PSFrame("TargetContent").Link("ItemizeHotelBill").Click
		Else
			WriteToReport micFail, "'Itemize Hotel Bill' Hyperlink Not Visible", "The 'Itemize Hotel Bill' hyperlink is not visible on screen.", True
		End If
	End With
	
	With Browser("PeopleSoft Browser").Page("Create/Modify")
		' Verify Navigation
		If .PsFrame("Itemize Hotel Bill").WebEdit("Transaction Date").Exist(10) Then
			WriteToReport micPass, "Navigation Successful", "Navigation successful after clicking the 'Itemize Hotel Bill' hyperlink.", False
		Else
			WriteToReport micFail, "Navigation Failure", "Navigation failed after clicking the 'Itemize Hotel Bill' hyperlink.", True
			ExitTest
		End If
		
		' Fill out the required fields.
		' TRANSACTION DATE
		' Use today's date if it says "TODAY".
		If sDate = "TODAY" Then
			sDate = CStr(date())' mm/dd/ccyy is the default format.
		ElseIf sDate = "Add_MinusDAYS" Then
			nNumOfNights = CInt(GlobalDictionary("Add_MinusDays"))
			sDate = CStr(DateAdd("d", nNumOfNights, date()))
		End If
		
		.PSFrame("Itemize Hotel Bill").WebEdit("Transaction Date").Set sDate
		
		' PAYMENT TYPE
		.PSFrame("Itemize Hotel Bill").WebList("Payment Type").Select sPaymentType
		
		' BILLING TYPE
		.PSFrame("Itemize Hotel Bill").WebList("Billing Type").Select sBillingType
		
		' NUMBER OF NIGHTS
		.PSFrame("Itemize Hotel Bill").WebEdit("Number of Nights").Set nNights
		
		' AMOUNT SPENT
		.PSFrame("Itemize Hotel Bill").WebEdit("Amount Spent").Set nAmountSpent
		
		' Fill out the optional fields.
		' ROOM SERVICE
		If GlobalDictionary.Exists("ITH_RoomService") Then
			.PSFrame("Itemize Hotel Bill").WebCheckBox("Room Service").Click
		End If
		
		' ROOM CHARGE
		If GlobalDictionary.Exists("ITH_RoomCharge") Then
			.PSFrame("Itemize Hotel Bill").WebCheckBox("Room Charge").Click
		End If
		
		' TELEPHONE/INTERNET
		If GlobalDictionary.Exists("ITH_Telephone_Internet") Then
			.PSFrame("Itemize Hotel Bill").WebCheckBox("Telephone_Internet").Click
		End If
		
		' PARKING
		If GlobalDictionary.Exists("ITH_Parking") Then
			.PSFrame("Itemize Hotel Bill").WebCheckBox("Parking").Click
		End  If
		
		' LAUNDRY
		If GlobalDictionary.Exists("ITH_Laundry") Then
			.PSFrame("Itemize Hotel Bill").WebCheckBox("Laundry").Click
		End If
		
		' MISC CHARGES
		If GlobalDictionary.Exists("ITH_MiscCharges") Then
			.PSFrame("Itemize Hotel Bill").WebCheckBox("Misc Charges").Click
		End If
		
		' Finish by clicking "Continue".
		.PSFrame("Itemize Hotel Bill").WebButton("Continue").Click
		
		' Fill out clicked checkbox sections.
		' ROOM CHARGE
		If bRoomCharge Then
			Call HotelBillRoomCharge(GlobalDictionary("RC_Date"), GlobalDictionary("RC_NumberOfNights"), GlobalDictionary("RC_RoomRate"), GlobalDictionary("RC_RoomTax"))
		End If
		
		' ROOM SERVICE
		If bRoomService Then
			' Verify Error Message that appears after you click continue.
			If GlobalDictionary.Exists("RS_ErrorMessage") Then
				Call HotelBillRoomService(GlobalDictionary("RS_Date"), "VERIFY", 0)
				Call HotelBillFinalize()
			End If
			
			Call HotelBillRoomService(GlobalDictionary("RS_Date"), GlobalDictionary("RS_MealType"), GlobalDictionary("RS_Amount"))
		End If	
		
		' TELEPHONE/INTERNET
		If bTelephone_Internet Then
			Call HotelBillTelephoneInternet(GlobalDictionary("TI_Date"), GlobalDictionary("TI_Amount"))
		End If
		
		' PARKING
		If bParking Then
			Call HotelBillParking(GlobalDictionary("P_Date"), GlobalDictionary("P_Amount"))
		End If
		
		' LAUNDRY
		If bLaundry Then
			Call HotelBillLaundry(GlobalDictionary("L_Date"), GlobalDictionary("L_Amount"))
		End If
		
		' MISCELLANEOUS CHARGES
		If bMiscCharges Then
			Call HotelBillMiscCharges(GlobalDictionary("MC_Date"), GlobalDictionary("MC_ExpenseType"), GlobalDictionary("MC_Amount"))
		End If
	End With
	
	' Finalize
	Call HotelBillFinalize()
End Function

'**************************************************************************************************************
''' <summary> 
''' This Function fills out the itemized hotel bill room charge section.
''' </summary>
''' <author>Brian Buckhana</author>
''' <datecreated>26DEC18</datecreated>
''' <startstate>Itemized Hotel Room Charge section visible.</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function HotelBillRoomCharge(sDate, nNumOfNights, nRoomRate, nRoomTax)
	Dim nNights

	With Browser("PeopleSoft Browser").Page("Create/Modify")
		' Verify Navigation
		If .PSFrame("Itemize Hotel Bill").WebEdit("Room Charge Date").Exist(10) Then
			WriteToReport micPass, "Navigation Successful", "Navigation successful to the Hotel Bill Room Charge page.", False
		Else
			WriteToReport micFail, "Navigation Failure", "Navigation failed to reach the Hotel Bill Room Charge page.", True
			ExitTest
		End If
		
		' Fill out fields.
		' DATE
		' Use today's date if it says "TODAY".
		If sDate = "TODAY" Then
			sDate = CStr(date())' mm/dd/ccyy is the default format.
		ElseIf sDate = "Add_MinusDAYS" Then
			nNights = CInt(GlobalDictionary("Add_MinusDays"))
			sDate = CStr(DateAdd("d", nNights, date()))
		End If
		
		.PSFrame("Itemize Hotel Bill").WebEdit("Room Charge Date").Set sDate
		
		' NUMBER OF NIGHTS
		.PSFrame("Itemize Hotel Bill").WebEdit("Room Charge Number Of Nights").Set nNumOfNights
		
		' ROOM RATE
		.PSFrame("Itemize Hotel Bill").WebEdit("Room Charge Room Rate").Set nRoomRate
		
		' ROOM TAX
		.PSFrame("Itemize Hotel Bill").WebEdit("Room Charge Room Tax").Set nRoomTax
		
		' Finish and continue.
		.PSFrame("Itemize Hotel Bill").WebButton("Continue").Click
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' This Function fills out the itemized hotel bill Telephone/Internet section.
''' </summary>
''' <author>Brian Buckhana</author>
''' <datecreated>26DEC18</datecreated>
''' <startstate>Itemized Hotel Telephone/Internet section visible.</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function HotelBillTelephoneInternet(sDate, nAmount)
	With Browser("PeopleSoft Browser").Page("Create/Modify")
		' Verify Navigation
		If .PSFrame("Itemize Hotel Bill").WebEdit("Telephone_Internet Date").Exist(10) Then
			WriteToReport micPass, "Navigation Successful", "Navigation successful to the Hotel Bill Telephone/Internet page.", False
		Else
			WriteToReport micFail, "Navigation Failure", "Navigation failed to reach the Hotel Bill Telephone/Internet page.", True
			ExitTest
		End If
		
		' Verify Hotel Bill Values
		If GlobalDictionary.Exists("TI_VerifyHotelBill") Then
			Call HotelBillCompare(Split(GlobalDictionary("TI_VerifyHotelBill"), "|"))
		End If
		
		' Fill out fields.
		' DATE
		' Use today's date if it says "TODAY".
		If sDate = "TODAY" Then
			sDate = CStr(date())' mm/dd/ccyy is the default format.
		End If
		
		.PSFrame("Itemize Hotel Bill").WebEdit("Telephone_Internet Date").Set sDate
		
		' AMOUNT
		.PSFrame("Itemize Hotel Bill").WebEdit("Telephone_Internet Amount").Set nAmount
		
		' Finish and continue.
		.PSFrame("Itemize Hotel Bill").WebButton("Continue").Click
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' This Function fills out the itemized hotel bill Laundry section.
''' </summary>
''' <author>Brian Buckhana</author>
''' <datecreated>26DEC18</datecreated>
''' <startstate>Itemized Hotel Laundry section visible.</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function HotelBillLaundry(sDate, nAmount)
	With Browser("PeopleSoft Browser").Page("Create/Modify")
		' Verify Navigation
		If .PSFrame("Itemize Hotel Bill").WebEdit("Laundry Date").Exist(10) Then
			WriteToReport micPass, "Navigation Successful", "Navigation successful to the Hotel Bill Laundry page.", False
		Else
			WriteToReport micFail, "Navigation Failure", "Navigation failed to reach the Hotel Bill Laundry page.", True
			ExitTest
		End If
		
		' Verify Hotel Bill Values
		If GlobalDictionary.Exists("L_VerifyHotelBill") Then
			Call HotelBillCompare(Split(GlobalDictionary("L_VerifyHotelBill"), "|"))
		End If
		
		' Fill out fields.
		' DATE
		' Use today's date if it says "TODAY".
		If sDate = "TODAY" Then
			sDate = CStr(date())' mm/dd/ccyy is the default format.
		End If
		
		.PSFrame("Itemize Hotel Bill").WebEdit("Laundry Date").Set sDate
		
		' AMOUNT
		.PSFrame("Itemize Hotel Bill").WebEdit("Laundry Amount").Set nAmount
		
		' Finish and continue.
		.PSFrame("Itemize Hotel Bill").WebButton("Continue").Click
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' This function verifies how many expense lines are visible.
''' </summary>
''' <author>Brian Buckhana</author>
''' <datecreated>27DEC18</datecreated>
''' <startstate>Expense Lines visible.</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function VerifyExpenseLines(nLinesToVerify)
	Dim i
	Dim sExpenseName

	With Browser("PeopleSoft Browser").Page("Create/Modify Expenses")
		' Verify a certain amount of lines are visible.
		For i = 1 To nLinesToVerify
			Call .PSFrame("TargetContent").WebList("Expense Type").SetTOProperty("name", "EXPENSE_TYPE$" & (i - 1))
			If .PSFrame("TargetContent").WebList("Expense Type").Exist(5) Then
				sExpenseName = .PSFrame("TargetContent").WebList("Expense Type").GetROProperty("value")
				WriteToReport micPass, "Expense #[" & i & "] Exists", "The name of this expense is [" & sExpenseName & "]", False
			Else
				WriteToReport micFail, "Expense #[" & i & "] Does Not Exist", "Expense is not visible.", True
			End If
		Next
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' This Function fills out the itemized hotel bill Parking section.
''' </summary>
''' <author>Brian Buckhana</author>
''' <datecreated>26DEC18</datecreated>
''' <startstate>Itemized Hotel Parking section visible.</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function HotelBillParking(sDate, nAmount)
	With Browser("PeopleSoft Browser").Page("Create/Modify")
		' Verify Navigation
		If .PSFrame("Itemize Hotel Bill").WebEdit("Parking Date").Exist(10) Then
			WriteToReport micPass, "Navigation Successful", "Navigation successful to the Hotel Bill Parking page.", False
		Else
			WriteToReport micFail, "Navigation Failure", "Navigation failed to reach the Hotel Bill Parking page.", True
			ExitTest
		End If
		
		' Verify Hotel Bill Values
		If GlobalDictionary.Exists("P_VerifyHotelBill") Then
			Call HotelBillCompare(Split(GlobalDictionary("P_VerifyHotelBill"), "|"))
		End If
		
		' Fill out fields.
		' DATE
		' Use today's date if it says "TODAY".
		If sDate = "TODAY" Then
			sDate = CStr(date())' mm/dd/ccyy is the default format.
		End If
		
		.PSFrame("Itemize Hotel Bill").WebEdit("Parking Date").Set sDate
		
		' AMOUNT
		.PSFrame("Itemize Hotel Bill").WebEdit("Parking Amount").Set nAmount
		
		' Finish and continue.
		.PSFrame("Itemize Hotel Bill").WebButton("Continue").Click
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' This Function fills out the itemized hotel bill room service section.
''' </summary>
''' <author>Brian Buckhana</author>
''' <datecreated>12DEC18</datecreated>
''' <startstate>Itemized Hotel Room Service section visible.</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function HotelBillRoomService(sDate, sMealType, nAmount)
	Dim sActualMealTypes
	Dim aExpectedMealTypes
	Dim nVRoomCharge, nVRoomTax, nVRemainingAmount, nActual
	Dim i

	With Browser("PeopleSoft Browser").Page("Create/Modify")
		' Verify Navigation
		If .PSFrame("Itemize Hotel Bill").WebEdit("Room Service Date").Exist(10) Then
			WriteToReport micPass, "Navigation Successful", "Navigation successful to the Hotel Bill Room Service page.", False
		Else
			WriteToReport micFail, "Navigation Failure", "Navigation failed to reach the Hotel Bill Room Service page.", True
			ExitTest
		End If
		
		' Verify Hotel Bill Values
		If GlobalDictionary.Exists("RS_VerifyHotelBill") Then
			Call HotelBillCompare(Split(GlobalDictionary("RS_VerifyHotelBill"), "|"))
		End If
		
		' Fill out fields.
		' DATE
		' Use today's date if it says "TODAY".
		If sDate = "TODAY" Then
			sDate = CStr(date())' mm/dd/ccyy is the default format.
		End If
		
		.PSFrame("Itemize Hotel Bill").WebEdit("Room Service Date").Set sDate
		
		' MEAL TYPE
		If sMealType = "VERIFY" Then ' Verify the meal types are inside the list.
			aExpectedMealTypes = Split(GlobalDictionary("RS_VerifyMealTypes"), ";")
			sActualMealTypes = .PSFrame("Itemize Hotel Bill").WebList("Room Service Meal Type").GetROProperty("all items")
			
			For i = 0 To UBound(aExpectedMealTypes)
				If InStr(1, aExpectedMealTypes(i), sActualMealTypes, VBTextCompare) > 0 Then
					WriteToReport micPass, "Meal Type [" & aExpectedMealTypes(i) & "] Found In Room Service Dropdown", "Meal Type [" & aExpectedMealTypes(i) & "] found in dropdown on room service page.", False
				Else
					WriteToReport micFail, "Meal Type [" & aExpectedMealTypes(i) & "] Not Found In Room Service Dropdown", "Meal Type [" & aExpectedMealTypes(i) & "] not found in dropdown [" & sActualMealTypes & "] on room service page.", False
				End If
			Next
		Else ' Set Meal type regularly.
			.PSFrame("Itemize Hotel Bill").WebList("Room Service Meal Type").Select sMealType
		End If
		
		' AMOUNT
		.PSFrame("Itemize Hotel Bill").WebEdit("Room Service Amount").Set nAmount
		
		' Finish and continue.
		.PSFrame("Itemize Hotel Bill").WebButton("Continue").Click
	End With

	' Cleanup
	If isArray(aExpectedMealTypes) Then Erase aExpectedMealTypes
End Function

'**************************************************************************************************************
''' <summary> 
''' This Function fills out the itemized hotel bill misc charges section.
''' </summary>
''' <author>Brian Buckhana</author>
''' <datecreated>26DEC18</datecreated>
''' <startstate>Itemized Hotel Misc Charges section visible.</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function HotelBillMiscCharges(sDates, sExpenseTypes, sAmounts)
	Dim aDates, aExpenseTypes, aAmounts
	Dim sDate, sExpenseType
	Dim nAmount, i, nNumOfNights

	aDates = Split(sDates, ";")
	aExpenseTypes = Split(sExpenseTypes, ";")
	aAmounts = Split(sAmounts, ";")

	With Browser("PeopleSoft Browser").Page("Create/Modify")
		' Verify Navigation
		If .PSFrame("Itemize Hotel Bill").WebEdit("Misc Date").Exist(10) Then
			WriteToReport micPass, "Navigation Successful", "Navigation successful to the Hotel Bill Misc Charges page.", False
		Else
			WriteToReport micFail, "Navigation Failure", "Navigation failed to reach the Hotel Bill Misc Charges page.", True
			ExitTest
		End If
		
		' Verify Hotel Bill Values
		If GlobalDictionary.Exists("MC_VerifyHotelBill") Then
			Call HotelBillCompare(Split(GlobalDictionary("MC_VerifyHotelBill"), "|"))
		End If
		
		' Fill out fields.
		For i = 0 To UBound(aDates)
			sDate = aDates(i)
			sExpenseType = aExpenseTypes(i)
			nAmount = aAmounts(i)
			
			' DATE
			' Use today's date if it says "TODAY".
			If sDate = "TODAY" Then
				sDate = CStr(date())' mm/dd/ccyy is the default format.
			ElseIf sDate = "ADD_NUMOFNIGHTS" Then
				nNumOfNights = CInt(GlobalDictionary("ITH_NumberOfNights"))
				sDate = CStr(DateAdd("d", nNumOfNights, date()))
			End If
			
			.PSFrame("Itemize Hotel Bill").WebEdit("Misc Date").SetTOProperty "name", "EX_SHT_RCPT_TMP_TRANS_DT$" & i
			.PSFrame("Itemize Hotel Bill").WebEdit("Misc Date").Set sDate
			
			' EXPENSE TYPE
			.PSFrame("Itemize Hotel Bill").WebList("Misc Expense Type").SetTOProperty "name", "EX_SHT_RCPT_TMP_EXPENSE_TYPE$" & i
			.PSFrame("Itemize Hotel Bill").WebList("Misc Expense Type").Select sExpenseType

			' AMOUNT
			.PSFrame("Itemize Hotel Bill").WebEdit("Misc Amount").SetTOProperty "name", "EX_SHT_RCPT_TMP_TXN_AMOUNT$" & i
			.PSFrame("Itemize Hotel Bill").WebEdit("Misc Amount").Set nAmount
			
			If NOT(i = UBound(aDates)) Then
				.PSFrame("Itemize Hotel Bill").WebButton("Add Charge").Click
			End If
		Next
		
		' Finish and continue.
		.PSFrame("Itemize Hotel Bill").WebButton("Continue").Click
	End With
	
	' Cleanup
	If isArray(aDates) Then Erase aDates
	If isArray(aExpenseTypes) Then Erase aExpenseTypes
	If isArray(aAmounts) Then Erase aAmounts
End Function

'**************************************************************************************************************
''' <summary> 
''' This Function compares and reports out an item on the hotel bill.
''' </summary>
''' <author>Brian Buckhana</author>
''' <datecreated>26DEC18</datecreated>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function HotelBillCompare(aLineItemsAndValues)
	Dim i
	Dim nExpected, nActual
	Dim sItemCompared, sWebElement
	Dim aLineItemAndValue

	With Browser("PeopleSoft Browser").Page("Create/Modify")
		For i = 0 To UBound(aLineItemsAndValues)
			aLineItemAndValue = Split(aLineItemsAndValues(i), ";")
			sItemCompared = Trim(aLineItemAndValue(0))
			nExpected = aLineItemAndValue(1)
			
			Select Case UCase(sItemCompared)
				Case "ROOM CHARGE"
					sWebElement = "Bill Room Charge"					
				Case "ROOM TAX"
					sWebElement = "Bill Room Tax"
				Case "ROOM SERVICE"
					sWebElement = "Bill Room Service"
				Case "TELEPHONE/INTERNET"
					sWebElement = "Bill Telephone_Internet"
				Case "PARKING"
					sWebElement = "Bill Parking"
				Case "LAUNDRY"
					sWebElement = "Bill Laundry"
				Case "MISC CHARGES"
					sWebElement = "Bill Misc Charges"
				Case "REMAINING AMOUNT"
					sWebElement = "Bill Remaining Amount"
				Case Else
					WriteToReport micFail, "[" & sItemCompared & "] is Not A Recognized Hotel Bill Line Item", "Please check the case statement or your input for errors.", False
			End Select
		
			nActual = Trim(.PSFrame("Itemize Hotel Bill").WebElement(sWebElement).GetROProperty("innertext"))
			
			If nExpected = nActual Then
				WriteToReport micPass, "[" & sItemCompared & "] On 'Your Hotel Bill'", "Expected [" & nExpected & "] matches actual [" & nActual & "].", False
			Else
				WriteToReport micFail, "[" & sItemCompared & "] Does Not Match On 'Your Hotel Bill'", "Expected [" & nExpected & "] does not match actual [" & nActual & "].", True
			End If
		Next
	End With
	
	' Cleanup
	If isArray(aLineItemAndValue) Then Erase aLineItemAndValue
End Function

'**************************************************************************************************************
''' <summary> 
''' This Function handles the finalize page of the hotel itemzation process.
''' </summary>
''' <author>Brian Buckhana</author>
''' <datecreated>12DEC18</datecreated>
''' <startstate>Itemized Hotel Finalize section visible.</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function HotelBillFinalize()
	Dim sErrorMessage, sActualMessage

	' Verify Error Message
	If GlobalDictionary.Exists("RS_ErrorMessage") Then
		sErrorMessage = GlobalDictionary("RS_ErrorMessage")
	End If

	With Browser("PeopleSoft Browser").Page("Create/Modify")
		If Len(sErrorMessage) > 0 Then
			sActualMessage = .PSFrame("Itemize Hotel Bill").WebElement("Hotel Itemization Finish Error Message").GetROProperty("innerText")
			If Instr(1, sActualMessage, sErrorMessage, VBTextCompare) > 0 Then
				WriteToReport micPass, "Error Message Successfully Found", "Error Message Successfully Found: Expected [" & sErrorMessage & "] | Actual [" & sActualMessage & "].", False
			Else
				WriteToReport micFail, "Error Message Not Found", "Error Message Not Found: Expected [" & sErrorMessage & "] | Actual [" & sActualMessage & "].", False
			End If
			
			' Allows the function to continue if it is called again.
			If GlobalDictionary.Exists("RS_ErrorMessage") Then 
				GlobalDictionary.Remove("RS_ErrorMessage")
			End If
			
			' Return to previous page so that the error can be fixed.
			.PSFrame("Itemize Hotel Bill").WebButton("Previous").Click
			
		Else ' Continue normally without error message verify.
			' Verify Final Hotel Bill Values
			If GlobalDictionary.Exists("F_VerifyHotelBill") Then
				Call HotelBillCompare(Split(GlobalDictionary("F_VerifyHotelBill"), "|"))
			End If
			
			' Finish by clicking "Done".
			.PSFrame("Itemize Hotel Bill").WebButton("Done").Click
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Login as Approver and Verify Attachments
''' </summary>
''' <author>Eric Trout</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'	24JAN19		Brian B.		Added .Exist for transaction ID link click.
'	28JAN19		Brian B.		Added a .Sync to help with page navigation.
'**************************************************************************************************************
Public Function ReviewAttachmentPaths
	Dim aApprovers, aLineAttachments, aHeaderAttachments
	Dim sLineAttachments, sHeaderAttachments, nResult

	'Login as Approver, use login captured
	aApprovers = Split(GlobalDictionary("Approvers"), ";")
	Call Login(aApprovers(1))

	'Verify Attachment in each of these areas, File must be displayed,  Attachments(1) is shown, File opens from link,  Line Attachemnt is available
	'Travel and Expenses --> Approve Transactions --> Approve Transactions
	'Navigate to the Travel and Expense>Approve Transactions>Approve Transactions
	If SelectMainMenu1(GlobalDictionary("ApproveExpenseReport")) = True Then
		WriteToReport micPass, "ReviewAttachmentPaths", "On the Approve Transactions page.", False
	Else
		WriteToReport micFail, "ReviewAttachmentPaths", "Navigation to Approve Transactions page failed. Exiting test.", True
		ExitTest
	End If	

	With Browser("PeopleSoft Browser").Page("Approve Transactions")
		If .PSFrame("Approve Transactions").WebElement("Search Pending Transactions").Exist(30) Then
			.PSFrame("Approve Transactions").WebElement("Search Pending Transactions").Click
			WriteToReport micDone, "Clicked the Search Pending Transactions Dropdown", "Clicked Search Pending Transactions", FALSE
		Else
			WriteToReport micFail, "Could Not Locate Search Pending Transactions Dropwdown", "Could not click Search Pending Transactions", TRUE
			ExitTest
		End If
	
		.PSFrame("Approve Transactions").WebList("COLUMN NAME").Select "Transaction ID"
		.PSFrame("Approve Transactions").WebList("EXPRESSION").Select "="
		.PSFrame("Approve Transactions").WebEdit("Criteria").Set GlobalDictionary("ExpenseReportID")
		.PSFrame("Approve Transactions").WebButton("Search").Click
		Wait 2
		.PSFrame("Approve Transactions").Link("Transaction ID First Row").Click	
		'Verify Header Attachment

		'Verify Header Attachment- shows (1)
		'Grab innertext - Split by"("
		.Sync
		
		' Give extra time for page to finish transitioning and loading in Win 10.
		If .Image("Processing Circle").Exist(10) Then
			WriteToReport micInfo, "Processing Circle Still Visible", "Page is still transitioning.", TRUE
			Wait 5
		End If
		
		If .PSFrame("Approve Expense Report").Link("Attachments").Exist(10) Then ' PSFRame will sometimes not be found.
			aHeaderAttachments = Split(.PSFrame("Approve Expense Report").Link("Attachments").GetROProperty("innertext"),"(")
		Else
			WriteToReport micFail, "Failed To Navigate to Expense Report", "Failed to navigate after clicking transaction ID", TRUE
			ExitTest
		End If
		
		'Verify i has attachments
		If ubound(aHeaderAttachments) < 1 Then
			WriteToReport micFail, "Header attachment", "There are not any attachments displayed", TRUE
			ExitTest			
		End If

		'Replace")" with "" in (0)
		sHeaderAttachments = Replace(aHeaderAttachments(1),")","")

		'Compare with expected - GlobalDictionary Value for HeaderAttachments
		If sHeaderAttachments = GlobalDictionary("NumHeaderAttachments") Then
			WriteToReport micPass, "Header attachment", "There are [" &sHeaderAttachments &"] displayed as expected.", TRUE	
		Else	
			WriteToReport micFail, "Header attachment", "There are [" &sHeaderAttachments &"] displayed, Expect [" &GlobalDictionary("NumHeaderAttachments") & "].",TRUE	
		End If

		.PSFrame("Approve Expense Report").Link("Attachments").Click		
		nResult = VerifyAttachment (GlobalDictionary("FileName"),"1","True")
		If nResult <> 1 Then
			WriteToReport micPass, "Header attachment", "Attachment has been verified.", TRUE			
		Else
			WriteToReport micFail, "Header attachment", "Attachment is not correct.", TRUE			
		End If

		'Click OK to close attachment window
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Expense Report Attachments").WebButton("OK").Click

		'Verify Line Attachment- shows (1)
		'Grab innertext - Split by"("
		aLineAttachments = Split(.PSFrame("Approve Expense Report").Link("LineAttachment").GetROProperty("innertext"),"(")
		If ubound(aLineAttachments) < 1 Then
			WriteToReport micFail, "Line attachment", "There are not any attachments displayed", TRUE
			ExitTest			
		End If

		'Replace")" with "" in (0)
		sLineAttachments = Replace(aLineAttachments(1),")","")

		'Compare with expected - GlobalDictionary Value for :ineAttachments
		If sLineAttachments = GlobalDictionary("NumLineAttachments") Then
			WriteToReport micPass, "Line attachment", "There are [" &sLineAttachments &"] displayed as expected.", TRUE	
		Else	
			WriteToReport micFail, "Line attachment", "There are [" &sLineAttachments &"] displayed, Expect [" &GlobalDictionary("NumLineAttachments") & "].",TRUE	
		End If

		.PSFrame("Approve Expense Report").Link("LineAttachment").Click		
		nResult = VerifyAttachment (GlobalDictionary("FileName"),"1","True") 
		If nResult <> 1 Then
			WriteToReport micPass, "Line attachment", "Attachment has been verified.", TRUE			
		Else
			WriteToReport micFail, "Line attachment", "Attachment is not correct.", TRUE			
		End If
	End With

	'Click OK to close attachment window
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Expense Report Attachments").WebButton("OK").Click

	'Travel and Expenses --> Process Expenses --> Verify Receipts --> Validate Against Expenses
	'Navigate to the Travel and Expense>Process Expenses>Verify Receipts>Validate Against Expenses
	If SelectMainMenu1(GlobalDictionary("ValidateAgainstExp")) = True Then
		WriteToReport micPass, "ReviewAttachmentPaths", "On the Verify Expense Report Receipt page.", False
	Else
		WriteToReport micFail, "ReviewAttachmentPaths", "Navigation to Verify Expense Report Receipt page failed. Exiting test.", True
		ExitTest
	End If	

	With Browser("PeopleSoft Browser").Page("Validate Against Expenses")
		.PSFrame("TargetContent").WebEdit("Report ID").Set GlobalDictionary("ExpenseReportID")
		.PSFrame("TargetContent").WebButton("Search").Click

		'Confirm that we are on a new page, otherwise exit the test
		If .PSFrame("TargetContent").Link("Attachments").Exist(10) Then
			WriteToReport micPass, "Validate Against Expenses Page", "On the Validate Against Expenses page.", False
		Else
			WriteToReport micFail, "Validate Against Expenses Page", "Not on the Validate Against Expenses page. Exiting test.", True
			ExitTest
		End If

		'Verify Header Attachment	
		'Verify Header Attachment- shows (1)
		'Grab innertext - Split by"("
		aHeaderAttachments = Split(.PSFrame("TargetContent").Link("Attachments").GetROProperty("innertext"),"(")
		'Verify i has attachments
		If ubound(aHeaderAttachments) < 1 Then
			WriteToReport micFail, "Header attachment", "There are not any attachments displayed", TRUE
			ExitTest			
		End If

		'Replace")" with "" in (0)
		sHeaderAttachments = Replace(aHeaderAttachments(1),")","")

		'Compare with expected - GlobalDictionary Value for HeaderAttachments
		If sHeaderAttachments = GlobalDictionary("NumHeaderAttachments") Then
			WriteToReport micPass, "Header attachment", "There are [" &sHeaderAttachments &"] displayed as expected.", TRUE	
		Else	
			WriteToReport micFail, "Header attachment", "There are [" &sHeaderAttachments &"] displayed, Expect [" &GlobalDictionary("NumHeaderAttachments") & "].",TRUE	
		End If

		.PSFrame("TargetContent").Link("Attachments").Click		
		nResult = VerifyAttachment (GlobalDictionary("FileName"),"1","True")
		If nResult <> 1 Then
			WriteToReport micPass, "Header attachment", "Attachment has been verified.", TRUE			
		Else
			WriteToReport micFail, "Header attachment", "Attachment is not correct.", TRUE			
		End If

		'Click OK to close attachment window
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Expense Report Attachments").WebButton("OK").Click

		'Verify Line Attachment- shows (1)
		'Grab innertext - Split by"("
		aLineAttachments = Split(.PSFrame("TargetContent").Link("LineAttachment").GetROProperty("innertext"),"(")
		If ubound(aLineAttachments) < 1 Then
			WriteToReport micFail, "Line attachment", "There are not any attachments displayed", TRUE
			ExitTest			
		End If

		'Replace")" with "" in (0)
		sLineAttachments = Replace(aLineAttachments(1),")","")

		'Compare with expected - GlobalDictionary Value for :ineAttachments
		If sLineAttachments = GlobalDictionary("NumLineAttachments") Then
			WriteToReport micPass, "Line attachment", "There are [" &sLineAttachments &"] displayed as expected.", TRUE	
		Else	
			WriteToReport micFail, "Line attachment", "There are [" &sLineAttachments &"] displayed, Expect [" &GlobalDictionary("NumLineAttachments") & "].",TRUE	
		End If

		.PSFrame("TargetContent").Link("LineAttachment").Click		
		nResult = VerifyAttachment (GlobalDictionary("FileName"),"1","True") 
		If nResult <> 1 Then
			WriteToReport micPass, "Line attachment", "Attachment has been verified.", TRUE			
		Else
			WriteToReport micFail, "Line attachment", "Attachment is not correct.", TRUE			
		End If
	End With

	'Click OK to close attachment window
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Expense Report Attachments").WebButton("OK").Click

	'Navigate to Travel and Expenses>Process Expenses>Verify Receipts>Attach Receipts
	If SelectMainMenu1(GlobalDictionary("EXAttachReceipts")) = True Then
		WriteToReport micPass, "ReviewAttachmentPaths", "On the Attach Receipts page.", False
	Else
		WriteToReport micFail, "ReviewAttachmentPaths", "Navigation to Attach Receipts page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Attach Receipts")
		.PSFrame("TargetContent").WebEdit("Report ID").Set GlobalDictionary("ExpenseReportID")
		.PSFrame("TargetContent").WebButton("Search").Click

		'Confirm that we are on a new page, otherwise exit the test
		If .PSFrame("TargetContent").WebButton("Add Attachment").Exist(10) Then
			WriteToReport micPass, "AttachReceipts - Results Page", "On the results page.", False
		Else
			WriteToReport micFail, "AttachReceipts - Results Page", "Not on the results page. Exiting test.", True
		End If

		nResult = VerifyAttachment (GlobalDictionary("FileName"),"1","True")
		If nResult <> 1 Then
			WriteToReport micPass, "Header attachment", "Attachment has been verified.", TRUE			
		Else
			WriteToReport micFail, "Header attachment", "Attachment is not correct.", TRUE			
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Verify File name of Attachments and option to verify if link opens when clicked
''' </summary>
''' <author>Eric Trout</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'	28JAN19		Brian B.		Updated object from WinObject to WinButton for Windows 10.
'   02MAY19		Zach A.			Updated the "Save and open" procedure for .xlsx files
'**************************************************************************************************************
Function VerifyAttachment(FileName,Row,Open) 
	Dim sAttachment, DeviceReplay

	VerifyAttachment = 0

	With Browser("PeopleSoft Browser").Page("Create/Modify Expenses")
		.PSFrame("Expense Report Attachments").Link("Attachment document link").SetTOProperty "html id", "VIEWBUTTON$" & Row - 1
		Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").Link("Attachment document link").SetTOProperty "html id", "VIEWBUTTON$" & Row - 1
		If .PSFrame("Expense Report Attachments").Link("Attachment document link").Exist(20) Then
			sAttachment = .PSFrame("Expense Report Attachments").Link("Attachment document link").GetROProperty("innertext")
		ElseIf Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").Link("Attachment document link").Exist(20) Then	
			sAttachment = Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").Link("Attachment document link").GetROProperty("innertext")
		End If
	
		If sAttachment = FileName Then
			WriteToReport micPass, "Attachment Verification", "The File ["& sAttachment &"] is displayed.", False	
		Else
			WriteToReport micFail, "Attachment Verification", "The File ["& sAttachment &"] was displayed,  expected [" & FileName &"].", True	
			VerifyAttachment = 1
			Exit Function
		End If
		
		If ucase(Open) = "TRUE" Then
			'Verify file can open
			If .PSFrame("Expense Report Attachments").Link("Attachment document link").exist(20) Then
				.PSFrame("Expense Report Attachments").Link("Attachment document link").Click
			ElseIf Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").Link("Attachment document link").exist(20) Then
				Browser("PeopleSoft Browser").Page("Attach Receipts").PSFrame("TargetContent").Link("Attachment document link").Click
			End If	
	
			If Instr(FileName,"pdf")>0 Then
				If Browser("PeopleSoft Browser NewTab").WinObject("AVPageView").Exist(60) Then
					WriteToReport micPass, "Attachment", "Attachment [" & FileName & "] opened.", False	
				End iF	
				
			'JPEG
			ElseIf Instr(FileName,"JPG")>0 Then
				If Browser("CheckDisplay").Image("EX_Attachment").Exist(60) Then
					WriteToReport micPass, "Attachment", "Attachment [" & FileName & "] opened.", False	
				End iF			
				
				'Email
			ElseIf Instr(FileName,"msg")>0 Then

				Set DeviceReplay =CreateObject("Mercury.DeviceReplay")  
				 Browser("creationtime:=0").WinObject("acc_name:=Notification","regexpwndclass:=DirectUIHWND", "index:=0").highlight
				
				 'This will leftclick the save button to put focus on it.
				
'				 Browser("creationtime:=0").WinObject("acc_name:=Notification","regexpwndclass:=DirectUIHWND", "Class Name:=WinButton").Clickontext "Save",,,,,true,micLeftBtn,true
				 
'				Browser("creationtime:=0").WinObject("acc_name:=6","object class:=drop down button", "index:=0").highlight ' Win 7
				Browser("creationtime:=0").WinObject("acc_name:=Notification","regexpwndclass:=DirectUIHWND", "index:=0").WinButton("acc_name:=6","object class:=drop down button").highlight ' Win 10
				Browser("creationtime:=0").WinObject("acc_name:=Notification","regexpwndclass:=DirectUIHWND", "index:=0").WinButton("acc_name:=6","object class:=drop down button").Click
				 'This will press the 'down arrow' then the 'a' key to activate the drop-down button and then activate the Save and Opencommand.
				 DeviceReplay.PressKey 208 'Presses 'down arrow' key
				 DeviceReplay.PressKey 208 'Presses 'down arrow' key
				 DeviceReplay.PressKey 24 'Presses 'o' key
				 Set DeviceReplay = Nothing
			
				If Window("Message (HTML)").Exist(60) Then
					WriteToReport micPass, "Attachment", "Attachment [" & FileName & "] opened.", False	
					Window("Message (HTML)").Close					
				Else
					WriteToReport micFail, "Attachment", "Attachment [" & FileName & "] did not open.", True
					VerifyAttachment = 1
					ExitTest					
				End If

				'Excel
			ElseIf Instr(FileName,"xlsx")>0 Then				
				 'This will highlight the download bar to grab focus on it.
				If Browser("CheckDisplay").WinObject("Notification").WinButton("object class:=drop down button").Exist(30) Then
					Browser("CheckDisplay").WinObject("Notification").WinButton("object class:=drop down button").Highlight 'Win 10 NOTE: Can see the object but for some reason, can not click it.  Description click works however.
					Browser("CheckDisplay").WinObject("Notification").WinButton("object class:=drop down button").Click
				Else
					WriteToReport micFail, "No Dropdown Button to Save File Found", "Save Prompt Not Found", TRUE
					ExitTest
				End If
				
				
				 'This will left-click the save button to put focus on it.
				
				 ' Browser("creationtime:=0").WinObject("acc_name:=Notification","regexpwndclass:=DirectUIHWND", "index:=0").Clickontext "Save",,,,,true,micLeftBtn,true
				
				 'This will press the 'down arrow' then the 'a' key to activate the drop-down button and then activate the Save As command.
				
				If Browser("CheckDisplay").WinMenu("ContextMenu").Exist(15) Then
					Browser("CheckDisplay").WinMenu("ContextMenu").Select "Save and open"
				Else
					WriteToReport micFail, "The Save Options Menu Did Not Appear", "Could not save the file", TRUE
					ExitTest
				End If
				 
				If Window("Excel").Exist(360) Then
					WriteToReport micPass, "Attachment", "Attachment [" & FileName & "] opened.", False	
					Window("Excel").Close					
				Else
					WriteToReport micFail, "Attachment", "Attachment [" & FileName & "] did not open.", True			
					VerifyAttachment = 1		
				End If					
			
			Else
				WriteToReport micFail, "Attachment", "Attachment [" & FileName & "] did not open.", True
				VerifyAttachment = 1
			End If
		
			Browser("PeopleSoft Browser NewTab").Close
		
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Verify that users are unable to edit Account field on a created Expense Report. EX_08_ExpenseUserAccountField
''' </summary>
''' <author>Stephen King</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control:
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function ValidateExpenseUserAccountField

	'Call our CreateExpenseReport function. No parameters needed
	CreateExpenseReport

	'Click the Expense Details link to go back to our original report page
	With Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent")

		.Link("Expense Details").Click
		Browser("PeopleSoft Browser").Sync

		'Expand our accounting details section
		.Link("Expand All").Click
		Browser("PeopleSoft Browser").Sync
		.Image("Expand Accounting Details").Click
		Browser("PeopleSoft Browser").Sync

		'Validate that we can't change the amount
		If .WebElement("AccountingMonetaryAmount").Exist(5) Then

			'If it's the element and not a webedit then we can't modify the values.
			WriteToReport micPass, "ValidateExpenseUserAccountField - Unable to edit account", "Unable to modify data in the Accounting/GL Chartfield table", False
		Else
			WriteToReport micFail, "ValidateExpenseUserAccountField - Able to edit account", "Able to modify data in the Accounting/GL Chartfield table or table not displaying. Failing test.", True
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the CDWEXAPR process. EX_ST13_ExpenseApprovalWorkflow
''' </summary>
''' <author>Stephen King</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control:
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function RunExpenseApprovalWorkflowLoad
	Dim strInstance
	Dim arrInstance
	Dim sRunID

	'Navigate to Update Expense Approval Workflow page
	If SelectMainMenu1(GlobalDictionary("EXApprvlLoadAutoMaint")) = True Then
		WriteToReport micPass, "RunExpenseApprovalWorkflowLoad", "On the RunExpenseApprovalWorkflowLoad page.", False
	Else
		WriteToReport micFail, "RunExpenseApprovalWorkflowLoad", "Navigation to RunExpenseApprovalWorkflowLoad page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("TargetContent")

		'Enter a new run control ID
		.WebElement("AddANewValue").Click
		sRunId = "Auto" & CLng(Timer)
	    WriteToReport micDone, "Run control ID", sRunID, False
		.WebEdit("RunControlIDAdd").Set sRunID
		.WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Click the run process button
		.WebButton("Run").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Work with the popup process scheduler frame
	With Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("Process Scheduler Request")

		'Store and report our Process name
		GlobalDictionary("Process") = "CDWEXAPR"
		WriteToReport micDone, "RunExpenseApprovalWorkflowLoad - Process Name", GlobalDictionary("Process"), False

		'Start the process
		.WebCheckBox("SelectCDWExpApprvlLoad").Click
		.WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Return to the original page
	With Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("TargetContent")

		'Save our instance ID
		strInstance = .WebElement("ProcessInstance").GetROProperty("innertext")
		arrInstance = split(strInstance, ":")
		GlobalDictionary("InstanceNumber") = arrInstance(1)
		WriteToReport micDone, "RunExpenseApprovalWorkflowLoad - Instance Number", GlobalDictionary("InstanceNumber"), False

		'Click on the process monitor link
		.Link("ProcessMonitor").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Run and monitor our process
	SharedProcessMonitor "RunExpenseApprovalWorkflowLoad"
End Function

'**************************************************************************************************************
''' <summary> 
''' Update and validate the Expense Account field changes. EX__08_07
''' </summary>
''' <author>Stephen King</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control:
'Date of Change 	Author 		Description of change
' 25JAN19	Brian B.	Flow goes through a search now after signing in.  Added code to handle it.
'**************************************************************************************************************
Public Function UpdateLevel3WalletItems
	Dim sSQL
	Dim arrRecordValues, arrExpense(1), arrTemp()
	Dim i, nResult, x
	Dim employeeID

 	'Find Emp Id with unapplied Wallet items that have level 3 data tied to them (Hotel charges will have this)
	sSQL = "SELECT * FROM PS_EX_TRANS A WHERE A.SHEET_ID = '' AND A.TXN_STATUS  = 'U' AND A.EXPENSE_TYPE = 'HOTEL' AND " &_
		   "1 < (SELECT COUNT(*) FROM PS_EX_TRANS B WHERE A.EMPLID = B.EMPLID AND A.DATA_SOURCE_EX = B.DATA_SOURCE_EX AND A.TRANS_NBR = B.TRANS_NBR) " &_
		   "ORDER BY EMPLID,TRANS_NBR,SEQ_NBR"
	WriteToReport micDone, "UpdateLevel3WalletItems - Wallet SQL Query", "Query being used is " & sSQL, False

   'Get the first journal that meets our criteria, exit if none found
	arrRecordValues = dbGetFirstRecord(sSQL, "", arrTemp, "UpdateLevel3WalletItems")
	nResult = -1

	On Error Resume Next
	nResult = UBound(arrRecordValues)
	On Error GoTo 0
	If nResult >= 0 AND arrRecordValues(0) <> "" Then
		WriteToReport micPass, "UpdateLevel3WalletItems - SQL results", "There were " & nResult + 1 & " result(s) found!", False
	Else
		WriteToReport micFail, "UpdateLevel3WalletItems - SQL results", "There were 0 results found. Exiting test.", False
		ExitTest
	End If

	'Find Emp Id with unapplied Wallet items that have level 3 data tied to them (Hotel charges will have this)
	employeeID = arrRecordValues(0)	'EG, "00000000509"
	GlobalDictionary("SignInUser") = dbFindUserByEMPLID(employeeID)(0)

	'Set up variables for our loop
	x = 0
	arrExpense(0) = "09 Hotel Charges"
	arrExpense(1) = "08 Airfare"

	'Loop through our steps. Added so we can test that wallet updates persist.
	For x = 0 To 1

		'Login into PeopleSoft with Oprid
		Login(GlobalDictionary("SignInUser"))

		'Navigate to My Wallet
		If SelectMainMenu1(GlobalDictionary("EXWallet")) = True Then
			WriteToReport micPass, "UpdateLevel3WalletItems - My Wallet Page", "On the My Wallet page.", False
		Else
			WriteToReport micFail, "UpdateLevel3WalletItems - My Wallet Page", "Navigation to My Wallet page failed. Exiting test.", True
			ExitTest
		End If
		
		With Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet")
			' Search using Employee ID if the search is visible.
			If .WebButton("WalletSearch").Exist(30) Then
				.WebEdit("EmployeeId").Set employeeID
				.WebButton("WalletSearch").Click
			End If
			
			If Not .WebEdit("FromDate").exist(20) Then
				WriteToReport micFail, "UpdateLevel3WalletItems - My Wallet Page", "Unable to find FromDate search field.", True
				ExitTest			
			End If
			
			'Enter a From Date value
			.WebEdit("FromDate").Set GlobalDictionary("FromDate") '"01/01/2000"

			'Enter a Through Date value - Must be current date
			.WebEdit("ToDate").Set Date

			'Select Receipt Data Source = All Data Sources
			'Currently defaults to this. Add object if we need to change.

			'Select Transaction Status
			.WebList("TransactionStatus").Select "Unassigned"

			'Click on the Search button
			.WebButton("Search").Click
			Browser("PeopleSoft Browser").Sync

			'Confirm we have search results
			If .WebCheckBox("Status").Exist(10) Then
				WriteToReport micPass, "UpdateLevel3WalletItems - My Wallet Page - Search Results", "Search results found!", False
			Else
				WriteToReport micFail, "UpdateLevel3WalletItems - My Wallet Page - Search Results", "No search results found. Check search criteria. Exiting test.", True
				ExitTest
			End If

			'Find a Wallet Item with an Expense Type of Hotel Charges and click on the Expense type hyperlink
	 		'For Instance : Hotel Charge for $253.08 on 02/10/2015'store amount and date
	 		For i = 0 To .WebTable("Results").GetROProperty("rows")
	 			If .Link("HTML ID:=EXP_TYPE\$" & i).GetROProperty("innertext") = arrExpense(x) Then
	 				.Link("HTML ID:=EXP_TYPE\$" & i).Click
	 				Browser("PeopleSoft Browser").Sync
	 				WriteToReport micPass, "UpdateLevel3WalletItems - My Wallet Page - Expense", "Expense result " & arrExpense(x) & " found!", False
	 				Exit For
	 			End If
	 		Next
 
	 		'Validate an object on the results page, otherwise exit test
	 		If .WebList("Expense Type").Exist(10) Then
	 			WriteToReport micPass, "UpdateLevel3WalletItems - My Wallet Page - My Wallet Details", "Navigated to My Wallet Details page", False
			Else
				WriteToReport micFail, "UpdateLevel3WalletItems - My Wallet Page - My Wallet Details", "Unable to navigated to My Wallet Details page. Confirm search results. Exiting test.", True
				ExitTest
			End If

			'Set our new value
			If x = 0 Then
	 			.WebList("Expense Type").Select arrExpense(1)
	 			WriteToReport micDone, "UpdateLevel3WalletItems - Expense Type", "Updated Expense Type to " & arrExpense(1), False
	 		Else
	 			.WebList("Expense Type").Select arrExpense(0)
	 			WriteToReport micDone, "UpdateLevel3WalletItems - Expense Type", "Updated Expense Type to " & arrExpense(0), False
	 		End If
			'.WebList("Expense Type").Select "08 Airfare"
			'WriteToReport micDone, "UpdateLevel3WalletItems - Expense Type", "Updated Expense Type to 08 Airfare", False

			'Click save
			.WebButton("Save").Click
			Browser("PeopleSoft Browser").Sync
	
'		'Undo that last process to keep a result for testing
' 		.WebList("Expense Type").Select "09 Hotel Charges"
' 		WriteToReport micDone, "UpdateLevel3WalletItems - Expense Type", "Reverted Expense Type to 09 Hotel Charges", False
'
'		'Click save
'		.WebButton("Save").Click
'		Browser("PeopleSoft Browser").Sync
		End With
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Helper function that we use to search up wallet receipt items as we don't have a unique ID we can use
''' </summary>
''' <author>Stephen King</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control:
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Private Function VerifyWalletResults(functionName, strMerchant, strAmount, strDate)
	Dim bFound
	Dim i

	'Validate our wallet data that should now be restored
	'search for our merchant in the table
	bFound = False

	With Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet")
		For i = 1 To .WebTable("Results").GetROProperty("rows")
			If Trim(.WebElement("html id:=EX_TRANS_WRK_MERCHANT\$" & i - 1).GetROProperty("Innertext")) = strMerchant Then
				WriteToReport micDone, functionName & " - My Wallet Page - Merchant", "Merchant found", False

				'Confirm our amount matches
				If Trim(.WebElement("html id:=EX_TRANS_MONETARY_AMOUNT\$" & i-1).GetROProperty("Innertext")) = strAmount Then
					WriteToReport micDone, functionName & " - My Wallet Page - Monetary Amount", "Monetary Amount found", False

					'Last check, otherwise we exit the if statements and start a new loop
					If Trim(.WebElement("html id:=TRANS_DATE\$" & i-1).GetROProperty("Innertext")) = strDate Then
						WriteToReport micDone, functionName & " - My Wallet Page - Date", "Date found", False
						bFound = True
						Exit For
					Else
						WriteToReport micDone, functionName & " - My Wallet Page - Date", "Date not found - " & strDate, True
					End If
				Else
					WriteToReport micDone, functionName & " - My Wallet Page - Monetary Amount", "Monetary Amount not found - " & strAmount, True
				End If
			Else
				WriteToReport micDone, functionName & " - My Wallet Page - Merchant", "Merchant " & strMerchant & " not found. Going to next row.", False
			End If
		Next
	End With

	'Return our found status
	VerifyWalletResults = bFound
End Function

'**************************************************************************************************************
''' <summary> 
''' Checks that the User cannot Reassign an approval task in their Workflow
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function VerifyCannotReassign
	Dim aApprovers
	Dim sUserLogin
	Dim oLink, oButton
	If GlobalDictionary.Exists("Approvers") Then
		aApprovers = Split(GlobalDictionary("Approvers"), ";")
		sUserLogin = aApprovers(1)
	Else
		sUserLogin = GlobalDictionary("NoReassignUser")
	End If

	Call Login(sUserLogin)
	'Navigate to the Worklist>Worklist page
	If SelectMainMenu1(GlobalDictionary("Worklist")) = True Then
		WriteToReport micPass, "Worklist Page", "On the Worklist page.", False
	Else
		WriteToReport micFail, "Worklist Page", "Navigation to Worklist page failed. Exiting test.", True
		ExitTest
	End If

	'Find the Expense Report ID and click it
	Set oLink = Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist").WebElement("Link")
	Call oLink.SetTOProperty("innertext", ".*"&GlobalDictionary("ExpenseReportID")&".*")
	If oLink.Exist(15) Then
		WriteToReport micDone, "Found The Expense Report: "&GlobalDictionary("ExpenseReportID"),"Found the Expense Report", FALSE
	Else
		WriteToReport micFail, "Did Not Find the Expense Report: "&GlobalDictionary("ExpenseReportID"), "Failed to find the Expense Report", TRUE
		ExitTest
	End If

	Set oButton = Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist").WebButton("Reassign")
	Call oButton.SetTOProperty("xpath", "//a[contains(text(),'"&GlobalDictionary("ExpenseReportID")&"')]/../../../../../td[8]/div/a/span/input")

	If oButton.GetROProperty("disabled") Then
		WriteToReport micPass, "The Reassign Button for Expense Report "&GlobalDictionary("ExpenseReportID")&" is Disabled", "Button is disabled", FALSE
	Else
		WriteToReport micFail, "The Reassign Button for Expense Report "&GlobalDictionary("ExpenseReportID")&" is Enabled", "Button is enabled", TRUE
		ExitTest
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Reassigns an approver for an Expense Report
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function ReassignApprover
	Dim sUserToReassign
	Dim oCheckbox
	Dim aApprovers
	Const USER_ID = "User ID"
	If GlobalDictionary.Exists("Approvers") Then
		aApprovers = Split(GlobalDictionary("Approvers"), ";")
		sUserToReassign = aApprovers(1)
	Else
		sUserToReassign = GlobalDictionary("NoReassignUser")
	End If
	Call Login(GlobalDictionary("Reassigner"))
	'Navigate to T and E Admin Center
	If SelectMainMenu1(GlobalDictionary("EXTandEAdminCenter")) Then
		WriteToReport micPass, "T and E Admin Center Page", "On the T and E Admin Center page.", False
	Else
		WriteToReport micFail, "T and E Admin Center Page", "Navigation to T and E Admin Center page failed. Exiting test.", True
		ExitTest
	End If

	'Click Manage Security
	Browser("PeopleSoft Browser").Page("T and E Admin Center").Link("Manage Security").Click
	WriteToReport micDone, "Clicked the Manage Security Link", "Successfully Clicked Manage Security", FALSE

	'Click Reassign Approval Work
	Browser("PeopleSoft Browser").Page("T and E Admin Center").Link("Reassign Approval Work").Click
	WriteToReport micDone, "Clicked the Reassign Approval Work Link", "Successfully Clicked Reassign Approval Work", FALSE
	Browser("PeopleSoft Browser").Sync

	'Set the Search By Field to User ID
	Browser("PeopleSoft Browser").Page("Reassign Work").WebList("SearchBy").Select USER_ID

	'Set the User ID
	Browser("PeopleSoft Browser").Page("Reassign Work").WebEdit("SearchBeginsWith").Set sUserToReassign

	'Click Search
	Browser("PeopleSoft Browser").Page("Reassign Work").WebButton("Search").Click

	Browser("PeopleSoft Browser").Sync

	'Find and click the checkbox
	Set oCheckbox = Browser("PeopleSoft Browser").Page("Reassign Work").PSFrame("TargetContent").WebTable("TransactionInformation").WebCheckBox("Select")
	Call oCheckbox.SetTOProperty("xpath", "//span[text()='"&GlobalDictionary("ExpenseReportID")&"']/../../../td[1]/div/input[@type='checkbox']")
	If oCheckbox.Exist(5) Then
		oCheckbox.Click
		WriteToReport micDone, "Clicked the Checkbox for Expense Report: "&GlobalDictionary("ExpenseReportID"), "Checkbox Clicked", FALSE
	Else
		WriteToReport micFail, "Could Not Locate the Checkbox for Expense Report: "&GlobalDictionary("ExpenseReportID"), "Checkbox not clicked", TRUE
		ExitTest
	End If

	'Set the User to have the report reassigned to
	Browser("PeopleSoft Browser").Page("Reassign Work").PSFrame("TargetContent").WebEdit("Reassign Work To").Set GlobalDictionary("UserReassignTo")
	WriteToReport micDone, "Set the User to Reassign to as: "&GlobalDictionary("UserReassignTo"), "Reassign Work To field set", FALSE

	'Click Reassign
	Browser("PeopleSoft Browser").Page("Reassign Work").PSFrame("TargetContent").WebButton("Reassign").Click
	WriteToReport micDone, "Clicked the Reassign Button", "Reassign Clicked", FALSE

	Browser("PeopleSoft Browser").Sync

	'Check that it is no longer in the table
	Wait 2
	If oCheckbox.Exist(5) Then
		WriteToReport micFail, "Row Still Exists with Work that Should Have Been Reassigned", "Work Item not reassigned", TRUE
	End If

	'Update the approver list, replacing the old HR Supervisor with UserReassignTo
	GlobalDictionary("Approvers") = Replace(GlobalDictionary("Approvers"), sUserToReassign, GlobalDictionary("UserReassignTo"))
End Function

'**************************************************************************************************************
''' <summary> 
''' Verifies the Exchange rate calculated correctly after submitting an expense report in CAD
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function VerifyExchangeRate
	Dim sAmountDueEmp
	Dim nCalculated

	sAmountDueEmp = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("AmountDueToEmployee").GetROProperty("innertext")
	nCalculated = GlobalDictionary("ExpenseAmount") * GlobalDictionary("ExchangeRate")

	If sAmountDueEmp = FormatNumber(Round(nCalculated,3),2) Then
		WriteToReport micPass, "The Amount Due Shown ["&sAmountDueEmp&"] Matches the Calculation ["&GlobalDictionary("ExchangeRate")&"] * ["&GlobalDictionary("ExpenseAmount")&"] = ["&FormatNumber(Round(nCalculated,3),2)&"]", "Correct Amount Due to Employee Shown", FALSE
	Else
		WriteToReport micFail,"The Amount Due Shown ["&sAmountDueEmp&"] Does Not Match the Calculation ["&GlobalDictionary("ExchangeRate")&"] * ["&GlobalDictionary("ExpenseAmount")&"] = ["&FormatNumber(Round(nCalculated,3),2)&"]", "Incorrect Amount Shown", TRUE
		ExitTest
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Opens a previous expense from My Wallet into the Create/Modify page, attempts to change the date of the hotel stay,
''' Check that it throws an error for an invalid date
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function VerifyWalletHotelDates
	Dim nWalletItems
	Dim sDate, sEmployeeID
	Dim oDate
	Const DAYSTOSUBTRACT = -3
	Const NUMOFNIGHTS = 1
	Const ROOMRATE = 145
	Const ROOMTAX = 12
	'Find a user to login as, that has a Hotel Charge in the unassigned status, from the database
	Call Login(dbFindHotelInWallet()(0))
	If SelectMainMenu1(GlobalDictionary("AddExpenseReport")) Then
		WriteToReport micPass, "Create/Modify Expense Page", "On the Create/Modify Expense page.", False
	Else
		WriteToReport micFail, "Create/Modify Expense Page", "Navigation to Create/Modify Expense page failed. Exiting test.", True
		ExitTest
	End If

	'Verify the EMPLID field is not empty
	sEmployeeID = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Employee ID").GetROProperty("value")
	If NOT (sEmployeeID = "") OR NOT (isEmpty(sEmployeeID)) Then
		WriteToReport micDone, "Employee ID Filled", "Employee ID not empty", FALSE
	Else
		WriteToReport micFail, "Employee ID Empty", "Cannot add Expense Report due to ID not being auto-filled", TRUE
		ExitTest
	End If

	'Click Add
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Add").Click
	WriteToReport micDone, "Add Button Clicked", "Successfully clicked Add", FALSE

	Browser("PeopleSoft Browser").Sync

	'Enter Business Purpose
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("Business Purpose").Select GlobalDictionary("BusinessPurpose")
	WriteToReport micDone, "Selected the Business Purpose ["&GlobalDictionary("BusinessPurpose")&"]", "Business Purpose selected", FALSE

	'Enter Report Description
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Report Description").Set GlobalDictionary("ReportDescription")
	WriteToReport micDone, "Set the Report Description ["&GlobalDictionary("ReportDescription")&"]", "Report Description set", FALSE

	'Get the number out of the My Wallet Link, Split right of the '(' and split that result to the left of the ')'
	nWalletItems = Split(Split(Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("MyWallet#").GetROProperty("innertext"),"(")(1),")")(0)
	WriteToReport micDone, "Current Number of Items in My Wallet ["&nWalletItems&"]", "Stored the current number of items in My Wallet", FALSE

	'Click the My Wallet link
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("MyWallet#").Click
	WriteToReport micDone, "Clicked the My Wallet ("&nWalletItems&") Link", "My Wallet Clicked", FALSE

	'Check the Select box next to the first Hotel Charges line found
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebCheckBox("FirstHotelCharges").Exist(15) Then
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebCheckBox("FirstHotelCharges").Click
		WriteToReport micDone, "Clicked the 'Select' Checkbox for the First Hotel Charges Found", "Checkbox checked", FALSE
	Else
		WriteToReport micFail, "Could Not Locate any Line with '09 Hotel Charges' to Use in Finding an Associated Checkbox", "Checkbox not checked", TRUE
		ExitTest
	End If

	'Click Done
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Done").Click
	WriteToReport micDone, "Clicked the Done Button", "Successfully clicked Done", FALSE

	'Check that the My Wallet number has gone down by one
	If CInt(nWalletItems-1) = CInt(Split(Split(Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("MyWallet#").GetROProperty("innertext"),"(")(1),")")(0)) Then
		WriteToReport micPass, "My Wallet Link Now Shows One Less Item", "My Wallet decremented appropriately", FALSE
	Else
		WriteToReport micFail, "My Wallet Link Did Not Decrement After Selecting an Item", "My Wallet Link Shows ["&Split(Split(Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("MyWallet#").GetROProperty("innertext"),"(")(1),")")(0)&"] Items", TRUE
		ExitTest
	End If

	'Note the value in the Date field from the expense opened
	sDate = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Date").GetROProperty("value")
	WriteToReport micDone, "Stored the Expense Date ["&sDate&"]", "Expense date stored", FALSE

	'Click on Itemize Hotel Bill
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("ItemizeHotelBill").Exist(5) Then
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("ItemizeHotelBill").Click
		WriteToReport micDone, "Clicked the Itemize Hotel Bill Link", "Itemize Hotel Bill clicked", FALSE
	Else
		WriteToReport micFail, "Could not Locate the Itemize Hotel Bill Link", "Itemize Hotel Bill not clicked", TRUE
		ExitTest
	End If

	'Check / Click the Room Charge Checkbox
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebCheckBox("RoomCharge").GetROProperty("checked") <> 1 Then
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebCheckBox("RoomCharge").Click
		WriteToReport micDone, "Checked the Room Charge Checkbox", "Checkbox checked", FALSE
	Else
		WriteToReport micDone, "Room Charge Checkbox Already Clicked", "Checkbox already checked", FALSE
	End If

	'Click Continue
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Continue").Click
	WriteToReport micDone, "Clicked the Continue Button", "Successfully Clicked Continue", FALSE

	'Change the Transaction Date to a previous date
	oDate = DateAdd("d",DAYSTOSUBTRACT,CDate(sDate))
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("TransactionDate").Set oDate
	WriteToReport micDone, "Set the Transaction Date Field to ["&oDate&"]", "Successfully Set the Transaction Date Field", FALSE

	'Enter a Number of Nights, if not populated
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("NumberOfNights").Set NUMOFNIGHTS
	WriteToReport micDone, "Set the Number Of Nights Field to ["&NUMOFNIGHTS&"]", "Successfully Set the Number Of Nights Field", FALSE

	'Enter a Room Rate, if not populated
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("RoomRate").Set ROOMRATE
	WriteToReport micDone, "Set the Room Rate Field to ["&ROOMRATE&"]", "Successfully Set the Room Rate Field", FALSE

	'Enter a Room Tax, if not populated
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("RoomTax").Set ROOMTAX
	WriteToReport micDone, "Set the Room Tax Field to ["&ROOMTAX&"]", "Successfully Set the Room Tax Field", FALSE

	'Click Continue
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Continue").Click
	WriteToReport micDone, "Clicked the Continue Button", "Successfully clicked Continue", FALSE

	'If a message "Total of number of nights..." appears, click No
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").WebButton("No").Exist(15) Then
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").WebButton("No").Click
		WriteToReport micDone, "Dismissed the Error Message for 'Total number of nights...' With Choice No", "Alert Dismissed", FALSE
	End If

	'If a message "You entered a date that is out of range..." appears, report pass
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").WebButton("OK").Exist(20) Then
		WriteToReport micPass, "The Error Message Stating 'You entered a date that is out of range' Appeared", "Alert Appeared as Expected", FALSE
	Else
		WriteToReport micFail, 	"The Error Message Stating 'You entered a date that is out of range' Failed to Appear", "Alert Not Shown as Expected", TRUE
		ExitTest
	End If

	'Click OK
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").WebButton("OK").Click
	WriteToReport micDone, "Clicked OK to Dismiss the Alert", "Alert Dismissed", FALSE

	'Click "Return to Expense Report"
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("ReturnToExpenseReport").Click
	WriteToReport micDone, "Clicked the Return to Expense Report Link", "Link Clicked", FALSE

	'Click the [-] icon to delete the Hotel Charges line
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Delete Expense Line -").Click
	WriteToReport micDone, "Clicked the [-] Button on the Expense Report that was Brought In", "Clicked [-]", FALSE

	'Click OK
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("SaveConfirmation").WebButton("OK").Click
	WriteToReport micDone, "Clicked OK to Accept Deleting the Expense", "Expense removed", FALSE

	'Check that the My Wallet number goes up by one
	If CInt(nWalletItems) = CInt(Split(Split(Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("MyWallet#").GetROProperty("innertext"),"(")(1),")")(0)) Then
		WriteToReport micPass, "My Wallet Link Shows Full Amount of Items Again", "My Wallet incremented appropriately", FALSE
	Else
		WriteToReport micFail, "My Wallet Link Did Not Increment After Removing the Expense", "My Wallet Link Shows ["&Split(Split(Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("MyWallet#").GetROProperty("innertext"),"(")(1),")")(0)&"] Items", TRUE
		ExitTest
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Checks that the User cannot add to their My Wallet directly from the My Wallet page
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function CannotAddMyWallet
	Const SEARCH_EMPLID = "Empl ID"

	'Navigate to My Wallet
	If SelectMainMenu1(GlobalDictionary("EXWallet")) Then
		WriteToReport micPass, "My Wallet Page", "On the My Wallet page.", FALSE
	Else
		WriteToReport micFail, "My Wallet Page", "Navigation to My Wallet page failed. Exiting test.", TRUE
		ExitTest
	End If

	'Choose Empl ID as the Search By 
	Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebList("SearchBy").Select SEARCH_EMPLID
	WriteToReport micDone, "Selected ["&SEARCH_EMPLID&"] to Search By", "Search by Field chosen", FALSE

	'Set the begins with to the EMPLID of the currently logged in user
	Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebEdit("BeginsWith").Set dbFindEMPLIDByOPRID(GlobalDictionary("SignInUser"))(0)
	WriteToReport micDone, "Set the Begins with Field to ["&dbFindEMPLIDByOPRID(GlobalDictionary("SignInUser"))(0)&"]", "EMPLID Set", FALSE

	'Click Search
	Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebButton("LandingPageSearch").Click
	WriteToReport micDone, "Clicked the Search Button", "Successfully clicked Search", FALSE

	'Check that the Add button is disabled
	If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebButton("Add").Exist(30) Then
		If Browser("PeopleSoft Browser").Page("My Wallet").PSFrame("My Wallet").WebButton("Add").GetROProperty("disabled") = 1 Then
			WriteToReport micPass, "The Add Button is Disabled as Expected", "Add Disabled", FALSE
		Else
			WriteToReport micFail, "The Add Button was Enabled, and it Should Not Have Been", "Add Enabled, Unexpected", TRUE
			ExitTest
		End If
	Else
		WriteToReport micFail, "Could Not Find the Add Button on the My Wallet Page", "Took Longer than 30 Seconds to Load", FALSE
		ExitTest
	End If
	
End Function

'**************************************************************************************************************
''' <summary> 
''' Fills out an expense for an Airfare, skipping the Ticket Number field originally.
''' Checks that the program alerts you that you did not fill the Ticket Number field, fills it out, then submits
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'	24JAN19		Brian B.		Added a .Exist(10) to the ExpenseID toward the end.
'**************************************************************************************************************
Public Function AirfareExpReqTicketNumber
	Dim sExpID, sEmployeeID
	Dim nTicketNumber
	Const BUS_PURP = "Trade Show/Events/Conference"
	Const REP_DESC = "Airline Ticket Check"
	Const EXP_TYPE = "08 Airfare"
	Const EXP_DESC = "Airline Ticket Check"
	Const PMT_TYPE = "Personal Credit Card"
	Const AMT = "350.00"
	Const LOCATION = "All USA Locations"
	Const NON_PREF_VENDOR_VAL = "test"
	Const TICKET_NUM = "TEST"

	If SelectMainMenu1(GlobalDictionary("AddExpenseReport")) Then
		WriteToReport micPass, "Create/Modify Expense Page", "On the Create/Modify Expense page.", False
	Else
		WriteToReport micFail, "Create/Modify Expense Page", "Navigation to Create/Modify Expense page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent") 
	'Verify the EMPLID field is not empty
		sEmployeeID = .WebElement("Employee ID").GetROProperty("value")
		If NOT (sEmployeeID = "") OR NOT (isEmpty(sEmployeeID)) Then
			WriteToReport micDone, "Employee ID Filled", "Employee ID not empty", FALSE
		Else
			WriteToReport micFail, "Employee ID Empty", "Cannot add Expense Report due to ID not being auto-filled", TRUE
			ExitTest
		End If

		'Click Add
		.WebButton("Add").Click
		WriteToReport micDone, "Add Button Clicked", "Successfully clicked Add", FALSE

		Browser("PeopleSoft Browser").Sync

		'Enter Business Purpose
		.WebList("Business Purpose").Select BUS_PURP
		WriteToReport micDone, "Selected the Business Purpose ["&BUS_PURP&"]", "Business Purpose selected", FALSE

		'Enter Report Description
		.WebEdit("Report Description").Set REP_DESC
		WriteToReport micDone, "Set the Report Description ["&REP_DESC&"]", "Report Description set", FALSE

		'Enter Date
		.WebEdit("Expense Date").Set CStr(date())
		WriteToReport micDone, "Set the Date to Today's Date ["&CStr(date())&"]", "Date Field set", FALSE

		'Enter Expense Type
		.WebList("Expense Type").Select EXP_TYPE
		WriteToReport micDone, "Selected ["&EXP_TYPE&"] From the Expense Type List", "Expense Type Selected", FALSE

		'Enter Description
		.WebEdit("Expense Description").Set EXP_DESC
		WriteToReport micDone, "Set the Expense Description to ["&EXP_DESC&"]", "Expense Description set", FALSE

		'Enter Payment Type
		.WebList("Expense Payment Type").Select PMT_TYPE
		WriteToReport micDone, "Set the Expense Payment Type to ["&PMT_TYPE&"]", "Expense Payment Type set", FALSE

		'Enter Amount
		.WebEdit("Expense Amount").Set AMT
		WriteToReport micDone, "Set the Amount to ["&AMT&"]", "Amount Set", FALSE

		'Enter Location
		.WebEdit("Select A Location").Set LOCATION
		WriteToReport micDone, "Set the Location to ["&LOCATION&"]", "Location Set", FALSE

		'Enter Non-Preferred Vendor Value
		.WebEdit("Non Preferred Vendor Value").Set NON_PREF_VENDOR_VAL
		WriteToReport micDone, "Set the Non-Preferred Vendor Value to ["&NON_PREF_VENDOR_VAL&"]", "Non-Preferred Vendor Value set", FALSE

		'Click Summary and Submit
		.Link("SummaryAndSubmit").Click
		WriteToReport micDone, "Clicked the Summary and Submit Link", "Link clicked", FALSE

		'Check the 'By checking this...' box
		.WebCheckBox("ByCheckingThis").Click
		WriteToReport micDone, "Checked the checkbox with message 'By checking this...'", "Checkbox checked", FALSE

		'Click Submit Expense Report
		.WebButton("Submit Expense Report").Click
		WriteToReport micDone, "Clicked Submit Expense Report", "Successfully clicked Submit Expense Report", FALSE

		'It should bring you back to the Details screen, with a Red Flag shown and the Ticket Number field in Red
		'Verify Red Flag'
		If .Image("RedFlag").Exist(15) Then
			WriteToReport micPass, "Red Flag Shown as Expected", "Red Flag appeared, indicating a missing field", FALSE
		Else
			WriteToReport micFail, "Red Flag Did Not Appear as Expected", "Red Flag missing", TRUE
			ExitTest
		End If
		
		'Verify Ticket Number in Red
		If .WebEdit("TicketNumber").GetROProperty("class") = "PSERROR" Then
			WriteToReport micPass, "Ticket Number Field Highlighted in Red as Expected", "Field Red, showing it was missed / is required", FALSE
		Else
			WriteToReport micFail, "Ticket Number Field Not Highlighted in Red as Expected", "Field Not Red, although it should be", FALSE
			ExitTest
		End If

		'Set the Ticket Number
		Randomize
		nTicketNumber = Round(100000*Rnd)
		.WebEdit("TicketNumber").Set nTicketNumber
		WriteToReport micDone, "Set the Ticket Number to ["&nTicketNumber&"]", "Ticket Number Set", FALSE

		'Click Summary and Submit
		.Link("SummaryAndSubmit").Click

		'Click Submit Expense Report
		.WebButton("Submit Expense Report").Click
		WriteToReport micDone, "Clicked the Summary and Submit Link", "Link clicked", FALSE

		'Click OK
		If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Expense Report Submit Confirm").WebButton("OK").Exist(15) Then
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Expense Report Submit Confirm").WebButton("OK").Click
			WriteToReport micDone, "Clicked the OK Button", "Successfully clicked OK", FALSE
		End If
		
		'Report the Report ID generated
		If .WebElement("ExpenseReportID").Exist(10) Then
			sExpID = Trim(Split(.WebElement("ExpenseReportID").GetROProperty("innertext"), "Submission")(0))
			WriteToReport micDone, "Airfare Expense Submitted With ID ["&sExpID&"]", "Airfare Expense Generated Successfully", FALSE
		Else
			WriteToReport micFail, "Failed to Grab Airfare Expense ID", "ID was not visible in time after clicking the 'OK' button on the confirm popup.", TRUE
			ExitTest
		End If
		
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Removes and Replaces an Expense Job Code Role. Does not have to have be run from ChangeJobCodeRoles.
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function RemoveAddJobCodeRole 'ST05
	Dim i
	Dim arrRemoveAdd
	Dim oRowDelete, oTemp
	Dim sJobCode, sRoleName
	arrRemoveAdd = Split(GlobalDictionary("RemoveAdd"),";")
	Const ROW_2_INDEX = 1
	
	For i=0 To UBound(arrRemoveAdd)
		'Navigate to Expense Job Code Role
		If SelectMainMenu1(GlobalDictionary("EXJobCodeRole")) Then
			WriteToReport micPass, "Expense Job Code Role Page", "On the Expense Job Code Role page.", False
		Else
			WriteToReport micFail, "Expense Job Code Role Page", "Navigation to Expense Job Code Role page failed. Exiting test.", True
			ExitTest
		End If
		'Search for value if GlobalDictionary value not empty
		If GlobalDictionary.Exists("SetID") Then
			If Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebEdit("SetID").Exist(30) Then
				Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebEdit("SetID").Set GlobalDictionary("SetID")
			Else
				WriteToReport micFail, "Could Not Locate the Textbox for the Set ID", "Text box not found", TRUE
				ExitTest
			End If
			WriteToReport micDone, "Set the SetID to Search for as ["&GlobalDictionary("SetID")&"]", "Successfully Set the SetID to search for", FALSE
		Else
			WriteToReport micDone, "Leaving the SetID Empty", "SetID not needed", FALSE
		End If

		'Click Search
		If Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebButton("Search").Exist(30) Then
			Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebButton("Search").Click
		End If
		WriteToReport micDone, "Clicked the Search Button", "Successfully clicked Search", FALSE
		
		Browser("PeopleSoft Browser").Sync
		
		Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").Link("JobCodeDescription").Click
		Wait 1
		Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").Link("JobCodeDescription").Click
		WriteToReport micDone, "Clicked the Column Header Job Code Description Twice", "Table Sorted in Descending Order by Job Code Description", FALSE
		
		'Store the information before deleting the row
		Set oTemp = Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").WebEdit("JobCode")
		Call oTemp.SetTOProperty("name", "CDW_EX_JBCD_MAP_JOBCODE$"&(arrRemoveAdd(i)-1))
		If oTemp.Exist(30) Then
			sJobCode = oTemp.GetROProperty("value")
			WriteToReport micDone, "Storing the Original Job Code for Row ["&arrRemoveAdd(i)&"] as Job Code "&sJobCode, "Original Job Code Stored", FALSE
		Else
			WriteToReport micFail, "Could not locate Row "&arrRemoveAdd(i),"Row not found",TRUE
			ExitTest
		End If
		
		Set oTemp = Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").WebEdit("RoleName")
		Call oTemp.SetTOProperty("name", "CDW_EX_JBCD_MAP_ROLENAME$"&(arrRemoveAdd(i)-1))
		If oTemp.Exist(30) Then
			sRoleName = oTemp.GetROProperty("value")
			WriteToReport micDone, "Storing the Original Role Name for Row ["&arrRemoveAdd(i)&"] as Role Name "&sRoleName, "Original Role Name Stored", FALSE
		Else
			WriteToReport micFail, "Could not locate Row "&arrRemoveAdd(i),"Row not found",TRUE
			ExitTest
		End If
		
		'Set the object to find the row to delete
		Set oRowDelete = Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").WebButton("RowDelete")
		Call oRowDelete.SetTOProperty("html id", "DEPTID$delete$"&(arrRemoveAdd(i)-1)&"$$0")

		'Delete the entry
		If oRowDelete.Exist(30) Then
			oRowDelete.Click
			If Browser("PeopleSoft Browser").Page("Expense Job Code Role").WebButton("OK").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Expense Job Code Role").WebButton("OK").Click
				WriteToReport micDone, "Clicked to Delete the Job Code "&sJobCode&" with Role Name "&sRoleName, "Deleted the row and clicked OK", FALSE
			Else
				WriteToReport micFail, "Failed to Click the [-] Button to Delete Row "&arrRemoveAdd(i), "Delete Button not clicked", TRUE
				ExitTest
			End If
		Else
			WriteToReport micFail, "Could Not Locate Row ["&arrRemoveAdd(i)&"] to Delete", "Row Not Deleted", TRUE
			ExitTest
		End If

		'Save
		Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync
		WriteToReport micPass, "Saved After Deletion", "Save Button Clicked", FALSE

		'Click add on the first row
		Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").WebButton("FirstRowAdd").Click
		WriteToReport micDone, "Clicked the [+] Button on the First Row", "Add Button Clicked", FALSE

		Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").RefreshObject
		WriteToReport micDone, "New Row Appeared on Row 2", "New Row", FALSE

		'Set the job code
		Set oTemp = Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").WebEdit("JobCode")
		Call oTemp.SetTOProperty("name", "CDW_EX_JBCD_MAP_JOBCODE$"&ROW_2_INDEX)
		oTemp.Set sJobCode
		WriteToReport micPass, "Set the New Row's Job Code to "&sJobCode, "New Job Code Set to the Deleted Job Code", FALSE

		'Set the job role
		Set oTemp = Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").WebEdit("RoleName")
		Call oTemp.SetTOProperty("name", "CDW_EX_JBCD_MAP_ROLENAME$"&ROW_2_INDEX)
		oTemp.Set sRoleName
		WriteToReport micPass, "Set the New Row's Role Name to "&sRoleName, "New Role Name Set to the Deleted Role Name", FALSE

		'Save
		Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		WriteToReport micPass, "Saved After Addition", "Save Button Clicked", FALSE
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Updates a Job Code's Role Name. 
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function UpdateJobCodeRole 'ST05
	Dim i
	Dim arrUpdate
	Dim sJobCode, sRoleName, sCheck
	Dim oTemp
	Dim nResultsShown, nRow

	arrUpdate = Split(GlobalDictionary("Update"),";")
	For i=0 To UBound(arrUpdate)
		'Navigate to Expense Job Code Role
		If SelectMainMenu1(GlobalDictionary("EXJobCodeRole")) Then
			WriteToReport micPass, "Expense Job Code Role Page", "On the Expense Job Code Role page.", False
		Else
			WriteToReport micFail, "Expense Job Code Role Page", "Navigation to Expense Job Code Role page failed. Exiting test.", True
			ExitTest
		End If
		'Search for value if GlobalDictionary value not empty
		If GlobalDictionary.Exists("SetID") Then
			If Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebEdit("SetID").Exist(30) Then
				Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebEdit("SetID").Set GlobalDictionary("SetID")
			Else
				WriteToReport micFail, "Could Not Locate the Textbox for the Set ID", "Text box not found", TRUE
				ExitTest
			End If
			WriteToReport micDone, "Set the SetID to Search for as ["&GlobalDictionary("SetID")&"]", "Successfully Set the SetID to search for", FALSE
		Else
			WriteToReport micDone, "Leaving the SetID Empty", "SetID not needed", FALSE
		End If

		'Click Search
		If Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebButton("Search").Exist(30) Then
			Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebButton("Search").Click
		End If
		WriteToReport micDone, "Clicked the Search Button", "Successfully clicked Search", FALSE
		
		Browser("PeopleSoft Browser").Sync

		Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").Link("JobCodeDescription").Click
		Wait 1
		Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").Link("JobCodeDescription").Click
		WriteToReport micDone, "Clicked the Column Header Job Code Description Twice", "Table Sorted in Descending Order by Job Code Description", FALSE

		'Store the information before updating the row
		Set oTemp = Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").WebEdit("JobCode")
		Call oTemp.SetTOProperty("name", "CDW_EX_JBCD_MAP_JOBCODE$"&(arrUpdate(i)-1))
		If oTemp.Exist(30) Then
			sJobCode = oTemp.GetROProperty("value")
		Else
			WriteToReport micFail, "Could not locate Row "&arrUpdate(i),"Row not found",TRUE
			ExitTest
		End If
		
		Set oTemp = Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").WebEdit("RoleName")
		Call oTemp.SetTOProperty("name", "CDW_EX_JBCD_MAP_ROLENAME$"&(arrUpdate(i)-1))
		If oTemp.Exist(30) Then
			sRoleName = oTemp.GetROProperty("value")
			WriteToReport micDone, "Storing the Original Role Name for Row ["&arrUpdate(i)&"] as Role Name "&sJobCode, "Original Role Name Stored", FALSE
		Else
			WriteToReport micFail, "Could not locate Row "&arrUpdate(i),"Row not found",TRUE
			ExitTest
		End If

		'Store for cleanup later
		If GlobalDictionary.Exists("Update"&arrUpdate(i)) Then
       		GlobalDictionary.Remove("Update"&arrUpdate(i))
    	End If
    	GlobalDictionary.Add "Update"&arrUpdate(i), sJobCode&";"&sRoleName
    	WriteToReport micDone, "Saved the Combo ["&sJobCode&";"&sRoleName&"] to Cleanup Later", "Stored for later", FALSE

    	'Update the job role
		'Click the search icon on the row to update
		Set oTemp =  Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").WebButton("RolenameSearchIcon")
		Call oTemp.SetTOProperty("html id", "CDW_EX_JBCD_MAP_ROLENAME$prompt$"&(arrUpdate(i)-1))
		oTemp.Click
		WriteToReport micDone, "Clicked the Search Icon for the Role Name on Row ["&arrUpdate(i)&"]", "Search Icon Clicked", FALSE
		
		If Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("LookUpRoleName").WebEdit("SearchBeginsWith").Exist(15) Then
			WriteToReport micDone, "The Rolename Search Menu Appeared", "Menu Appeared", FALSE
		Else
			WriteToReport micFail, "The Rolename Search Menu Did Not Appear", "Menu not found", TRUE
			ExitTest
		End If

		'Enter the search criteria, if any
		If GlobalDictionary.Exists("UpdateNameBegins") Then
			Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("LookUpRoleName").WebEdit("SearchBeginsWith").Set GlobalDictionary("UpdateNameBegins")
			WriteToReport micDone, "Set the Begins With Field to "&GlobalDictionary("UpdateNameBegins"), "Begins With field set", FALSE
		End If

		'Click Look Up
		Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("LookUpRoleName").WebButton("LookUp").Click
		WriteToReport micDone, "Clicked the Look Up Button", "Look Up Clicked", FALSE
		Wait 1

		'Grab a different role name than the original. Removed 2, as the indexes start at 0, and the last entry is not a number but uses different words for the "name" field
		nResultsShown = Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("LookUpRoleName").WebTable("SearchResults").RowCount()-2

		Do
			Randomize
			nRow = Round(nResultsShown*Rnd)
			Set oTemp = Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("LookUpRoleName").WebTable("SearchResults").Link("RoleName")
			Call oTemp.SetTOProperty("xpath", "//a[@name='RESULT0$"&nRow&"']")
			oTemp.RefreshObject
			sCheck = oTemp.GetROProperty("innertext")
		Loop While sRoleName = sCheck

		WriteToReport micDone, "Changing the Role Name to "&sCheck, "Selected a Role Name to switch to", FALSE

		'Reassign, just in case it reset after the loop ended
		Set oTemp = Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("LookUpRoleName").WebTable("SearchResults").Link("RoleName")
		Call oTemp.SetTOProperty("xpath", "//a[@name='RESULT0$"&nRow&"']")

		'Click the new Role Name
		oTemp.Click
		WriteToReport micDone, "Clicked the Role Name to Update To", "Role Name Clicked", FALSE

		'Check that the row is updated to the new Role Name
		Set oTemp = Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebTable("ExpenseJobcodeRoles").WebEdit("RoleName")
		Call oTemp.SetTOProperty("name", "CDW_EX_JBCD_MAP_ROLENAME$"&(arrUpdate(i)-1))
		If sCheck = oTemp.GetROProperty("value") Then
			WriteToReport micPass, "Updated Row ["&arrUpdate(i)&"] to New Role Name ["&sCheck&"] From ["&sRoleName&"]", "Updated the Role Name", FALSE
		Else
			WriteToReport micFail, "Did Not Update the Role Name for Row ["&arrUpdate(i)&"]", "Role name not updated. Expected: ["&sCheck&"] Actual: ["&oTemp.GetROProperty("value")&"]", TRUE
			ExitTest
		End If

		'Save
		Browser("PeopleSoft Browser").Page("Expense Job Code Role").PSFrame("Target Content").WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		WriteToReport micPass, "Saved After Update", "Save Button Clicked", FALSE
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Runs the Expense Approval Load Auto Maintenance job (Possible Duplicate)
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function ExpApprovalLoadAutoMaint 'ST05/06
	Dim sProcInst 
	Const RCID = "ExpApprovalLoadAutoMaint"
	Const PROCNAME = "CDWEXAPR"
	'Navigate to Expense Approval Workflow Load Page
	If SelectMainMenu1(GlobalDictionary("EXApprvlLoadAutoMaint")) Then
		WriteToReport micPass, "Expense Approval Workflow Load Page", "On the Expense Approval Workflow Load page.", False
	Else
		WriteToReport micFail, "Expense Approval Workflow Load Page", "Navigation to Expense Approval Workflow Load page failed. Exiting test.", True
		ExitTest
	End If

	Browser("PeopleSoft Browser").Sync

	'Enter the Run Control ID into the search field
	Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("TargetContent").WebEdit("RunControlIDSearch").Set RCID
	WriteToReport micDone, "Set the Search Field to ["&RCID&"]", "Search set", FALSE

	'Click Search
	Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("TargetContent").WebButton("Search").Click
	WriteToReport micDone, "Clicked the Search Button", "Successfully clicked Search", FALSE

	'Check if Run Control ID already exists
	If Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("TargetContent").Link("ExpApprovalLoadAutoMaint").Exist(10) Then
		'Click the link
	 	Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("TargetContent").Link("ExpApprovalLoadAutoMaint").Click
	 	WriteToReport micDone, "Found the Run Control ID Already Existed. Link Clicked for ["&RCID&"]", "Clicked existing Run Control ID", FALSE
	ElseIf Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("TargetContent").WebButton("Run").Exist(10) Then
		WriteToReport micDone, "Run Control ID Already Existed and Unique, Sitting on the Update Expense Approval Workflow Page", "Auto-navigated to the Run Control ID's page", FALSE
		'Continue on
	Else
		'Click the Add a New Value tab
		Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("TargetContent").WebElement("AddANewValue").Click
		WriteToReport micDone, "Clicked the Add a New Value Tab", "Moved to the Add a New Value tab", FALSE

		'Enter a name for the Run Control ID
		Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("TargetContent").WebEdit("RunControlIDAdd").Set RCID
		WriteToReport micDone, "Set the New Run Control ID to ["&RCID&"]", "New ID set", FALSE

		'Click Add
		Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("TargetContent").WebButton("Add").Click
		WriteToReport micDone, "Clicked the Add Button", "Add Clicked", FALSE
	End If 

	'Click Run
	Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("TargetContent").WebButton("Run").Click
	WriteToReport micDone, "Clicked the Run Button", "Run Clicked", FALSE

	'Click the checkbox for process name CDWEXAPR
	If Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("Process Scheduler Request").WebCheckBox("SelectCDWExpApprvlLoad").Exist(15) Then
		Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("Process Scheduler Request").WebCheckBox("SelectCDWExpApprvlLoad").Click
		WriteToReport micDone, "Clicked the Checkbox Associated to the Process Name "&PROCNAME, "Checkbox checked", FALSE
	End If

	'Click OK
	Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("Process Scheduler Request").WebButton("OK").Click
	WriteToReport micDone, "Clicked the OK Button", "OK Clicked", FALSE

	'Grab the Process Instance
	If Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("TargetContent").WebElement("ProcessInstance").Exist(15) Then
		sProcInst = Split(Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("TargetContent").WebElement("ProcessInstance").GetROProperty("innertext"), ":")(1)
		WriteToReport micDone, "The Process Instance is: ["&sProcInst&"]", "Process Instance Reported", FALSE
	End If

	'Click Process Monitor
	Browser("PeopleSoft Browser").Page("Expense Approval Workflow Load").PSFrame("TargetContent").Link("ProcessMonitor").Click
	WriteToReport micDone, "Clicked the Process Monitor Link", "Link Clicked", FALSE

	Call CheckProcessMontiorStatus(PROCNAME)

End Function

'**************************************************************************************************************
''' <summary> 
''' Removes and Replaces an Excluded Department.
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'	06FEB19		Brian B.		Added object cleanup.
'**************************************************************************************************************
Public Function RemoveAddBackExcludedDept 'ST06
	Dim sSearchBy, sID, sDept
	Dim nTimeout, nRow
	Dim oDelete, oDept, oDesc
	Const ROW_2_INDEX = 1
	nTimeout = 1

	'Navigate to Excluded Expense Dept Page
	If SelectMainMenu1(GlobalDictionary("EXExcludedDept")) Then
		WriteToReport micPass, "Excluded Expense Dept Page", "On the Excluded Expense Dept page.", False
	Else
		WriteToReport micFail, "Excluded Expense Dept Page", "Navigation to Excluded Expense Dept page failed. Exiting test.", True
		ExitTest
	End If

	'Select the Search By criteria
	If Browser("PeopleSoft Browser").Page("Excluded Expense Departments").PSFrame("TargetContent").WebList("SearchBy").Exist(5) Then
		Browser("PeopleSoft Browser").Page("Excluded Expense Departments").PSFrame("TargetContent").WebList("SearchBy").Select GlobalDictionary("SearchBy")
		WriteToReport micDone, "Selected "&GlobalDictionary("SearchBy")&" to Search By", "Search By option selected", FALSE
	Else
		WriteToReport micFail, "Could Not Locate the Dropdown for the Search By options", "Dropdown not found", TRUE
		ExitTest
	End If

	If GlobalDictionary("SearchBy") = "Business Unit" Then
		sSearchBy = GlobalDictionary("BusinessUnit") 
		WriteToReport micDone, "The Business Unit to Search For Is: "&GlobalDictionary("BusinessUnit"), "The Business Unit", FALSE
	ElseIf GlobalDictionary("SearchBy") = "SetID" Then
		sSearchBy = GlobalDictionary("SetID")
		WriteToReport micDone, "The SetID to Search For Is: "&GlobalDictionary("SetID"), "The SetID", FALSE
	Else
		WriteToReport micFail, "Not a Valid Option: ["&GlobalDictionary("SearchBy")&"]", "Please check the Search By given, or add it to the possible options", FALSE
		ExitTest
	End If

	Browser("PeopleSoft Browser").Page("Excluded Expense Departments").PSFrame("TargetContent").WebEdit("BeginsWith").Set sSearchBy
	WriteToReport micDone, "Set the Search field to "&sSearchBy, "Search Set", FALSE

	'Click Search
	Browser("PeopleSoft Browser").Page("Excluded Expense Departments").PSFrame("TargetContent").WebButton("Search").Click
	WriteToReport micDone, "Clicked the Search Button", "Search clicked", FALSE

	If Browser("PeopleSoft Browser").Page("Excluded Expense Departments").PSFrame("TargetContent").WebTable("ExcludedDepartments").Exist(10) Then
		Do
			Browser("PeopleSoft Browser").Page("Excluded Expense Departments").PSFrame("TargetContent").WebTable("ExcludedDepartments").Link("Find").Click
			If Browser("PeopleSoft Browser").Dialog("Script Prompt").Exist(15) Then
				Browser("PeopleSoft Browser").Dialog("Script Prompt").WinEdit("Search").Set GlobalDictionary("DeptDelete"&GlobalDictionary("Counter"))
				Setting.Webpackage("ReplayType") = 2 'Mouse
				Browser("PeopleSoft Browser").Dialog("Script Prompt").WinButton("OK").Click
				Setting.Webpackage("ReplayType") = 1 'Event
			End If
			Set oDesc = Description.Create
			oDesc("value").value = GlobalDictionary("DeptDelete"&GlobalDictionary("Counter"))
			nTimeout = nTimeout +1
		Loop Until Browser("PeopleSoft Browser").Page("Excluded Expense Departments").PSFrame("TargetContent").WebTable("ExcludedDepartments").WebEdit(oDesc).Exist(5) OR nTimeout = 11
	Else
		WriteToReport micFail, "Could not Locate the Table of Excluded Departments", "Table not found", TRUE
		ExitTest
	End If

	sID = Browser("PeopleSoft Browser").Page("Excluded Expense Departments").PSFrame("TargetContent").WebTable("ExcludedDepartments").WebEdit(oDesc).GetROProperty("html id")

	nRow = Split(sID, "$")(1)

	Set oDelete = Browser("PeopleSoft Browser").Page("Excluded Expense Departments").PSFrame("TargetContent").WebTable("ExcludedDepartments").WebButton("Delete")
	Call oDelete.SetTOProperty("html id", "DEPTID$delete$"&nRow&"$$0")
	If oDelete.Exist(5) Then
		oDelete.Click
		WriteToReport micDone, "Clicked to Delete the Excluded Department ["&GlobalDictionary("DeptDelete"&GlobalDictionary("Counter"))&"]", "[-] Clicked", FALSE
	End If

	'Click Save
	Browser("PeopleSoft Browser").Page("Excluded Expense Departments").PSFrame("TargetContent").WebButton("Save").Click
	
	Wait 5 'Give time to save.
	
	'Click the Add button on the first row
	Browser("PeopleSoft Browser").Page("Excluded Expense Departments").PSFrame("TargetContent").WebTable("ExcludedDepartments").WebButton("Add+").Click
	Set oDept = Browser("PeopleSoft Browser").Page("Excluded Expense Departments").PSFrame("TargetContent").WebTable("ExcludedDepartments").WebEdit("Department")
	Call oDept.SetTOProperty("name", "CDW_EX_XCL_DEPT_DEPTID$"&ROW_2_INDEX)

	'Add the appropriate dept
	oDept.Set GlobalDictionary("DeptAdd"&GlobalDictionary("Counter"))

	'Click Save
	Browser("PeopleSoft Browser").Page("Excluded Expense Departments").PSFrame("TargetContent").WebButton("Save").Click

	'Increment Counter
	GlobalDictionary("Counter") = CInt(GlobalDictionary("Counter"))+1
	
	' Cleanup
	If isObject(oDelete) Then Set oDelete = Nothing
	If isObject(oDept) Then Set oDept = Nothing
	If isObject(oDesc) Then Set oDesc = Nothing
End Function

'**************************************************************************************************************
''' <summary> 
''' Runs and Saves the Expense Approver Report
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'	04FEB19		Brian B.		Changed the Save Dropdown button click to a description.
'**************************************************************************************************************
Public Function RunEXApproverReport
	Dim sTemp
	
	If GlobalDictionary.Exists("FileCounter") Then
		sTemp = GlobalDictionary("FileName" & GlobalDictionary("FileCounter"))
		If GlobalDictionary.Exists("FileName") Then
			GlobalDictionary.Remove("FileName")
		End If
		
		GlobalDictionary.Add "FileName", sTemp
		WriteToReport micInfo, "Changed File Name For Count [" & GlobalDictionary("FileCounter") & "]", "File name changed to [" & GlobalDictionary("FileName") & "]." , False
	End If

	'Navigate to EX Approver Report Page
	If SelectMainMenu1(GlobalDictionary("EXAppReport")) Then
		WriteToReport micPass, "Expense EX Approver Report Page", "On the Expense EX Approver Report page.", False
	Else
		WriteToReport micFail, "Expense EX Approver Report Page", "Navigation to Expense EX Approver Report page failed. Exiting test.", True
		ExitTest
	End If

	'Click Generate Report
	Browser("PeopleSoft Browser").Page("EX Approver Report").PSFrame("TargetContent").WebButton("GenerateReport").Click
	WriteToReport micDone, "Clicked The Generate Report Button", "Generate Report clicked", FALSE

	'Wait for the message to appear saying it was successful
	If Browser("PeopleSoft Browser").Page("EX Approver Report").PSFrame("TargetContent").WebElement("SuccessMessage").Exist(30) Then
		WriteToReport micPass, "Report Generated Successfully", "Report ready to download", FALSE
	Else
		WriteToReport micFail, "Report Took Too Long to Generate", "Report not generated", TRUE
		ExitTest
	End If

	'Click Run To Excel
	Browser("PeopleSoft Browser").Page("EX Approver Report").PSFrame("TargetContent").Link("RunToExcel").Click
	WriteToReport micDone, "Run To Excel Clicked", "Excel ready to download", FALSE

	Wait 5 'Adding waits, it opens a new tab and becomes confused over multiple tabs

	'Save the excel file that was generated
	If Browser("PeopleSoft Browser").WinObject("Notification").WinButton("SaveDropdown").Exist(30) Then
'		Browser("PeopleSoft Browser").WinObject("Notification").WinButton("SaveDropdown").Click
		Browser("PeopleSoft Browser").WinObject("Notification").WinButton("object class:=drop down button").highlight ' Win 10 NOTE: Can see the object but for some reason, can not click it.  Description click works however.
		Browser("PeopleSoft Browser").WinObject("Notification").WinButton("object class:=drop down button").Click
		Wait 2
		If Browser("PeopleSoft Browser").WinMenu("SaveOptions").Exist(15) Then
			Browser("PeopleSoft Browser").WinMenu("SaveOptions").Select "Save as"
			If Browser("PeopleSoft Browser").Dialog("Save As").Exist(15) Then
				Wait 2
				Browser("PeopleSoft Browser").Dialog("Save As").WinEdit("SaveName").Set GlobalDictionary("FileLocation") & GlobalDictionary("FileName")
				Browser("PeopleSoft Browser").Dialog("Save As").WinButton("Save").Click
				WriteToReport micPass, "Saved the Excel Sheet", "File Saved as [" & GlobalDictionary("FileName") & "] at location [" & GlobalDictionary("FileLocation") & "].", FALSE
			End If
		Else
			WriteToReport micFail, "The Save Options Menu Did Not Appear", "Could not save the file", TRUE
			ExitTest
		End If
	Else
		WriteToReport micFail, "The 'Do you want to open or save...' Notification Did Not Appear", "Could not save the file", TRUE
		ExitTest
	End If
	Wait 10 'Give it time to change from asking to download, to reporting it has downloaded
	If Browser("PeopleSoft Browser").WinObject("Notification").WinButton("Close x").Exist(5) Then
		Browser("PeopleSoft Browser").WinObject("Notification").WinButton("Close x").Click
		WriteToReport micDone, "Clicked the [x] to Clear the Saved File Notification", "Dismissed Notification", FALSE
	End If
	
	If Browser("PeopleSoft Browser").WinObject("Notification").WinButton("Close x").Exist(5) Then
		Browser("PeopleSoft Browser").WinObject("Notification").WinButton("Close x").Click
		WriteToReport micDone, "Clicked the [x] Again Since It Was Still There", "Dismissed Notification", FALSE
	End If

	If GlobalDictionary.Exists("FileCounter") Then
'		GlobalDictionary("FileCounter") = CInt(GlobalDictionary("FileCounter"))+1
		sTemp = GlobalDictionary("FileCounter")
		sTemp = CInt(sTemp) + 1
		
		If GlobalDictionary.Exists("FileCounter") Then
			GlobalDictionary.Remove("FileCounter")
		End If
		GlobalDictionary.Add "FileCounter", sTemp
		WriteToReport micInfo, "Raised RunEXApproverReport File Counter", "Counter raised to [" & GlobalDictionary("FileCounter") & "]." , False
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Compares two Approval Reports. Reports should mostly be line for line equal. 
''' TODO: Add expected differences to check for
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function CompareEXAppReport 'ST06
    Dim oFSO, oExcel, oComp1, oComp2, oSheet1, oSheet2
    Dim sCompare1, sCompare2
    Dim bSheet1, bSheet2
    Dim i, j, nMax, nS1, nS2
    Const EXCEL_I = 9
    bSheet1 = FALSE
    bSheet2 = FALSE
    nS1 = 0
    nS2 = 0

    Set oFSO = CreateObject("Scripting.FileSystemObject")
    Set oExcel = CreateObject("Excel.Application")

    sCompare1 = GlobalDictionary("FileLocation") & GlobalDictionary("FileName1")
    sCompare2 = GlobalDictionary("FileLocation") & GlobalDictionary("FileName2")

    'Check that the first file exists
    If NOT oFSO.FileExists(sCompare1) Then
        WriteToReport micFail, "First File Does Not Exist", "File not found at "&sCompare1, FALSE
        ExitTest
    Else
        WriteToReport micPass, "First File Exists", "File named [" & sCompare1 & "] found.", FALSE
    End If
    
    'Check that the second file exists
    If NOT oFSO.FileExists(sCompare2) Then
        WriteToReport micFail, "Second File Does Not Exist", "File not found at "&sCompare2, FALSE
        ExitTest
    Else
        WriteToReport micPass, "Second File Exists", "File named [" & sCompare2 & "] found.", FALSE
    End If

    'Open the first file
    Set oComp1 = oExcel.Workbooks.Open(sCompare1)
    Set oSheet1 = oComp1.Worksheets("sheet1")

    'Open the second file
    Set oComp2 = oExcel.Workbooks.Open(sCompare2)
    Set oSheet2 = oComp2.Worksheets("sheet1")

    'Start Compare
    If oSheet1.UsedRange.Rows.Count > oSheet2.UsedRange.Rows.Count Then
        nMax = oSheet1.UsedRange.Rows.Count
        bSheet1 = TRUE
    Else
        nMax = oSheet2.UsedRange.Rows.Count
        bSheet2 = TRUE
    End If

    For i=2 To nMax
        For j=1 To EXCEL_I
            If oSheet1.Cells(i+nS1,j) = oSheet2.Cells(i+nS2,j) Then
                
            Else
                WriteToReport micWarning, "Row "&i+nS1& " Column "&j+nS2&" Does Not Match Between Files", "Sheet 1: ["&oSheet1.Cells(i+nS1,j)&"] Sheet 2: ["&oSheet2.Cells(i+nS2,j)&"]", FALSE
                If bSheet1 Then
                    nS1 = nS1 + 1
                    If oSheet1.Cells(i+nS1,j) = oSheet2.Cells(i+nS2,j) Then
                    Else
                        '
                    End If
                End If
                If bSheet2 Then
                    nS2 = ns2 + 1
                    If oSheet1.Cells(i+nS1,j) = oSheet2.Cells(i+nS2,j) Then
                        '
                    End If
                End If
            End If
        Next
    Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Checks approval report for missing/added line. 
''' </summary>
''' <author>Brian Buckhana</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'	19FEB19		Brian B.		Changed i to start at 3 instead of 2 due to file changes.
'**************************************************************************************************************
Public Function CheckRowEXAppReport 'ST06
	Dim aRowToFind
    Dim oFSO, oExcel, oComp1, oSheet1
    Dim sCompare, nCounter, sAddedOrDeleted, sGLUnit, sDept, sProfile, sSheetGLUnit, sSheetDept, sSheetProfile
    Dim i, j, nMax
    Const GLUNIT_COL = 1, DEPT_COL = 2, PROFILE_COL = 6

    Set oFSO = CreateObject("Scripting.FileSystemObject")
    Set oExcel = CreateObject("Excel.Application")
	nCounter = GlobalDictionary("RowFindCounter")
	aRowToFind = Split(GlobalDictionary("Row_Added_Removed" & nCounter), ";")
    sCompare = GlobalDictionary("FileLocation") & GlobalDictionary("FileName" & nCounter)

    'Check that the file exists
    If NOT oFSO.FileExists(sCompare) Then
        WriteToReport micFail, "File Does Not Exist", "File not found at [" & sCompare & "].", FALSE
        ExitTest
    Else
        WriteToReport micPass, "File Exists", "File named [" & sCompare & "] found.", FALSE
    End If

    'Open the first file
    Set oComp1 = oExcel.Workbooks.Open(sCompare)
    Set oSheet1 = oComp1.Worksheets("sheet1")

    'Start Compare
    nMax = oSheet1.UsedRange.Rows.Count	
	sAddedOrDeleted = aRowToFind(0)
	sGLUnit = aRowToFind(1)
	sDept = aRowToFind(2)
	sProfile = aRowToFind(3)
	
    For i = 3 To nMax
    	sSheetGLUnit = oSheet1.Cells(i, GLUNIT_COL) 
    	sSheetDept = oSheet1.Cells(i, DEPT_COL)
    	sSheetProfile = oSheet1.Cells(i, PROFILE_COL)
    	
        If sSheetGLUnit = sGLUnit AND sSheetDept = sDept AND sSheetProfile = sProfile Then
            If sAddedOrDeleted = "Added" Then
            	WriteToReport micPass, "Row Found In EX App Report As Expected", "GL Unit [" & sGLUnit & "] | Department [" & sDept & "] | Profile [" & sProfile & "]", FALSE
            	Exit For
            Else
            	WriteToReport micFail, "Row Found In EX App Report Unexpectedly", "GL Unit [" & sGLUnit & "] | Department [" & sDept & "] | Profile [" & sProfile & "]", FALSE
            	WriteToReport micInfo, "Last Row Checked", "GL Unit Column [" & sSheetGLUnit &"] | Dept Column [" & sSheetDept & "] | Profile [" & sSheetProfile & "]", FALSE
            	ExitTest
            End If
        ElseIf oSheet1.Cells(i, GLUNIT_COL) > sGLUnit OR i = nMax Then
			If sAddedOrDeleted = "Removed" Then
				WriteToReport micPass, "Row Not Found In EX App Report As Expected", "GL Unit [" & sGLUnit & "] | Department [" & sDept & "] | Profile [" & sProfile & "]", FALSE
				Exit For
			Else
				WriteToReport micFail, "Row Not Found In EX App Report Unexpectedly", "GL Unit [" & sGLUnit & "] | Department [" & sDept & "] | Profile [" & sProfile & "]", FALSE
				WriteToReport micInfo, "Last Row Checked", "GL Unit Column [" & sSheetGLUnit &"] | Dept Column [" & sSheetDept & "] | Profile [" & sSheetProfile & "]", FALSE
				ExitTest
			End If
        End If
    Next
	
	' Close out books.
	oComp1.Close
	oExcel.Quit
	
	' Raise counter
	If GlobalDictionary.Exists("RowFindCounter") Then
		GlobalDictionary.Remove("RowFindCounter")
	End If
	
	GlobalDictionary.Add "RowFindCounter", nCounter + 1
	WriteToReport micInfo, "Raised CheckRowEXAppReport File Counter", "Counter raised to [" & GlobalDictionary("RowFindCounter") & "]." , False
	
	' Cleanup
	If isArray(aRowToFind) Then Erase aRowToFind
	If isObject(oSheet1) Then Set oSheet1 = Nothing
	If isObject(oComp1) Then Set oComp1 = Nothing
	If isObject(oExcel) Then Set oExcel = Nothing
	If isObject(oFSO) Then Set oFSO = Nothing
End Function

'**************************************************************************************************************
''' <summary> 
''' Removes one of the Approvers from the List. This can be undone by running the Expense Approval Workflow Load job
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'	04FEB19		Brian B.		Changed WebElement(GLBusUnit) to WebEdit.  Added oDelete object to declaration.
'**************************************************************************************************************
Public Function RemoveApproverFromList 'ST06
	Dim oDelete
	
	'Navigate to Approver List Page
	If SelectMainMenu1(GlobalDictionary("EXApproverList")) Then
		WriteToReport micPass, "Approver List Page", "On the Approver List page.", False
	Else
		WriteToReport micFail, "Approver List Page", "Navigation to Approver List page failed. Exiting test.", True
		ExitTest
	End If

	If Browser("Peoplesoft Browser").Page("Approver List").PSFrame("TargetContent").WebEdit("GLBusUnit").Exist(15) Then
		Browser("Peoplesoft Browser").Page("Approver List").PSFrame("TargetContent").WebEdit("GLBusUnit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set the GL Business Unit as ["&GlobalDictionary("BusinessUnit")&"]", "GL Unit Set", FALSE
	End If

	Browser("Peoplesoft Browser").Page("Approver List").PSFrame("TargetContent").WebList("TransactionType").Select GlobalDictionary("TransactionType")
	WriteToReport micDone, "Chose the Transaction Type ["&GlobalDictionary("TransactionType")&"]", "Transaction Type Selected", FALSE

	Browser("Peoplesoft Browser").Page("Approver List").PSFrame("TargetContent").WebEdit("ApproverType").Set GlobalDictionary("ApproverType")
	WriteToReport micDone, "Set the Approver Type to ["&GlobalDictionary("ApproverType")&"]", "Approver Type Set", FALSE

	Browser("Peoplesoft Browser").Page("Approver List").PSFrame("TargetContent").WebButton("Search").Click
	WriteToReport micDone, "Clicked the Search Button", "Search Clicked", FALSE

	Browser("Peoplesoft Browser").Page("Approver List").PSFrame("TargetContent").WebEdit("DeptFrom").Set GlobalDictionary("DeptFrom")
	WriteToReport micDone, "Set the Department From Field to ["&GlobalDictionary("DeptFrom")&"]", "Department From Set", FALSE

	Browser("Peoplesoft Browser").Page("Approver List").PSFrame("TargetContent").WebButton("DeptSearch").Click
	WriteToReport micDone, "Clicked the Search Button", "Search Button Clicked", FALSE

	Set oDelete = Browser("Peoplesoft Browser").Page("Approver List").PSFrame("TargetContent").WebButton("DeleteApprover")
	Call oDelete.SetTOProperty("xpath", "//input[@value='"&GlobalDictionary("Approver")&"']/../../../td/div/a[contains(@class,'DELETE')]")
	oDelete.Click
	WriteToReport micDone, "Clicked the Delete Button for the Approver ["&GlobalDictionary("Approver")&"]", "Delete Clicked for Approver", FALSE

	If Browser("Peoplesoft Browser").Page("Approver List").WebButton("OK").Exist(15) Then
		Browser("Peoplesoft Browser").Page("Approver List").WebButton("OK").Click
		WriteToReport micDone, "Clicked the OK Button from the Alert", "OK Button Clicked", FALSE
	Else
		WriteToReport micFail, "Could not Locate the OK Button in the Popup", "Alert did not appear, check the Delete Object", TRUE
		ExitTest
	End If

	Browser("Peoplesoft Browser").Page("Approver List").PSFrame("TargetContent").WebButton("Save").Click
	WriteToReport micDone, "Saved After Deleting Approver ["&GlobalDictionary("Approver")&"]", "Save Clicked", FALSE
End Function

'**************************************************************************************************************
''' <summary> 
''' Deletes a 'Saved for Later' Expense Report
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'	28JAN19		Brian B.		Removed the Browser.Sync and increased .Exist timer of object afterwards.
'**************************************************************************************************************
Public Function DeleteSavedExpenseReport
	Dim oCheckbox 
	'Navigate to Delete Expense Page
	If SelectMainMenu1(GlobalDictionary("EXDelete")) Then
		WriteToReport micPass, "Delete Expense Page", "On the Delete Expense page.", False
	Else
		WriteToReport micFail, "Delete Expense Page", "Navigation to Delete Expense page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("Peoplesoft Browser").Page("Delete Expense Report").PSFrame("TargetContent")

		'Click the Search Button
		If .WebButton("Search").Exist(5) Then
			.WebButton("Search").Click
			WriteToReport micDone, "Clicked the Search Button", "Search clicked", FALSE
		Else
			WriteToReport micFail, "Could Not Locate the Search Button", "Search not clicked", TRUE
			ExitTest
		End If

		'Find and Check the report for deletion
		If .WebTable("Reports").Exist(10) Then
			Set oCheckbox = .WebTable("Reports").WebCheckBox("SelectToDelete")
			Call oCheckbox.SetTOProperty("xpath", "//span[text()='"&GlobalDictionary("ExpenseReportID")&"']/../../../td/div/input[@class='PSCHECKBOX']")
			If oCheckbox.Exist(5) Then
				oCheckbox.Click
				WriteToReport micDone, "Clicked the Checkbox for Expense Report ["&GlobalDictionary("ExpenseReportID")&"]", "Checkbox Checked", FALSE
			Else
				WriteToReport micFail, "Could Not Locate the Checkbox for Expense Report ["&GlobalDictionary("ExpenseReportID")&"]", "Check the Properties for the oCheckbox object, make sure it has the right Expense ID", TRUE
				ExitTest
			End If
		End If

		'Click the Delete Selected Report(s) button
		.WebButton("DeleteSelected").Click
		WriteToReport micDone, "Clicked the Delete Selected Report(s) Button", "Successfully Clicked the button to delete the selected reports", FALSE

'		Browser("Peoplesoft Browser").Sync

		'Check that the Checkmark image appears, signalling a successful deletion
		If .Image("Check").Exist(240) Then
			WriteToReport micPass, "The Success Checkmark is Displayed After the Report was Deleted", "Success Message Displayed", FALSE
		Else
			WriteToReport micFail, "The Success Checkmark Did Not Display After One Minute", "The Success Message took too long to appear", TRUE
			ExitTest
		End If

		'Click OK, returning to the screen with the table of reports
		.WebButton("OK").Click
		WriteToReport micDone, "Clicked the OK Button", "OK Clicked, and Returned to the Delete Reports Selection Screen", FALSE

		'Check that the Expense Report is no longer found in the table
		If oCheckbox.Exist(5) Then
			WriteToReport micFail, "The Checkbox Associated with Expense Report ["&GlobalDictionary("ExpenseReportID")&"] was Still in the Table", "Expense not Deleted", TRUE
			ExitTest
		Else
			WriteToReport micPass, "The Checkbox Associated with Expense Report ["&GlobalDictionary("ExpenseReportID")&"] was Not Found", "Expense Deleted", FALSE
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Verifies Amount Due to Supplier when Opening a MyWallet Item
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function VerifyAmountDueSupplierFromMyWallet
	Dim nWalletItems, sTransAmount, sTemp, sEmployeeID
	Const ZERO = "0.00"
	'Find a user to login as, that has a Hotel Charge in the unassigned status, from the database
	Call Login(dbFindUserWithManyExpenses())
	If SelectMainMenu1(GlobalDictionary("AddExpenseReport")) Then
		WriteToReport micPass, "Create/Modify Expense Page", "On the Create/Modify Expense page.", False
	Else
		WriteToReport micFail, "Create/Modify Expense Page", "Navigation to Create/Modify Expense page failed. Exiting test.", True
		ExitTest
	End If

	'Verify the EMPLID field is not empty
	sEmployeeID = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Employee ID").GetROProperty("value")
	If NOT (sEmployeeID = "") OR NOT (isEmpty(sEmployeeID)) Then
		WriteToReport micDone, "Employee ID Filled", "Employee ID not empty", FALSE
	Else
		WriteToReport micFail, "Employee ID Empty", "Cannot add Expense Report due to ID not being auto-filled", TRUE
		ExitTest
	End If

	'Click Add
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Add").Click
	WriteToReport micDone, "Add Button Clicked", "Successfully clicked Add", FALSE

	Browser("PeopleSoft Browser").Sync

	'Enter Business Purpose
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("Business Purpose").Select GlobalDictionary("BusinessPurpose")
	WriteToReport micDone, "Selected the Business Purpose ["&GlobalDictionary("BusinessPurpose")&"]", "Business Purpose selected", FALSE

	'Enter Report Description
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Report Description").Set GlobalDictionary("ReportDescription")
	WriteToReport micDone, "Set the Report Description ["&GlobalDictionary("ReportDescription")&"]", "Report Description set", FALSE

	'Get the number out of the My Wallet Link, Split right of the '(' and split that result to the left of the ')'
	nWalletItems = Split(Split(Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("MyWallet#").GetROProperty("innertext"),"(")(1),")")(0)
	WriteToReport micDone, "Current Number of Items in My Wallet ["&nWalletItems&"]", "Stored the current number of items in My Wallet", FALSE

	'Click the My Wallet link
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("MyWallet#").Click
	WriteToReport micDone, "Clicked the My Wallet ("&nWalletItems&") Link", "My Wallet Clicked", FALSE

	'Click the first Select box next to the entry on the first line
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebCheckBox("FirstItemSelect").Click
	WriteToReport micDone, "Checked the First Result's Checkbox", "Checkbox Checked", FALSE

	'Click Done
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebButton("Done").Click
	WriteToReport micDone, "Clicked the Done Button", "Done Clicked", FALSE

	'Note the Transaction Amount
	sTransAmount = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Amount").GetROProperty("value")
	WriteToReport micDone, "The Transaction Amount is ["&sTransAmount&"]", "Stored the Transaction Amount for Later", FALSE

	'Populate and required fields
	'Expense Description
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Expense Description").Set GlobalDictionary("ExpenseDescription")
	WriteToReport micDone, "Set the Expense Description to "&GlobalDictionary("ExpenseDescription"), "Expense Description Set", FALSE

	'Location
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Select A Location").Set GlobalDictionary("SelectALocation")
	WriteToReport micDone, "Set the Expense Location to "&GlobalDictionary("SelectALocation"), "Set Location", FALSE

	'Click 'Summary and Submit'
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("SummaryAndSubmit").Click
	WriteToReport micDone, "Clicked the Summary and Submit Link", "Link Clicked", FALSE

	'Review the amount Due to Employee, should be zero
	sTemp = Trim(Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("AmountDueToEmployee").GetROProperty("innertext"))
	If ZERO <> sTemp Then
		WriteToReport micFail, "Amount Due to Employee Should be ["&ZERO&"] but Instead Was ["&sTemp&"]", "The Amount Due to Employee was not 0.00", TRUE
		ExitTest
	Else
		WriteToReport micPass, "Amount Due to Employee Was ["&sTemp&"] As Expected", "The Amount Due to Employee was 0.00", FALSE
	End If

	'Review the amount Due to Supplier, should match Transaction Amount from before
	sTemp = Trim(Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("AmountDueToSupplier").GetROProperty("innertext"))
	If sTransAmount <> sTemp Then
		WriteToReport micFail, "Amount Due to Supplier Should be ["&sTransAmount&"] but Instead Was ["&sTemp&"]", "The Amount Due to Employee was not "&sTransAmount, TRUE
		ExitTest
	Else
		WriteToReport micPass, "Amount Due to Supplier Was ["&sTemp&"] As Expected", "The Amount Due to Employee was "&sTransAmount, FALSE
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Fills out an expense for an Airfare, skipping the Ticket Number field originally.
''' Checks that the program alerts you that you did not fill the Ticket Number field, fills it out, then submits
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function SaveWithErrors
	Dim sExpID, sEmployeeID
	
	If SelectMainMenu1(GlobalDictionary("AddExpenseReport")) Then
		WriteToReport micPass, "Create/Modify Expense Page", "On the Create/Modify Expense page.", False
	Else
		WriteToReport micFail, "Create/Modify Expense Page", "Navigation to Create/Modify Expense page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent") 
	'Verify the EMPLID field is not empty
		sEmployeeID = .WebElement("Employee ID").GetROProperty("value")
		If NOT (sEmployeeID = "") OR NOT (isEmpty(sEmployeeID)) Then
			WriteToReport micDone, "Employee ID Filled", "Employee ID not empty", FALSE
		Else
			WriteToReport micFail, "Employee ID Empty", "Cannot add Expense Report due to ID not being auto-filled", TRUE
			ExitTest
		End If

		'Click Add
		.WebButton("Add").Click
		WriteToReport micDone, "Add Button Clicked", "Successfully clicked Add", FALSE

		Browser("PeopleSoft Browser").Sync

		'Enter Business Purpose
		.WebList("Business Purpose").Select GlobalDictionary("BusinessPurpose")
		WriteToReport micDone, "Selected the Business Purpose ["&GlobalDictionary("BusinessPurpose")&"]", "Business Purpose selected", FALSE

		'Enter Report Description
		.WebEdit("Report Description").Set GlobalDictionary("ReportDescription")
		WriteToReport micDone, "Set the Report Description ["&GlobalDictionary("ReportDescription")&"]", "Report Description set", FALSE

		'Enter Date
		If GlobalDictionary("ExpenseDateValue") = "TODAY" Then
			.WebEdit("Expense Date").Set CStr(date())
			WriteToReport micDone, "Set the Date to Today's Date ["&CStr(date())&"]", "Date Field set", FALSE
		Else
			.WebEdit("Expense Date").Set GlobalDictionary("ExpenseDateValue")
			WriteToReport micDone, "Set the Date to  ["&GlobalDictionary("ExpenseDateValue")&"]", "Date Field set", FALSE
		End If

		'Enter Expense Type
		.WebList("Expense Type").Select GlobalDictionary("ExpenseType")
		WriteToReport micDone, "Selected ["&GlobalDictionary("ExpenseType")&"] From the Expense Type List", "Expense Type Selected", FALSE

		'Enter Description
		.WebEdit("Expense Description").Set GlobalDictionary("ExpenseDescription")
		WriteToReport micDone, "Set the Expense Description to ["&GlobalDictionary("ExpenseDescription")&"]", "Expense Description set", FALSE

		'Enter Payment Type
		.WebList("Expense Payment Type").Select GlobalDictionary("ExpensePaymentType")
		WriteToReport micDone, "Set the Expense Payment Type to ["&GlobalDictionary("ExpensePaymentType")&"]", "Expense Payment Type set", FALSE

		'Enter Amount
		.WebEdit("Expense Amount").Set GlobalDictionary("ExpenseAmount")
		WriteToReport micDone, "Set the Amount to ["&GlobalDictionary("ExpenseAmount")&"]", "Amount Set", FALSE

		'Enter Location
		.WebEdit("Select A Location").Set GlobalDictionary("SelectALocation")
		WriteToReport micDone, "Set the Location to ["&GlobalDictionary("SelectALocation")&"]", "Location Set", FALSE

		'Enter Non-Preferred Vendor Value
		.WebEdit("Non Preferred Vendor Value").Set GlobalDictionary("NonPreferredVendorValue")
		WriteToReport micDone, "Set the Non-Preferred Vendor Value to ["&GlobalDictionary("NonPreferredVendorValue")&"]", "Non-Preferred Vendor Value set", FALSE

		'Check No Receipt
		If GlobalDictionary("NoReceipt") = "TRUE" Then
			.WebCheckBox("NoReceipt").Click
			WriteToReport micDone, "Checked the Box for No Receipt", "Checkbox Checked", FALSE
		End If

		'Click Save For Later
		.Link("Save for Later").Click
		WriteToReport micDone, "Clicked the Summary and Submit Link", "Link clicked", FALSE

		'It should refresh the Details screen, with a Red Flag shown and certain fields in Red
		'Verify Red Flag
		If .Image("RedFlag").Exist(15) Then
			WriteToReport micPass, "Red Flag Shown as Expected", "Red Flag appeared, indicating a missing field", FALSE
		Else
			WriteToReport micFail, "Red Flag Did Not Appear as Expected", "Red Flag missing", TRUE
			ExitTest
		End If
		
		'Verify fields in Red
		If GlobalDictionary("BusinessPurpose") = "" Then
			If .WebList("Business Purpose").GetROProperty("class") = "PSERROR" Then
				WriteToReport micPass, "Business Purpose Field in Red as Expected", "Class is PSERROR", FALSE
			Else
				WriteToReport micFail, "Business Purpose Field in Not Red as Expected", "Class is not PSERROR", FALSE
				ExitTest
			End If
		End If

		If GlobalDictionary("ReportDescription") = "" Then
			If .WebEdit("Report Description").GetROProperty("class") = "PSERROR" Then
				WriteToReport micPass, "Report Description Field in Red as Expected", "Class is PSERROR", FALSE
			Else
				WriteToReport micFail, "Report Description Field in Not Red as Expected", "Class is not PSERROR", FALSE
				ExitTest
			End If
		End If

		If GlobalDictionary("ExpenseDateValue") = "" Then
			If .WebEdit("Expense Date").GetROProperty("class") = "PSERROR" Then
				WriteToReport micPass, "Expense Date Value Field in Red as Expected", "Class is PSERROR", FALSE
			Else
				WriteToReport micFail, "Expense Date Value Field in Not Red as Expected", "Class is not PSERROR", FALSE
				ExitTest
			End If
		End If

		If GlobalDictionary("ExpenseDescription") = "" Then
			If .WebEdit("Expense Description").GetROProperty("class") = "PSERROR" Then
				WriteToReport micPass, "Expense Description Field in Red as Expected", "Class is PSERROR", FALSE
			Else
				WriteToReport micFail, "Expense Description Field in Not Red as Expected", "Class is not PSERROR", FALSE
				ExitTest
			End If
		End If

		If GlobalDictionary("ExpenseAmount") = "" Then
			If .WebEdit("Expense Amount").GetROProperty("class") = "PSERROR" Then
				WriteToReport micPass, "Expense Amount Field in Red as Expected", "Class is PSERROR", FALSE
			Else
				WriteToReport micFail, "Expense Amount Field in Not Red as Expected", "Class is not PSERROR", FALSE
				ExitTest
			End If
		End If

		If GlobalDictionary("SelectALocation") = "" Then
			If .WebEdit("Select A Location").GetROProperty("class") = "PSERROR" Then
				WriteToReport micPass, "Location Field in Red as Expected", "Class is PSERROR", FALSE
			Else
				WriteToReport micFail, "Location Field in Not Red as Expected", "Class is not PSERROR", FALSE
				ExitTest
			End If
		End If

		If GlobalDictionary("NonPreferredVendorValue") = "" Then
			If .WebEdit("Non Preferred Vendor Value").GetROProperty("class") = "PSERROR" Then
				WriteToReport micPass, "Non-Preferred Vendor Field in Red as Expected", "Class is PSERROR", FALSE
			Else
				WriteToReport micFail, "Non-Preferred Vendor Field in Not Red as Expected", "Class is not PSERROR", FALSE
				ExitTest
			End If
		End If

		'Report the Report ID generated
		sExpID = Trim(Split(.WebElement("ExpenseReportID").GetROProperty("innertext"), "Pending")(0))
		WriteToReport micDone, "Expense Saved for Later With ID ["&sExpID&"]", "Expense Saved Successfully", FALSE
		GlobalDictionary("ExpenseReportID") = sExpID
	End With

End Function

'**************************************************************************************************************
''' <summary> 
''' Verifies fields were Saved Correctly
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'11Mar2019			Eric Trout	updates so if GlobalDictionary("ExpenseDateValue") = "TODAY" then it pulls today's date
'**************************************************************************************************************
Public Function VerifySavedReport
	Dim sEmployeeID, sTemp
	If SelectMainMenu1(GlobalDictionary("AddExpenseReport")) Then
		WriteToReport micPass, "Create/Modify Expense Page", "On the Create/Modify Expense page.", False
	Else
		WriteToReport micFail, "Create/Modify Expense Page", "Navigation to Create/Modify Expense page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent")

		'Verify the EMPLID field is not empty
		sEmployeeID = .WebElement("Employee ID").GetROProperty("value")
		If NOT (sEmployeeID = "") OR NOT (isEmpty(sEmployeeID)) Then
			WriteToReport micDone, "Employee ID Filled", "Employee ID not empty", FALSE
		Else
			WriteToReport micFail, "Employee ID Empty", "Cannot add Expense Report due to ID not being auto-filled", TRUE
			ExitTest
		End If

		'Click Find an Existing Value
		.Link("Find an Existing Value").Click
		WriteToReport micDone, "Clicked the Find an Existing Value Link", "Link Clicked", FALSE	

		'Enter the Report ID
		.WebEdit("Report ID").Set GlobalDictionary("ExpenseReportID")
		WriteToReport micDone, "Set the Report ID to ["&GlobalDictionary("ExpenseReportID")&"]", "Report ID Set for Search", FALSE

		'Click Search
		.WebButton("Search").Click
		WriteToReport micDone, "Clicked the Search Button", "Button Clicked", FALSE

		'Check all the data

		'Click Expand All
		.Link("ExpandAll").Click
		WriteToReport micDone, "Clicked the Expand All Link", "Link Clicked", FALSE

		'BusinessPurpose
		sTemp = .WebList("Business Purpose").GetROProperty("value")
		If GlobalDictionary("BusinessPurpose") <> "*SKIP_ITERATION*" Then 
			If sTemp = GlobalDictionary("BusinessPurpose") Then
				WriteToReport micPass, "The Business Purpose ["&sTemp&"] Matches What was Set Earlier", "Business Purpose Matches", FALSE
			Else
				WriteToReport micFail, "The Business Purpose ["&sTemp&"] Does Not Match What was Set Earlier", "Business Purpose Does Not Match", TRUE
				ExitTest
			End If
		Else
			If sTemp = "" Then
				WriteToReport micPass, "The Business Purpose ["&sTemp&"] Matches What was Set Earlier", "Business Purpose Matches", FALSE
			Else
				WriteToReport micFail, "The Business Purpose ["&sTemp&"] Does Not Match What was Set Earlier", "Business Purpose Does Not Match", TRUE
				ExitTest
			End If
		End If
		
		'ReportDescription
		sTemp = .WebEdit("Report Description").GetROProperty("value")
		If GlobalDictionary("ReportDescription") <> "*SKIP_ITERATION*" Then 
			If sTemp = GlobalDictionary("ReportDescription") Then
				WriteToReport micPass, "The Report Description ["&sTemp&"] Matches What was Set Earlier", "Report Description Matches", FALSE
			Else
				WriteToReport micFail, "The Report Description ["&sTemp&"] Does Not Match What was Set Earlier", "Report Description Does Not Match", TRUE
				ExitTest
			End If
		Else
			If sTemp = "" Then
				WriteToReport micPass, "The Report Description ["&sTemp&"] Matches What was Set Earlier", "Report Description Matches", FALSE
			Else
				WriteToReport micFail, "The Report Description ["&sTemp&"] Does Not Match What was Set Earlier", "Report Description Does Not Match", TRUE
				ExitTest
			End If
		End If
		
		'Date
		sTemp = .WebEdit("Expense Date").GetROProperty("value")

		If GlobalDictionary("ExpenseDateValue") <> "*SKIP_ITERATION*" Then 
				
			If GlobalDictionary("ExpenseDateValue") = "TODAY" Then
				GlobalDictionary("ExpenseDateValue") = DateLeadingZeros
			End  If
			If sTemp = GlobalDictionary("ExpenseDateValue") OR sTemp = CStr(Date()) Then
				WriteToReport micPass, "The Expense Date ["&sTemp&"] Matches What was Set Earlier", "Expense Date Matches", FALSE
			Else
				WriteToReport micFail, "The Expense Date ["&sTemp&"] Does Not Match What was Set Earlier", "Expense Date Does Not Match", TRUE
				ExitTest
			End If
		Else
			If sTemp = "" Then
				WriteToReport micPass, "The Expense Date ["&sTemp&"] Matches What was Set Earlier", "Expense Date Matches", FALSE
			Else
				WriteToReport micFail, "The Expense Date ["&sTemp&"] Does Not Match What was Set Earlier", "Expense Date Does Not Match", TRUE
				ExitTest
			End If
		End If
			
		'Expense Type
		sTemp = .WebList("Expense Type").GetROProperty("value")
		If GlobalDictionary("ExpenseType") <> "*SKIP_ITERATION*" Then 
			If sTemp = GlobalDictionary("ExpenseType") Then
				WriteToReport micPass, "The Expense Type ["&sTemp&"] Matches What was Set Earlier", "Expense Type Matches", FALSE
			Else
				WriteToReport micFail, "The Expense Type ["&sTemp&"] Does Not Match What was Set Earlier", "Expense Type Does Not Match", TRUE
				ExitTest
			End If
		Else
			If sTemp = "" Then
				WriteToReport micPass, "The Expense Type ["&sTemp&"] Matches What was Set Earlier", "Expense Type Matches", FALSE
			Else
				WriteToReport micFail, "The Expense Type ["&sTemp&"] Does Not Match What was Set Earlier", "Expense Type Does Not Match", TRUE
				ExitTest
			End If
		End If
			
		'ExpenseDescription
		sTemp = .WebEdit("Expense Description").GetROProperty("value")
		If GlobalDictionary("ExpenseDescription") <> "*SKIP_ITERATION*" Then 
			If sTemp = GlobalDictionary("ExpenseDescription") Then
				WriteToReport micPass, "The Expense Description ["&sTemp&"] Matches What was Set Earlier", "Expense Description Matches", FALSE
			Else
				WriteToReport micFail, "The Expense Description ["&sTemp&"] Does Not Match What was Set Earlier", "Expense Description Does Not Match", TRUE
				ExitTest
			End If
		Else
			If sTemp = "" Then
				WriteToReport micPass, "The Expense Description ["&sTemp&"] Matches What was Set Earlier", "Expense Description Matches", FALSE
			Else
				WriteToReport micFail, "The Expense Description ["&sTemp&"] Does Not Match What was Set Earlier", "Expense Description Does Not Match", TRUE
				ExitTest
			End If
		End If
			
		'Payment Type
		sTemp = .WebList("Expense Payment Type").GetROProperty("value")
		If GlobalDictionary("ExpensePaymentType") <> "*SKIP_ITERATION*" Then 
			If sTemp = GlobalDictionary("ExpensePaymentType") Then
				WriteToReport micPass, "The Expense Payment Type ["&sTemp&"] Matches What was Set Earlier", "Expense Payment Type Matches", FALSE
			Else
				WriteToReport micFail, "The Expense Payment Type ["&sTemp&"] Does Not Match What was Set Earlier", "Expense Payment Type Does Not Match", TRUE
				ExitTest
			End If
		Else
			If sTemp = "" Then
				WriteToReport micPass, "The Expense Payment Type ["&sTemp&"] Matches What was Set Earlier", "Expense Payment Type Matches", FALSE
			Else
				WriteToReport micFail, "The Expense Payment Type ["&sTemp&"] Does Not Match What was Set Earlier", "Expense Payment Type Does Not Match", TRUE
				ExitTest
			End If
		End If
			
		'Amount
		sTemp = .WebEdit("Expense Amount").GetROProperty("value")
		If GlobalDictionary("ExpenseAmount") <> "*SKIP_ITERATION*" Then 
			If sTemp = GlobalDictionary("ExpenseAmount") Then
				WriteToReport micPass, "The Expense Amount ["&sTemp&"] Matches What was Set Earlier", "Expense Amount Matches", FALSE
			Else
				WriteToReport micFail, "The Expense Amount ["&sTemp&"] Does Not Match What was Set Earlier", "Expense Amount Does Not Match", TRUE
				ExitTest
			End If
		Else
			If sTemp = "" Then
				WriteToReport micPass, "The Expense Amount ["&sTemp&"] Matches What was Set Earlier", "Expense Amount Matches", FALSE
			Else
				WriteToReport micFail, "The Expense Amount ["&sTemp&"] Does Not Match What was Set Earlier", "Expense Amount Does Not Match", TRUE
				ExitTest
			End If
		End If
			
		'Location
		sTemp = .WebEdit("Select A Location").GetROProperty("value")
		If GlobalDictionary("SelectALocation") <> "*SKIP_ITERATION*" Then 
			If sTemp = GlobalDictionary("SelectALocation") Then
				WriteToReport micPass, "The Location ["&sTemp&"] Matches What was Set Earlier", "Location Matches", FALSE
			Else
				WriteToReport micFail, "The Location ["&sTemp&"] Does Not Match What was Set Earlier", "Location Does Not Match", TRUE
				ExitTest
			End If
		Else
			If sTemp = "" Then
				WriteToReport micPass, "The Location ["&sTemp&"] Matches What was Set Earlier", "Location Matches", FALSE
			Else
				WriteToReport micFail, "The Location ["&sTemp&"] Does Not Match What was Set Earlier", "Location Does Not Match", TRUE
				ExitTest
			End If
		End If
			
		'Merchant Description
		sTemp = .WebEdit("Non Preferred Vendor Value").GetROProperty("value")
		If GlobalDictionary("NonPreferredVendorValue") <> "*SKIP_ITERATION*" Then 
			If sTemp = GlobalDictionary("NonPreferredVendorValue") Then
				WriteToReport micPass, "The Non-Preferred Vendor ["&sTemp&"] Matches What was Set Earlier",  "Non-Preferred Vendor Matches", FALSE
			Else
				WriteToReport micFail, "The Non-Preferred Vendor ["&sTemp&"] Does Not Match What was Set Earlier", "Non-Preferred Vendor Does Not Match", TRUE
				ExitTest
			End If
		Else
			If sTemp = "" Then
				WriteToReport micPass, "The Non-Preferred Vendor ["&sTemp&"] Matches What was Set Earlier",  "Non-Preferred Vendor Matches", FALSE
			Else
				WriteToReport micFail, "The Non-Preferred Vendor ["&sTemp&"] Does Not Match What was Set Earlier", "Non-Preferred Vendor Does Not Match", TRUE
				ExitTest
			End If
		End If
			
		'No Receipt
		If GlobalDictionary("NoReceipt") = "TRUE" Then
			If .WebCheckBox("NoReceipt").GetROProperty("checked") = 1 Then '1 is checked
				WriteToReport micPass, "The No Receipt Checkbox Matches What was Set Earlier", "No Receipt Checkbox Matches", FALSE
			Else
				WriteToReport micFail, "The No Receipt Checkbox Does Not Match What was Set Earlier", "No Receipt Checkbox Does Not Match", TRUE
				ExitTest
			End If
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Loops Through a ';' delimited list of Expense Types, checking that certain fields show red/errored when empty, and also checking Preferred Vendors, if any
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function CheckAllExpenseTypeErrors
	Dim sEmployeeID
	Dim arrExpenseTypes, arrCheckVendor, arrFunctionCalls
	Dim i

	arrExpenseTypes = Split(GlobalDictionary("ExpenseTypes"),";") 'Indexed 0-51
	arrCheckVendor = Split(GlobalDictionary("CheckVendor"),";") 
	arrFunctionCalls = Split(GlobalDictionary("FunctionCalls"),";")

	If SelectMainMenu1(GlobalDictionary("AddExpenseReport")) Then
		WriteToReport micPass, "Create/Modify Expense Page", "On the Create/Modify Expense page.", False
	Else
		WriteToReport micFail, "Create/Modify Expense Page", "Navigation to Create/Modify Expense page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent")
		'Verify the EMPLID field is not empty
		sEmployeeID = .WebElement("Employee ID").GetROProperty("value")
		If NOT (sEmployeeID = "") OR NOT (isEmpty(sEmployeeID)) Then
			WriteToReport micDone, "Employee ID Filled", "Employee ID not empty", FALSE
		Else
			WriteToReport micFail, "Employee ID Empty", "Cannot add Expense Report due to ID not being auto-filled", TRUE
			ExitTest
		End If

		'Click Add
		.WebButton("Add").Click
		WriteToReport micDone, "Add Button Clicked", "Successfully clicked Add", FALSE

		Browser("PeopleSoft Browser").Sync

		'Enter Business Purpose
		.WebList("Business Purpose").Select GlobalDictionary("BusinessPurpose")
		WriteToReport micDone, "Selected the Business Purpose ["&GlobalDictionary("BusinessPurpose")&"]", "Business Purpose selected", FALSE

		'Enter Report Description
		.WebEdit("Report Description").Set GlobalDictionary("ReportDescription")
		WriteToReport micDone, "Set the Report Description ["&GlobalDictionary("ReportDescription")&"]", "Report Description set", FALSE

		'Enter Date
		.WebEdit("Expense Date").Set CStr(date())
		WriteToReport micDone, "Set the Date to Today's Date ["&CStr(date())&"]", "Date Field set", FALSE

		'Enter Description
		.WebEdit("Expense Description").Set GlobalDictionary("ExpenseDescription")
		WriteToReport micDone, "Set the Expense Description to ["&GlobalDictionary("ExpenseDescription")&"]", "Expense Description set", FALSE

		'Enter Payment Type
		.WebList("Expense Payment Type").Select GlobalDictionary("ExpensePaymentType")
		WriteToReport micDone, "Set the Expense Payment Type to ["&GlobalDictionary("ExpensePaymentType")&"]", "Expense Payment Type set", FALSE

		'Enter Amount
		.WebEdit("Expense Amount").Set GlobalDictionary("ExpenseAmount")
		WriteToReport micDone, "Set the Amount to ["&GlobalDictionary("ExpenseAmount")&"]", "Amount Set", FALSE

		'Loop over each Expense Type
		For i=0 To UBound(arrExpenseTypes)
			'Set the Expense Type
			WriteToReport micDone, "Attempting to Set the Expense Type to "&arrExpenseTypes(i), "", FALSE
			.WebList("Expense Type").Select arrExpenseTypes(i)

			'Check the Payment Type, it can be reset when changing expense type
			If .WebList("Expense Payment Type").Object.Value <> GlobalDictionary("ExpensePaymentType") Then
				.WebList("Expense Payment Type").Select GlobalDictionary("ExpensePaymentType")
			End If

			'Check expense billing
			If .WebList("BillingType").Object.value <> "CDW" Then
				WriteToReport micFail, "The Billing Type Was Not CDW as Expected", "Unexpected Billing Type", TRUE
			Else
				WriteToReport micPass, "The Billing Type Was Correct", "Correct Billing Type", FALSE
			End If

			'Click Save for Later
			.Link("Save for Later").Click
			WriteToReport micDone, "Clicked Saved for Later", "Link clicked", FALSE

			'Verify Red Flag
			If .Image("RedFlag").Exist(15) Then
				WriteToReport micPass, "Red Flag Shown as Expected", "Red Flag appeared, indicating a missing field", FALSE
			Else
				WriteToReport micFail, "Red Flag Did Not Appear as Expected", "Red Flag missing", TRUE
				ExitTest
			End If

			'Check Location element's class for PSERROR, if applicable
			If .WebEdit("Select A Location").GetROProperty("class") = "PSERROR" Then
				WriteToReport micPass, "Location Field Is Red As Expected", "Location Field now has class of PSERROR", FALSE
			Else
				WriteToReport micFail, "Location Field Not Red as Expected", "Location Field did not have class of PSERROR", TRUE
			End If

			'Check Preferred Merchant (none, one, many, hidden)
			WriteToReport micDone, "Checking the Preferred Vendor (if any) for Expense Type ["&arrExpenseTypes(i)&"]", "Checking the Preferred Vendor List", FALSE
			Call CheckPreferredVendor(arrCheckVendor(i))

			'Click Save for Later again
			.Link("Save for Later").Click
			WriteToReport micDone, "Clicked Saved for Later", "Link clicked", FALSE

			'Check Non-Preferred for Red, if applicable
			If arrCheckVendor(i) <> "hidden" Then
				If .Webedit("Non Preferred Vendor Value").GetROProperty("class") = "PSERROR" Then
					WriteToReport micPass, "The Non Preferred Vendor Value Field is Red as Expected", "Non Preferred Vendor Value Field now has class of PSERROR", FALSE
				Else
					WriteToReport micFail, "Non Preferred Vendor Value Field Not Red as Expected", "Non Preferred Vendor Value Field did not have class of PSERROR", TRUE
				End If
			End If

			'Call other function for this Expense Type, if applicable
			If arrFunctionCalls(i) <> "" Then
				Call Eval(arrFunctionCalls(i))
			End If
		Next
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Helper Function for CheckAllExpenseTypeErrors, checking Preferred Vendor for none, one, many, or hidden
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Private Function CheckPreferredVendor(sAmount)
	Dim nTemp
	WriteToReport micDone, "Checking the Preferred Vendor List for ["&sAmount&"]", "Checking Vendor List", FALSE

	Select Case sAmount
		Case "none"
			'Click the Preferred Vendor Element
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Preferred").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Preferred").Click
			End If
			nTemp = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("PreferredVendorList").Object.Length
			If nTemp <> 1 Then '1 represents the blank option
				WriteToReport micFail, "Expected Only the Blank Option but had ["&nTemp&"] Options", "Unexpected Number of Options", TRUE
			Else 
				WriteToReport micPass, "Found Only the Blank Option", "Found Expected Amount", FALSE
			End If
			'Reset the Vendor to Non-Preferred
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Non-Preferred").Click
			WriteToReport micDone, "Reset the Vendor Type to Non-Preferred", "Non-Preferred Vendor Set", FALSE

		Case "one"
			'Click the Preferred Vendor Element
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Preferred").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Preferred").Click
			End If
			nTemp = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("PreferredVendorList").Object.Length
			If nTemp <> 2 Then '2 represents the blank option and one other option
				WriteToReport micFail, "Expected Only the Blank Option and One Other, but had ["&nTemp&"] Options", "Unexpected Number of Options", TRUE
			Else 
				WriteToReport micPass, "Found Only the Blank Option and One Other", "Found Expected Amount", FALSE
			End If
			'Reset the Vendor to Non-Preferred
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Non-Preferred").Click
			WriteToReport micDone, "Reset the Vendor Type to Non-Preferred", "Non-Preferred Vendor Set", FALSE

		Case "many"
			'Click the Preferred Vendor Element
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Preferred").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Preferred").Click
			End If
			nTemp = Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("PreferredVendorList").Object.Length
			If nTemp < 2 Then 'Anything more than 1 is expected
				WriteToReport micFail, "Expected Many Options but had ["&nTemp&"] Options", "Unexpected Number of Options", TRUE
			Else 
				WriteToReport micPass, "Found Many Options", "Found Expected Amount", FALSE
			End If
			'Reset the Vendor to Non-Preferred
			Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Non-Preferred").Click
			WriteToReport micDone, "Reset the Vendor Type to Non-Preferred", "Non-Preferred Vendor Set", FALSE

		Case "hidden"
			'Check both the radio button and the dropdown are not visible
			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebElement("Preferred").Exist(5) Then
				WriteToReport micFail, "Found Option for Preferred Vendor, When it Should be Hidden", "Should not have any option for vendor", TRUE
			Else
				WriteToReport micPass, "No Option Given to Choose a Vendor", "No Vendor as Expected", FALSE
			End If

			If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebList("PreferredVendorList").Exist(5) Then
				WriteToReport micFail, "Found List for Preferred Vendor, When it Should be Hidden", "Should not have any option for vendor", TRUE
			Else
				WriteToReport micPass, "No List Given to Choose a Vendor", "No Vendor as Expected", FALSE
			End If
	End Select
End Function

'**************************************************************************************************************
''' <summary> 
''' Helper Function for CheckAllExpenseTypeErrors, that Adds a Title to the default attendee (signed in user), and checks that the error for needing 2 or more attendees appears when attempting to submit
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Private Function CheckAttendees
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("Attendees").Exist(15) Then
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").Link("Attendees").Click
		WriteToReport micPass, "The Attendees Link Was Available, and was Clicked", "Clicked Attendees Link", FALSE
	Else
		WriteToReport micFail, "Could not Locate Attendees Link, When it Was Expected", "Attendees Link not Found", TRUE
		Exit Function
	End If

	'Reset Title of Attendee to Blank
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Attendees").WebEdit("Title").Set ""
	WriteToReport micDone, "Reset the Title of the Default Attendee to Blank", "Reset the Title", FALSE

	'Try to Click OK without a Title for the Attendee
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Attendees").WebButton("OK").Click
	WriteToReport micDone, "Clicked OK", "Clicked OK", FALSE

	'Handle Error Message
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").WebElement("AttendeeTitleNeeded").Exist(5) Then
		WriteToReport micPass, "Error Appeared for the Missing Attendee Title", "Error Appeared as Expected", FALSE
		Browser("PeopleSoft Browser").Page("Create/Modify Expenses").WebButton("OK").Click
		WriteToReport micDone, "Clicked OK to Dismiss Error Message", "Error Message Dismissed", FALSE
	Else
		WriteToReport micFail, "Error Did Not Appear as Expected", "Error Message Not Found", TRUE
	End If

	'Set the Title
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Attendees").WebEdit("Title").Set "Tester"
	WriteToReport micDone, "Set the Title of the Default Attendee to Tester", "Title Set", FALSE

	'Click OK
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("Attendees").WebButton("OK").Click
	WriteToReport micDone, "Clicked OK to Dismiss Attendees Window", "Attendees Window Dismissed", FALSE

	'Try to Submit the Expense With Only One Attendee
	Call ClickSummaryAndSubmit()
	
	'Verify Error Message for only one Attendee
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").WebElement("MultipleAttendees_ErrorMessage").Exist(5) Then
		WriteToReport micPass, "Error Given for Only one Attendee as Expected", "Error Appeared as Expected", FALSE
	Else
		WriteToReport micFail, "Error Message Not Given for Only One Attendee", "Error Message Not Shown", FALSE
		Exit Function
	End If

	'Click OK
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").WebButton("OK").Click
	WriteToReport micDone, "Clicked OK Button", "Clicked OK", FALSE

	'Uncheck the 'By Checking this box' box
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PsFrame("TargetContent").WebCheckBox("ByCheckingThis").Click
	WriteToReport micDone, "Unchecked the 'By checking this..' Box", "Box Unchecked", FALSE

	'Click Expense Details to Go Back
	Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PsFrame("TargetContent").Link("Expense Details").Click
	WriteToReport micDone, "Clicked Expense Details To Return to Details View", "Clicked Expense Details", FALSE
End Function

'**************************************************************************************************************
''' <summary> 
''' Helper Function for CheckAllExpenseTypeErrors, Checks the Mileage field for PSERROR
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Private Function CheckAutoMileage
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("Miles").GetROProperty("class") = "PSERROR" Then
		WriteToReport micPass, "Miles Is Red As Expected", "Miles now has class of PSERROR", FALSE
	Else
		WriteToReport micFail, "Miles Not Red as Expected", "Miles did not have class of PSERROR", TRUE
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Helper Function for CheckAllExpenseTypeErrors, Checks the Ticket Number field for PSERROR
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Private Function CheckAirfare
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("TicketNumber").GetROProperty("class") = "PSERROR" Then
		WriteToReport micPass, "Ticket Number Is Red As Expected", "Ticket Number now has class of PSERROR", FALSE
	Else
		WriteToReport micFail, "Ticket Number Not Red as Expected", "Ticket Number did not have class of PSERROR", TRUE
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Helper Function for CheckAllExpenseTypeErrors, Checks the Number of Nights field for PSERROR
''' </summary>
''' <author>Zach Apple</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Private Function CheckHotel
	If Browser("PeopleSoft Browser").Page("Create/Modify Expenses").PSFrame("TargetContent").WebEdit("NumberOfNights").GetROProperty("class") = "PSERROR" Then
		WriteToReport micPass, "Number Of Nights Is Red As Expected", "Number Of Nights now has class of PSERROR", FALSE
	Else
		WriteToReport micFail, "Number Of Nights Not Red as Expected", "Number Of Nights did not have class of PSERROR", TRUE
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Extra validation requested for the EX20 test cases
''' </summary>
''' <author>Stephen King</author>
''' <startstate>All 4 EX20 test cases passed</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control:
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function ExpPaymentAndLiabilitiesValidation
	Dim i, nResult
	Dim sSQL
	Dim arrRecordValues, arrSqlTemp()
	Dim bFound
	Dim strDate

	'Call our generatejournals function to run/check the FS_JGEN process without any invoices
	GenerateJournalsNoInvoice "ExpPaymentAndLiabilitiesValidation"

	'Check payments
	'Our sign in ID and employee ID are stored in the datasheet. If those ever need to change, you can get the new employee ID by calling the dbFindEMPLIDByOPRID function in PSF_Database.qfl
	'strDate = DateAdd("ww", -1, Date)
	sSQL = GlobalDictionary("PaymentSQL") & Date & "' AND EMPLID = '" & GlobalDictionary("SignInEmplID") & "'"

	'Execute our SQL query
	WriteToReport micDone, "ExpPaymentAndLiabilitiesValidation - SQL Query", "Query being used is " & sSQL, False

	'Get the first journal that meets our criteria, exit if none found
	arrRecordValues = dbGetFirstRecord(sSQL, "", arrSqlTemp, "ExpPaymentAndLiabilitiesValidation")
	nResult = -1

	'Confirm we have results
	On Error Resume Next
	nResult = UBound(arrRecordValues)
	On Error GoTo 0
	If nResult >= 0 Then
		WriteToReport micPass, "ExpPaymentAndLiabilitiesValidation - SQL results", "Results found!", False
	Else
		WriteToReport micFail, "ExpPaymentAndLiabilitiesValidation - SQL results", "No results found.", False
		ExitTest
	End If
	'arr(0) = SHEET_ID
	'arr(1) = PAID_AMT
	'arr(2) = LINE_NBR

'	'Compare to our original value
'	If oldNum = arrRecordValues(0) Then
'		WriteToReport micPass, "ExpPaymentAndLiabilitiesValidation - Processing validation", "SQL results matches the original number", False
'	Else
'		WriteToReport micFail, "ExpPaymentAndLiabilitiesValidation - Processing validation", "SQL results " & arrRecordValues(0) & " doesn't match " & oldNum, False
'	End If

	'Log in as AIDESEG
	Login(GlobalDictionary("SignInUser"))

	'Navigate to Travel & Expenses>Manage Accounting>View/Adjust Accounting Entries>Expense Report Acctg Entries
	If SelectMainMenu1(GlobalDictionary("AccountEntries")) = True Then
		WriteToReport micPass, "ExpPaymentAndLiabilitiesValidation - Navigation", "On the Expense Report Acctg Entries page.", False
	Else
		WriteToReport micFail, "ExpPaymentAndLiabilitiesValidation - Navigation", "Navigation to Expense Report Acctg Entries page failed. Exiting test.", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Expense Report Acctg Entries").PSFrame("TargetContent")
		.WebList("#ICKeySelect").Select "Empl ID"
		.WebEdit("EmployeeID").Set GlobalDictionary("SignInEmplID")	'EG, "0000000BR80"
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm that our table exists and we have search results
		If .WebTable("Report ID").Exist(10) Then
			WriteToReport micPass, "ExpPaymentAndLiabilitiesValidation - Search Results", "Search results found", False
		Else
			WriteToReport micFail, "ExpPaymentAndLiabilitiesValidation - Search Results", "No search results found. Exiting test.", True
			ExitTest
		End If

		'Check our table for our sheet id. Two columns are specially named, so we check those first
		bFound = False
		If .Link("html id:=SEARCH_RESULT1").Exist(5) Then
			If Trim(.Link("html id:=SEARCH_RESULT1").GetROProperty("innertext")) = arrRecordValues(0) Then
				WriteToReport micPass, "ExpPaymentAndLiabilitiesValidation - Record Found", "Record " & arrRecordValues(0) & " found", False
				.Link("html id:=SEARCH_RESULT1").Click
				bFound = True
			End If
		End If

		If NOT bFound AND .Link("html id:=SEARCH_RESULTLAST").Exist(5) Then
			If Trim(.Link("html id:=SEARCH_RESULTLAST").GetROProperty("innertext")) = arrRecordValues(0) Then
				WriteToReport micPass, "ExpPaymentAndLiabilitiesValidation - Record Found", "Record " & arrRecordValues(0) & " found", False
				.Link("html id:=SEARCH_RESULTLAST").Click
				bFound = True
			End If
		End If

		'If our result wasn't in the two named ones, then we check the dynamic rows
		If NOT bFound Then
			For i = 1 To .WebTable("Report ID").GetROProperty("rows") - 1
				If .Link("html id:=RESULT0\$" & i).Exist(5) Then
					If Trim(.Link("html id:=RESULT0\$" & i).GetROProperty("innertext")) = arrRecordValues(0) Then
						WriteToReport micPass, "ExpPaymentAndLiabilitiesValidation - Record Found", "Record " & arrRecordValues(0) & " found", False
						.Link("html id:=RESULT0\$" & i).Click
						bFound = True
					End If
				End If
			Next
		End If

		If NOT bFound Then
			WriteToReport micFail, "ExpPaymentAndLiabilitiesValidation - Record Not Found", "Record " & arrRecordValues(0) & " not found", True
			ExitTest
		End If
		Browser("PeopleSoft Browser").Sync

		'Check for the currency tab existing, otherwise exit the test if our search results weren't found
		If .WebTabStrip("WebTabStrip").Exist(10) Then
			WriteToReport micPass, "ExpPaymentAndLiabilitiesValidation - Record Page", "Record Page loaded", False
		Else
			WriteToReport micFail, "ExpPaymentAndLiabilitiesValidation - Record Page", "Record Page didn't load. Exiting test.", True
			ExitTest
		End If

		'Click on the Currency tab
		.WebTabStrip("WebTabStrip").Select "Currency"
		Browser("PeopleSoft Browser").Sync

		'Validate the amount on page to the database
		'PAID_AMT
		If Trim(.WebElement("Amount").GetROProperty("Innertext")) = LEFT(arrRecordValues(1), LEN(arrRecordValues(1)) - 1) Then
			WriteToReport micPass, "ExpPaymentAndLiabilitiesValidation - Payment Amount", "Payment Amount verified", False
		Else
			WriteToReport micFail, "ExpPaymentAndLiabilitiesValidation - Payment Amount", "Payment Amount not verified. Exiting test.", True
			ExitTest
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Helper function that we use to run the FS_JGEN process without some of the AR/BI overhead. Called in multiple libraries.
''' </summary>
''' <author>Stephen King</author>
''' <startstate>N/A</startstate>
''' <endstate>Completed</endstate>
''' <returns type="N/A"> </returns>
'Change Control:
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function GenerateJournalsNoInvoice(functionName)
	Dim processInstanceObj, processInstance

	'Check for journals
	logincdwbatch()

	'Navigate to the Generate Journals page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection3")) Then
		WriteToReport micPass, "ExpPaymentAndLiabilitiesValidation", "Generate Journals Page is Loaded Successfully", False
	Else
		WriteToReport micFail, "ExpPaymentAndLiabilitiesValidation", "Generate Journals Page is not Loaded Successfully", True
		ExitTest
	End If

	'Run control ID EX_ExpenseProcesses is hardcoded due to specific processes needed.
	'If this is ever blank, recreate with EX_ACCRUAL(possibly need EXCANCEL, EXCLOSURE, EX_PAYMENT) and accounting definition name EXDEFN
   
	'Set RunControl field
	setValue_WebEdit getObjectInfoFromXML("Runcontrol_Webedit", objectsFile, "Value"), "EX_ExpenseProcesses", False, getObjectInfoFromXML("Runcontrol_Webedit", objectsFile, "Description")
	btn_click getObjectInfoFromXML("Search_RunControlId_Btn", objectsFile, "Value"), getObjectInfoFromXML("Search_RunControlId_Btn", objectsFile, "Description")

	'Sets Journal Processing Option to Edit
	check_CheckBox getObjectInfoFromXML("Edit_JournalProcessingOption_CHKBox", objectsFile, "Value"), getObjectInfoFromXML("Edit_JournalProcessingOption_CHKBox", objectsFile, "Description")

	'Sets Journal Processing Option to Post
	check_CheckBox getObjectInfoFromXML("Post_JournalProcessingOption_CHKBox", objectsFile, "Value"), getObjectInfoFromXML("Post_JournalProcessingOption_CHKBox", objectsFile, "Description")

	'Sets Process Frequency to Always
	Verify_ClickRadioBtn getObjectInfoFromXML("Always_ProcessFrequency_RadioBtn", objectsFile, "Value"), getObjectInfoFromXML("Always_ProcessFrequency_RadioBtn", objectsFile, "Description"), "A"

	'Puts SetID to SHARE - Corporate SetID
	setValue_WebEdit getObjectInfoFromXML("SetID_PRP_TXT", objectsFile, "Value"), "SHARE", False, getObjectInfoFromXML("SetID_PRP_TXT", objectsFile, "Description")

	'Set Accounting Definition Name
	If GlobalDictionary.Exists("AccountingDefinition") = False Then
		setValue_WebEdit getObjectInfoFromXML("AccountingDefinitionName_TXT", objectsFile, "Value"),"EXDEFN", False, getObjectInfoFromXML("AccountingDefinitionName_TXT", objectsFile, "Description")
	Else
		setValue_WebEdit getObjectInfoFromXML("AccountingDefinitionName_TXT", objectsFile, "Value"), GlobalDictionary("AccountingDefinition"), False, getObjectInfoFromXML("AccountingDefinitionName_TXT", objectsFile, "Description")
	End If

	'Sets Business Unit
	setValue_WebEdit getObjectInfoFromXML("ApplicationUnit_TXT", objectsFile, "Value"), GlobalDictionary("BusinessUnit"), False, getObjectInfoFromXML("ApplicationUnit_TXT", objectsFile, "Description")

	'Sets Ledger Group
	setValue_WebEdit getObjectInfoFromXML("Ledgergrp_weblist", objectsFile, "Value"), GlobalDictionary("Ledgergrp"), False, getObjectInfoFromXML("Ledgergrp_weblist", objectsFile, "Description")
	WebList_select getObjectInfoFromXML("FromDateOption_weblist", objectsFile, "Value"), "Specify Date", getObjectInfoFromXML("FromDateOption_weblist", objectsFile, "Description")
	WebList_select getObjectInfoFromXML("ToDateOption_weblist", objectsFile, "Value"), "Specify Date", getObjectInfoFromXML("ToDateOption_weblist", objectsFile, "Description")
	Browser("creationtime:=0").Page("index:=1").WebEdit("html id:= JRNLGEN_REQUEST_FROM_DT\$0").Set Date
	Browser("creationtime:=0").Page("index:=1").WebEdit("html id:= JRNLGEN_REQUEST_TO_DT\$0").Set DateAdd("ww", 1, Date)
	btn_click getObjectInfoFromXML("Run_SingleActionInvoice_btn", objectsFile, "Value"), getObjectInfoFromXML("Run_SingleActionInvoice_btn", objectsFile, "Description")
	Browser("creationtime:=0").Sync

	'Validate our new popup window
	If Browser("CreationTime:=0").Page("index:=1").PSFrame("html id:=ptModFrame_0").WebElement("innerhtml:=User ID","html tag:=SPAN").Exist(60) Then
		WriteToReport micPass, "ExpPaymentAndLiabilitiesValidation - Process Scheduler Page", "Process Scheduler Page is Loaded Successfully", False
	Else
		WriteToReport micFail, "ExpPaymentAndLiabilitiesValidation - Process Scheduler Page", "Process scheduler Page is not Loaded Successfully", True
		ExitTest
	End If

	'Output our name
	check_CheckBox getObjectInfoFromXML("FS_JGEN_ProcessScheduler", objectsFile, "Value"), getObjectInfoFromXML("FS_JGEN_ProcessScheduler", objectsFile, "Description")
	WriteToReport micDone, "ExpPaymentAndLiabilitiesValidation - Process Name", "Process Name is FS_JGEN", False
	GlobalDictionary("Process") = "FS_JGEN"
	btn_click getObjectInfoFromXML("OK_ProcessScheduler_btn", objectsFile, "Value"), getObjectInfoFromXML("OK_ProcessScheduler_btn", objectsFile, "Description")	
	Browser("creationtime:=0").Sync

	'Get our process number
	Set processInstanceObj = Browser("creationtime:=0").Page("index:=1").WebElement("innertext:=Process Instance:.*","index:=1")
	processInstance = split(processInstanceObj.GetROProperty("innertext"),":")(1)
	WriteToReport micDone, "ExpPaymentAndLiabilitiesValidation - Instance Number", "Instance number is " & processInstance, False

	'click the process monitor link
	btn_click getObjectInfoFromXML("ProcessMonitor_link", objectsFile, "Value"), getObjectInfoFromXML("ProcessMonitor_link", objectsFile, "Description")
	
	'Call our SharedProcessMonitor function
	SharedProcessMonitor functionName
End Function
