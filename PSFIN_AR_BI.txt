'==========================================================
'PSF Common Function Library
'Contains commonly used functions for interacting with the PSF application.
'Changelog: 
'Date			Author					Description

'______________________________________________________ 

Option Explicit

'**************************************************************************************************************
''' <summary>
''' verifyCustomerGeneralInfo Function is to verify general information of customer
''' </summary>
''' <author>Venu Arigela</author>
''' <datecreated>21-Nov-2015</datecreated>
''' <param name="custName" type="string">customer name</param>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function  verifyCustomerGeneralInfo(custName)
	verifyValue getObjectInfoFromXML("SETID_Element", objectsFile,"Value"), GlobalDictionary("SetID"), "innertext", getObjectInfoFromXML("SETID_Element", objectsFile, "Description")
	verifyValue getObjectInfoFromXML("CUSTOMER_ID_Element", objectsFile, "Value"), GlobalDictionary("Customer"), "innertext", getObjectInfoFromXML("CUSTOMER_ID_Element", objectsFile, "Description")
	verifyValue getObjectInfoFromXML("CUSTOMER_NAME_Element", objectsFile, "Value"), custName, "innertext", getObjectInfoFromXML("CUSTOMER_NAME_Element", objectsFile, "Description")
End Function

'**************************************************************************************************************
''' <summary> 
''' getStatus is a Function that checks the Status of the Process and Prints how much time is taken for the Process to Run
''' </summary>
''' <author>Rama Peela</author>
''' <datecreated>18-Nov-2015</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 			Description of change
'06/23/2016         venu arigela  	added BIJOB03 check
'06/23/2017			Eric Trout		Replaced hard coded reference to column number with function call to find column number
'10/25/2017         Eric Trout  	Updated to report warning as a warning instead of a pass
'01/22/2018			Stephen King	Added validation checks for User ID and Instance Number parameters to help filter our searches
'03/03/2018			Eric Trout		Update to accomodate for BIIF0001 
'05/15/2018			Eric Trout		Cleaned up due to issues 
'**************************************************************************************************************
Public Function getStatus(instanceNumber, userID)
 	Dim oExcel, oWB, oSheet, getVal, rows, fso, objSht, rowNumber, endingTrans, bRunFlag
    Dim oDesc, oTable, runStatus, distributionStatus, startTrans, endTrans, totalTime, processName
    Dim sColumn
    processName = "Process Name"
    Err.clear
    On Error Resume Next
    Wait 5

    'If our user ID is passed in, use it to filter our results
    If userID <> "" Then
    	Browser("creationtime:=0").Page("index:=1").WebEdit("html id:=PMN_FILTER_WRK_WS_OPRID").Set userID
    Else
    	Browser("creationtime:=0").Page("index:=1").WebEdit("html id:=PMN_FILTER_WRK_WS_OPRID").Set ""
    End If

    Browser("creationtime:=0").Page("index:=1").WebList("html id:=PMN_FILTER_WRK_PRCSTYPE").Select "#0"
    Browser("creationtime:=0").Page("index:=1").WebEdit("html id:=PMN_FILTER_WRK_PT_FILTERVALUE").Set "1" 
    Browser("creationtime:=0").Page("index:=1").WebList("html id:=PMN_FILTER_WRK_PT_FILTERUNIT").Select("Hours")
    Browser("creationtime:=0").Page("index:=1").WebList("html id:=PMN_FILTER_WRK_RUNSTATUS").Select "#0"
    Browser("creationtime:=0").Page("index:=1").WebList("html id:=PMN_FILTER_WRK_SERVERNAME").Select "#0"

    'Limit our process ID to a certain range if a value was passed in
    If instanceNumber <> "" Then
    	'From field
    	Browser("creationtime:=0").Page("index:=1").WebEdit("html id:=PMN_DERIVED_PRCSINSTANCE").Set instanceNumber

    	'To field
 		Browser("creationtime:=0").Page("index:=1").WebEdit("html id:=PMN_DERIVED_TO_PRCSINSTANCE").Set instanceNumber
    End If

    'JT added clear previous
	Browser("creationtime:=0").Page("index:=1").WebEdit("html id:=PMN_FILTER_WRK_PRCSNAME").Set ""
   	startTrans = Now()
   	bRunFlag = True
	
	'Stays looping unless runStatus is equal to "Success" or "Warning" and distibutionStatus = "Posted"
   	Do While (Trim(runStatus) <> "Success"  OR Trim(runStatus) <> "Warning") AND Trim(distributionStatus) <> "Posted" 
  		Dim objbutton
   		Set objbutton = Eval(getObjectInfoFromXML("Refresh_ProcessMonitor_btn",objectsFile, "Value"))
   		objbutton.highlight
   		objbutton.Click
		Set objbutton = Nothing
		Wait 2
   		Set oDesc = Description.Create
		oDesc("micclass").Value = "WebTable" 
		oDesc("class").Value = "PSLEVEL1GRID"

		Set oTable = Browser("creationtime:=0").Page("index:=1").PSFrame("html id:=ptifrmtgtframe").WebTable(oDesc)
		sColumn = GetColumn(oTable, "Run Status")
		rowNumber = oTable.GetRowWithCellText(Trim(instanceNumber), 2, 1)
		If rowNumber = False Then
			Call WriteToReport (micFail, "Process instance " & instanceNumber, "Process instance " & instanceNumber & " is not displayed ", True)
		Else
			   'Returns column number of Run Status
			   sColumn = GetColumn(oTable, "Run Status")	
               runStatus = oTable.GetCellData(rowNumber,sColumn)

			   'Returns column number of Distribution Status
			   sColumn = GetColumn(oTable, "Distribution Status")	
		       distributionStatus = oTable.GetCellData(rowNumber,sColumn)

			   'Return Column number of Process Name
			   sColumn = GetColumn(oTable, "Process Name")
			   
			   If sColumn <> "" Then
              		processName = 	oTable.GetCellData(rowNumber,sColumn)			   		
			   End If
 			       
		End If
		'  End If

		endingTrans = now()
		
		'Checks to see how long process has been looping, exits if above 10 minutes
		If DateDiff("s", startTrans, endingTrans) > 610 Then
			Call WriteToReport (micFail, "Process did not Ran into Success and is not Posted in 10 minutes", "", True)
			Exit Do
		End If
   	Loop

	If Trim(processName) = "BIJOB03" OR Trim(processName) = "BIIF0001"  Then
		If (Trim(runStatus) = "Success") AND Trim(distributionStatus) = "Posted" Then
			Call WriteToReport (micPass, "Process " & instanceNumber & " Ran into Success and is Posted", "", True)
		ElseIf (Trim(runStatus) = "Warning") AND (Trim(distributionStatus) = "Posted") Then
			Call WriteToReport (micWarning, "Process " & instanceNumber & " Ran into Warning and is Posted", "", True)
		Else
		    Call WriteToReport (micFail, "Process  " & instanceNumber & " did not Ran into Success and is not Posted in 10 minutes", "", True)
		End If
	Else
		If Trim(runStatus) = "Success" AND Trim(distributionStatus) = "Posted" Then
			Call WriteToReport (micPass, "Process " & instanceNumber & " Ran into Success and is Posted", "", True)
		Else
			Call WriteToReport (micFail, "Process " & instanceNumber & " did not Ran into Success and is not Posted in 10 minutes", "", True)
		End If
	End If

	endTrans = Now()
	totalTime = DateDiff("s", startTrans, endTrans)
	Call WriteToReport (micDone, "Refreshed Time", "Refreshed in " & totalTime & "seconds.", True)
   	getStatus = runStatus
	Set fso = CreateObject("Scripting.FileSystemObject")
	Set oExcel=CreateObject("Excel.Application")
	oExcel.DisplayAlerts = False
	Set oWB=oExcel.Workbooks.Open(processTimeUpdate)
	oExcel.Visible = TRUE
	If Not verifySheetExists(oWB,GlobalDictionary("TestName")) Then
		Set objSht = oWB.Worksheets(GlobalDictionary("TestName"))
		rows = objSht.UsedRange.Rows.Count
		objSht.Cells(rows+1,1) = processName
		objSht.Cells(rows+1,2) = totalTime
		objSht.Cells(rows+1,3) = Now
	Else
		Set objWrkSht = oWB.Sheets.Add(oWB.Sheets(oWB.Sheets.Count))
		objWrkSht.Name = GlobalDictionary("TestName")
		objWrkSht.Cells(1,1) = "PROCESS NAME"
		objWrkSht.Cells(1,2) = "JOB COMPLETION TIME IN SECONDS"
		objWrkSht.Cells(1,3) = "PROCESS RUN TIME STAMP"
		rows = objWrkSht.UsedRange.Rows.Count
		objWrkSht.Cells(rows+1,1) = processName
		objWrkSht.Cells(rows+1,2) = totalTime
		objWrkSht.Cells(rows+1,3) = Now
	End If

	oWB.Save
	oWB.Close
	Set oSheet = Nothing
	Set objSht = Nothing
	Set objWrkSht = Nothing
	Set oWB = Nothing
	Set oExcel = Nothing
	On Error goto 0
End Function

'**************************************************************************************************************
''' <summary> 
''' This process checks to see if CDWCC process has finished and posted successfully
''' </summary>
''' <author>NA</author>
''' <datecreated>NA</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 			Description of change
'06/22/2018			Eric Trout		Fixed so it will cycle for CDWCC and look for most current CDWCC process instance based on previous instance
'06/27/2018			Eric Trout		Updated due to issues with table object losing focus
'**************************************************************************************************************
Public Function getCDWCCStatus()
	Dim status, instanceNumber,runStatus,distributionStatus, authInstanceNumber,rowNumber,processName,startTrans,endingTrans
    Dim sColumn

	'authInstanceNumber = Environment("InstanceNum")
	'Browser("creationtime:=0").Page("index:=1").WebEdit("html id:=PMN_FILTER_WRK_WS_OPRID").Set ""
    'Browser("creationtime:=0").Page("index:=1").WebList("html id:=PMN_FILTER_WRK_PRCSTYPE").Select "#0"
    'Browser("creationtime:=0").Page("index:=1").WebEdit("html id:=PMN_FILTER_WRK_PT_FILTERVALUE").Set "1"
    'Browser("creationtime:=0").Page("index:=1").WebList("html id:=PMN_FILTER_WRK_PT_FILTERUNIT").Select("Hours")
    'Browser("creationtime:=0").Page("index:=1").WebList("html id:=PMN_FILTER_WRK_RUNSTATUS").Select "#0"
    'Browser("creationtime:=0").Page("index:=1").WebList("html id:=PMN_FILTER_WRK_SERVERNAME").Select "#0"
	'Browser("creationtime:=0").Page("index:=1").WebEdit("html id:=PMN_FILTER_WRK_PRCSNAME").Set "CDWCC"
	'Browser("creationtime:=0").Page("index:=1").WebEdit("html id:=PMN_DERIVED_PRCSINSTANCE").Set ""
	GlobalDictionary("ClearName")  = True
	GlobalDictionary("ProcessType") = ""
	GlobalDictionary("Process") = "CDWCC"

	SharedProcessMonitor(getCDWCCStatus)
	'''''''''''''''''''''
	'status = False
	'startTrans = Now()
   	'endingTrans = Now()
   	
   	 ' 	Dim objbutton,i,oDesc,oTable, x
   	  	
		'Turn off saving to avoid conflicts with other tests
   	'  	Browser("creationtime:=0").Page("index:=1").WebCheckBox("html id:=PMN_FILTER_WRK_PMN_SAVE_FLAG").Set "OFF"
		
		'Refresh table
   '	  	Browser("creationtime:=0").Page("index:=1").WebButton("html id:=REFRESH_BTN").Click

	'	Wait 5

	'	Set oTable = Browser("creationtime:=0").Page("index:=1").PSFrame("html id:=ptifrmtgtframe").WebTable("class:=PSLEVEL1GRID","html tag:=TABLE")
		
	'Do While (Trim(runStatus) <> "Success"  Or Trim(runStatus) <> "Warning") And Trim(distributionStatus) <> "Posted" 


	'	For i = 2 To oTable.RowCount Step 1
		
	'		For x = 1 To 20 Step 1
	'			If Trim(oTable.GetCellData(i,2)) = "" Then
	'			ElseIf Trim(oTable.GetCellData(i,2)) > authInstanceNumber Then					
	'				Exit For						
	'			End If
	'			
	'			Browser("creationtime:=0").Page("index:=1").WebButton("html id:=REFRESH_BTN").Click
	'			oTable.RefreshObject
	'			wait(10)
	'		Next
			
			
	'		If Trim(oTable.GetCellData(i,2)) > authInstanceNumber  Then
	'			rowNumber = i
	'			Exit For
	'		End If
	'	Next

	'	If rowNumber = -1 Then
	'			Call WriteToReport (micFail,"Process instance " & authinstanceNumber, "Process instance " & authinstanceNumber & " is not displayed", True)
	'	        getCDWCCStatus = status
	'	        Exit Function
	'	Else
	'			Browser("creationtime:=0").Page("index:=1").WebButton("html id:=REFRESH_BTN").Click
	'			oTable.RefreshObject
	'			If oTable.Exist(30) Then				
	'			   'Pull Column with Column name for Run Status
	'			   sColumn = GetColumn(oTable, "Run Status")
	'			   runStatus = oTable.GetCellData(rowNumber,sColumn)
'
'				   'Pull Column with Column name for Distribution Status
'				   sColumn = GetColumn(oTable, "Distribution Status")
'				   distributionStatus = oTable.GetCellData(rowNumber,sColumn)

'				End If   
'		End If

		''''''''''
'		If (Trim(runStatus) = "Success" Or Trim(runStatus) = "Warning") And Trim(distributionStatus) = "Posted" Then
'			Call WriteToReport (micPass, "CDWCC Process " & Trim(oTable.GetCellData(rowNumber,2)) & " Ran into Success and is Posted", "", True)
'			status = True
'			Exit Do
'		End If
'
'		If (Trim(LCase(runStatus) = LCase("NO Success")) Or Trim(LCase(runStatus) = LCase("processing")) ) And Trim(LCase(distributionStatus) = LCase("Posted")) T'hen
'			Call WriteToReport (micFail, "CDWCC Process " & Trim(oTable.GetCellData(rowNumber,2)) & " Ran into " & runStatus & " and is Posted", "", True)
'			Exit Do
'		End If

'		endingTrans = Now()
'		If DateDiff("s", startTrans, endingTrans) > 1210 Then
'			Call WriteToReport (micFail, "CDWCC Process did not Ran into Success and is not Posted in 20 minutes.  Instance Number is [" & authinstanceNumber & "'].", "", True)
'			Exit Do
'		End If


'	 Loop
	 
'	Set objbutton = Nothing	'''''''''''''''''
'	Set oDesc = Nothing
'	Set oTable = Nothing
	 getCDWCCStatus = SharedProcessMonitor(getCDWCCStatus)
End Function

'**************************************************************************************************************
''' <summary> 
''' verifyCustomerGeneralInfo Function is to verify general information of customer
''' </summary>
''' <author>Venu Arigela</author>
''' <datecreated>21-Nov-2015</datecreated>
''' <param name="custName" type="string">customer name</param>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function maincontactpage()
	Dim objTable, objCustID, objNextBtn, status, CustID, completed, objName, name

	Set objNextBtn = Browser("creationtime:=0").Page("index:=1").WebButton("name:=Next in List")
	completed = false
	Do While objNextBtn.Object.isDisabled = False or completed = False
		Set objTable = Browser("creationtime:=0").Page("index:=1").WebList("html id:=CONTACT_EFF_STATUS\$0","index:=0")
		status = objTable.GetROProperty("value")	
		Set objCustID = Browser("creationtime:=0").Page("index:=1").WebElement("html id:=CONTACT_CONTACT_ID")
		CustID = objCustID.GetROProperty("innerhtml")
		Set objName = Browser("creationtime:=0").Page("index:=1").WebEdit("html id:=CONTACT_NAME1\$0","index:=0")
		name = objName.GetROProperty("value")
		If Trim(status) = "Active" or Trim(status) = "Inactive" Then
			Call WriteToReport(micPass, "Contact ID " & CustID & "", "Customer " & name & " Verified with Contact ID and Status is " & status & "", False)
		Else
			Call WriteToReport(micFail, "Contact ID", "Failed to load Customer Status", True)        
		End If

		If objNextBtn.Object.isDisabled = True Then
			completed = True
		End If

		If Not completed Then
			Browser("creationtime:=0").Page("index:=1").WebButton("name:=Next in List").Click
			Wait 2
		End If

		Set objTable = Nothing
		Set objNextBtn = Nothing
		Set objName = Nothing
		Set objNextBtn = Browser("creationtime:=0").Page("index:=1").WebButton("name:=Next in List")
	Loop
End Function

'**************************************************************************************************************
''' <summary> 
''' ARspeciallistSetUserFieldValues Function is to verify general information of customer
''' </summary>
''' <author>vikram</author>
''' <datecreated>21-Nov-2015</datecreated>
''' <param name="custName" type="string">customer name</param>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function ARspeciallistSetUserFieldValues()
	Dim bSetSecure
	Dim custInfoArr

	custInfoArr = dbFetchCustomerDetails(GlobalDictionary("BusinessUnit"))
	If Not UBound(custInfoArr) = 0 Then
		If Browser("creationtime:=0").Page("index:=1").WebButton("html id:=#ICSearch").Exist Then
			Call WriteToReport(micPass, "General Information Page", "General Information Page loaded Successfully", False)
		Else
			Call WriteToReport(micFail, "General Information Page", "Failed to load General Information Page", True)
		End If

		Call click_Lookup_Img_And_Select_Item("Look up SetID.*", "SP_SETID_CLSVW_SETID", GlobalDictionary("SetID"), "SetID")
		Call click_Lookup_Img_And_Select_Item("Look up Customer ID.*","CUST_ALL_VW_CUST_ID",  custInfoArr(0), "CustomerID")
		setValue_WebEdit getObjectInfoFromXML("Name_1", objectsFile, "Value"), custInfoArr(1), bSetSecure, getObjectInfoFromXML("Name_1", objectsFile, "Description")
		btn_click getObjectInfoFromXML("Search_Button", objectsFile, "Value"), getObjectInfoFromXML("Search_Button", objectsFile, "Description")
		Wait 2
		If Browser("creationtime:=0").Page("index:=1").WebElement("html id:=CUSTOMER_SETID").Exist Then
			Call WriteToReport(micPass, "General Info Page", "General Info Page loaded Successfully", False)
		Else
			Call WriteToReport(micFail, "General Info Page", "Failed to load General Info Page", True)
		End If

		verifyValue getObjectInfoFromXML("GeneralInfo_SetID", objectsFile, "Value"), GlobalDictionary("SetID"), "innerhtml", "SetID"
		verifyValue getObjectInfoFromXML("GeneralInfo_CustomerID", objectsFile, "Value"), custInfoArr(0), "innerhtml", "Customer ID"    	            
		element_dblClick getObjectInfoFromXML("BilltoOptions_WebElement", objectsFile, "Value"), getObjectInfoFromXML("BilltoOptions_WebElement", objectsFile, "Description")		
		If Browser("creationtime:=0").Page("index:=1").WebElement("innertext:=Bill To Options", "index:=0").Exist Then
			Call WriteToReport(micPass, "Bill To Options Page", "Bill To Options Page loaded Successfully", False)
		Else
			Call WriteToReport(micFail, "Bill To Options Page", "Failed to load Bill To Options Page", True)
		End If
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' ARCustomerUserFieldsValues Function is to verify general information of customer
''' </summary>
''' <author>Vikram</author>
''' <datecreated>21-Nov-2015</datecreated>
''' <param name="custName" type="string">customer name</param>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function ARCustomerUserFieldsValues()
	Dim custInfoArr

	custInfoArr = dbFetchCustomerDetails(GlobalDictionary("BusinessUnit"))
	If Not UBound(custInfoArr) = 0 Then
		Call click_Lookup_Img_And_Select_Item("Look up SetID.*", "SP_SETID_CLSVW_SETID", GlobalDictionary("SetID"), "SetID")
		Call click_Lookup_Img_And_Select_Item("Look up Customer SetID.*", "SP_SETID_CLSVW_SETID", GlobalDictionary("CustomerSetID"), "Customer SetID")
		Call click_Lookup_Img_And_Select_Item("Look up Customer ID.*", "CUST_CNTCT_VW_CUST_ID_CNTCT", custInfoArr(0), "CustomerID")
		btn_click getObjectInfoFromXML("Search_Button3", objectsFile, "Value"), getObjectInfoFromXML("Search_Button3", objectsFile, "Description")
		Wait 2
		click_Link getObjectInfoFromXML("FirstContact_Link", objectsFile, "Value"), getObjectInfoFromXML("FirstContact_Link", objectsFile, "Description")
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' InvoiceLookupvalues Function is to verify general information of customer
''' </summary>
''' <author>Vikram</author>
''' <datecreated>21-Nov-2015</datecreated>
''' <param name="custName" type="string">customer name</param>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function InvoiceLookupvalues()
	Err.Clear
	On Error Resume Next
	Dim recordCount,intrCount,rCount,j,intFlag,k,arrRecordActalues(),i,sSQL
	
	sSQL = "SELECT A.INVOICE_FORM_ID FROM PS_BI_IVC_FORM A WHERE A.STATUS_BI = 'A'"
	recordCount = dbVerifyInvoiceValues()
	btn_click getObjectInfoFromXML("Invoice_LookUp", objectsFile, "Value"), getObjectInfoFromXML("Invoice_LookUp", objectsFile, "Description")
	intrCount = Browser("creationtime:=0").Page("index:=1").WebTable("html id:=PTSRCHRESULTS").GetROProperty("rows")
	rCount = Ubound(recordCount)
	If Ubound(recordCount) > 0 Then
		j=1
		For i = 2 To intrCount
			ReDim Preserve arrRecordActalues(j) 
			arrRecordActalues(j) = Browser("creationtime:=0").Page("index:=1").WebTable("html id:=PTSRCHRESULTS").GetCellData(i,1)
			j=j+1
		Next

		intFlag = 0
		For k = 1 To rCount
			If strcomp(arrRecordActalues(k),recordCount(k),1)=0 Then
				intFlag = intFlag + 1
			End If
		Next

		If intFlag = rCount Then
			Call WriteToReport(micPass, "Values in Invoice Form Lookup", "Matches Database Query " & sSQL & " Record Values with Application Values", False)
		Else
			Call WriteToReport(micFail, "Values in Invoice Form Lookup", "Doesnot Match Database Query " & sSQL & " Record Values with Application Values", True)
		End If
	Else
		Call WriteToReport(micFail, "Verifying the Record from Database", "No Record Exist for SQL "&sSQL&"",true)
	End If

	On Error GoTo 0
End Function

'**************************************************************************************************************
''' <summary> 
''' SetCustomerValue Function is to verify general information of customer
''' </summary>
''' <author>Vikram</author>
''' <datecreated>21-Nov-2015</datecreated>
''' <param name="custName" type="string">customer name</param>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function SetCustomerValue()
	Dim custInfoArr
	On Error Resume Next

	custInfoArr = dbFetchCustomerIdItemInfo(GlobalDictionary("BusinessUnit"))
	If Not UBound(custInfoArr) = 0 Then
		Call click_Lookup_Img_And_Select_Item("Look up Cust ID.*", "SP_IDCUST_CLSVW_CUST_ID", custInfoArr(1), "Customer")
	Else
		Call WriteToReport(micFail, "Customer info From DB", "DB query returned zero records ", True)   
		On Error Goto 0        
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' SetCustomerValueACHPaymentMethod Function is to verify general information of customer
''' </summary>
''' <author>Vikram</author>
''' <datecreated>21-Nov-2015</datecreated>
''' <param name="custName" type="string">customer name</param>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function SetCustomerValueACHPaymentMethod()
	Dim custInfoArr
	
	On Error Resume Next
	custInfoArr = dbFetchCustomerIdItemInfoACHPaymentMetod(GlobalDictionary("BusinessUnit"))
	If Not UBound(custInfoArr) = 0 Then
		Call click_Lookup_Img_And_Select_Item("Look up Cust ID.*", "SP_IDCUST_CLSVW_CUST_ID", custInfoArr(3), "Customer")
	Else
		Call WriteToReport(micFail, "Customer info From DB", "DB query returned zero records", True)    
		On Error Goto 0        
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' SetItemValue Function is to verify general information of customer
''' </summary>
''' <author>Vikram</author>
''' <datecreated>21-Nov-2015</datecreated>
''' <param name="custName" type="string">customer name</param>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function SetItemValue()
	Dim custInfoArr

	On Error Resume Next
	custInfoArr = dbFetchCustomerIdItemInfo(GlobalDictionary("BusinessUnit"))
	If Not UBound(custInfoArr) = 0 Then
		Call click_Lookup_Img_And_Select_Item("Look up Reference.*", "ITEM_ITEM_VW_ITEM", custInfoArr(2), "ITEM")
	Else
		Call WriteToReport(micFail, "Customer info From DB", "DB query returned zero records", True)
		On Error Goto 0
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' v Function is to verify general information of customer
''' </summary>
''' <author>Vikram</author>
''' <datecreated>21-Nov-2015</datecreated>
''' <param name="custName" type="string">customer name</param>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function SetItemValueACHPaymentMethod()
	Dim custInfoArr

	custInfoArr = dbFetchCustomerIdItemInfoACHPaymentMetod(GlobalDictionary("BusinessUnit"))
	If Not UBound(custInfoArr) = 0 Then
		Call click_Lookup_Img_And_Select_Item("Look up Reference.*", "ITEM_ITEM_VW_ITEM", custInfoArr(5), "ITEM")
	 Else
        Call WriteToReport(micFail, "Customer info From DB", "DB query returned zero records", True)
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' ARUserID Function is to verify general information of customer
''' </summary>
''' <author>Vikram</author>
''' <datecreated>21-Nov-2015</datecreated>
''' <param name="custName" type="string">customer name</param>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function ARUserID(strCaptureUser)
	Dim userIDInfoArr, userBox

	userIDInfoArr = dbFetchUserId(strCaptureUser)
	If Not UBound(userIDInfoArr) = 0 Then
		closeAllBrowsersExceptQC
		SystemUtil.Run GlobalDictionary("ApplicationUrl")
		Wait 3
		deleteCookies
		maximizeBrowser()
		Set userBox = eval(getObjectInfoFromXML("UserName_Edit", objectsFile, "Value"))
		If userBox.Exist Then
			setValue_WebEdit getObjectInfoFromXML("UserName_Edit", objectsFile, "Value"), userIDInfoArr(1), False, getObjectInfoFromXML("UserName_Edit", objectsFile, "Description")
			setValue_WebEdit getObjectInfoFromXML("Pwd_Edit", objectsFile, "Value"), ENCRYPTEDPASSWORD, True, getObjectInfoFromXML("Pwd_Edit", objectsFile, "Description")
			btn_click getObjectInfoFromXML("Login_BTN", objectsFile, "Value"), getObjectInfoFromXML("Login_BTN", objectsFile, "Description")
		End If
	End If
End Function

'**************************************************************************************************************
''' <summary> 
'''This Function is to Run Single Action Invoice BIJOB03 Process
''' </summary>
''' <author>Rama Peela</author>
''' <datecreated>18-Nov-2015</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 			Description of change
'11/21/2017			Stephen King	Updated objects to match application for From and To Invoice text fields
'12/05/2017			Stephen King	Updated the Run button properties used in page validation and running the job
'*************************************************************************************************************
Public Function singleActionInvoiceBIJOB03(invoice, runcontrol)
	Dim Runcontrolid,srtBusinessValue,strSQL,sConnectionString,sheetName,arrRecordValues,getObjectFromXML
	Dim processInstance, runStatus, userID

	'Login as our CDW_BATCH user
	LOGINCDWBATCH

	If SelectMainMenu1(GlobalDictionary("MainMenuSelection1")) Then
		If Browser("CreationTime:=0").Page("title:=Single Action Invoice").PSFrame("name:=TargetContent").WebElement("html id:=app_label","html tag:=H1","index:=0").Exist(45) Then
			Call WriteToReport (micPass, "Single Action Invoice page is Loaded Successfully", "", True)
		Else
			Call WriteToReport (micFail, "Single Action Invoice page is not Loaded", "", True)
		End If

		' Select run control id
		setValue_WebEdit getObjectInfoFromXML("Runcontrol_Webedit", objectsFile, "Value"), runcontrol, False, getObjectInfoFromXML("Runcontrol_Webedit", objectsFile, "Description")
		btn_click getObjectInfoFromXML("Search_RunControlId_Btn", objectsFile, "Value"), getObjectInfoFromXML("Search_RunControlId_Btn", objectsFile, "Description")

		'If Browser("creationtime:=0").Page("index:=1").PSFrame("name:=TargetContent").WebButton("name:=Run","html tag:=INPUT").Exist(45) Then
		'If Browser("title:=Single Action Invoice").Page("title:=Single Action Invoice").WebButton("html id:=PRCSRQSTDLG_WRK_LOADPRCSRQSTDLGPB").Exist(30) Then
		With Browser("Peoplesoft Browser").Page("Single Action Invoice").PSFrame("TargetContent")
			If .WebButton("Run").Exist(30) Then
				WriteToReport micPass, "Single Action Invoice Page for Selecting Selection Parameters is Loaded Successfully", "", True
			Else
				WriteToReport micFail, "Single Action Invoice Page for Selecting Selection Parameters is not Loaded Successfully", "", True
				ExitTest
			End If

			'Selection Parameters   
			'Verify_ClickRadioBtn getObjectInfoFromXML("Processingdate", objectsFile, "Value"), getObjectInfoFromXML("Processingdate", objectsFile, "Description"), "U"
			.WebRadioGroup("InvoiceDate").Select "U"
			Browser("Peoplesoft Browser").Sync

			'setValue_WebEdit getObjectInfoFromXML("InvoiceDateoption_WebEdit", objectsFile, "Value"), Date, False, getObjectInfoFromXML("InvoiceDateoption_WebEdit", objectsFile, "Description")
			'Browser("title:=Single Action Invoice").Page("title:=Single Action Invoice").webedit("html id:=RUN_BI_PRNTIVC_INVOICE_DT\$0").Set Date
			.WebEdit("Date").Set Date

			'Verify_ClickRadioBtn getObjectInfoFromXML("PostingAction", objectsFile, "Value"), getObjectInfoFromXML("PostingAction", objectsFile, "Description"), "L"
			.WebRadioGroup("InvoicePostingAction").Select "L"
			Browser("Peoplesoft Browser").Sync

			'Browser("CreationTime:=0").Page("index:=1").WebRadioGroup("name:=RUN_BI_PRNTIVC_INVOICE_RANGE_OPT\Browser("CreationTime:=0").Page("index:=1").WebRadioGroup("html id:=RUN_BI_PRNTIVC_INVOICE_RANGE_OPT\$22\$\$0").Select "INV"").Select "INV"
			'Browser("CreationTime:=0").Page("index:=1").WebRadioGroup("name:=RUN_BI_PRNTIVC_INVOICE_RANGE_OPT\$0").Select "INV"
			.WebRadioGroup("InvoiceRangeSelection").Select "INV"
			Browser("Peoplesoft Browser").Sync
			'Browser("CreationTime:=0").Page("index:=1").WebRadioGroup("name:=PVN_RANGE_OPT\$0").Select "INV"

			'Browser("title:=Single Action Invoice").Page("title:=Single Action Invoice").webedit("html id:=RUN_BI_PRNTIVC_START_INVOICE\$0").Set invoice
			'Browser("title:=Single Action Invoice").Page("title:=Single Action Invoice").webedit("html id:=RUN_BI_PRNTIVC_END_INVOICE\$0").Set invoice
			.WebEdit("FromInvoice").Set invoice
			.WebEdit("ToInvoice").Set invoice

			'Browser("title:=Single Action Invoice").Page("title:=Single Action Invoice").webedit("html id:=RUN_BI_PRNTIVC_BUSINESS_UNIT\$0").Set GlobalDictionary("BusinessUnit")
			.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")

			'btn_click getObjectInfoFromXML("Save_Selectionparameters_btn", objectsFile, "Value"), getObjectInfoFromXML("Save_Selectionparameters_btn", objectsFile, "Description")
			.WebButton("Save").Click
			Browser("Peoplesoft Browser").Sync

			'Give time to save and then click run
			If .WebButton("Run").exist(60) Then
				.WebButton("Run").Click
				Browser("Peoplesoft Browser").Sync
			End If
		End With

		'Gives Save time to save
'		If Browser("title:=Single Action Invoice").Page("title:=Single Action Invoice").WebButton("html id:=PRCSRQSTDLG_WRK_LOADPRCSRQSTDLGPB").exist(30) Then
'
'			'Not checking for the Run button here as it's what we used to validate being on the page. Also, properties seem to have changed from the XML OR.
'			Browser("title:=Single Action Invoice").Page("title:=Single Action Invoice").WebButton("html id:=PRCSRQSTDLG_WRK_LOADPRCSRQSTDLGPB").Click		
'		End If

		If Browser("CreationTime:=0").Page("index:=1").PSFrame("html id:=ptModFrame_0").WebElement("innerhtml:=User ID","html tag:=SPAN").Exist(40) Then
			WriteToReport micPass, "Process Scheduler Page is Loaded Successfully", "", True
		Else
			WriteToReport micFail, "Process scheduler Page is not Loaded Successfully", "", True
			ExitTest
		End If

		check_CheckBox getObjectInfoFromXML("SingleActionInvoice_CHKBOX", objectsFile, "Value"), getObjectInfoFromXML("SingleActionInvoice_CHKBOX", objectsFile, "Description")
		btn_click getObjectInfoFromXML("OK_ProcessScheduler_btn", objectsFile, "Value"), getObjectInfoFromXML("OK_ProcessScheduler_btn", objectsFile, "Description")

		' wait 5
		If Browser("creationtime:=0").Page("index:=1").WebElement("innertext:=Process Instance:.*","index:=0").Exist(40) Then
			processInstance = Browser("creationtime:=0").Page("index:=1").WebElement("innertext:=Process Instance:.*","index:=0").GetROProperty("innertext")
			btn_click getObjectInfoFromXML("ProcessMonitor_link", objectsFile, "Value"), getObjectInfoFromXML("ProcessMonitor_link", objectsFile, "Description")
		End If

		If Browser("creationtime:=0").Page("index:=1").PSFrame("html id:=ptifrmtgtframe").webbutton("name:=Refresh","html id:=REFRESH_BTN").Exist(60) Then
			WriteToReport micPass,"Process Monitor Page is Loaded Successfully", "", True
		Else
			WriteToReport micFail, "Process Monitor Page is not Loaded Successfully", "", True
		End If

		If GlobalDictionary("RunControl") = "CDWBIJOB" Then
			userID = "CDW_BATCH"
		Else
			userID = GlobalDictionary("SignInUser")
		End If

		runStatus = getStatus(Trim(split(processInstance,":")(1)),"")
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' This Function is to Run CDWBIJOB Process
''' </summary>
''' <author>Rama Peela</author>
''' <datecreated>18-Nov-2015</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function processCDWBIJOB(invoice, runcontrol)
	Dim Runcontrolid,srtBusinessValue,strSQL,sConnectionString,sheetName,arrRecordValues,getObjectFromXML
	Dim runStatus

	'Login as our CDW_BATCH user
	LOGINCDWBATCH

	If SelectMainMenu1(GlobalDictionary("MainMenuSelection1")) Then
		If Browser("CreationTime:=0").Page("title:=Single Action Invoice").PSFrame("name:=TargetContent").WebElement("html id:=app_label","html tag:=H1","index:=0").Exist(30) Then
			Call WriteToReport (micPass, "Single Action Invoice page is Loaded Successfully", "", True)
		Else
			Call WriteToReport (micFail, "Single Action Invoice page is not Loaded", "", True)		
		End If

		' Select run control id
		setValue_WebEdit getObjectInfoFromXML("Runcontrol_Webedit",objectsFile, "Value"),runcontrol,false, getObjectInfoFromXML("Runcontrol_Webedit",objectsFile, "Description")
		btn_click getObjectInfoFromXML("Search_RunControlId_Btn",objectsFile, "Value"),getObjectInfoFromXML("Search_RunControlId_Btn",objectsFile, "Description")

		'If Browser("creationtime:=0").Page("index:=1").PSFrame("name:=TargetContent").WebButton("name:=Run","html tag:=INPUT").Exist(45) Then
'		If Browser("title:=Single Action Invoice").Page("title:=Single Action Invoice").WebButton("html id:=PRCSRQSTDLG_WRK_LOADPRCSRQSTDLGPB").Exist(30) Then
'			WriteToReport micPass, "Single Action Invoice Page for Selecting Selection Parameters is Loaded Successfully", "", True
'		Else
'			WriteToReport micFail, "Single Action Invoice Page for Selecting Selection Parameters is not Loaded Successfully", "", True
'			ExitTest
'		End If

		'Selection Parameters
'		Verify_ClickRadioBtn getObjectInfoFromXML("Processingdate",objectsFile, "Value"),getObjectInfoFromXML("Processingdate",objectsFile, "Description"),"U"

		'setValue_WebEdit getObjectInfoFromXML("InvoiceDateoption_WebEdit", objectsFile, "Value"), Date, False, getObjectInfoFromXML("InvoiceDateoption_WebEdit", objectsFile, "Description")
'		Browser("title:=Single Action Invoice").Page("title:=Single Action Invoice").webedit("html id:=RUN_BI_PRNTIVC_INVOICE_DT\$0").Set Date
'		Verify_ClickRadioBtn getObjectInfoFromXML("PostingAction",objectsFile, "Value"),getObjectInfoFromXML("PostingAction",objectsFile, "Description"),"L"
		'Verify_ClickRadioBtn getObjectInfoFromXML("invoiceid_WebRadioGroup",objectsFile, "Value"),getObjectInfoFromXML("invoiceid_WebRadioGroup",objectsFile, "Description"),"INV"

		'setValue_WebEdit getObjectInfoFromXML("FromInvoice_SP_WebEdit",objectsFile, "Value"),invoice,false, getObjectInfoFromXML("FromInvoice_SP_WebEdit",objectsFile, "Description")
		'setValue_WebEdit getObjectInfoFromXML("ToInvoice_SP_WebEdit",objectsFile, "Value"),invoice,false, getObjectInfoFromXML("ToInvoice_SP_WebEdit",objectsFile, "Description")
		'setValue_WebEdit getObjectInfoFromXML("Unit_selectionparameters_TXT",objectsFile, "Value"),GlobalDictionary("BusinessUnit"),false, getObjectInfoFromXML("Unit_selectionparameters_TXT",objectsFile, "Description")
'		Browser("title:=Single Action Invoice").Page("title:=Single Action Invoice").WebRadioGroup("html id:=RUN_BI_PRNTIVC_INVOICE_RANGE_OPT.*").Select "INV"
'		Browser("title:=Single Action Invoice").Page("title:=Single Action Invoice").webedit("html id:=RUN_BI_PRNTIVC_START_INVOICE\$0").Set invoice
'		Browser("title:=Single Action Invoice").Page("title:=Single Action Invoice").webedit("html id:=RUN_BI_PRNTIVC_END_INVOICE\$0").Set invoice
'		Browser("title:=Single Action Invoice").Page("title:=Single Action Invoice").webedit("html id:=RUN_BI_PRNTIVC_BUSINESS_UNIT\$0").Set GlobalDictionary("BusinessUnit")
'		btn_click getObjectInfoFromXML("Save_Selectionparameters_btn",objectsFile, "Value"),getObjectInfoFromXML("Save_Selectionparameters_btn",objectsFile, "Description")

		'btn_click getObjectInfoFromXML("Run_SingleActionInvoice_btn",objectsFile, "Value"),getObjectInfoFromXML("Run_SingleActionInvoice_btn",objectsFile, "Description")
		'Browser("title:=Single Action Invoice").Page("title:=Single Action Invoice").WebButton("html id:=PRCSRQSTDLG_WRK_LOADPRCSRQSTDLGPB").Click
		
		With Browser("Peoplesoft Browser").Page("Single Action Invoice").PSFrame("TargetContent")
			If .WebButton("Run").Exist(30) Then
				WriteToReport micPass, "Single Action Invoice Page is Loaded Successfully", "", True
			Else
				WriteToReport micFail, "Single Action Invoice Page is not Loaded Successfully", "", True
				ExitTest
			End If

			'Selection Parameters   
			.WebRadioGroup("InvoiceDate").Select "U"

			.WebEdit("Date").Set Date

			.WebRadioGroup("InvoicePostingAction").Select "L"

			.WebRadioGroup("InvoiceRangeSelection").Select "INV"
			Browser("Peoplesoft Browser").Sync

			.WebEdit("FromInvoice").Set invoice
			.WebEdit("ToInvoice").Set invoice

			.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")

			'btn_click getObjectInfoFromXML("Save_Selectionparameters_btn", objectsFile, "Value"), getObjectInfoFromXML("Save_Selectionparameters_btn", objectsFile, "Description")
			.WebButton("Save").Click
			Browser("Peoplesoft Browser").Sync
			
			.WebButton("Run").Click
			Browser("Peoplesoft Browser").Sync
		End With

		Wait 2
		If Browser("CreationTime:=0").Page("index:=1").WebElement("innerhtml:=User ID","html tag:=SPAN").Exist(45) Then
			Call WriteToReport (micPass,"Process Scheduler Page is Loaded Successfully", "", True)
		Else
			Call WriteToReport (micFail, "Process scheduler Page is not Loaded Successfully", "", True)
		End If
		
		check_CheckBox getObjectInfoFromXML("CDWBIJOBProcess_CHKBOX",objectsFile, "Value"),getObjectInfoFromXML("CDWBIJOBProcess_CHKBOX",objectsFile, "Description")
		btn_click getObjectInfoFromXML("OK_ProcessScheduler_btn",objectsFile, "Value"),getObjectInfoFromXML("OK_ProcessScheduler_btn",objectsFile, "Description")
		Wait 5
		Dim processInstance
		If Browser("creationtime:=0").Page("index:=1").WebElement("innertext:=Process Instance:.*","index:=0").Exist(40) Then
			processInstance = Browser("creationtime:=0").Page("index:=1").WebElement("innertext:=Process Instance:.*","index:=0").GetROProperty("innertext")
			btn_click getObjectInfoFromXML("ProcessMonitor_link",objectsFile, "Value"),getObjectInfoFromXML("ProcessMonitor_link",objectsFile, "Description")
		End If
		
		If Browser("creationtime:=0").Page("index:=1").PSFrame("html id:=ptifrmtgtframe").webbutton("name:=Refresh","html id:=REFRESH_BTN").Exist(50) Then
			Call WriteToReport (micPass,"Process Monitor Page is Loaded Successfully", "", True)
		Else
			Call WriteToReport (micFail, "Process Monitor Page is not Loaded Successfully", "", True)
		End If
		
		runStatus = getStatus(split(processInstance,":")(1),"CDW_BATCH")	
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' This Function is to FilterConversationNew
''' </summary>
''' <author>Vikram Reddy Enukonda</author>
''' <datecreated>18-Nov-2015</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function FilterConversationNew()
	Dim objPage, objTable1, intRowCount, strCellData, intCount, strExpDesc, intFlag

	Set objPage = Browser("name:=Collections Workbench").Page("title:=Collections Workbench").Frame("html id:=ptifrmtgtframe")
	'Set objTable1 = objPage.WebTable("class:=PSLEVEL1GRIDWBO","column names:=Conversations  Personalize.*","index:=0").WebTable("column names:=More Info Unit Cust ID.*","index:=0").WebTable("class:=psprintgrid","html id:=gbCWB_CONVR_VW\$0").WebTable("html id:=tdgbrCWB_CONVR_VW\$0")
	Set objTable1 = objPage.WebTable("html id:=tdgbrCWB_CONVR_VW\$0")
	intRowCount = objTable1.RowCount
	Wait 3
	intFlag = 0
 	For intCount = 1 To intRowCount
		strCellData = objTable1.GetCellData(intCount,7)
		If StrComp("New",Trim(strCellData),1)=0 Then
			intFlag = intFlag + 1
		End If
	Next

	Call WriteToReport(micPass, "Filtered Conversation Status", "All Conversations Displayed having status New", False)
End Function

'**************************************************************************************************************
''' <summary> 
''' arcreditcardprocessing is for AR Credit Processing
''' </summary>
''' <author>Vikram Reddy Enukonda</author>
''' <datecreated>17-Feb-2016</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="boolean"> </returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'17May2018			Eric Trout	Added filter on Process Instance, and cleared Process Name on filter.
'**************************************************************************************************************
Public Function arcreditcardprocessing()
	Dim processTable , rowNum ,processnameObj , outerVal , rowNumVal , processRunStatusBoolVal

	loginCDWBATCH() 
	If Browser("creationtime:=0").page("index:=1").Link("innertext:=Home").exist(5) Then
		Browser("creationtime:=0").page("index:=1").Link("innertext:=Home").Click
	End If

	SelectMainMenu1("CDW Menu > CDW System Process Request")
	If Browser("creationtime:=0").Page("index:=1").WebButton("html id:=#ICSearch").Exist(30) Then
		Call WriteToReport(micPass, "CDW System Process Request Page", "Successfully Navigated to CDW System Process Request Page", False)
	Else
		Call WriteToReport(micFail, "CDW System Process Request Page", "Failed to load CDW System Process Request Page", True)
	End If

	btn_click getObjectInfoFromXML("Search_Button", objectsFile, "Value"), getObjectInfoFromXML("Search_Button", objectsFile, "Description")
	Wait 3
	click_Link getObjectInfoFromXML("RunControlId_Search", objectsFile, "Value"), getObjectInfoFromXML("RunControlId_Search", objectsFile, "Description")
	If Browser("creationtime:=0").Page("index:=1").WebButton("html id:=PRCSRQSTDLG_WRK_LOADPRCSRQSTDLGPB").Exist(30) Then
		Call WriteToReport(micPass, "Process Request Dialog Tab", "Process Request Dialog Tab loaded Successfully", False)
	Else
		Call WriteToReport(micFail, "Process Request Dialog Tab", "Failed to load Process Request Dialog Tab", True)
	End If

	btn_click getObjectInfoFromXML("Run_Button", objectsFile, "Value"), getObjectInfoFromXML("Run_Button", objectsFile, "Description")	
	Wait 5

	''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
	rowNum = rowNumberOfSpecificProcess("CDW_CRCRD_OB")
	Browser("creationtime:=0").Page("index:=1").WebCheckBox("html id:=PRCSRQSTDLG_WRK_SELECT_FLAG\$" & rowNum).Click
	If Err.Number = 0 Then
		Call WriteToReport(micPass, "CDW_CRCRD_OB", "CDW_CRCRD_OB Process is checked  Successfully", True)
	End If

	Call WriteToReport(micPass, "Process Request Dialog Tab", "Process Request Dialog Tab loaded Successfully", False)
	''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
	'  check_CheckBox getObjectInfoFromXML("CDWCRCRDOB_CheckBox",objectsFile, "Value"),getObjectInfoFromXML("CDWCRCRDOB_CheckBox",objectsFile, "Description")
	btn_click getObjectInfoFromXML("Ok_But5", objectsFile, "Value"), getObjectInfoFromXML("Ok_But5", objectsFile, "Description")

	' Wait 15
	''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
	Dim processInstance, processInstanceObj

	If Browser("creationtime:=0").Page("index:=1").WebElement("innertext:=Process Instance:.*","index:=1").Exist(60) Then
		Set processInstanceObj = Browser("creationtime:=0").Page("index:=1").WebElement("innertext:=Process Instance:.*", "index:=1")
		processInstance = split(processInstanceObj.GetROProperty("innertext"),":")(1)
	Else
		Call WriteToReport(micFail, "process instance ", "process instance element is not displayed", True)
	End If

	Set processInstanceObj = Nothing
	
	'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
	btn_click getObjectInfoFromXML("ProcessMonitor_Link1", objectsFile, "Value"), getObjectInfoFromXML("ProcessMonitor_Link1", objectsFile, "Description")
	If Browser("creationtime:=0").Page("index:=1").WebButton("name:=Refresh","html id:=REFRESH_BTN").Exist(30) Then
		Call WriteToReport(micPass, "Process Monitor Page", "Process Monitor Page loaded Successfully", False)
	Else
		Call WriteToReport(micFail, "Process Monitor Page", "Failed to load Process Monitor Page", True)
	End If

	GlobalDictionary("ClearName") = True
	GlobalDictionary("ProcessType") = ""
	GlobalDictionary("Process") = ""
	GlobalDictionary("InstanceNumber") = processInstance

	SharedProcessMonitor("arcreditcardprocessing")

	SelectMainMenu1("CDW Menu > CDW System Process Request")
	If Browser("creationtime:=0").Page("index:=1").WebButton("html id:=#ICSearch").Exist(30) Then
		Call WriteToReport(micPass, "CDW System Process Request Page", "Successfully Navigated to CDW System Process Request Page", False)
	Else
		Call WriteToReport(micFail, "CDW System Process Request Page", "Failed to load CDW System Process Request Page", True)
	End If

	btn_click getObjectInfoFromXML("Search_Button", objectsFile, "Value"), getObjectInfoFromXML("Search_Button", objectsFile, "Description")	
	Wait 3
	click_Link getObjectInfoFromXML("RunControlId_Search", objectsFile, "Value"), getObjectInfoFromXML("RunControlId_Search", objectsFile,"Description")	
	If Browser("creationtime:=0").Page("index:=1").WebButton("html id:=PRCSRQSTDLG_WRK_LOADPRCSRQSTDLGPB").Exist(30) Then
		Call WriteToReport(micPass, "Process Request Dialog Tab", "Process Request Dialog Tab loaded Successfully", False)
	Else
		Call WriteToReport(micFail, "Process Request Dialog Tab", "Failed to load Process Request Dialog Tab", True)
	End If

	btn_click getObjectInfoFromXML("Run_Button", objectsFile, "Value"), getObjectInfoFromXML("Run_Button", objectsFile, "Description")	
	Wait 5
	rowNum = rowNumberOfSpecificProcess("CDW_CCAUAUTH")
	Browser("creationtime:=0").Page("index:=1").WebCheckBox("html id:=PRCSRQSTDLG_WRK_SELECT_FLAG\$" & rowNum).click
	If Err.Number = 0 Then
		Call WriteToReport(micPass, "CDW_CCAUAUTH", "CDW_CCAUAUTH Process is checked Successfully", True)
	End If

	btn_click getObjectInfoFromXML("Ok_But5", objectsFile, "Value"), getObjectInfoFromXML("Ok_But5", objectsFile, "Description")	
	Wait 10

	' Set processInstanceObj = Browser("creationtime:=0").Page("index:=1").WebElement("innertext:=Process Instance:.*","index:=1")
	'processInstance =   split(processInstanceObj.GetROProperty("innertext"),":")(1)
	'Set processInstanceObj = nothing
	If Browser("creationtime:=0").Page("index:=1").WebElement("innertext:=Process Instance:.*","index:=1").Exist(60) Then
		Set processInstanceObj = Browser("creationtime:=0").Page("index:=1").WebElement("innertext:=Process Instance:.*", "index:=1")
		processInstance = Split(processInstanceObj.GetROProperty("innertext"),":")(1)
	Else
		Call WriteToReport(micFail, "process instance ", "process instance element is not displayed", True)
	End If
	
	Set processInstanceObj = Nothing
	btn_click getObjectInfoFromXML("ProcessMonitor_Link1", objectsFile, "Value"), getObjectInfoFromXML("ProcessMonitor_Link1", objectsFile, "Description")
	
	If Browser("creationtime:=0").Page("index:=1").WebButton("name:=Refresh","html id:=REFRESH_BTN").Exist(30) Then
		Call WriteToReport(micPass, "Process Monitor Page", "Process Monitor Page loaded Successfully", False)
	Else
		Call WriteToReport(micFail, "Process Monitor Page", "Failed to load Process Monitor Page", True)
	End If
	
	GlobalDictionary("ClearName") = True
	GlobalDictionary("ProcessType") = ""
	GlobalDictionary("Process") = ""
	GlobalDictionary("InstanceNumber") = processInstance

	If SharedProcessMonitor("arcreditcardprocessing") Then
		arcreditcardprocessing = True
	End If
	

End Function

'**************************************************************************************************************
''' <summary> 
''' arupdate Function is to Run the AR Update Process
''' </summary>
''' <author>Rama Peela</author>
''' <datecreated>21-Nov-2015</datecreated>
''' <param name="srtBusinessValue" type="string">Business Unit</param>
''' <param name="runcontrol" type="string">Runcontrol ID</param>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function arupdate(srtBusinessValue,runcontrol)
	Dim processInstanceObj,processInstance
	Dim runStatus, signinUser1

	If Browser("creationtime:=0").page("index:=1").Link("innertext:=Home").exist(5) Then
		Browser("creationtime:=0").page("index:=1").Link("innertext:=Home").Click
	End If

	If SelectMainMenu1(GlobalDictionary("MainMenuSelection1")) Then	
		If Browser("creationtime:=0").Page("index:=1").WebElement("html id:=app_label","html tag:=H1").Exist(30) Then
			Call WriteToReport (micPass, "Request Receivables Update Page is Loaded Successfully", "", True)
		Else
			Call WriteToReport (micFail, "Request Receivables Update Page is not Loaded Successfully", "", True)
		End If

		setValue_WebEdit getObjectInfoFromXML("Runcontrol_Webedit", objectsFile, "Value"), runcontrol, False, getObjectInfoFromXML("Runcontrol_Webedit", objectsFile, "Description")
		btn_click getObjectInfoFromXML("Search_RunControlId_Btn", objectsFile, "Value"), getObjectInfoFromXML("Search_RunControlId_Btn", objectsFile, "Description")
		If Browser("creationtime:=0").Page("index:=1").WebElement("html id:=app_label","html tag:=SPAN").Exist(30) Then
			Call WriteToReport (micPass, "Receivables Update Request Tabbed Page is Loaded Successfully", "", True)
		Else
			Call WriteToReport (micFail, "Receivables Update Request Tabbed Page is not Loaded Successfully", "", True)
		End If

		setValue_WebEdit getObjectInfoFromXML("unitaruppdate_webedit",objectsFile, "Value"),srtBusinessValue,false, getObjectInfoFromXML("unitaruppdate_webedit",objectsFile, "Description")
		WebList_select getObjectInfoFromXML("Processfreqaruppdate_weblist",objectsFile, "Value"),"Always",("Always option was successfully selected from the Process Frequency WebList ")
		setValue_WebEdit getObjectInfoFromXML("Acctngdatefromaruppdate_weblist",objectsFile, "Value"),dateadd("d",-10,DATE),false, getObjectInfoFromXML("Acctngdatefromaruppdate_weblist",objectsFile, "Description")	
		setValue_WebEdit getObjectInfoFromXML("Acctngdatetoaruppdate_weblist",objectsFile, "Value"),dateadd("d",10,DATE),false, getObjectInfoFromXML("Acctngdatetoaruppdate_weblist",objectsFile, "Description")	
		btn_click getObjectInfoFromXML("Save_Selectionparameters_btn",objectsFile, "Value"),getObjectInfoFromXML("Save_Selectionparameters_btn",objectsFile, "Description")
		btn_click getObjectInfoFromXML("Run_SingleActionInvoice_btn",objectsFile, "Value"),getObjectInfoFromXML("Run_SingleActionInvoice_btn",objectsFile, "Description")	
		Wait 2
		If Browser("CreationTime:=0").Page("index:=1").WebElement("innerhtml:=User ID","html tag:=SPAN").Exist(30) Then
			Call WriteToReport (micPass,"Process Scheduler Page is Loaded Successfully", "", True)
		Else
			Call WriteToReport (micFail, "Process scheduler Page is not Loaded Successfully", "", True)
		End If

		check_CheckBox getObjectInfoFromXML("ARUPDATE_webCheckBox",objectsFile, "Value"),getObjectInfoFromXML("ARUPDATE_webCheckBox",objectsFile, "Description")
		btn_click getObjectInfoFromXML("OK_ProcessScheduler_btn",objectsFile, "Value"),getObjectInfoFromXML("OK_ProcessScheduler_btn",objectsFile, "Description")		
		Wait 5
		Set processInstanceObj = Browser("creationtime:=0").Page("index:=1").WebElement("innertext:=Process Instance:.*", "index:=1")
		processInstance = Split(processInstanceObj.GetROProperty("innertext"),":")(1)
		btn_click getObjectInfoFromXML("ProcessMonitor_link",objectsFile, "Value"),getObjectInfoFromXML("ProcessMonitor_link",objectsFile, "Description")
		If Browser("creationtime:=0").Page("index:=1").PSFrame("html id:=ptifrmtgtframe").webbutton("name:=Refresh","html id:=REFRESH_BTN").Exist(30) Then
			Call WriteToReport (micPass,"Process Monitor Page is Loaded Successfully", "", True)
		Else
			Call WriteToReport (micFail, "Process Monitor Page is not Loaded Successfully", "", True)
		End If

		signinUser1 = GlobalDictionary("SignInUser1")
		If Err.number <> 0 Then
			getStatus processInstance,GlobalDictionary("SignInUser1")
		Else
			getStatus processInstance,GlobalDictionary("SignInUser") 
		End If
	End If 		
End Function

'**************************************************************************************************************
''' <summary> 
''' generateJournals Function is to generate journals for invoices generated
''' </summary>
''' <author>Rama Peela</author>
''' <datecreated>14-Mar-2015</datecreated>
''' <param name="invoice" type="string">Invoice Id</param>
''' <param name="runcontrol" type="string">Runcontrol ID</param>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'11/09/2017			Eric Trout		Added Comments to code and put in parameter for Accounting Definition
'11/21/2017			Stephen King	Adjusted whitespace and added extra handling for From/To fields
'05/30/2018			Eric Trout		Updated description of Journal Request Process Frequency radiogroup
'01/29/2018			Eric Trout		Updated Radiogroup to select A, also updated query for Journal ID, now uses Invoice to find
'05/09/2019			Eric Trout		Updated to set Edit Checkbox instead of Click due to it not activating
'**************************************************************************************************************
Public Function generateJournals(invoice, runcontrol)

	'Generate Journals
	If Browser("creationtime:=0").page("index:=1").Link("innertext:=Home").exist Then
		Browser("creationtime:=0").page("index:=1").Link("innertext:=Home").Click
	End If

	If SelectMainMenu1(GlobalDictionary("MainMenuSelection3")) Then
		WriteToReport micPass, "Generate Journals Page is Loaded Successfully", "", True
	Else
		WriteToReport micFail, "Generate Journals Page is not Loaded Successfully", "", True
	End If

	'Set RunControl field
	setValue_WebEdit getObjectInfoFromXML("Runcontrol_Webedit", objectsFile, "Value"), runcontrol, False, getObjectInfoFromXML("Runcontrol_Webedit", objectsFile, "Description")
	btn_click getObjectInfoFromXML("Search_RunControlId_Btn", objectsFile, "Value"), getObjectInfoFromXML("Search_RunControlId_Btn", objectsFile, "Description")

	'check_CheckBox getObjectInfoFromXML("Edit_JournalProcessingOption_CHKBox", objectsFile, "Value"), getObjectInfoFromXML("Edit_JournalProcessingOption_CHKBox", objectsFile, "Description")
	With Browser("title:=Generate Journals").Page("title:=Generate Journals")
		If .WebCheckBox("html id:=FS_PANELS_WRK_JRNL_EDIT_OPTN\$3\$").Exist(30) Then
			WriteToReport micPass, "Generate Journals Page is Loaded Successfully", "", True
		Else
			WriteToReport micFail, "Generate Journals Page is not Loaded Successfully", "", True
		End If
		
		'Sets Journal Processing Option to Edit
		Browser("PeopleSoft Browser").Page("GenerateJournals").PSFrame("TargetContent").WebCheckBox("Edit").Set "ON"

		'Sets Process Frequency to Always
		.WebRadioGroup("html id:=JRNLGEN_REQUEST_PROCESS_FREQUENCY.*").Select "A"

		'Puts SetID to SHARE - Corporate SetID
		setValue_WebEdit getObjectInfoFromXML("SetID_PRP_TXT", objectsFile, "Value"), "SHARE", False, getObjectInfoFromXML("SetID_PRP_TXT", objectsFile, "Description")

		'Set Accounting Definition Name
		If GlobalDictionary.Exists("AccountingDefinition") = False Then
			setValue_WebEdit getObjectInfoFromXML("AccountingDefinitionName_TXT", objectsFile, "Value"),"BIDEFN", False, getObjectInfoFromXML("AccountingDefinitionName_TXT", objectsFile, "Description")
		Else
			setValue_WebEdit getObjectInfoFromXML("AccountingDefinitionName_TXT", objectsFile, "Value"), GlobalDictionary("AccountingDefinition"), False, getObjectInfoFromXML("AccountingDefinitionName_TXT", objectsFile, "Description")
		End If

		'Sets Business Unit
		setValue_WebEdit getObjectInfoFromXML("ApplicationUnit_TXT", objectsFile, "Value"), GlobalDictionary("BusinessUnit"), False, getObjectInfoFromXML("ApplicationUnit_TXT", objectsFile, "Description")

		'Sets Ledger Group
		setValue_WebEdit getObjectInfoFromXML("Ledgergrp_weblist", objectsFile, "Value"), GlobalDictionary("Ledgergrp"), False, getObjectInfoFromXML("Ledgergrp_weblist", objectsFile, "Description")

		.WebList("html id:=JRNLGEN_REQUEST_FROM_DT_OPTN\$0").Select "Begin Date - From Period"
		.WebList("html id:=JRNLGEN_REQUEST_TO_DT_OPTN\$0").Select "End Date - To Period"

		.WebButton("html id:=PRCSRQSTDLG_WRK_LOADPRCSRQSTDLGPB").Click
		.Sync
	End With

	If Browser("CreationTime:=0").Page("index:=1").PSFrame("html id:=ptModFrame_0").WebElement("innerhtml:=User ID","html tag:=SPAN").Exist(30) Then
		WriteToReport micPass, "Process Scheduler Page", "Process Scheduler Page is Loaded Successfully", False
	Else
		WriteToReport micFail, "Process Scheduler Page", "Process scheduler Page is not Loaded Successfully", True
	End If

	check_CheckBox getObjectInfoFromXML("FS_JGEN_ProcessScheduler", objectsFile, "Value"), getObjectInfoFromXML("FS_JGEN_ProcessScheduler", objectsFile, "Description")
	btn_click getObjectInfoFromXML("OK_ProcessScheduler_btn", objectsFile, "Value"), getObjectInfoFromXML("OK_ProcessScheduler_btn", objectsFile, "Description")	
	Wait 8
	Dim processInstanceObj, processInstance
	Set processInstanceObj = Browser("creationtime:=0").Page("index:=1").WebElement("innertext:=Process Instance:.*","index:=1")
	processInstance = split(processInstanceObj.GetROProperty("innertext"),":")(1)
	btn_click getObjectInfoFromXML("ProcessMonitor_link", objectsFile, "Value"), getObjectInfoFromXML("ProcessMonitor_link", objectsFile, "Description")
	If Browser("creationtime:=0").Page("index:=1").PSFrame("html id:=ptifrmtgtframe").webbutton("name:=Refresh","html id:=REFRESH_BTN").Exist(30) Then
		WriteToReport micPass, "Process Monitor Page", "Process Monitor Page is Loaded Successfully", False
	Else
		WriteToReport micFail, "Process Monitor Page", "Process Monitor Page is not Loaded Successfully", True
	End If
	
	Wait 5
	Dim runStatus, ProcessInstance1, tblPageObj
	runStatus = getStatus(processInstance,"")

	'Capture the Process Instance
	Set tblPageObj = Browser("creationtime:=0").page("index:=1")
	If countOfElements(tblPageObj, "WebElement", "html id", "html tag", "PMN_PRCSLIST_PRCSINSTANCE.*", "SPAN", "Details Column is Populated with Details link on for each process listed", False) > 0 Then
		ProcessInstance1=getObjFromMultipleObjs(tblPageObj, "WebElement", "html id", "html tag", "PMN_PRCSLIST_PRCSINSTANCE.*", "SPAN", "Details Column is Populated with Details link on for each process listed",0).GetroProperty("innertext")
		If Trim(ProcessInstance1) <> "" Then
			WriteToReport micPass, "ProcessInstance", "ProcessInstance Captured is " & ProcessInstance1, False
		Else
			WriteToReport micFail, "ProcessInstance", "ProcessInstance is not captured", True
		End If
	End If

	If Browser("creationtime:=0").page("index:=1").Link("innertext:=Home").exist Then
		Browser("creationtime:=0").page("index:=1").Link("innertext:=Home").Click
	End If

	If SelectMainMenu1(GlobalDictionary("MainMenuSelection4")) Then
		Dim journalID, journal_ID
		journalID = dbGetJournalIdfrmInvoice(GlobalDictionary("Invoice"))

		If len(Trim(journalID)) = 0 Then
			GlobalDictionary("dataAvailable") = False
			WriteToReport micFail, "DB query returned zero records", "DB query returned zero records", True
			Exit Function
		Else
			GlobalDictionary("dataAvailable") = True
			WriteToReport micPass, "DB query returned one record", "DB query returned one record ", True
		End If

		Wait 5
		'journal_ID=DataTable.Value("JOURNAL_ID", "JournalID_"&ProcessInstance1)
		'journal_ID = journalID(0)
		If Trim(journalID) <> "" Then
			WriteToReport micPass, "journalID", "journalID is " & journal_ID, True
		Else
			WriteToReport micFail, "journalID is not captured", "", True
			Exit Function
		End If

		setValue_WebEdit getObjectInfoFromXML("Unit_Journals", objectsFile, "Value"), GlobalDictionary("BusinessUnit"), False, getObjectInfoFromXML("Unit_Journals", objectsFile, "Description")
		setValue_WebEdit getObjectInfoFromXML("JournalID_Journals", objectsFile, "Value"), journalID, False, getObjectInfoFromXML("JournalID_Journals", objectsFile, "Description")
		Browser("creationtime:=0").Page("index:=1").WebEdit("html tag:=INPUT","html id:=JRNL_LN_BI_JOURNAL_DATE").Set(DATE)
		btn_click getObjectInfoFromXML("Search_RunControlId_Btn", objectsFile, "Value"), getObjectInfoFromXML("Search_RunControlId_Btn", objectsFile, "Description")
		Wait 3
		If Not btn_click(getObjectInfoFromXML("JournalID_Link", objectsFile, "Value"), getObjectInfoFromXML("JournalID_Link", objectsFile, "Description")) Then
		  Call WriteToReport (micFail, "No Results ", "No search results displayed for journal ID " & Trim(journalID), True)
		  Exit Function
		End If

		Dim objNextBtn, objTable, invoiceId, objTable1, accnt, dept, completed, objProcessing
		Wait 10
		Set objNextBtn = Browser("CreationTime:=0").Page("index:=1").WebButton("name:=Next in List")
		completed = False
		If objNextBtn.Exist(30) Then
			Do While objNextBtn.Object.isDisabled = False Or completed = False
				Set objTable = Browser("CreationTime:=0").Page("title:=Review Entries by Journal").PSFrame("html id:=ptifrmtgtframe").WebTable("html id:=tdgblBI_ACCT_JRNL_VW.*")
				invoiceId = objTable.GetCellData(1,2)

				'	Print invoiceId
				If Trim(invoiceId) = invoice Then
					Set objTable1 = Browser("CreationTime:=0").Page("title:=Review Entries by Journal").PSFrame("html id:=ptifrmtgtframe").WebTable("html id:=tdgbrBI_ACCT_JRNL_VW.*")
					accnt = objTable1.GetCellData(1,1)
					If Trim(accnt) = "" Then
						WriteToReport micFail, "Account is blank for the invoice id " & invoiceId & "", "", True
					Else
						WriteToReport micPass, "Account is "  & accnt & "  for the invoice id " & invoiceId & "", "", True
					End If
					
					dept = objTable1.GetCellData(1,2)
					If Trim(dept) = "" Then
						WriteToReport micFail, "Dept is blank for the invoice id " & invoiceId & "", "", True
					Else
						WriteToReport micPass, "Dept is "  & dept & "  for the invoice id " & invoiceId & "", "", True
					End If
				End If
		
				If objNextBtn.Object.isDisabled = True Then
					completed = True
				End If
				
				If Not completed Then
					Wait 5
					Browser("CreationTime:=0").Page("index:=1").WebButton("name:=Next in List").Click
					Wait 30

				End If

				Set objProcessing = Nothing
				Set objTable = Nothing
				Set objTable1 = Nothing
				Set objNextBtn = Nothing
				Set objNextBtn = Browser("CreationTime:=0").Page("index:=1").WebButton("name:=Next in List")
			Loop
		Else
			WriteToReport micFail, "Fail " & invoiceId & "", "", True
		End If
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' wrapper to run singleActionInvoiceBIJOB03 and then Verify Status of Invoice
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>18Oct2017</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> NA</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function VerifySingleActionInvoiceBIJOB03
	Dim arrRecordValues()
	Dim sSQL, sUnit
    Dim sInvoice, sResults, sRunControl, finalizeandprint

    sInvoice = GlobalDictionary("Invoice")
    sRunControl = GlobalDictionary("RunControl")
    finalizeandprint = singleActionInvoiceBIJOB03(sInvoice,sRunControl)

    'Verify Invoice Status is INV
	sSql =  "SELECT HDR.BUSINESS_UNIT, HDR.INVOICE, HDR.INVOICE_DT, HDR.BILL_STATUS , HDR.BILL_SOURCE_ID, HDR.PAYMENT_METHOD, HDR.INVOICE_AMOUNT, HDR.BILL_TYPE_ID " &_
			"FROM PS_BI_HDR HDR " &_
			"WHERE HDR.INVOICE = '" & GlobalDictionary("Invoice") & "'"
	WriteToReport micDone, "SQL query for VerifySingleActionInvoiceBIJOB03", "Query used for VerifySingleActionInvoiceBIJOB03 is " & sSQL, False
 
	'First parameter is our sql query
	'Second parameter is created in function.
	'Third parameter is arrRecordValues, which is our previously declared  empty array.
	'Final parameter is the label for our data being stored in the datatable
	sResults = dbGetFirstRecord(sSQL,"", arrRecordValues, "VerifySingleActionInvoiceBIJOB03" & sUnit)

    'Check for Status, Must be INV to continue
    'If IsArray(arrRecordValues) Then
	If IsArray(sResults) Then
    	If StrComp(sResults(3), "INV", vbTextCompare) = 0 Then
	    	WriteToReport micPass, "VerifySingleActionInvoiceBIJOB03", "Invoice Processed correctly, Status shows as " &sResults(3), False
	    Else
	    	WriteToReport micFail, "VerifySingleActionInvoiceBIJOB03", "Invoice failed to process, Status shows as " &sResults(3) &", check logs.", False
	    	ExitTest
	    End If
	Else
	    WriteToReport micFail, "VerifySingleActionInvoiceBIJOB03", "Invoice not found in database", False
    End If
End Function

'**************************************************************************************************************
''' <summary> 
''' wrapper to run processCDWBIJOB_wrapper
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>18Oct2017</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function processCDWBIJOBwrapper
    Dim sInvoice, sRunControl, finalizeandprint

    sInvoice = GlobalDictionary("Invoice")
    sRunControl = GlobalDictionary("RunControl1")
    finalizeandprint = processCDWBIJOB(sInvoice,sRunControl)
End Function

'**************************************************************************************************************
''' <summary> 
''' Copy an existing Invoice by Source and BU for testcase
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>19Oct2017</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Precondition - LaunchApplication with 3530 as the default user
'Change Control: 
'Date of Change 	Author 		Description of change
'10/19/2017			Stephen King	Created
'11/10/2017			Stephen King	Updated objects and dbGetFirstRecord function calls
'4/18/2018			Eric Trout		Update to use in CCDenied Test, added SQL and added entry of Credit Card
'01/29/2019			Eric Trout		Added Query Check to make sure Invoice is set to RDY after saving. 
'**************************************************************************************************************
Public Function SetupRevProInvoice()
	Dim arrRecordValues()
	Dim nResult, i
	Dim sResults, sSource, sSQL, sUnit, bStatusRDY

	bStatusRDY = FALSE
	sUnit = GlobalDictionary("BusinessUnit")
	sSource = GlobalDictionary("Source")
    If GlobalDictionary("OldInvoice") = "" Then
			If GlobalDictionary.Exists("CCInvoice") = True Then
				'Perform a SQL operation to create a copy of an existing invoice. This way each test will have unique(to it) data
				sSql =  "SELECT TOP 1 HDR.BUSINESS_UNIT, HDR.INVOICE, HDR.INVOICE_DT, HDR.BILL_STATUS , HDR.BILL_SOURCE_ID, HDR.PAYMENT_METHOD, HDR.INVOICE_AMOUNT, HDR.BILL_TYPE_ID,HDR.INVOICE_TYPE, HDR.INVOICE_DT " &_
						"FROM PS_BI_HDR HDR " &_
						"WHERE HDR.BUSINESS_UNIT IN ('" & sUnit & "') AND HDR.INVOICE_TYPE IN ('REG','ACR','ARB') AND HDR.BILL_SOURCE_ID = '" & sSource & "' " &_
						"AND HDR.BILL_TYPE_ID <> 'ICY' AND HDR.PAYMENT_METHOD = 'CC' AND HDR.INVOICE_DT > '01/01/2018' AND HDR.INVOICE_AMOUNT < 10000"
						'"AND HDR.BILL_STATUS in ('NEW', 'RDY') "
			Else

				'Perform a SQL operation to create a copy of an existing invoice. This way each test will have unique(to it) data
				sSql =  "SELECT TOP 1 HDR.BUSINESS_UNIT, HDR.INVOICE, HDR.INVOICE_DT, HDR.BILL_STATUS , HDR.BILL_SOURCE_ID, HDR.PAYMENT_METHOD, HDR.INVOICE_AMOUNT, HDR.BILL_TYPE_ID,HDR.INVOICE_TYPE, HDR.INVOICE_DT " &_
						"FROM PS_BI_HDR HDR " &_
						"WHERE HDR.BUSINESS_UNIT IN ('" & sUnit & "') AND HDR.INVOICE_TYPE IN ('REG','ACR','ARB') AND HDR.BILL_SOURCE_ID = '" & sSource & "' " &_
						"AND HDR.BILL_TYPE_ID <> 'ICY' AND HDR.PAYMENT_METHOD <> 'CC' AND HDR.INVOICE_DT > '01/01/2018' AND HDR.INVOICE_AMOUNT < 10000"
						'"AND HDR.BILL_STATUS in ('NEW', 'RDY') "		
			End If
	Else
		sSql =  "SELECT HDR.BUSINESS_UNIT, HDR.INVOICE, HDR.INVOICE_DT, HDR.BILL_STATUS , HDR.BILL_SOURCE_ID, HDR.PAYMENT_METHOD, HDR.INVOICE_AMOUNT, HDR.BILL_TYPE_ID, HDR.INVOICE_TYPE " &_
                "FROM PS_BI_HDR HDR " &_
                "WHERE HDR.INVOICE = '" & GlobalDictionary("OldInvoice") & "'"
	End If

    WriteToReport micDone, "SetupRevProInvoice - SQL Query", "Query used for SetupRevProInvoice is " & sSQL, False

    'First parameter is our sql query
    'Second parameter is created in function.
    'Third parameter is arrRecordValues, which is our previously declared  empty array.
    'Final parameter is the label for our data being stored in the datatable
     sResults = dbGetFirstRecord(sSQL,"", arrRecordValues, "SetupRevProInvoice" & sUnit)

    'Store the BILL_TYPE_ID, INVOICE , BILL_SOURCE, INVOICE_AMOUNT
    On Error Resume Next
	nResult = UBound(arrRecordValues)
	If nResult > 0 Then
	'If Err.Number = 0 Then
        'Storing our Invoice for later use - new Invoice number created when we copy. Updated later.
        GlobalDictionary("OldInvoice") = ArrRecordValues(1)
        GlobalDictionary("InvoiceAmount") = arrRecordValues(6)
        GlobalDictionary("BillTypeID") = arrRecordValues(7)
        GlobalDictionary("InvoiceType") = arrRecordValues(8)
        'GlobalDictionary("Date") = arrRecordValues(8)
        WriteToReport micPass, "SetupRevProInvoice - SQL Query Executed", "SQL query successfully executed. Values were returned and the test will continue.", False
    Else
    	On Error Goto 0
    	WriteToReport micFail, "SetupRevProInvoice - SQL Query Executed", "SQL query successfully executed. However, no values were returned and the test will stop.", False
    	ExitTest
	End If

	'1. Select from Navigator Billing > Maintain Bills > Copy single bill
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection")) <> True Then
		WriteToReport micFail, "SetupRevProInvoice - Copy Single Bill Search Page", "Copy Single Bill Page loading failed, so failing the test case", True
		ExitTest
	End If

	'Browser("creationtime:=1").Sync
'	If Browser("creationtime:=1").Page("index:=1").WebElement("innertext:=Copy Single Bill", "index:=1", "html tag:=H1").Exist(60) Then
'		WriteToReport micPass, "SetupRevProInvoice - Copy Single Bill Search Page", "Copy Single Bill Search Page loaded successfully", False
'	Else
'    	WriteToReport micFail, "SetupRevProInvoice - Copy Single Bill Search Page", "Copy Single Bill Page loading failed, so failing the test case", True
'		ExitTest
'	End If

	'2. Enter: Business Unit
'	setValue_WebEdit getObjectInfoFromXML("business_unit", objectsFile, "Value"), GlobalDictionary("BusinessUnit"), False, getObjectInfoFromXML("business_unit", objectsFile, "Description")

	'3. Enter invoice number
	'With Browser("name:=Copy Single Bill").Page("title:=Copy Single Bill")
	With Browser("PeopleSoft Browser").Page("Copy Single Bill").PSFrame("TargetContent")

		If .WebEdit("Business Unit").Exist(30) Then
			WriteToReport micPass, "SetupRevProInvoice - Copy Single Bill Search Page", "Copy Single Bill Page loaded", True
		Else	
			WriteToReport micFail, "SetupRevProInvoice - Copy Single Bill Search Page", "Copy Single Bill Page loading failed, so failing the test case", True
			ExitTest						
		End If
		
		.WebEdit("Business Unit").Set GlobalDictionary("BusinessUnit")
		.WebEdit("Invoice").Set GlobalDictionary("OldInvoice")

		'4. Hit search
	    'btn_click getObjectInfoFromXML("Search_button", objectsFile, "Value"), getObjectInfoFromXML("Search_button", objectsFile, "Description")
	    .WebButton("Search").Click
		.Sync

		'5. Invoice (Click to Search and select)
		'Step not currently needed as having the invoice takes us right to the correct page. Keeping this here until code reviewed to make sure that this is ok.
	    'click_Link getObjectInfoFromXML("invoice_id",objectsFile, "Value"),getObjectInfoFromXML("invoice_id",objectsFile, "Description")
	    'If isObjectExist(getObjectInfoFromXML("copy_bill",objectsFile, "Value"), getObjectInfoFromXML("copy_bill", objectsFile, "Description")) = True Then
	    If .WebElement("Copy Bill Label").Exist(30) Then
			WriteToReport micPass, "SetupRevProInvoice - Copy Single Bill Page", "Copy Single Bill Page loaded successfully", False
	    Else
			WriteToReport micFail, "SetupRevProInvoice - Copy Single Bill Page", "Copy Single Bill Page loading failed, so failing the test case", True
			ExitTest
	    End If

		'6. Select Bill Action = Copy Bill
		'btn_click getObjectInfoFromXML("copy_bill", objectsFile, "Value"), getObjectInfoFromXML("copy_bill", objectsFile, "Description")
		.WebRadioGroup("Bill Action").Select "CPY"

		'7. Click Save
	    'btn_click getObjectInfoFromXML("Save_Button", objectsFile, "Value"), getObjectInfoFromXML("Save_Button", objectsFile, "Description") 
	    .WebButton("Save").Click
		.Sync

		'8. Click on the link 'Go To Bill Header - Gen. Info'
		'click_Link getObjectInfoFromXML("Bill_Header_Info_link", objectsFile, "Value"), getObjectInfoFromXML("Bill_Header_Info_link", objectsFile, "Description")
		.Link("Go To Bill Header").Click
		.Sync
	End With
	
	wait(10)
	
	'Closes first tab
	Browser("CreationTime:=0").Close
	
	With Browser("PeopleSoft Browser NewTab").Page("Standard Billing").PSFrame("TargetContent")
		If .WebElement("Unit").Exist(30) Then
			WriteToReport micPass, "SetupRevProInvoice - Header Info 1 Tabbed Page", "Header Info 1 Tabbed Page loaded successfully", False
		Else
			WriteToReport micFail, "SetupRevProInvoice - Header Info 1 Tabbed Page", "Header Info 1 Tabbed Page loading failed", True
			ExitTest
		End If

		'9. Click on Line Info 1 tab
		If .WebElement("Line - Info 1").Exist(30) Then
			.WebElement("Line - Info 1").Click
			WriteToReport micPass, "SetupRevProInvoice - Line Info 1 header", "Line Info 1 header clicked", False
		Else
			'There are some identification issues with the Line Info 1 tab during runtime
			If .WebTable("name:=Line - Info 1").Link("name:=Line - Info 1").Exist(30) Then
				.WebTable("name:=Line - Info 1").Link("name:=Line - Info 1").Click
				WriteToReport micPass, "SetupRevProInvoice - Line Info 1 header", "Line Info 1 header clicked", False
			Else
				On Error GoTo 0
				WriteToReport micFail, "SetupRevProInvoice - Line Info 1 header", "Line Info 1 header not clicked. Object not found on page", True
				ExitTest
			End If
		End If
		Browser("PeopleSoft Browser NewTab").Sync

		'Store our new invoice number
		GlobalDictionary("Invoice") = Trim(.WebElement("INVOICE").GetROProperty("innertext"))
		If GlobalDictionary("Invoice") <> "" Then
			WriteToReport micPass, "SetupRevProInvoice - Invoice Captured", GlobalDictionary("Invoice"), False
		Else
			WriteToReport micFail, "SetupRevProInvoice - Invoice Captured", "Unable to capture invoice number.", True
			ExitTest
		End If

		'10. If status is New Move Invoice to RDY status. Requires us to return to the Header - Info 1 page
		'Setting.WebPackage("ReplayType") = 2
		'.WebElement("Header - Info 1").Click
		'Setting.WebPackage("ReplayType") = 1
		.Link("Header - Info 1").Click
		Browser("PeopleSoft Browser NewTab").Sync
	'End With

	'With Browser("PeopleSoft Browser").Page("Standard Billing").PSFrame("TargetContent")
		If .WebEdit("BILL_STATUS").GetROProperty("innertext") <> "RDY" Then
			.WebEdit("BILL_STATUS").Set "RDY"
		End If

		'Update the payterms method field if needed
		If GlobalDictionary("PaymentTerms") <> "" Then
			.WebEdit("Payment Terms").Set GlobalDictionary("PaymentTerms")
		End If

		'Edit Credit Card if needed
		If GlobalDictionary.Exists("CCInvoice") = True Then
			.image("name:=BI_PB_WRK_CR_CARD_PB\$IMG","html tag:=IMG").Click  
			.Frame("title:=Bill Entry").WebList("html id:=BI_HDR_CRCARD_CR_CARD_TYPE\$0").Select GlobalDictionary("CreditCardType")
			.Frame("title:=Bill Entry").WebEdit("html id:=FUNCLIB_CR_CARD_CR_CARD_NBR_E2\$0").Set GlobalDictionary("CreditCardNumber")
			.Frame("title:=Bill Entry").WebEdit("html id:=BI_HDR_CRCARD_CR_CARD_EXPMO\$0").Set GlobalDictionary("ExpiryMonth")
			.Frame("title:=Bill Entry").WebEdit("html id:=BI_HDR_CRCARD_CR_CARD_EXPYR\$0").Set GlobalDictionary("Expiryyear")
			.Frame("title:=Bill Entry").WebEdit("html id:=BI_HDR_CRCARD_CR_CARD_FNAME\$0").Set GlobalDictionary("CreditCardFirstName")
			.Frame("title:=Bill Entry").WebEdit("html id:=BI_HDR_CRCARD_CR_CARD_LNAME\$0").Set GlobalDictionary("CreditCardLastName")
			.Frame("title:=Bill Entry").WebEdit("html id:=BI_HDR_CRCARD_EMAILID\$0").Set GlobalDictionary("EMAIL")
			.Frame("title:=Bill Entry").WebEdit("html id:=BI_HDR_CRCARD_PHONE\$0").Set GlobalDictionary("Phone")
			btn_click getObjectInfoFromXML("Click_Save_Delete", objectsFile, "Value"), getObjectInfoFromXML("Click_Save_Delete", objectsFile, "Description")
			.WebTable("name:=Header - Info 1").Link("name:=Header - Info 1").Click				
		End If

		'11. Verify Invoice Date  to be in-between open period (todays date)
		'Date function returns in MM/DD/YYYY format, which is what the page expects
		.WebEdit("From Date").Set Date
		.WebEdit("To Date").Set Date

		'12. Click on Save button
		.WebButton("Save").Click
		
		'Added to ensure Invoice Saved
		If Browser("PeopleSoft Browser").Page("Standard Billing").PSFrame("TargetContent").WebElement("Saving").Exist(30) Then
			WriteToReport micPass, "SetupRevProInvoice - Save Invoice", "Invoice was saved.", False
		End If

		'Had to add SQL check due to above not always dependable
		For i = 1 to 60
					'Verify Invoice Status is INV
			sSQL =  "SELECT HDR.BUSINESS_UNIT, HDR.INVOICE, HDR.INVOICE_DT, HDR.BILL_STATUS , HDR.BILL_SOURCE_ID, HDR.PAYMENT_METHOD, HDR.INVOICE_AMOUNT, HDR.BILL_TYPE_ID " &_
					"FROM PS_BI_HDR HDR " &_
					"WHERE HDR.INVOICE = '" & GlobalDictionary("Invoice") & "'"
			WriteToReport micDone, "SQL query for VerifySingleActionInvoiceBIJOB03", "Query used for VerifySingleActionInvoiceBIJOB03 is " & sSQL, False
		 
			'First parameter is our sql query
			'Second parameter is created in function.
			'Third parameter is arrRecordValues, which is our previously declared  empty array.
			'Final parameter is the label for our data being stored in the datatable
			sResults = dbGetFirstRecord(sSQL,"", arrRecordValues, "VerifyInvoiceRDY" & sUnit)

			'Check for Status, Must be INV to continue
			'If IsArray(arrRecordValues) Then
			If IsArray(sResults) Then
				If StrComp(sResults(3), "RDY", vbTextCompare) = 0 Then
					WriteToReport micPass, "VerifySingleActionInvoiceBIJOB03", "Invoice Processed correctly, Status shows as " &sResults(3), False
					bStatusRDY = TRUE
					Exit For
				Else
					wait(1)
				End If
			Else
				WriteToReport micFail, "VerifySingleActionInvoiceBIJOB03", "Invoice not found in database", False
			End If
		Next
		
		If bStatusRDY = FALSE Then
			WriteToReport micFail, "Invoice Status", "Invoice status never changed to RDY,", False
			ExitTest
		End If
		
		Browser("PeopleSoft Browser NewTab").Sync


	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Verify that the displayed invoice matches the copy that we made
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>19Oct2017</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Precondition - SetupRevProInvoice has been successfully ran, as that creates our copy. Still be logged in.
'Change Control: 
'Date of Change 	Author 		Description of change
'10/19/2017			Stephen King	Created
'10/26/2017			Stephen King	Added new steps for navigation and validation in app as well as database
'11/02/2017			Stephen King	Updated function with validation on the transactions page
'11/09/2017			Stephen King	Updated reporter statements on all calls, added a new one for when the invoice doesn't load(NYI)
'11/27/2017         Eric Trout      Moved SQL query to PSF_database qfl
'*************************************************************************************************************
Public Function VerifyRevProAccountingEntries
	Dim arrResult
	Dim nResult
	Dim sAccount, sInvoice, sResults, sSource, sDept
    
    sInvoice = GlobalDictionary("Invoice")
	sSource = GlobalDictionary("Source")
	
	'Validate the accounting entries match the source system
    arrResult = dbGetRevProAccountingEntries(sInvoice)
    On Error Resume Next
	nResult = UBound(arrResult)
	If nResult > 0 Then
    	If StrComp(arrResult(1), sInvoice, vbTextCompare) = 0 Then
	    	WriteToReport micPass, "VerifyRevProAccountingEntries - SQL Query", "New invoice found in database", False
	    Else
	    	On Error Goto 0
	    	WriteToReport micFail, "VerifyRevProAccountingEntries - SQL Query", "New invoice not found in database", False
	    	ExitTest
	    End If
	Else
	    On Error Goto 0
	    WriteToReport micFail, "VerifyRevProAccountingEntries - SQL Query", "New invoice not found in database", False
    	ExitTest
    End If

    'Export data for validation later
    SetGlobalDictionaryValue "InvoiceType", arrResult(7)
    SetGlobalDictionaryValue "InvoiceAmount", arrResult(6)    

    'Navigate to the Accounting Entries By Invoice page
    If SelectMainMenu1(GlobalDictionary("MainMenuSelection5")) = True Then
    	Browser("creationtime:=1").Sync

    	'Enter BU and Invoice and click Search button
    	With Browser("PeopleSoft Browser").Page("Review Entries by Invoice").PSFrame("TargetContent")
	    	.WebEdit("Business Unit").Set GlobalDictionary("BusinessUnit")
	    	.WebEdit("Invoice").Set GlobalDictionary("Invoice")
			.WebButton("Search").Click
	    	Browser("PeopleSoft Browser").Sync

	 		'Review Entries by Invoice' screen - click on Transaction Accounts tab			
	 		Dim i
	 		i = 0
	 		'Giving our invoices 5 minutes(300 seconds) to process
	 		Do While Not .WebElement("DEPTID").Exist(10)
	 			i = i + 10
	 			If i > 60 Then
	 				Exit Do
	 			End If

 				If .WebButton("Search").Exist(10) Then
		 			.WebButton("Search").Click
	 				Browser("PeopleSoft Browser").Sync	
 				End If
	 		Loop

			Browser("PeopleSoft Browser").Sync

			'validate the Account information. The \ in the html id accounts for $ being a regex character
			'sAccount = .WebElement("html id:=tdBI_ACCT_INV_VW\$0#4").GetROProperty("innertext")
			sAccount = Trim(.WebElement("ACCOUNT").GetROProperty("innertext"))

            'Pulls DeptID
            GlobalDictionary("DeptID") = sDept

			Select Case sSource
				'RevPro Zuora Clearing Account' - '27543'
				Case "ZUORA"
					If sAccount = "27543" Then
						WriteToReport micPass, "VerifyRevProAccountingEntries - Transaction Accounts Page", "Account information for " & sSource & " and " & sAccount & " matches!", False
					Else
						WriteToReport micFail, "VerifyRevProAccountingEntries - Transaction Accounts Page", "Expected account information for " & sSource & " is 27543. Current account information is " & sAccount & ".", True
						VerifyRevProAccountingEntries = False
						ExitTest
					End If
						
				'RevPro iSeries Clearing Account' - '27542'
				'Case "ISERIES"
				'	If sAccount = "27542" Then
				'		WriteToReport micPass, "VerifyRevProAccountingEntries - Transaction Accounts Page", "Account information for " & sSource & " and " & sAccount & " matches!", False
				'	Else
				'		NOTE - we should only ever end up here with this one. We aren't currently copying bills from iSeries Clearing Account
				'		WriteToReport micFail, "VerifyRevProAccountingEntries - Transaction Accounts Page", "Account information for " & sSource & " and " & sAccount & " do not match. Expecting 27542.", True
				'		VerifyRevProAccountingEntries = False
				'		ExitTest
				'	End If
				
				'RevPro Ensim Clearing Account' - '27541
				Case "ENSIM"
					If sAccount = "27541" Then
						WriteToReport micPass, "VerifyRevProAccountingEntries - Transaction Accounts Page", "Account information for " & sSource & " and " & sAccount & " matches!", False
					Else
						WriteToReport micFail, "VerifyRevProAccountingEntries - Transaction Accounts Page", "Expected account information for " & sSource & " is 27541. Current account information is " & sAccount & ".", True
						VerifyRevProAccountingEntries = False
						ExitTest
					End If
						
				'RevPro CP Clearing Account' - '27540
				Case "CP"
					If sAccount = "27540" Then
						WriteToReport micPass, "VerifyRevProAccountingEntries - Transaction Accounts Page", "Account information for " & sSource & " and " & sAccount & " matches!", False
					Else
						WriteToReport micFail, "VerifyRevProAccountingEntries - Transaction Accounts Page", "Expected account information for " & sSource & " is 27540. Current account information is " & sAccount & ".", True
						VerifyRevProAccountingEntries = False
						ExitTest
					End If

				Case Else
					WriteToReport micFail, "VerifyRevProAccountingEntries - Unknown Source on Transactions tab", "Current source is " & sAccount & ", expecting a source of either ENSIM, CP, or ZUORA.", False
			End Select
'			Else
'				WriteToReport micFail, "VerifyRevProAccountingEntries - Invoice Not Loading", "Invoice page not loaded. Please ensure that the processing job has been ran.", False
'			End If
		End With
	Else
		WriteToReport micFail, "VerifyRevProAccountingEntries", "Unable to navigate to " & GlobalDictionary("MainMenuSelection5") & " from our current page. Make sure we're logged in.", True
		ExitTest
	End If
End Function

'*************************************************************************************************************
''' <summary> 
'''Verify if Invoice has been posted in Billing Header table
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>19Oct2017</datecreated>
''' <startstate>NA</startstate>
''' <endstate>N/A</endstate>
''' <returns type="NA"> </returns>
'Change Control: 
'Date of Change     Author         Description of change
'11/27/2017         Eric Trout      Moved dbquery to PSF_Database qfl
'12/27/2017			Eric Trout		Updated Validations
'01/29/2018			Eric Trout		Updated Validations for Account and DeptI
'**************************************************************************************************************
Public Function VerifyRevProBillingTables
	Dim sAccount, sBusinessUnit, sInvoice, arrResults, arrAppliedDate, arrCompare, sLineSeqNum, nBILineDetailsRowCount, nHDRBillingTableRowCount, nCurrentRowCurrentRow, i
    
    sInvoice = GlobalDictionary("Invoice")
    sBusinessUnit = GlobalDictionary("BusinessUnit")
    
    'Pull info from Query
	arrResults = dbgetRevProBillingTableHDR(sBusinessUnit, sInvoice)

    'Checks to see if results are returned as an array
    If IsArrayEmpty(arrResults) Then
	    WriteToReport micFail, "VerifyRevProBillingTables", "Query returned with no results.", False
        ExitTest    
    Else
        'Checks for Invoice first
    	If StrComp(arrResults(1), GlobalDictionary("Invoice"), vbTextCompare) = 0 Then
	    	WriteToReport micPass, "VerifyRevProBillingTables", "Invoice found in database", False
	    Else
	    	WriteToReport micFail, "VerifyRevProBillingTables", "Invoice not found in database", False
            ExitTest
	    End If

        'arrResults(0)- BUSINESS_UNIT, arrResults(1)-INVOICE,arrResults(2) -CDW_EXTRACT_DATE, arrResults(3)-CDW_APPLIED_DATE, arrResults(4)-POSTED_FLAG  
        If 	GlobalDictionary("PostedFlag") = "N" Then
            'Verifies Posted flag is N and if 
            If arrResults(4) = "N" AND arrResults(3) = "" Then
                WriteToReport micPass, "VerifyRevProBillingTables", "The Posted Flag shows N", False
            Else
                WriteToReport micFail, "VerifyRevProBillingTables", "The Posted Flag does not show N", False
            End If
        ElseIf GlobalDictionary("PostedFlag") = "Y" Then
            If arrResults(4) = "Y"AND arrResults(3) <> ""  Then
                'Verifies date if Posted Flag is Y
            	arrAppliedDate = Split(arrResults(3)," ") 
            	If CDate(arrAppliedDate(0)) = DATE Then
                    WriteToReport micPass, "VerifyRevProBillingTables", "The Posted Flag shows ["& arrResults(4) &"] and the Applied date is Today.", False
                    Exit Function
                Else
                    WriteToReport micFail, "VerifyRevProBillingTables", "The Posted Flag shows ["& arrResults(4) &"] and the Applied date shows [" & arrResult(3) &"].", False                
                    Exit Function
                End If
            Else
                WriteToReport micFail, "VerifyRevProBillingTables", "The Posted Flag shows ["& arrResults(4) &"].", False
                Exit Function
            End If
        End If
    End If

    'Sets flag for next validation when this is ran to check for Posted  
    GlobalDictionary("PostedFlag") = "Y"

    'Gets data from PS_BI_LINE_DST to validate Header details
    arrCompare = dbgetBILineDetails(sBusinessUnit, sInvoice)
    If IsArrayEmpty(arrCompare) Then
    	WriteToReport micFail, "BILineDetails", "Records not found in PS_BI_LINE_DST", False
        ExitTest
    End If    

    'Verify Header Details of Invoice
    arrResults = dbgetRevProBillingTableHDRDetails(sBusinessUnit, sInvoice)

    'Verify BUSINESS_UNIT, INVOICE , INVOICE_TYPE, BILL_SOURCE_ID,INVOICE_AMOUNT,Account, DeptID 
    If IsArrayEmpty(arrResults) Then
	    WriteToReport micFail, "VerifyRevProBillingTables", "Records not found in PS_CDW_RPBI_DT_STG", False
        ExitTest
    End If

	'GetRowcounts
	nBILineDetailsRowCount = DataTable.GetSheet("dbgetBILineDetails").GetRowCount
	nHDRBillingTableRowCount = DataTable.GetSheet("dbgetRevProBillingTableHDRDetails").GetRowCount
	If nBILineDetailsRowCount <> nHDRBillingTableRowCount Then
	    WriteToReport micFail, "VerifyRevProBillingTables", "Records returned from db tables do not match.", False
        ExitTest
	End If

	'Get Current Row
	nCurrentRowCurrentRow = DataTable.GetSheet("dbgetRevProBillingTableHDRDetails").GetCurrentRow

	'Invoice
	If DataTable.Value("INVOICE","dbgetBILineDetails") = sInvoice Then
    	WriteToReport micPass, "VerifyRevProBillingTables", "Invoice found in database [" & sInvoice &"].", False
    Else
    	WriteToReport micFail, "VerifyRevProBillingTables", "Invoice not found in database [" & sInvoice &"].", False
        ExitTest
    End If

	'Business Unit
	If DataTable.Value("BUSINESS_UNIT","dbgetBILineDetails") = sBusinessUnit Then
        WriteToReport micPass, "VerifyRevProBillingTables", "The Business Unit is verified as [" & sBusinessUnit & "]", False
    Else
        WriteToReport micFail, "VerifyRevProBillingTables", "The Business unit does not match [" & sBusinessUnit & "]", False
    End If

    'Sets Current Row to 1
    DataTable.SetCurrentRow(1) 

    'Invoice Type
    If DataTable.Value("INVOICE_TYPE","dbgetRevProBillingTableHDRDetails")  = "REG" OR  DataTable.Value("INVOICE_TYPE","dbgetRevProBillingTableHDRDetails") = "ACR" OR DataTable.Value("INVOICE_TYPE","dbgetRevProBillingTableHDRDetails") = "ARB" Then
        WriteToReport micPass, "VerifyRevProBillingTables", "The Invoice Type is verified as [" & DataTable.Value("INVOICE_TYPE","dbgetRevProBillingTableHDRDetails") & "]", False
    Else
        WriteToReport micFail, "VerifyRevProBillingTables", "The Invoice Type does not match. PS_CDW_RPBI_DT_STG shows [" & DataTable.Value("INVOICE_TYPE","dbgetRevProBillingTableHDRDetails")  & "]. Should be either REG, ACR or ARB", False
    End If    

    'Source
    If DataTable.Value("BILL_SOURCE_ID","dbgetRevProBillingTableHDRDetails")  = GlobalDictionary("Source") Then
        WriteToReport micPass, "VerifyRevProBillingTables", "The Bill Source is verified as [" & DataTable.Value("BILL_SOURCE_ID","dbgetRevProBillingTableHDRDetails") & "]", False
    Else
        WriteToReport micFail, "VerifyRevProBillingTables", "The Bill Source does not match. PS_CDW_RPBI_DT_STG shows [" & DataTable.Value("BILL_SOURCE_ID","dbgetRevProBillingTableHDRDetails") & "]. Previous Record shows [" & GlobalDictionary("Source") & "]", False
    End If      

    'Goes thru each Line Seq Number to check data in datasheets
	For i = 0 to NHDRBillingTableRowCount - 1
	
        'Sets Current Row
        DataTable.SetCurrentRow(i+1) 
		'DataTable.Value(ColumnName,SheetID)
		
		'Pull Line Seq Number for reference
		sLineSeqNum = DataTable.Value("LINE_SEQ_NUM","dbgetBILineDetails")
	
	    'Get account based on Source
		sAccount = GetSourceAccount(GlobalDictionary("Source"))
		
		'Account
		If DataTable.Value("ACCOUNT","dbgetRevProBillingTableHDRDetails") = sAccount Then
	        WriteToReport micPass, "LINE_SEQ_NUM [" & sLineSeqNum &"]", "The Account is verified as [" & DataTable.Value("ACCOUNT","dbgetRevProBillingTableHDRDetails") & "]", False
	    Else
	        WriteToReport micFail, "LINE_SEQ_NUM [" & sLineSeqNum &"]", "The Account does not match, PS_CDW_RPBI_DT_STG shows [" & DataTable.Value("ACCOUNT","dbgetRevProBillingTableHDRDetails") & "]. Account for Source should be [" & sAccount & "]", False
		End If	
		
		'DeptID
		If "00999"= DataTable.Value("DEPTID","dbgetRevProBillingTableHDRDetails") Then
	        WriteToReport micPass, "LINE_SEQ_NUM [" & sLineSeqNum &"]", "The DeptID is verified as [" & DataTable.Value("DEPTID","dbgetRevProBillingTableHDRDetails") & "]", False
	    Else
	        WriteToReport micFail, "LINE_SEQ_NUM [" & sLineSeqNum &"]", "The DeptID does not match, PS_CDW_RPBI_DT_STG shows [" & DataTable.Value("DEPTID","dbgetRevProBillingTableHDRDetails") & "]. Dept ID should be [00999]", False
		End If
		
		'Amount
		If DataTable.Value("AMOUNT","dbgetBILineDetails")= DataTable.Value("GROSS_EXTENDED_AMT","dbgetRevProBillingTableHDRDetails") Then
	        WriteToReport micPass, "LINE_SEQ_NUM [" & sLineSeqNum &"]", "The Invoice Amount is verified as [" & DataTable.Value("GROSS_EXTENDED_AMT","dbgetRevProBillingTableHDRDetails")& "]", False
	    Else
	        WriteToReport micFail, "LINE_SEQ_NUM [" & sLineSeqNum &"]", "The Invoice Amount does not match. PS_CDW_RPBI_DT_STG shows [" & DataTable.Value("GROSS_EXTENDED_AMT","dbgetRevProBillingTableHDRDetails") & "]. PS_BI_LINE_DS shows [" & DataTable.Value("AMOUNT","dbgetBILineDetails") & "]", False
		End If
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Verify the GLDistribution value in the database
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>25Oct2017</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Precondition - LaunchApplication with 3530 as the default user
'Change Control: 
'Date of Change 	Author 		Description of change
'10/25/2017			Stephen King	Created
'11/27/2017         Eric Trout      Moved dbquery to PSF_Database qfl
'**************************************************************************************************************
Public Function VerifyGLDistribution()
	Dim nResult
	Dim arrResults
	Dim sInvoice
	
    sInvoice = GlobalDictionary("Invoice")
    arrResults = dbgetDistributionStatus(sInvoice)

    'Validate that we got a return value
    On Error Resume Next
	nResult = UBound(arrResults)
	If nResult > 0 Then
    	If arrResults(0) = "D" Then
	    	WriteToReport micPass, "VerifyGLDistribution", "Invoice " & sInvoice & " confirmed in database", False
	    Else
	    	'We shouldn't ever be here, but just in case it's a variant return type
	    	On Error Goto 0
	    	WriteToReport micFail, "VerifyGLDistribution", "GL_DISTRIB_STATUS value is " & arrResults(0), False
	    	ExitTest
	    End If
	Else
		On Error Goto 0
	    WriteToReport micFail, "VerifyGLDistribution", "SQL query returned no entries", False
	    ExitTest
    End If
End Function

'**************************************************************************************************************
''' <summary> 
''' wrapper for generateJournals Function, this also handles login 
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>26-Oct-2017</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function generateJournalcopiedinvoice
Dim generateJournals1

    'Logs in
    login(GlobalDictionary("SignInUser1"))

    'completes generate journal process
    generateJournals1=generateJournals(GlobalDictionary("Invoice"),GlobalDictionary("RunControl2"))	  
    PSFinLogout()
End Function

'**************************************************************************************************************
''' <summary> 
''' RunCDWSystemProcessRequest 
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>27-Oct-2017</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'**************************************************************************************************************
Public Function RunCDWSystemProcessRequest
	Dim aProcessNum
	Dim iRowNum, i
	Dim sProcessNum, sRunId, sValue
	
	'Login as CDWBatch
	loginCDWBATCH
	
	'CDW MENU>CDW System process Request
	SelectMainMenu1(GlobalDictionary("MainMenuSelection6"))	
    Browser("creationtime:=0").Sync
    With Browser("title:=CDW System Process Request").Page("title:=CDW System Process Request")

	    'Click the Add A New Value link to get started. We will also use this link as validation that we're on the correct page
	    If .WebElement("html id:=ICTAB_1").Exist(5) Then
	    	WriteToReport micPass, "CDW System Process Request", "Currently on the CDW System Process Request page", False
	    	.WebElement("html id:=ICTAB_1").Click
	    	Browser("title:=CDW System Process Request").Sync
	    Else
	    	WriteToReport micFail, "CDW System Process Request", "Unable to verify that we are on the CDW System Process Request page.", True
	    	ExitTest
	    End If

	    'Enter a name for our run process ID
	    sRunId = "Auto" & CLng(Timer)
	    .WebEdit("html id:=PRCSRUNCNTL_RUN_CNTL_ID").Set sRunId

		'Click the Add button to take us to the Process Request Dialog page
		.WebButton("html id:=#ICSearch").Click
		Browser("title:=CDW System Process Request").Sync

		'Click the Run button, which we will also use to validate the page that we are on
		If .WebButton("html id:=PRCSRQSTDLG_WRK_LOADPRCSRQSTDLGPB").Exist(5) Then
			WriteToReport micPass, "CDW System Process Request - Run", "Currently on the CDW System Process Request page", False
			.WebButton("html id:=PRCSRQSTDLG_WRK_LOADPRCSRQSTDLGPB").Click
			Browser("title:=CDW System Process Request").Sync
		Else
			WriteToReport micFail, "CDW System Process Request - Run", "Unable to verify that we are on the CDW System Process Request page.", True
			ExitTest
		End If

		'Get the row number of the Invoice Interface to IIB process.
		iRowNum = rowNumberOfSpecificProcess(GlobalDictionary("Process")) 'CDW_INVIIBOB")		
		If iRowNum = "" Then
			WriteToReport micFail, "CDW System Process Request - Unable to locate process", "Unable to locate row containing CDW_INVIIBOB", True
			ExitTest
		End If

		'Select the checkbox returned in the previous function call
		.WebCheckBox("html id:=PRCSRQSTDLG_WRK_SELECT_FLAG\$" & iRowNum).click

		'Click the OK button located at the bottom of the window
		.WebButton("html id:=#ICSave").Click
		Browser("title:=CDW System Process Request").Sync

		'Read the Process Number
		If .WebElement("html id:=PRCSRQSTDLG_WRK_DESCR100").Exist(10) Then
			sProcessNum = .WebElement("html id:=PRCSRQSTDLG_WRK_DESCR100").GetROProperty("innertext")
			aProcessNum = split(sProcessNum, ":")
			sProcessNum = aProcessNum(1)
		End If

		'Select the Process Monitor link
		If .PSFrame("html id:=ptifrmtgtframe").Link("innertext:=Process Monitor").Exist(5) Then
			WriteToReport micPass, "CDW System Process Request - Process Monitor Link", "Process Monitor link successfully clicked", False
			.PSFrame("html id:=ptifrmtgtframe").Link("innertext:=Process Monitor").Click
			Browser("title:=CDW System Process Request").Sync
		Else
			WriteToReport micFail, "CDW System Process Request - Process Monitor Link", "Process Monitor link did not exist. Link not clicked", True
			ExitTest
		End If
	End With
	
	'Verify Process complete successfully WS Posting
	'IIB WS Posting is successful
	'Use our process number to search for the current status
	With Browser("title:=CDW System Process Request").Page("title:=Process Requests")
		.WebEdit("html id:=PMN_DERIVED_PRCSINSTANCE").Set sProcessNum
		.WebEdit("html id:=PMN_DERIVED_TO_PRCSINSTANCE").Set sProcessNum
		.WebElement("html id:=win0divREFRESH_BTN").Click

		'Confirm our run status is success
		sValue = Trim(.WebElement("html id:=win0divPMN_PRCSLIST_RUNSTATUSDESCR\$0").GetROProperty("innertext"))
        i = 0
		Do While sValue <> "Success" AND sValue <> "Warning" AND sValue <> "No Success"
			Wait 10
            i = i + 1
			'.WebElement("html id:=win0divREFRESH_BTN").Click
			.WebElement("html id:=REFRESH_BTN").Click
			sValue = Trim(.WebElement("html id:=win0divPMN_PRCSLIST_RUNSTATUSDESCR\$0").GetROProperty("innertext"))
            
            If i = 60 Then
                Exit Do
            End If
		Loop

		If sValue = "Success" Then
			WriteToReport micPass, "CDW System Process Request - Run Status", "Run status confirmed as Success", False
		Else
			WriteToReport micFail, "CDW System Process Request - Run Status", "Run status is not confirmed as Success - current run status is [" & sValue & "]. Process Instance is [" & sProcessNum & "].", True
			ExitTest
		End If

		'Confirm that our Distribution Status is posted
		sValue = Trim(.WebElement("html id:=win0divPMN_PRCSLIST_DISTSTATUS\$0").GetROProperty("innertext"))
        i = 0
		Do While sValue = "N/A" Or sValue = "Posting"
			Wait 10
            i = i + 1
			.WebElement("html id:=REFRESH_BTN").Click
			sValue = Trim(.WebElement("html id:=win0divPMN_PRCSLIST_DISTSTATUS\$0").GetROProperty("innertext"))
            If i = 60 Then
                Exit Do
            End If            
		Loop

		If sValue = "Posted" Then
			WriteToReport micPass, "CDW System Process Request - Distribution Status", "Distribution status confirmed as Posted", False
		Else
			WriteToReport micFail, "CDW System Process Request - Distribution Status", "Distribution status is not confirmed as Posted - current distribution status is " & sValue & "]. Process Instance is [" & sProcessNum & "].", True
			ExitTest
		End If
		.WebElement("html id:=#ICSave").Click
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Returns 
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>30-Oct-2017</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'12/07/2017         Eric Trout     Updated for NonRevRec tests
'*************************************************************************************************************
Public Function GetSourceAccount(Source)

    Select Case UCASE(Source)
	    'Write Off Clearing Account
	    Case "WRITEOFF"
	        GetSourceAccount = "27544"
	    'RevPro Zuora Clearing Account
	    Case "ZUORA"
	        GetSourceAccount = "27543"
	    'RevPro iSeries Clearing Account
	    Case ""
	        GetSourceAccount = "27542"
	    'RevPro Ensim Clearing Account
	    Case "ENSIM"
	        GetSourceAccount = "27541"
	    'RevPro CP Clearing Account
	    Case "CP"
	        GetSourceAccount = "27540"
        Case "NONREVREC"
            GetSourceAccount = "NONREVREC"
        Case Else
            WriteToReport micFail, "GetSourceAccount", "Source not found check data.", false
            ExitTest  
    End Select

End Function

'**************************************************************************************************************
''' <summary> 
'''Verify if WO has been posted in  Header table
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>10Nov2017</datecreated>
''' <startstate>NA</startstate>
''' <endstate>N/A</endstate>
''' <returns type="NA"> </returns>
'Change Control: 
'Date of Change     Author         Description of change
'11/27/2017         Eric Trout     Moved SQL query to PSFIN_Database.qfl
'12/05/2017         Eric Trout     Updated using proper validations
'12/07/2017         Eric Trout     Updated for NonRevRec tests
'*************************************************************************************************************
Public Function ValidateWOHDR
	Dim  arrAppliedDate, arrItemActivity, arrItemDetails ,  arrExtrDate, arrPostDate, arrResult
	Dim sAccount, sBusinessUnit, sCustID, sItem, sItem_Line, sItem_Seq, sWOType, nResult

    sBusinessUnit = GlobalDictionary("BusinessUnit")
    sCustID = GlobalDictionary("CustID")
    sItem = GlobalDictionary("ITEM")
    sWOType = GlobalDictionary("WOType")

    'Pull DB Results for PS_ItemActivity Table 
    arrItemActivity =dbgetItemActivity(sCustID, sItem, sWOType)
    If IsArrayEmpty(arrItemActivity) Then
	    WriteToReport micFail, "ValidateWOHDR", "Query for PS_Item_Activity Table returned empty.", false
        ExitTest
    End If
    
    sItem_Line = arrItemActivity(3)
    sItem_Seq = arrItemActivity(4)
    
    'Get account based on Source
    sAccount = GetSourceAccount(GlobalDictionary("Source")) 
    
    'Pull DB results for WOHDR
    arrResult = dbgetWOHDR(sBusinessUnit, sCustID, sItem, sItem_Line, sItem_Seq)

    'Checks to see if results are returned
    If IsArrayEmpty(arrResult) AND UCASE(sAccount) = "NONREVREC" Then
  	    WriteToReport micPass, "ValidateWOHDR NonRevRec", "Query for PS_CDW_RPAR_HD_STG Table returned empty as expected.", False
        Exit Function 
    ElseIf UCASE(sAccount) = "NONREVREC" AND NOT(IsArrayEmpty(arrResult)) Then  
 	    WriteToReport micFail, "ValidateWOHDR NonRevRec", "Query for PS_CDW_RPAR_HD_STG Table returned with results.", False
        Exit Function     
    ElseIf IsArrayEmpty(arrResult) Then
 	    WriteToReport micFail, "ValidateWOHDR", "Query for PS_CDW_RPAR_HD_STG Table returned empty.", False
        ExitTest
    Else
        'Checks for CustID first
    	If StrComp(arrResult(1), arrItemActivity(1), vbTextCompare) = 0 Then
	    	WriteToReport micPass, "ValidateWOHDR", "CustID verified as ["& arrItemActivity(1), False
	    Else
	    	WriteToReport micFail, "ValidateWOHDR", "CustID does not match. PS_CDW_RPAR_HD_STG  shows ["&arrResult(1)&"]. PS_ITEM_ACTIVITY shows ["& arrItemActivity(1) &"]", False
            ExitAction
	    End If

        'arrResult(0)- BUSINESS_UNIT, arrResults(1)-CustID,arrResult(2)-ITEM , arrResult(3)-ITEM_LINE, arrResult(5)-CDW_EXTRACT_DATE arrResult(6) - CDW_APPLIED_DATE, arrResult(7)-POSTED_FLAG  
        If 	UCASE(GlobalDictionary("PostedFlag")) = "N" Then
            
            'Verifies Posted flag is N and Applied date is NULL (blank)
            If TRIM(arrResult(7)) = "N" AND arrResult(6) = "" Then
                WriteToReport micPass, "ValidateWOHDR", "The Posted Flag shows N with an applied date of NULL", False
            Else
                WriteToReport micFail, "ValidateWOHDR", "The Posted Flag shows ["& arrResult(7) &"].  Applied Date shows [" &arrResult(6) &"].", False
            End If 
 
          'Verify Business Unit    
            If arrResult(0) = arrItemActivity(0)  Then
                WriteToReport micPass, "ValidateWOHDR", "The Business Unit is verified as ["&arrResult(0)& "]", False
            Else
                WriteToReport micFail, "ValidateWOHDRD", "The Business unit does not match.  Business unit retrieved is ["&arrResult(0)&"]", False
            End If

            'Verify Item
            If arrResult(2) = arrItemActivity(2) Then
                WriteToReport micPass, "ValidateWOHDR", "The Item is verified as ["&arrResult(2)&"]", False
            Else
                WriteToReport micFail, "ValidateWOHDR", "The Item does not match. PS_CDW_RPAR_HD_STG  shows ["&arrResult(2)&"]. PS_ITEM_ACTIVITY shows ["& arrItemActivity(2) &"]", False
            End If

            'Verify Item_Line
            If arrResult(3) = arrItemActivity(3)  Then
                WriteToReport micPass, "ValidateWOHDR", "The ITem Line is verified as ["&arrResult(3)&"]", False
            Else
                WriteToReport micFail, "ValidateWOHDR", "The Item Line does not match. PS_CDW_RPAR_HD_STG shows ["& arrResult(3) &"]. PS_ITEM_ACTIVITY shows ["&arrItemActivity(3) &"]", False
            End If

            'ITEM_SEQ_NUM                    
            If arrResult(4) = arrItemActivity(4)  Then
                WriteToReport micPass, "ValidateWOHDR", "The ITEM_SEQ_NUM is verified as ["&arrResult(4)&"]", False
            Else
                WriteToReport micFail, "ValidateWOHDR", "The ITEM_SEQ_NUM does not match. PS_CDW_RPAR_HD_STG shows ["&arrResult(4)&"]. PS_ITEM_ACTIVITY shows ["&arrItemActivity(4) &"]", False
            End If
 
            arrExtrDate = Split(arrResult(5)," ") 
            If CDate(arrExtrDate(0)) = DATE Then
                WriteToReport micPass, "ValidateWOHDR", "The Extracted date is Today.", False
            Else
                WriteToReport micFail, "ValidateWOHDR", "The Extractedd date does not match with Today ["& DATE &". it is Showing [" &CDate(arrExtrDate(0)) &"]", False
            End If

            'Get db record for Item Details
            arrItemDetails = dbgetItemDetails(sBusinessUnit, sCustID, sItem, sItem_Line, sItem_Seq)
           If IsArrayEmpty(arrItemDetails) Then                            
               WriteToReport micFail, "ValidateWOHDRDetails", "Query for PS_ITEM_DST Table returned empty.", False
               ExitTest
           End If

            'Get db record for WOHDRDetails
             arrResult = dbgetWOHDRDetails(sBusinessUnit, sCustID, sItem, sItem_Line, sItem_Seq)

            'Verify WOHDRDetails              
            If IsArrayEmpty(arrResult) Then                            
                WriteToReport micFail, "ValidateWOHDRDetails", "Query for PS_CDW_RPAR_DT_STG  Table returned empty.", False
                ExitTest
            Else
                'Verfy ENTRY_AMT with MONETARY_AMOUNT calculate to 0
                nResult = CInt(arrItemDetails(36)) + Cint(arrResult(7))
                If nResult = 0 Then
                    WriteToReport micPass, "ValidateWOHDRDetails", "The ENTRY_AMT is verified as ["&arrResult(7)&"]", False
                Else
                    WriteToReport micFail, "ValidateWOHDRDetails", "The ENTRY_AMT does not match PS_CDW_RPAR_DT_STG  shows["&arrResult(7)&"]. Monetary Amount from PS_ITEM_DST shows ["& arrItemDetails(36) &"]", False
                End If

                'Verify POST_DT compare to 
                'arrPostDate = Split(arrResult(8)," ") 
                If CDate(arrResult(8)) = DATE Then
                    WriteToReport micPass, "ValidateWOHDRDetails", "The POST_DATE is verified as ["&arrResult(8)&"]", False    
                Else
                    WriteToReport micFail, "ValidateWOHDRDetails", "The POST_DATE does not match PS_CDW_RPAR_DT_STG shows ["& arrResult(8) &"].  It should be todays date. ["& DATE &"]", False
                End If

                'Verify ACCOUNTING_DT
                If arrResult(9) = arrItemDetails(45) Then
                    WriteToReport micPass, "ValidateWOHDRDetails", "The ACCOUNTING_DT is verified as ["&arrResult(9)&"]", False    
                Else
                    WriteToReport micFail, "ValidateWOHDRDetails", "The ACCOUNTING_DT does not match PS_CDW_RPAR_DT_STG shows ["&arrResult(9)&"]", False
                End If

                'Verify BUSINESS_UNIT_GL
                If arrResult(10) = arrItemDetails(11) Then
                    WriteToReport micPass, "ValidateWOHDRDetails", "The BUSINESS_UNIT_GL is verified as ["&arrResult(10)&"]", False    
                Else
                    WriteToReport micFail, "ValidateWOHDRDetails", "The BUSINESS_UNIT_GL does not match PS_CDW_RPAR_DT_STG shows ["&arrResult(10)&"]", False
                End If

                'Verify ACCOUNT
                If arrResult(0) = sAccount AND sAccount = arrItemDetails(0) Then
                    WriteToReport micPass, "ValidateWOHDRDetails", "The Account is verified as ["&arrResult(0)&"]", False
                Else
                    WriteToReport micFail, "ValidateWOHDRDetails", "The Account does not match PS_CDW_RPAR_DT_STG shows ["&arrResult(0)&"]. PS_ITEM_DST shows ["&arrItemDetails(0) &"]", False
                End If

                'Verify DEPTID 
                If arrResult(1) = arrItemDetails(1) Then
                    WriteToReport micPass, "ValidateWOHDRDetails", "The DEPTID is verified as ["&arrResult(1)&"]", False    
                Else
                    WriteToReport micFail, "ValidateWOHDRDetails", "The DEPTID does not match PS_CDW_RPAR_DT_STG ["&arrResult(1)&"] PS_ITEM_DST shows [" &arrItemDetails(1) & "].", False
                End If

                'Verify CHARTFIELD1
                If arrResult(13) = arrItemDetails(24) Then
                    WriteToReport micPass, "ValidateWOHDRDetails", "The CHARTFIELD1 is verified as ["&arrResult(13)&"]", False    
                Else
                    WriteToReport micFail, "ValidateWOHDRDetails", "The CHARTFIELD1 does not match PS_CDW_RPAR_DT_STG ["&arrResult(13)&"] PS_ITEM_DST shows [" &arrItemDetails(24) & "].", False
                End If

                'Verify USER2
                If Trim(arrResult(14)) = Trim(arrItemDetails(61)) Then
                    WriteToReport micPass, "ValidateWOHDRDetails", "The USER2 is verified as ["& Trim(arrResult(14)) &"]", False    
                Else
                    WriteToReport micFail, "ValidateWOHDRDetails", "The USER2 does not match PS_CDW_RPAR_DT_STG shows ["& Trim(arrResult(14)) &"] PS_ITEM_DST shows [" & Trim(arrItemDetails(61)) & "].", False
                End If

                'Verify ALTACCT -  Blank 
                If arrResult(15) = arrItemDetails(13) Then
                    WriteToReport micPass, "ValidateWOHDRDetails", "The ALTACCT is verified as ["&arrResult(15)&"]", False    
                Else
                    WriteToReport micFail, "ValidateWOHDRDetails", "The ALTACCT does not match PS_CDW_RPAR_DT_STG shows ["&arrResult(15)&"] PS_ITEM_DST shows [" &arrItemDetails(13) & "].", False
                End If

                'Verify OPERATING_UNIT 
                If arrResult(16) = arrItemDetails(15) Then
                    WriteToReport micPass, "ValidateWOHDRDetails", "The OPERATING_UNIT is verified as ["&arrResult(16)&"]", False    
                Else
                    WriteToReport micFail, "ValidateWOHDRDetails", "The OPERATING_UNIT  does not match PS_CDW_RPAR_DT_STG shows ["&arrResult(16)&"] PS_ITEM_DST shows [" &arrItemDetails(15) & "].", False
                End If

				'Verify PRODUCT 
                If arrResult(17) = arrItemDetails(16) Then
                    WriteToReport micPass, "ValidateWOHDRDetails", "The PRODUCT is verified as ["&arrResult(17)&"]", False    
                Else
                    WriteToReport micFail, "ValidateWOHDRDetails", "The PRODUCT does not match PS_CDW_RPAR_DT_STG shows ["&arrResult(17)&"] PS_ITEM_DST shows [" &arrItemDetails(16) & "].", False
                End If

                'Verify FUND_CODE
                If arrResult(18) = arrItemDetails(17) Then
                    WriteToReport micPass, "ValidateWOHDRDetails", "The FUND_CODE is verified as ["&arrResult(18)&"]", False    
                Else
                    WriteToReport micFail, "ValidateWOHDRDetails", "The FUND_CODE does not match PS_CDW_RPAR_DT_STG shows ["&arrResult(18)&"] PS_ITEM_DST shows [" &arrItemDetails(17) & "].", False
                End If

                'VerifyCLASS_FLD
                If arrResult(19) = arrItemDetails(18) Then
                    WriteToReport micPass, "ValidateWOHDRDetails", "The CLASS_FLD is verified as ["&arrResult(19)&"]", False    
                Else
                    WriteToReport micFail, "ValidateWOHDRDetails", "The CLASS_FLD does not match PS_CDW_RPAR_DT_STG shows ["&arrResult(19)&"] PS_ITEM_DST shows [" &arrItemDetails(18) & "].", False
                End If

                'Sets flag for next validation when this is ran to check for Posted  
                 GlobalDictionary("PostedFlag") = "Y"
            End If
        ElseIf GlobalDictionary("PostedFlag") = "Y" Then
	
            'Convert Applied Date to regular date for comparison           
            If arrResult(7) = "Y" AND arrResult(6) <> ""  Then
            	'Verifies date if Posted Flag is Y
            	arrAppliedDate = Split(arrResult(6)," ") 
            	If CDate(arrAppliedDate(0)) = DATE Then
                	WriteToReport micPass, "ValidateWOHDR", "The Posted Flag shows [Y] and the Applied date is Today", False
                Else
                	WriteToReport micFail, "ValidateWOHDR", "The Posted Flag shows [Y] and the Applied date does not math with Today. Showing [" &arrResult(6) &"]", False
				End If
            Else
                WriteToReport micFail, "ValidateWOHDR", "The Posted Flag does not show Y", False
            End If
        Else
            WriteToReport micFail, "ValidateWOHDR", "The Posted Flag is Empty, check datasheet.", False    
        End If
    End If
End Function

'**************************************************************************************************************
''' <summary> 
''' Approves the selected WriteOff operation
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>13-Nov-2017</datecreated>
''' <startstate>Call after GetWOItem</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'11/17/2017			Stephen King	Updated reporter statements for all objects and actions
'12/14/2017         Jolly Thomas	Updated to add ApprovalRequired option for NonRev C02 tests with Reason INTCO
'05/22/2018			Eric Trout		Updated so Worksheet id is checked for and clicked 
'02/27/2019			Eric Trout		Updated to use OR instead of descriptive
'05/07/2019			Zach Apple 		Updated to add NoPost option
'05/08/2019			Zach Apple 		Updated to close Report Index tab
'**************************************************************************************************************
Public Function ApproveWriteOff
	Dim BU, sRunStatus , sProcessInstance, sWorksheetID, ApprovalRequired, NoPost

	BU = GlobalDictionary("BusinessUnit")
	sWorksheetID = GlobalDictionary("WorksheetId")
	ApprovalRequired = GlobalDictionary("ApprovalRequired")
	NoPost = GlobalDictionary("NoPost")
	If ApprovalRequired <> "N" Then

		'Login as assigned approver from worksheet.
		Login(GlobalDictionary("ApprovedUser"))

		'Navigate to the proper destination 'Select Navigator/WorkList/WorkList
		If SelectMainMenu1(GlobalDictionary("ApproveWriteoff")) = True Then
			WriteToReport micPass, "ApproveWriteOff - Menu Navigation", "Successfully navigated to the proper page", False
		Else
			WriteToReport micFail, "ApproveWriteOff - Menu Navigation", "Unable to successfully navigate to the proper page", True
			ExitTest
		End If

		'Eric is passing in "WorksheetId" globally if needed
		With Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist")
			If .Link("DateFrom").Exist(5) Then
				'Click on "Date From" twice to sort by date. First click puts oldest on top, second click puts newest on top
				.Link("DateFrom").Click
				
				.Link("DateFrom").Click
				
				WriteToReport micPass, "ApproveWriteOff - Sort By Date", "Successfully sorted by date.", False
			Else
				WriteToReport micFail, "ApproveWriteOff - Sort By Date", "Unable to sort by date.", True
				ExitTest
			End If

			'Checks to see if Worksheet link is there and clicks on it
			If .Link("innertext:=.*" & GlobalDictionary("WorksheetId") &".*").exist(60) Then
			
				.Link("innertext:=.*" & GlobalDictionary("WorksheetId") &".*").Click
			Else
				WriteToReport micFail, "ApproveWriteOff - Click Link", "Link for Worksheet ID ["& GlobalDictionary("WorksheetId")& "]  is not diaplayed.", True
				ExitTest
			End If
		End With

		With Browser("PeopleSoft Browser").Page("Update Worksheet")

			'Enter Notes in 'Approver Comments' Box
			If .WebEdit("Comments").Exist(20) Then
				.WebEdit("Comments").Set ""
				WriteToReport micPass, "ApproveWriteOff - Approver Comments", "Approver comments successfully entered.", False
			Else
				WriteToReport micFail, "ApproveWriteOff - Approver Comments", "Approver comments field not found.", True
				ExitTest
			End If

			'Click on Approve button
			If .WebButton("Approve").Exist(20) Then
				.WebButton("Approve").Click
				WriteToReport micPass, "ApproveWriteOff - Approve Button", "Approve button successfully clicked.", False
			Else
				WriteToReport micFail, "ApproveWriteOff - Approve Button", "Approve button not found.", True
				ExitTest
			End If

	        'Verify Approved
	        If .Link("Approved Write-Off").Exist(10) Then          
	                WriteToReport micPass, "ApproveWriteOff", "Writeoff shows as Approved.", False
			Else
				WriteToReport micFail, "ApproveWriteOff", "Writeoff did not show as Approved.", True
				ExitTest
	        End If

	        'Click on Worksheet Action Link
	        .Link("Worksheet Action").Click
	   End With
	End If

	If NoPost <> "TRUE" Then
		'Logs in user for Post
	    login(GlobalDictionary("SignInUser2"))
		If SelectMainMenu1(GlobalDictionary("FinalizeWorksheet")) = True Then   
			Call WriteToReport (micPass, "Menu Navigation", "On Finalized Worksheet page.", False)
		Else
			Call WriteToReport (micFail, "Menu Navigation", "Navigation Failed.", True)  
			ExitTest
		End If
	     
		With Browser("PeopleSoft Browser").Page("Finalize Worksheet")

	   		'Search for Worksheet
	   		.Webedit("Business Unit").set BU
	   		.Webedit("WorksheetID").Set sWorksheetID
	   		.Webbutton("Search").Click
	   		
			'Link is automatically selected   		
	        'Verify on Worksheet Action Page
	        If .WebList("Posting Action").Exist(30) Then
	           Call WriteToReport (micPass, "Worksheet Action", "Page is displayed.", False)
	        Else
	           Call WriteToReport (micFail, "Worksheet Action", "Page is not displayed.", True)  
	           ExitTest
	        End If

	        'Change Weblist to Post Now
	        .WebList("Posting Action").Select "Post Now"

	        'Click OK
	        .WebButton("OK").Click

	        'Click Save
	        '.WebButton("Save").Click
		End With

	   'Wait for job to finish
		With  Browser("creationtime:=1").Page("title:=Report Index")
			If .Exist(300) Then
				Call WriteToReport (micPass, "Posted", "Job for Posting completed.", False)

				'Grab Run Status
				sRunStatus = .WebElement("html id:=CDM_WRK_RUNSTATUS").GetROProperty("innertext")

				'Grab Process Instance
				sProcessInstance = .WebElement("html id:=CDM_LIST_VW_PRCSINSTANCE").GetROProperty("innertext")
				If sRunStatus = "Success" Then
					Call WriteToReport (micPass, "Posted", "Status is showing Success. Process Instance is [" & sProcessInstance &"]", False)
				Else	
					Call WriteToReport (micFail, "Posted", "Status is showing [" & sRunStatus & "]. Process Instance is [" & sProcessInstance &"]", True)
				End If
			Else
	           Call WriteToReport (micFail, "Posted", "Page for Report on Posting job never displayed.", True)  
	           ExitTest
			End If		  
		End With
		Browser("creationtime:=1").Close
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' processFSJGEN Function is to generate journals running only FS_JGEN process
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>06-Dec-17</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'12/06/2017			Eric Trout		Pulled out FS_JGEN process of generate Joounal
'**************************************************************************************************************
Public Function processFSJGEN
    Dim runcontrol

    runcontrol = GlobalDictionary("RunControl2")

    'Logs in
    login(GlobalDictionary("SignInUser1"))

	'Generate Journals
	If Browser("creationtime:=0").page("index:=1").Link("innertext:=Home").exist(10) Then
		Browser("creationtime:=0").page("index:=1").Link("innertext:=Home").Click
	End If

	If SelectMainMenu1(GlobalDictionary("MainMenuSelection3")) Then
		WriteToReport micPass, "Generate Journals Page is Loaded Successfully", "", True
	Else
		WriteToReport micFail, "Generate Journals Page is not Loaded Successfully", "", True
	End If

    If Not Browser("CreationTime:=0").Page("index:=1").WebEdit("html id:=PRCSRUNCNTL_RUN_CNTL_ID").Exist(10) Then
    End If
    
	'Set RunControl field
	setValue_WebEdit getObjectInfoFromXML("Runcontrol_Webedit", objectsFile, "Value"), runcontrol, False, getObjectInfoFromXML("Runcontrol_Webedit", objectsFile, "Description")
	btn_click getObjectInfoFromXML("Search_RunControlId_Btn", objectsFile, "Value"), getObjectInfoFromXML("Search_RunControlId_Btn", objectsFile, "Description")

	'Sets Journal Processing Option to Edit
	check_CheckBox getObjectInfoFromXML("Edit_JournalProcessingOption_CHKBox", objectsFile, "Value"), getObjectInfoFromXML("Edit_JournalProcessingOption_CHKBox", objectsFile, "Description")

	'Sets Journal Processing Option to Post if specified in Datasheet
	If GlobalDictionary.Exists("Post_Journal") = True AND GlobalDictionary.Exists("Post_Journal") = "Y" Then
		check_CheckBox getObjectInfoFromXML("Edit_JournalProcessingOption_CHKBox", objectsFile, "Value"), getObjectInfoFromXML("Post_JournalProcessingOption_CHKBox", objectsFile, "Description")
	End If

	'Sets Process Frequency to Always
	Verify_ClickRadioBtn getObjectInfoFromXML("Always_ProcessFrequency_RadioBtn", objectsFile, "Value"), getObjectInfoFromXML("Always_ProcessFrequency_RadioBtn", objectsFile, "Description"), "A"

	'Puts SetID to SHARE - Corporate SetID
	setValue_WebEdit getObjectInfoFromXML("SetID_PRP_TXT", objectsFile, "Value"), "SHARE", False, getObjectInfoFromXML("SetID_PRP_TXT", objectsFile, "Description")

	'Set Accounting Definition Name
	If GlobalDictionary.Exists("AccountingDefinition") = False Then
		setValue_WebEdit getObjectInfoFromXML("AccountingDefinitionName_TXT", objectsFile, "Value"),"BIDEFN", False, getObjectInfoFromXML("AccountingDefinitionName_TXT", objectsFile, "Description")
	Else
		setValue_WebEdit getObjectInfoFromXML("AccountingDefinitionName_TXT", objectsFile, "Value"), GlobalDictionary("AccountingDefinition"), False, getObjectInfoFromXML("AccountingDefinitionName_TXT", objectsFile, "Description")
	End If

	'Sets Business Unit
	setValue_WebEdit getObjectInfoFromXML("ApplicationUnit_TXT", objectsFile, "Value"), GlobalDictionary("BusinessUnit"), False, getObjectInfoFromXML("ApplicationUnit_TXT", objectsFile, "Description")

	'Sets Ledger Group
	setValue_WebEdit getObjectInfoFromXML("Ledgergrp_weblist", objectsFile, "Value"), GlobalDictionary("Ledgergrp"), False, getObjectInfoFromXML("Ledgergrp_weblist", objectsFile, "Description")
	WebList_select getObjectInfoFromXML("FromDateOption_weblist", objectsFile, "Value"), "Begin Date - From Period", getObjectInfoFromXML("FromDateOption_weblist", objectsFile, "Description")
	WebList_select getObjectInfoFromXML("ToDateOption_weblist", objectsFile, "Value"), "End Date - To Period", getObjectInfoFromXML("ToDateOption_weblist", objectsFile, "Description")
	btn_click getObjectInfoFromXML("Run_SingleActionInvoice_btn", objectsFile, "Value"), getObjectInfoFromXML("Run_SingleActionInvoice_btn", objectsFile, "Description")
	If Browser("CreationTime:=0").Page("index:=1").PSFrame("html id:=ptModFrame_0").WebElement("innerhtml:=User ID","html tag:=SPAN").Exist(30) Then
		WriteToReport micPass, "Process Scheduler Page", "Process Scheduler Page is Loaded Successfully", False
	Else
		WriteToReport micFail, "Process Scheduler Page", "Process scheduler Page is not Loaded Successfully", True
	End If

	check_CheckBox getObjectInfoFromXML("FS_JGEN_ProcessScheduler", objectsFile, "Value"), getObjectInfoFromXML("FS_JGEN_ProcessScheduler", objectsFile, "Description")
	btn_click getObjectInfoFromXML("OK_ProcessScheduler_btn", objectsFile, "Value"), getObjectInfoFromXML("OK_ProcessScheduler_btn", objectsFile, "Description")	
	Wait 8
	Dim processInstanceObj, processInstance
	Set processInstanceObj = Browser("creationtime:=0").Page("index:=1").WebElement("innertext:=Process Instance:.*","index:=1")
	processInstance = split(processInstanceObj.GetROProperty("innertext"),":")(1)
	btn_click getObjectInfoFromXML("ProcessMonitor_link", objectsFile, "Value"), getObjectInfoFromXML("ProcessMonitor_link", objectsFile, "Description")
	If Browser("creationtime:=0").Page("index:=1").PSFrame("html id:=ptifrmtgtframe").webbutton("name:=Refresh","html id:=REFRESH_BTN").Exist(30) Then
		WriteToReport micPass, "Process Monitor Page", "Process Monitor Page is Loaded Successfully", False
	Else
		WriteToReport micFail, "Process Monitor Page", "Process Monitor Page is not Loaded Successfully", True
	End If

	Wait 3
	Dim runStatus, ProcessInstance1, tblPageObj
	runStatus = getStatus(processInstance,"")
	
	'Capture the Process Instance
	Set tblPageObj = Browser("creationtime:=0").page("index:=1")
	If countOfElements(tblPageObj, "WebElement", "html id", "html tag", "PMN_PRCSLIST_PRCSINSTANCE.*", "SPAN", "Details Column is Populated with Details link on for each process listed", False) > 0 Then
		ProcessInstance1=getObjFromMultipleObjs(tblPageObj, "WebElement", "html id", "html tag", "PMN_PRCSLIST_PRCSINSTANCE.*", "SPAN", "Details Column is Populated with Details link on for each process listed",0).GetroProperty("innertext")
		If Trim(ProcessInstance1) <> "" Then
			WriteToReport micPass, "ProcessInstance", "ProcessInstance Captured is " & ProcessInstance1, False
		Else
			WriteToReport micFail, "ProcessInstance", "ProcessInstance is not captured", True
		End If
	End If

	If Browser("creationtime:=0").page("index:=1").Link("innertext:=Home").exist Then
		Browser("creationtime:=0").page("index:=1").Link("innertext:=Home").Click
	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' SetupRevProInputFile Function is to read from a processed transaction file and update it to our current project, as well as create a copy at a new location
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>11-Dec-17</datecreated>
''' <startstate>We need a file or directory to check</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 			Description of change
'12/12/2017			Stephen King	Updated to data table and stored business unit as well as transaction ID
'01/03/2018			Stephen King	Updated directory loop to include REVPRO and exit the test earlier if no file is found
'**************************************************************************************************************
Public Function SetupRevProInputFile
	Dim objFSO, objFolder, objFiles, oFile, f, sDate, sTime
	Dim strTextFileName, strNewFileName, strData, strCurrentRow, strReadFile, strWriteFile, strTemp, strDirectoryPath, strNetworkPath, strNetworkFile, strTextFileNameFullPath, strNewFileNameFullPath
	Dim strLeft, strRight, sTransactionID
	Dim i
	Dim arrProperties, aDate
	Dim bError

	'Used for testing our journal validation
	'ValidateRevPro_PSF_GL "00001", "ADX0012850", "VAD0173807"

	'We will be pulling the transaction ID from the shared file for each test
	sTransactionID = ReadTransactionID
	GlobalDictionary("TransactionID") = sTransactionID

	'Ensure that we have a valid transaction ID before we start running the test
	If sTransactionID <> "" Then
		WriteToReport micPass, "SetupRevProInputFile - Transaction ID", "Transaction ID successfully read: " & sTransactionID, False
	Else
		WriteToReport micFail, "SetupRevProInputFile - Transaction ID", "Transaction ID not found. Please check data sheet at " & Environment("TransactionIdPath"), False
		ExitTest
	End If

	'Store the path that our text files are stored at since the test will be ran in a different location
	'strDirectoryPath = "C:\"
	strDirectoryPath = Environment("RevRecInputFolder") & GlobalDictionary("Directory") & "\"

	'Create our object for interacting with files
	Set objFSO = CreateObject("Scripting.FileSystemObject")

	'Assign the working directory to an object
	Set objFolder = objFSO.GetFolder(strDirectoryPath)

	'Get a list of the files in our directory
	Set objFiles = objFolder.Files
	For Each f in objFiles

		'Ensure that we are working on a RevPro text file and not a miscellaneous one in the folder
		If InStr(1, f.Name, "REVPRO", vbTextCompare) >= 1 AND InStr(1, f.Name, "txt", vbTextCompare) >= 1 Then
			'strTemp = f.DateCreated
			strTemp = Mid(f.DateCreated, 2, Len(f.DateCreated) - 1) 
			arrProperties = Split(strTemp, " ")

			'If this is our first file, we will use it as a baseline
			If sDate = "" Then
				sDate = arrProperties(0)
				sTime = arrProperties(1) & arrProperties(2)
				Set oFile = f

			'If our file is a more recent date than our previous one, use that. No need to compare the timestamp.
			ElseIf (CStr(arrProperties(0)) > sDate) = True Then
				sDate = arrProperties(0)
				sTime = arrProperties(1) & arrProperties(2)
				Set oFile = f

			'If they're the same date, then we compare times and update if we have a newer one
			ElseIf (CStr(arrProperties(0)) = sDate) = True AND (CStr(arrProperties(1) & arrProperties(2)) > sTime) = True Then
				sDate = arrProperties(0)
				sTime = arrProperties(1) & arrProperties(2)
				Set oFile = f
			End If
		End If
	Next

	'Exit our test run if we don't have a file to work with
	If oFile <> "" Then
		WriteToReport micPass, "REVPRO file found", "Ready to start processing REVPRO file " & oFile.Name & " in location " & strDirectoryPath & ".", False
	Else
		WriteToReport micFail, "No REVPRO file found to process", "Unable to find a REVPRO file to process in location " & strDirectoryPath & ".", False
		ExitTest
	End If

	'Assign our text file for reading - will update to a directory or GlobalDictionary once we know for sure
	'Example file name = "REVPRO_20171127_RP00000822_2017-11-27-12.25.28.000000.txt"
	strTextFileName = oFile.Name

	'Rename our new text file with our new project code.
	strNewFileName = strTextFileName

	'This replaces the original project code(RP) with the new one (RG), starting at the first position of the string, one time, and only if it matches case exactly
	strNewFileName = Replace(strNewFileName, "RP", GlobalDictionary("Project"), 1, 1, vbBinaryCompare)

	'Replace the transaction ID in the filename with our new transaction ID
	i = InStr(1, strNewFileName, GlobalDictionary("Project"), vbBinaryCompare)
	If i >= 0 Then
		WriteToReport micPass, "Project code in filename updated", "Project code successfully changed to " & GlobalDictionary("Project"), False
	Else
		WriteToReport micFail, "Project code in filename not updated", "Project code was not successfully changed to " & GlobalDictionary("Project"), False
		ExitTest
	End If

	'We want the last character of the search string, so if position i is at R, i + 1 is at G
	i = i + 1

	'Take the first i characters of the string, ending at RG
	strLeft = Left(strNewFileName, i)

	'Add our new transaction ID
	strNewFileName = strLeft & sTransactionID & ".txt"

	'Take the remaining characters - total length minus the length of strLeft minus 8, which is the length of our transaction ID
	'strRight = Right(strNewFileName, len(strNewFileName) - len(strLeft) - 8)
	'Compare and store our new string if it matches, stop otherwise
	'If Len(strTextFileName) = Len(strLeft & sTransactionID & strRight) Then
	'	WriteToReport micPass, "New filename matches after replacing Transaction ID", strLeft & sTransactionID & strRight, False
	'	strNewFileName = strLeft & sTransactionID & strRight
	'Else
	'	WriteToReport micFail, "New filename does not match after replacing Transaction ID", strTextFileName & " compared to " & strLeft & sTransactionID & strRight, False
	'	ExitTest
	'End If
	
	'Store our file paths that we will be using for the remainder of the function with the processed strings
	'Original file - doesn't change
	strTextFileNameFullPath = strDirectoryPath & strTextFileName

	'Store our network file location
	'strNetworkPath = "C:\Network\"
	strNetworkPath = Environment("TestDataNetworkPathPart1") & Environment("Environment") & Environment("TestDataNetworkPathPart2")
	strNetworkFile = strNetworkPath & strNewFileName

	'Store our new file location
	strNewFileNameFullPath = strDirectoryPath & strNewFileName

	'Ensure that our document exists before we start any work on it
	If objFSO.FileExists(strTextFileNameFullPath) Then
		WriteToReport micPass, "SetupRevProInputFile - File Exists", "Original file " & strTextFileNameFullPath & " exists.", False
	Else
		WriteToReport micFail, "SetupRevProInputFile - File Does Not Exist", "Original file " & strTextFileNameFullPath & " does not exist. Exiting test.", False
		ExitTest
	End If

	'Create our new test file, overwriting if it already exists due to, for example, a previous run not finishing
	objFSO.CreateTextFile strNewFileNameFullPath, True

	'Ensure that our file was created successfully
	If objFSO.FileExists(strNewFileNameFullPath) Then
		WriteToReport micPass, "SetupRevProInputFile - File Created", "New file " & strNewFileNameFullPath & " created.", False
	Else
		WriteToReport micFail, "SetupRevProInputFile - File Not Created", "New file " & strNewFileNameFullPath & " was not created. Exiting test.", False
		ExitTest
	End If

	'Open the original file for reading only
	Set strReadFile = objFSO.OpenTextFile(strTextFileNameFullPath, 1)

	'Open the new file for writing. MEMO - If this causes memory issues, then we will write to the datatable and only have one file opened at a time.
	Set strWriteFile = objFSO.OpenTextFile(strNewFileNameFullPath, 2)

	'We will be storing our data in the datatable, so ensure that we are on row 1
	i = 1
	DataTable.LocalSheet.SetCurrentRow(i)

	'We will be replacing the date with the current date, in YYYY-MM-DD format
	aDate = Split(Date, "/")
	
	'Depending on user/machine settings, sometime the month is MM, sometimes just D, so we add a leading zero if needed
	If Len(aDate(0)) = 2 Then
		sDate = aDate(2) & "-" & aDate(0)
	Else
		sDate = aDate(2) & "-0" & aDate(0)
	End If

	'Depending on user/machine settings, sometime the date is DD, sometimes just D, so we add a leading zero if needed
	If Len(aDate(1)) = 2 Then
		sDate =  sDate & "-" & aDate(1)
	Else
		sDate =  sDate & "-0" & aDate(1)
	End If

	'No errors found by default
	bError = False

	'Read the current line until the entire file has been read, and write the modified line to our new file
	Do Until strReadFile.AtEndOfStream

		'Read the current line of our original file
		strCurrentRow = strReadFile.ReadLine

		'**********Processing section**********

		'Replace our original project code(RP) with our new one(RG) at the beginning of our Transaction ID
		strCurrentRow = Replace(strCurrentRow, "RP", GlobalDictionary("Project"), 1, 1, vbBinaryCompare)

		'REMOVED BELOW SECTION DUE TO ENVIRONMENT ALLOWING OPEN PERIODS FROM 2017 ONWARDS. UNCOMMENT IN CASE OF CHANGE
'		'Make sure there are no out-of-range date characters displaying
		strLeft = Left(strCurrentRow, 45)
		strRight = Right(strCurrentRow, len(strCurrentRow) - 55)

		If Len(strCurrentRow) = Len(strLeft & sDate & strRight) Then
			'WriteToReport micPass, "String matches after modifying Date", strCurrentRow & " corresponds to " & strLeft & sDate & strRight & " with matching length " & Len(strLeft & sDate & strRight), False
			strCurrentRow = strLeft & sDate & strRight
		Else
			WriteToReport micFail, "Error on line " & i + 1 & " after modifying Date", strCurrentRow & " with length " & Len(strCurrentRow) & " does not correspond to " & strLeft & sDate & strRight & " with length " & Len(strLeft & sDate & strRight), False
			bError = True
			Exit Do
		End If
		'END REMOVED SECTION

		'Store our Business Unit, located at positions 1-5(length 5)
		strTemp = Mid(strCurrentRow, 1, 5)
		DataTable.Value("BusinessUnit", dtLocalSheet) = strTemp

		'Store our Transaction ID, located at positions 6 - 15(length 10), but read in elsewhere for automation
		DataTable.Value("TransactionID", dtLocalSheet) = sTransactionID

		'Update our Transaction ID to ensure that we don't run duplicate IDs
		strLeft = Left(strCurrentRow, 7)
		strRight = Right(strCurrentRow, len(strCurrentRow) - 15)
		If Len(strCurrentRow) = Len(strLeft & sTransactionID & strRight) Then
			'WriteToReport micPass, "String matches after modifying TransactionID ", strCurrentRow & " corresponds to " & strLeft & sTransactionID & strRight & " with matching length " & Len(strLeft & sTransactionID & strRight), False
			strCurrentRow = strLeft & sTransactionID & strRight			
		Else
			WriteToReport micFail, "Error on line " & i + 1 & " after modifying Transaction ID", strCurrentRow & " with length " & Len(strCurrentRow) & " does not correspond to " & strLeft & sTransactionID & strRight & " with length " & Len(strLeft & sTransactionID & strRight), False
			bError = True
			Exit Do
		End If

		'Write our processed string to the new file
		strWriteFile.WriteLine strCurrentRow

		'advance to the next row of the datatable
		i = i + 1
		DataTable.LocalSheet.SetCurrentRow(i)
	Loop
	
	'Close our files
	strReadFile.Close
	strWriteFile.Close
	Set strReadFile = Nothing
	Set strWriteFile = Nothing

	'If our file had an error in copying, delete the unfinished file, report an error, and stop the test
	If bError = True Then
		objFSO.DeleteFile strNewFileNameFullPath
		WriteToReport micFail, "Error processing file", "Exiting test", False
		ExitTest
	End If

	'Report our successfully completed file
	WriteToReport micPass, "SetupRevProInputFile", "File matches after modifying Transaction ID and Date for all rows", False

	'Copy our processed file to the new location on the network drive
	objFSO.Copyfile strNewFileNameFullPath, strNetworkFile

	'Delete our working copy once we confirm that the file copied successfully
	If objFSO.FileExists(strNetworkFile) Then
		WriteToReport micPass, "SetupRevProInputFile - Network File Created", "Network file " & strNetworkFile & " created.", False

		'Copy our existing file to the backup folder
		objFSO.CopyFile strNewFileNameFullPath, strDirectoryPath & "Old\" & strNewFileName
		objFSO.DeleteFile strNewFileNameFullPath

		'Copy the RP file to the stored folder
		objFSO.CopyFile strTextFileNameFullPath, strDirectoryPath & "RP_Old\" & strTextFileName
		objFSO.DeleteFile strTextFileNameFullPath
		Set objFSO = Nothing
	Else
		WriteToReport micFail, "SetupRevProInputFile - Network File Not Created", "Network file " & strNetworkFile & " not created. Exiting test.", False
		Set objFSO = Nothing
		ExitTest
	End If

	'Store our time to compare when the processes are ran
	GlobalDictionary("Time") = CLng(Timer)
End Function

'**************************************************************************************************************
''' <summary> 
''' ImportRevProFile Function is to check that the processes have been ran on our test files
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>12-Dec-17</datecreated>
''' <startstate>Peoplesoft webpage loaded</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 			Description of change
'12/13/2017			Stephen King	Updated objects on the Details windows to ensure they are unique and always found
'02/01/2019			Stephen King	Updated timing logic on Run Status to match Distribution Status as some processes were timing out and we were losing the instance on refresh
'**************************************************************************************************************
Public Function ImportRevProFile
	Dim currentTime, diffTime
	Dim sRunId, sValue
	Dim processNames(1)
	Dim i, j

	'Navigate to the CDW System Process Request page
	'PeopleTools>Process Scheduler>Process Monitor
	SelectMainMenu1(GlobalDictionary("MainMenuSelection1"))

	With Browser("PeopleSoft Browser")

		'Clear the username from cdw_batch as we haven't ran these processes
		.Page("Post Journals").PSFrame("Process Monitor").WebEdit("PMN_FILTER_WRK_WS_OPRID").Set ""
		processNames(0) = "CDWJGFLD"
		processNames(1) = "CDW_JRNL"
		For i = 0 To 1
			'Confirm our Type value
			.Page("Post Journals").PSFrame("Process Monitor").WebList("PMN_FILTER_WRK_PRCSTYPE").Select "PSJob"

			'Clear the Run Status weblist
			.Page("Post Journals").PSFrame("Process Monitor").WebList("RunStatus").Select(0)

			'Enter the name of the process we will be monitoring
			.Page("ProcessMonitorGeneric").PSFrame("Process Monitor").WebEdit("ProcessName").Set processNames(i)

			'We will be limiting our search by minutes. If less than a minute, then we want to set it to 1
			'Otherwise, get the number of minutes and then round up so we don't use an earlier process
			currentTime = CLng(Timer)
			diffTime = currentTime - GlobalDictionary("Time")
			If diffTime < 60 Then
				diffTime = 1
			Else
				diffTime = diffTime / 60
				diffTime = Round(diffTime)
				diffTime = diffTime + 1
			End If

			'There's an issue with catching the second process sometimes due to the processing time, so we're going to err on the side of caution here and add an additional minute
			diffTime = diffTime + i

			'Set our search time minimum. We don't want to check a process that ran before our files were created
			'The weblist sort value needs to be set to something besides "All" first or else the edit box is disabled
			.Page("Post Journals").PSFrame("Process Monitor").WebList("PMN_FILTER_WRK_PT_FILTERUNIT").Select "Minutes"
			.Page("Post Journals").PSFrame("Process Monitor").WebEdit("FilterValue").Set diffTime

			'Click the Refresh button to search with our current parameters
			.Page("Post Journals").PSFrame("Process Monitor").WebButton("Refresh").Click
			.Sync

			'Loop until our process appears. Fail after 10 minutes
			j = 0
			While Not .Page("Process Monitor").PSFrame("Process Monitor").Link("Details").Exist(5)
				'If we hit 10 minutes then stop the test
				If j > 10 Then
					On Error GoTo 0
					WriteToReport micFail, "ImportRevProFile", "Process " & processNames(i) & " not showing up after 10 minutes, stopping test", False
					ExitTest
				Else
					j = j + 1
				End If

				'Wait for a minute
				Wait(60)

				'Click the Refresh button to search again
				.Page("Post Journals").PSFrame("Process Monitor").WebButton("Refresh").Click
				.Sync
			Wend

			'Output our process number in case of issue
			sValue = Trim(.Page("ProcessMonitorGeneric").PSFrame("Process Monitor").WebElement("ProcessInstance").GetROProperty("innertext"))
			If sValue <> "" Then
				WriteToReport micDone, processNames(i) & " process number", "Current process number is " & sValue, True
			Else
				WriteToReport micFail, processNames(i), "Process never started.", True
				ExitTest
			End If

			'Confirm our run status is success
			sValue = Trim(.Page("ProcessMonitorGeneric").PSFrame("Process Monitor").WebElement("RunStatus").GetROProperty("innertext"))
			If sValue = "" Then
				.Page("Post Journals").PSFrame("Process Monitor").WebEdit("FilterValue").Set diffTime + 2
				.Page("Post Journals").PSFrame("Process Monitor").WebButton("Refresh").Click
				sValue = Trim(.Page("ProcessMonitorGeneric").PSFrame("Process Monitor").WebElement("RunStatus").GetROProperty("innertext"))
			End If

			While sValue <> "Success" AND sValue <> "Warning"
				Wait 60
				diffTime = diffTime + 1
				.Page("Post Journals").PSFrame("Process Monitor").WebEdit("FilterValue").Set diffTime
				.Page("Post Journals").PSFrame("Process Monitor").WebButton("Refresh").Click
				.Sync
				sValue = Trim(.Page("ProcessMonitorGeneric").PSFrame("Process Monitor").WebElement("RunStatus").GetROProperty("innertext"))
			Wend

			If sValue = "Success" Then
				WriteToReport micPass, "ImportRevProFile - Run Status", "Run status confirmed as Success", False
			Else
				WriteToReport micFail, "ImportRevProFile - Run Status", "Run status is not confirmed as Success - current run status is " & sValue & ".", True
				ExitTest
			End If

			'Confirm that our Distribution Status is posted
			sValue = Trim(.Page("ProcessMonitorGeneric").PSFrame("Process Monitor").WebElement("DistributionStatus").GetROProperty("innertext"))
			If sValue = "" Then
				.Page("Post Journals").PSFrame("Process Monitor").WebEdit("FilterValue").Set diffTime + 5
				.Page("Post Journals").PSFrame("Process Monitor").WebButton("Refresh").Click
				sValue = Trim(.Page("ProcessMonitorGeneric").PSFrame("Process Monitor").WebElement("DistributionStatus").GetROProperty("innertext"))
			End If

			While sValue = "N/A" Or sValue = "Posting" Or sValue = ""
				Wait 60
				diffTime = diffTime + 1
				.Page("Post Journals").PSFrame("Process Monitor").WebEdit("FilterValue").Set diffTime
				.Page("Post Journals").PSFrame("Process Monitor").WebButton("Refresh").Click
				.Sync
				sValue = Trim(.Page("ProcessMonitorGeneric").PSFrame("Process Monitor").WebElement("DistributionStatus").GetROProperty("innertext"))
			Wend

			If sValue = "Posted" Then
				WriteToReport micPass, "ImportRevProFile - Distribution Status", "Distribution status confirmed as Posted", False
			Else
				WriteToReport micFail, "ImportRevProFile - Distribution Status", "Distribution status is not confirmed as Posted - current distribution status is " & sValue & ".", True
				ExitTest
			End If

			'Click the details link
			.Page("Process Monitor").PSFrame("Process Monitor").Link("Details").Click
			.Sync

			'Click the messages link
			.Page("Process Monitor").PSFrame("Process Detail").Link("Message Log").Click
			.Sync

			'Check for any error messages
			If Trim(.Page("Process Monitor").PSFrame("Message Log").WebElement("html id:=win0divPMN_DERIVED_MESSAGE_DESCR\$0").GetROProperty("innertext")) = "" Then
				WriteToReport micPass, "ImportRevProFile", "No errors reported in file processing", False
			Else
				WriteToReport micFail, "ImportRevProFile", "Errors reported in file processing", True
			End If

			'Click on the Return button to close the top window
			.Page("Process Monitor").PSFrame("Message Log").WebButton("Return").Click
			.Sync

			'Click on the OK button to close the final window
			.Page("Process Monitor").PSFrame("Process Detail").WebButton("OK").Click
			.Sync
		Next
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' GetRevProPSFJournals Function is a function to collect the journals for each business unit and transaction id combo
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>14-Dec-17</datecreated>
''' <startstate>ImportRevProFile ran successfully</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Change Control: 
'Date of Change 	Author 			Description of change
'12/15/2017			Stephen King	Updated logic for multiple business units(file might have more than one)
'**************************************************************************************************************
Public Function GetRevProPSFJournals
	Dim arrRecordValues
	Dim i, k, nResult
	Dim objDict

	'Validate the processed text file as compared to the values in the database
	ValidateRevProOutputFile

	'Create a dictionary with case-insensitive keys so as to remove duplicates
	Set objDict = CreateObject("Scripting.Dictionary")
	objDict.CompareMode = vbTextCompare

	'Loop through our data table, storing each unique business unit with the transaction ID(identical).
	'Can erase and use our unique IDs for each transaction if needed later
	For i = 1 To DataTable.LocalSheet.GetRowCount
		DataTable.LocalSheet.SetCurrentRow(i)
		objDict(DataTable.Value("BusinessUnit", dtLocalSheet)) = DataTable.Value("TransactionID", dtLocalSheet)
	Next

	'Login as GWENCHO
	login(GlobalDictionary("SignInUser1"))

	'Loop through our unique keys(business units) and create our sql string with the associated transaction ID for this file
	For each k in objDict.Keys

		'k is our Business Unit
		'objDict(k) is the transaction ID stored with that business unit
		'We have to give the processing job time to update the SQL statement
		For i = 1 To 10
			arrRecordValues = dbGetRevProJournalEntries(k, GlobalDictionary("Project") & objDict(k))
			On Error Resume Next
			nResult = UBound(arrRecordValues)
			If nResult >= 0 Then
            	Exit For
	  		Else  	
				On Error Goto 0
			    Wait 60
	    	End If
		Next

		'Validate that we got a return value
	    On Error Resume Next

		'nResult = UBound(arrRecordValues)
		If nResult >= 0 Then
			'The database can have blank entries, so if the files process but there's no entry, then we report it and exit the test
			If InStr(1, arrRecordValues(0), "R", vbTextCompare) = 0 Then
				On Error Goto 0
				WriteToReport micFail, "GetRevProPSFJournals", nResult & " journal entries for business unit " & k & " and transaction ID " & objDict(k) & ". Check input and output files.", False
				ExitTest
			Else
				WriteToReport micPass, "GetRevProPSFJournals", nResult + 1 & " journal entries for business unit " & k & " and transaction ID " & objDict(k) & " confirmed in database", False
			End If
	  	Else  	
			On Error Goto 0
		    WriteToReport micFail, "GetRevProPSFJournals", "No journal entries found for business unit " & k & " and transaction ID " & objDict(k) & ". Check the Errors folder to see if an issue occurred while processing.", False
		    ExitTest
	    End If

		For i=0 to UBound(arrRecordValues)
			'arrRecordValues(i) is a journal ID as returned from the above query
			ValidateRevPro_PSF_GL k, objDict(k), arrRecordValues(i)
		Next
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Copy an existing Invoice by Source and BU for testcase
''' </summary>
''' <author>Eric Trout</author>
''' <datecreated>Dec 10 2017</datecreated>
''' <startstate>NA</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'12/15/2017			Stephen King	Moved some code to GetRevProPSFJournals, added SQL validations
'12/18/2017			Stephen King	Added validations
'______________________________________________________ 
'**************************************************************************************************************
Public function ValidateRevPro_PSF_GL(sBusinessUnit, sTransactionID, sJournalID)
	Dim arrRecordValues
	Dim bMultiLine
	Dim sResult, sSQL
	Dim i, j, nResult, startingRow

	'SQL query to allow us to cycle thru every line for the given journal id
	sSQL = "SELECT * FROM PS_JGEN_ACCT_ENTRY WHERE " &_
			"TRANSACTION_ID = '" & GlobalDictionary("Project") & sTransactionID & "' AND " &_
			"JOURNAL_ID = '" & sJournalID & "' AND " &_
			"BUSINESS_UNIT = '" & sBusinessUnit & "' " &_
			"ORDER BY SEQUENCENO"
			'Removed "LEDGER_GROUP = 'RECORDING' " &_ filter as it limits results for certain business units and we check on the page already
	WriteToReport micDone, "ValidateRevProOutputFile - PS_JGEN_ACCT_ENTRY - SQL query", sSQL, False
	dbGetRecords sSQL, "", arrRecordValues, "ValidateRevPro_PSF_GL" & sBusinessUnit

	'Validate that we got a return value. Report error if journal not found
    On Error Resume Next

	'nResult = UBound(arrRecordValues)	'arrRecordValues doesn't return for dbGetRecords like the other ones
	nResult = DataTable.GetSheet("ValidateRevPro_PSF_GL" & sBusinessUnit).GetRowCount
	If nResult >= 0 Then
    	WriteToReport micPass, "ValidateRevProOutputFile", nResult & " journal entries for business unit " & sBusinessUnit & " and transaction ID " & GlobalDictionary("Project") & sTransactionID & " confirmed in database", False
	Else
		On Error Goto 0
	    WriteToReport micFail, "ValidateRevProOutputFile", "No journal entries found for business unit " & sBusinessUnit & " and transaction ID " & GlobalDictionary("Project") & sTransactionID, False
	    ExitTest
    End If

	'Navigate to the Create/Update Journal Entries page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection3")) Then
		WriteToReport micPass, "ValidateRevPro_PSF_GL", "Create / Update Journals Page is Loaded Successfully", False
	Else
		WriteToReport micFail, "ValidateRevPro_PSF_GL", "Create / Update Journals Page is not Loaded Successfully", True
		ExitTest
	End If

	'Reset the active row for validation on the Header page
	DataTable.GetSheet("ValidateRevPro_PSF_GL" & sBusinessUnit).SetCurrentRow(1)

	'Validate the LEDGER_GROUP field, displayed on the Headers page
	sResult = Trim(DataTable.Value("LEDGER_GROUP", "ValidateRevPro_PSF_GL" & sBusinessUnit))
	If sResult = Trim(.WebEdit("html id:=JRNL_HEADER_LEDGER_GROUP").GetROProperty("Value")) Then
		WriteToReport micPass, "ValidateRevPro_PSF_GL - Headers Page - LEDGER_GROUP", "LEDGER_GROUP matches - " & sResult, False
    Else
    	WriteToReport micFail, "ValidateRevPro_PSF_GL - Headers Page - LEDGER_GROUP", "LEDGER_GROUP does not match - " & sResult & " in the database and " & Trim(.WebEdit("html id:=JRNL_HEADER_LEDGER_GROUP").GetROProperty("Value")) & " on the page", False
    	ExitTest
	End If

	'Check for a multiline ledger group value
	If UCase(sResult) = "RCRD_MULTI" Then
		bMultiLine = True
	Else
		bMultiLine = False
	End If

	'For each Journal do the following steps
	'With Browser("creationtime:=0").Page("index:=1").PSFrame("name:=TargetContent")
	With Browser("title:=Create/Update Journal Entries").Page("title:=Create/Update Journal Entries")

		'Wait for the page to finish loading
		.Sync

		'Select Find an existing Value on the
		'.WebTabStrip("html tag:=TR").Select "Find an Existing Value"
		.Link("name:=Find an Existing Value", "innertext:=Find an Existing Value").Click
		.Sync

		'Clear search criteria
		.WebButton("html id:=#ICClear").Click
		.Sync

		'Enter Business Unit - eg, 00001
		.WebEdit("name:=JRNL_HDR_IU_VW_BUSINESS_UNIT").Set sBusinessUnit 

		'Enter Journal - eg, 0000172896
		.WebEdit("name:=JRNL_HDR_IU_VW_JOURNAL_ID").Set sJournalID

		'Click on Search button
		.WebButton("name:=Search").Click
		.Sync

		'Check for results listed, fail if any message is shown
		If .WebElement("class:=PSSRCHINSTRUCTIONS").exist(10) Then
		
			'Get innertext to see what is displayed in results
			sResult = .WebElement("class:=PSSRCHINSTRUCTIONS").GetROProperty("innertext")
			WriteToReport micFail, sResult, "", True
			ExitTest
		End If

		'Should be taken directly to Journal page. Verify that the journal is shown.
		'If .WebElement("html id:=ICTAB_0").Exist(20) Then
		If .WebElement("html id:=JRNL_HEADER_JOURNAL_ID").Exist(20) Then
			sResult = .WebElement("html id:=JRNL_HEADER_JOURNAL_ID").GetROProperty("innertext")
			If Trim(sResult) = Trim(sJournalID) Then
				WriteToReport micPass, "ValidateRevPro_PSF_GL - Journal Header", "Journal Header Page is Loaded Successfully for Journal ID [" & sJournalID &"]", False
			Else
				WriteToReport micFail, "ValidateRevPro_PSF_GL - Journal Header", "Journal Header Page is Loaded for Journal ID [" & sResult &"], Does not match expected [" & sJournalID &"]", False
				ExitTest
			End If
		Else
			WriteToReport micFail, "ValidateRevPro_PSF_GL - Journal Header", "Journal Header Page is not showing Journal Header", False
			ExitTest
		End If

		'Click on the 'Errors' tab - Header Errors
		.WebTabStrip("html tag:=TR").Select "Errors"
		.Sync

		'Pull the error line to see if the journal contains any errors
		sResult = Trim(.WebElement("html id:=TSE_MSGS_WRK_MESSAGE_TEXT\$15\$\$0").GetROProperty("innertext"))

		'If no errors then click on the 'Lines' tab
		If sResult = "" OR InStr(1, sResult, "No journal line between line 1 and line", vbTextCompare) > 0 Then		' 2 is marked in error." Then
			WriteToReport micPass, "ValidateRevPro_PSF_GL - Errors Page", "No errors found on Journal Entries page", False
			.WebElement("html id:=ICTAB_1").Click
			.Sync
		Else
			WriteToReport micFail, "ValidateRevPro_PSF_GL - Errors Page", "Errors found on Journal Entries page: " & sResult, True
			ExitTest
		End If

		'By default the journal page displays 10 rows. We can update that to display all the lines for each journal
		Browser("creationtime:=0").Page("index:=1").WebEdit("html id:=JRNL_PANELS_WRK_LINE_NBR").Set nResult
		Browser("creationtime:=0").Page("index:=1").WebButton("html id:=#ICRefresh").Click
		.Sync

		'Need to ensure the Line column is in ascending order
		Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebElement("Line").Click
		Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebElement("Line").Click
		Browser("PeopleSoft Browser").Sync

'		wait 2
'		If InStr(1, Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebElement("Line").GetROProperty("title"), "ascending", vbTextcompare)>=0 Then
'			Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebElement("Line").Click
'			wait 2
'		End If
'
'		If InStr(1, Browser("PeopleSoft Browser").Page("Create/Update Journal").PSFrame("TargetContent").WebElement("Line").GetROProperty("title"), "descending", vbTextcompare)>=0 Then
'			WriteToReport micDone, "ValidateRevPro_PSF_GL", "Sorted by Line Column", False
'		End If

		'Once we've validated what we need from the header and error pages, pull the journal information from the PS_JRNL_LN table
		sSQL = "SELECT BUSINESS_UNIT, JOURNAL_ID, LEDGER, JOURNAL_LINE, ACCOUNT, DEPTID, MONETARY_AMOUNT FROM PS_JRNL_LN WHERE JOURNAL_ID = '" & sJournalID & "'"
		WriteToReport micDone, "ValidateRevPro_PSF_GL - PS_JRNL_LN - SQL query", sSQL, False

		'Erase arrRecordValues	'ReDim arrRecordValues(0)
		dbGetRecords sSQL, "", arrRecordValues, "ValidateRevPro_PSF_GL_JOURNAL" & sBusinessUnit

		'Validate that we got a return value. Report error if journal not found
	    On Error Resume Next

		'nResult = UBound(arrRecordValues)	'arrRecordValues doesn't return for dbGetRecords like the other ones
		nResult = DataTable.GetSheet("ValidateRevPro_PSF_GL_JOURNAL" & sBusinessUnit).GetRowCount
		If nResult >= 0 Then
	    	WriteToReport micPass, "ValidateRevPro_PSF_GL", nResult & " journal entries for business unit " & sBusinessUnit & " and transaction ID " & sTransactionID & " confirmed in database PS_JRNL_LN", False
		Else
			On Error Goto 0
		    WriteToReport micFail, "ValidateRevPro_PSF_GL", "No journal entries found in PS_JRNL_LN for business unit " & sBusinessUnit & " and transaction ID " & sTransactionID, False
		    ExitTest
	    End If

	    'Call our validation functions based on if we're using a multiline journal or not
	    If bMultiLine = True Then

	    	'For multiline, the first page is always LOCAL, and the second is always CORPORATE. So we need to determine which row we start on, 1 or 2
	    	DataTable.GetSheet("ValidateRevPro_PSF_GL_JOURNAL" & sBusinessUnit).SetCurrentRow(1)
			If Trim(DataTable("LEDGER", "ValidateRevPro_PSF_GL_JOURNAL" & sBusinessUnit)) = "LOCAL" Then
				startingRow = 1
			Else
				startingRow = 2
			End If

	    	'Validate the entries displayed on the primary page. If MultiLine, they alternate rows in the database, so our step value is 2 to skip them
	    	ValidateJournalLineEntries startingRow, 2, nResult,  sBusinessUnit

	    	'Naviage to the next page by clicking the "Secondary lines" link
	    	'.WebElement("html id:=win0divJRNL_PANELS_WRK_PB_SECONDARY\$0").Click
	    	.Link("html id:=JRNL_PANELS_WRK_PB_SECONDARY\$0").Click
	    	.Sync

	    	'Our starting row has to be either 1 or 2 to get every row in the datatable
	    	If startingRow = 1 Then
	    		startingRow = 2
	    	Else
	    		startingRow = 1
	    	End If

	    	'Validate the entries displayed on the secondary page
	    	ValidateJournalLineEntriesSecondaryPage startingRow, 2, nResult,  sBusinessUnit
	    	
	    	'Navigate back to the primary page by clicking the "back to primary lines" link
	    	.Link("html id:=JRNL_PANELS_WRK_PB_PRIMARY_LINE").Click
	    	.Sync
	    Else
	    	'Validate the entries displayed on the primary page. If not multiline then we start on the first row and check every row displayed
	    	ValidateJournalLineEntries 1, 1, nResult,  sBusinessUnit
    	End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Confirm that the local daemon is running before continuing our tests
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>January 03, 2018</datecreated>
''' <startstate>Logged in as CDW_BATCH</startstate>
''' <endstate>All three required processes for our GL tests to run are running</endstate>
''' <returns type="NA"> True if found and clicked</returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'14Mar2019			Eric Trout		Updated to include CDW_USB_DMN" Process
'**************************************************************************************************************
Public Function VerifyGLDaemonProcesses
	Dim found, i
	Dim sValue

	'Menu - CDW Interface>Daemon Control
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection1")) = True Then
		WriteToReport micPass, "VerifyGLDaemonProcesses", "On Daemon Control page.", False
	Else
		WriteToReport micFail, "VerifyGLDaemonProcesses", "Navigation to Daemon Control page failed.", True
		ExitTest
	End If

	'verify that our 3 required processes are checked.
	'With Browser("title:=Daemon Control").Page("title:=Daemon Control")
	With Browser("name:=Daemon Control").Page("title:=Daemon Control")
		.Sync

		'Enter our group to filer our searches by
		.WebEdit("html id:=DAEMONGROUP_VW_DAEMONGROUP").Set "PVDAEMON"

		'Click the search button
		.WebButton("html id:=#ICSearch").Click
		.Sync

		'Click the "View All" link so that all running processes are displayed
		.Link("html id:=CDW_DMN_CONTROL\$hviewall\$0").Click
		.Sync

		'Loop through the rows on the table for our process names
		found = 0
		For i = 0 To .WebTable("name:=Active").GetROProperty("rows")
			sValue = Trim(.WebEdit("html id:=CDW_DMN_CONTROL_AE_APPLID\$" & i).GetRoProperty("value"))

			'If the current row contains one of our three processes we care about, check to see if it's running
			If sValue = "CDW_CC_DMN" OR sValue = "CDW_JFLD_DMN" OR sValue = "CDW_JRNL_DMN" OR sValue = "CDW_USB_DMN" Then

				'0 for false/1 for true
				If .WebCheckBox("html id:=CDW_DMN_CONTROL_ACTIVE_FLAG\$" & i).GetROProperty("checked") = 1 Then
					WriteToReport micPass, sValue, "Process is running", False
				Else
					WriteToReport micDone, sValue, "Process not running by default, turning on now", False
					.WebCheckBox("html id:=CDW_DMN_CONTROL_ACTIVE_FLAG\$" & i).Click
					.WebButton("html id:=#ICSave").Click
					.Sync

					'No longer needing to fail test, as we only run this once now before regression
					'WriteToReport micFail, sValue, "Process not running", True
					'ExitTest
				End If

				'Keep track of the number of processes we have found so far
				found = found + 1
			End If

			'If all of our processes have been found, then we can exit the loop early. No need to continue.
			If found = 3 Then
				Exit For
			End If
		Next

		'If for some reason we didn't find all 3 processes, report and fail. All found process names are already reported.
		If found = 3 Then
			WriteToReport micPass, "VerifyGLDaemonProcesses", "All three processes are now running.", False
		Else
			WriteToReport micFail, "VerifyGLDaemonProcesses", "Found " & found & " processes.", True
			ExitTest
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Read the generated Transaction ID for the current run attempt
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>January 08, 2018</datecreated>
''' <startstate>RevPro_GL_Preconditions test ran</startstate>
''' <endstate>Completed, transaction ID returned from file</endstate>
''' <returns type="String">Transaction ID if found, "" otherwise</returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function ReadTransactionID
	Dim objExcel, objBook, objSheet
	Dim i, row
	Dim sPath, sValue, sDirectory

	'Assign a default value to our return value
	ReadTransactionID = ""

	'Create our Excel object
	Set objExcel = CreateObject("Excel.Application")

	'Get our shared transaction ID path
	'sPath = "\\mir\qa\AutoSource_Prod\PSFinUFT\Data\TransactionIDs.xls"
	sPath = Environment("SharedTransactionIdFile")

	'Open our spreadsheet
	Set objBook = objExcel.Workbooks.Open(sPath)

	'Fixed sheet ID
	Set objSheet= objBook.Worksheets("TransactionIDs")

	'Store our search string from our global dictionary
	'sDirectory = "SC_01"
	sDirectory = GlobalDictionary("Directory")

	'Use our Directory variable from the data sheet for the identifier for our transaction ID
	row = objSheet.usedrange.rows.count
	For i=1 to row
		sValue = objSheet.cells(i, 1)
		If sValue = sDirectory Then
			ReadTransactionID = objSheet.cells(i, 2)
			Exit For
		End If
	Next

	'Cleanup our objects
	objBook.Close
	Set objSheet = Nothing
	Set objBook = Nothing
	Set objExcel = Nothing
End Function

'**************************************************************************************************************
''' <summary> 
''' Update the transaction ID in the shared Excel file based off of previous runs from the database
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>January 11, 2018</datecreated>
''' <startstate></startstate>
''' <endstate>Completed, transaction IDs </endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'01/15/2018			Stephen King	Removed folder code to use the new SQL code
'______________________________________________________ 
'**************************************************************************************************************
Public Function UpdateTransactionID()
	Dim objFSO, objWorkingFolder, objFolders, objFiles
	Dim objExcel, objBook, objSheet
	Dim i, f, folder, j, row
	Dim strNetworkPath, strTemp, sTransactionID, sValue, sPath
	Dim arrSplit

	'Default our transaction ID
	sTransactionID = ""

'	'Create our object for interacting with files
'	Set objFSO = CreateObject("Scripting.FileSystemObject")
'
'	'Assign the working directory to an object
'	'strNetworkPath = "\\rmsearch\PSFN\FNREG\Journals\RevPro"
'	strNetworkPath = Environment("TestDataNetworkPathPart1") & Environment("Environment") & Environment("TestDataNetworkPathPart2")
'	Set objWorkingFolder = objFSO.GetFolder(strNetworkPath)
'
'	'Get a list of the folders in our working folder
'	Set objFolders = objWorkingFolder.SubFolders
'
'	'Search through each folder looking for the highest transaction ID
'	For Each folder in objFolders
'
'		'Get a list of the files in our directory
'		Set objFiles = folder.Files
'
'		'Check if this was our first instance of Transaction ID - waiting on SQL statement or directory recursion
'		For Each f in objFiles
'
'			'Ensure that we are working on a RevPro file and not a miscellaneous one in the folder
'			If InStr(1, f.Name, "REVPRO", vbTextCompare) >= 1 Then
'				'Take a filename like REVPRO_20171201_RG00000591_2018-01-02-15.17.51.000000 and split it on the _ character
'				arrSplit = Split(f.Name, "_")
'				
'				'The transaction ID is the third segment(RG00000591), so arrSplit(2)
'				'Transaction IDs are 8 characters long
'				strTemp = Right(arrSplit(2), 8)
'
'				'Some error files follow a slightly different naming format. Want to make sure we don't include those for our transaction ID checking
'				If InStr(1, strTemp, ".txt", vbTextCompare) = 0 Then
'
'					'If this is our first transaction ID or if it's greater than the current one, store it. Otherwise, do nothing
'					If sTransactionID = "" OR strTemp > sTransactionID Then
'						sTransactionID = strTemp
'					End If
'				End If
'			End If
'		Next
'	Next
'
'	'Clean up our file objects
'	Set objFolders = Nothing
'	Set objWorkingFolder = Nothing
'	Set objFSO = Nothing

	'Get the most recent transaction ID. We don't check the result as if there's an error we exit the test before it returns.
	'sTransactionID = dbGetTransactionID("RG")
	sTransactionID = dbGetTransactionID(GlobalDictionary("Project"))
	If sTransactionID = "" Then
		sTransactionID = "00000000"
	End If

	'Create our excel object
	Set objExcel = CreateObject("Excel.Application")

	'Get our shared transaction ID path
	'sPath = "\\mir\qa\AutoSource_Prod\PSFinUFT\Data\TransactionIDs.xls"
	sPath = Environment("SharedTransactionIdFile")
	Set objBook = objExcel.Workbooks.Open(sPath)

	'Get the sheet (fixed name) that we will write our IDs to
	Set objSheet= objBook.Worksheets("TransactionIDs")

	'Starting at the 2nd row(first is header), write our new transaction IDs
	row = objSheet.usedrange.rows.count
	For i=2 to row

		'Increment our transaction ID so we ensure we have a new one(one higher than the last one processed)
		sTransactionID = sTransactionID + 1

		'String length matters, so if we lose any length due to trailing zeros we need to pad our string back up to size
		If len(sTransactionID) < 8 Then
			strTemp = ""
			For j = 1 To (8 - len(sTransactionID))
				strTemp = strTemp & "0"
			Next

			'Excel formatting needs a leading ' to format the leading zeroes
			strTemp = "'" & strTemp & sTransactionID

			'Write it to the second column of the current row. The first column is used in ReadTransactionID
			objSheet.cells(i, 2) = strTemp
		Else
			'Write it to the second column of the current row. The first column is used in ReadTransactionID
			objSheet.cells(i, 2) = sTransactionID
		End If
	Next

	'Cleanup our excel objects
	objBook.Save
	objBook.Close
	Set objSheet = Nothing
	Set objBook = Nothing
	Set objExcel = Nothing
End Function

'**************************************************************************************************************
''' <summary> 
''' Compare the results of the PS_JRNL_LN SQL query to the live peoplesoft application
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>February 23, 2018</datecreated>
''' <startstate>Logged in as the correct user on the Create/Update Journal Entries page with the proper journal loaded</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'02/01/2019			Stephen King	Updated html ID for Account, DeptID, and Amount fields
'______________________________________________________ 
'**************************************************************************************************************
Public Function ValidateJournalLineEntries(startNumber, stepNumber, nResult,  sBusinessUnit)
	Dim i, j
	Dim sResult

	'With Browser("title:=Create/Update Journal Entries").Page("title:=Create/Update Journal Entries")
	With Browser("PeopleSoft Browser").Page("Create/Update Journal")

		'We will keep j as a counter for webpage rows, which are tracked independently of the data table as well as our for loop increments
		j = 0

		'Compare each row of the datatable(the database results) to the live data on the webpage
		For i = startNumber To nResult Step stepNumber
			'Set our current row
			DataTable.GetSheet("ValidateRevPro_PSF_GL_JOURNAL" & sBusinessUnit).SetCurrentRow(i)

			'******************************************************************************************************
			'Old logic, keeping it commented out in case there's a display issue with too many rows in the table
			'Journal page shows 10 rows(0-9) per page, so on 11, 21, etc we should go to the next page
			'j = i MOD 10
			'If j = 1 AND i <> 1 Then
			'	.Image("name:=JRNL_PANELS_WRK_PB_NEXT_GRP\$IMG").Click
				'.WebButton("html id:=JRNL_PANELS_WRK_PB_NEXT_GRP").Click
			'	.Sync
			'End If
			
			'Keeps our rows to 0-9 for each individual page
			'If j = 0 Then
			'	j = 9
			'Else
			'	j = i - 1
			'End If
			'******************************************************************************************************

		    'BUSINESS_UNIT
		    sResult = Trim(DataTable.Value("BUSINESS_UNIT", "ValidateRevPro_PSF_GL_JOURNAL" & sBusinessUnit))
		    If sResult = Trim(.WebElement("html id:=win0divBUSINESS_UNIT\$" & j).GetROProperty("innertext")) Then
		    	'WriteToReport micPass, "ValidateRevPro_PSF_GL - BUSINESS_UNIT - Row " & j + 1, "BUSINESS_UNIT matches - " & sResult, False
		    Else
		    	WriteToReport micFail, "ValidateRevPro_PSF_GL - BUSINESS_UNIT - Row " & j + 1, "BUSINESS_UNIT does not match - " & sResult & " in the database versus " & Trim(.WebElement("html id:=win0divBUSINESS_UNIT\$" & j).GetROProperty("innertext")) & " on the page", False
		    End If

		    'TRANSACTION_ID - Not on page to validate
		    'If arrRecordValues(1) = Trim(.WebElement("html id:=win0divBUSINESS_UNIT\$0")) Then
		    'End If

		    'LEDGER
		    sResult = Trim(DataTable.Value("LEDGER", "ValidateRevPro_PSF_GL_JOURNAL" & sBusinessUnit))
			If sResult = Trim(.WebElement("html id:=LEDGER\$" & j).GetROProperty("innertext")) Then
				'WriteToReport micPass, "ValidateRevPro_PSF_GL - LEDGER - Row " & j + 1, "LEDGER matches - " & sResult, False
		    Else
		    	'BU 00017 has special handling and ledger is sometimes blank in the database
		    	If sResult = "" AND UCase(Trim(.WebElement("html id:=LEDGER\$" & j).GetROProperty("innertext"))) = "LOCAL" Then
		    		'WriteToReport micPass, "ValidateRevPro_PSF_GL - LEDGER - Row " & j + 1, "LEDGER matches - LOCAL", False
		    	Else
		    		WriteToReport micFail, "ValidateRevPro_PSF_GL - LEDGER - Row " & j + 1, "LEDGER does not match - " & sResult & " in the database versus " & Trim(.WebElement("html id:=LEDGER\$" & j).GetROProperty("innertext")) & " on the page", False
		    	End If
			End If

			'JOURNAL_ID
			sResult = Trim(DataTable.Value("JOURNAL_ID", "ValidateRevPro_PSF_GL_JOURNAL" & sBusinessUnit))
			If sResult = Trim(.WebElement("html id:=JRNL_HEADER_JOURNAL_ID").GetROProperty("innertext")) Then
				'WriteToReport micPass, "ValidateRevPro_PSF_GL - JOURNAL_ID - Row " & j + 1, "JOURNAL_ID matches - " & sResult, False
		    Else
		    	WriteToReport micFail, "ValidateRevPro_PSF_GL - JOURNAL_ID - Row " & j + 1, "JOURNAL_ID does not match - " & sResult & " in the database versus " & Trim(.WebElement("html id:=JRNL_HEADER_JOURNAL_ID").GetROProperty("innertext")) & " on the page", False
			End If

			'JOURNAL_LINE
			sResult = Trim(DataTable.Value("JOURNAL_LINE", "ValidateRevPro_PSF_GL_JOURNAL" & sBusinessUnit))
			If sResult = Trim(.WebElement("html id:=win0divJOURNAL_LINE\$" & j).GetROProperty("innertext")) Then
				'WriteToReport micPass, "ValidateRevPro_PSF_GL - JOURNAL_LINE - Row " & j + 1, "JOURNAL_LINE matches - " & sResult, False
		    Else
		    	WriteToReport micFail, "ValidateRevPro_PSF_GL - JOURNAL_LINE - Row " & j + 1, "JOURNAL_LINE does not match - " & sResult & " in the database versus " & Trim(.WebElement("html id:=win0divJOURNAL_LINE\$" & j).GetROProperty("innertext")) & " on the page", False
			End If

			'ACCOUNT
			sResult = Trim(DataTable.Value("ACCOUNT", "ValidateRevPro_PSF_GL_JOURNAL" & sBusinessUnit))
			If sResult = Trim(.WebElement("html id:=ACCOUNT\$" & j).GetROProperty("innertext")) Then
				'WriteToReport micPass, "ValidateRevPro_PSF_GL - ACCOUNT - Row " & j + 1, "ACCOUNT matches - " & sResult, False
		    Else
		    	WriteToReport micFail, "ValidateRevPro_PSF_GL - ACCOUNT - Row " & j + 1, "ACCOUNT does not match - " & sResult & " in the database versus " & Trim(.WebElement("html id:=ACCOUNT\$" & j).GetROProperty("default value")) & " on the page", False
			End If

			'DEPTID
			sResult = Trim(DataTable.Value("DEPTID", "ValidateRevPro_PSF_GL_JOURNAL" & sBusinessUnit))
			If sResult = Trim(.WebElement("html id:=DEPTID\$" & j).GetROProperty("innertext")) Then
				'WriteToReport micPass, "ValidateRevPro_PSF_GL - DEPTID - Row " & j + 1, "DEPTID matches - " & sResult, False
		    Else
		    	WriteToReport micFail, "ValidateRevPro_PSF_GL - DEPTID - Row " & j + 1, "DEPTID does not match - " & sResult & " in the database versus " & Trim(.WebElement("html id:=DEPTID\$" & j).GetROProperty("default value")) & " on the page", False
			End If

			'MONETARY_AMOUNT
			sResult = Trim(DataTable.Value("MONETARY_AMOUNT", "ValidateRevPro_PSF_GL_JOURNAL" & sBusinessUnit))
			'Format the number to resemble currency so it matches on the page
			sResult = FormatNumber(sResult,,0)
			If sResult = Trim(.WebElement("html id:=FOREIGN_AMOUNT\$" & j).GetROProperty("innertext")) Then
				'WriteToReport micPass, "ValidateRevPro_PSF_GL - MONETARY_AMOUNT - Row " & j + 1, "MONETARY_AMOUNT matches - " & sResult, False
		    Else
		    	'0 in the database can display as blank for this field. This is working as intended.
			    If (sResult = 0 OR sResult = "0.00") AND Trim(.WebElement("html id:=FOREIGN_AMOUNT\$" & j).GetROProperty("innertext")) = "" Then
					'WriteToReport micPass, "ValidateRevPro_PSF_GL - MONETARY_AMOUNT - Row " & j + 1, "MONETARY_AMOUNT matches - " & sResult, False

			'If the number is negative a zero can sometimes not appear - EG, -.09 vs -0.09
			ElseIf FormatNumber(Trim(DataTable.Value("MONETARY_AMOUNT", "ValidateRevPro_PSF_GL_JOURNAL" & sBusinessUnit)), , -1) = Trim(.WebElement("html id:=FOREIGN_AMOUNT\$" & j).GetROProperty("innertext")) Then
					'WriteToReport micPass, "ValidateRevPro_PSF_GL - MONETARY_AMOUNT - Row " & j + 1, "MONETARY_AMOUNT matches - " & sResult, False
			    Else
			    	WriteToReport micFail, "ValidateRevPro_PSF_GL - MONETARY_AMOUNT - Row " & j + 1, "MONETARY_AMOUNT does not match - " & sResult & " in the database versus " & Trim(.WebElement("html id:=FOREIGN_AMOUNT\$" & j).GetROProperty("default value"))  & " on the page", False
		    	End If
			End If

			'increment our webpage row counter
			j = j + 1
		Next
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Compare the results of the PS_JRNL_LN SQL query to the secondary page live peoplesoft application
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>February 23, 2018</datecreated>
''' <startstate>Logged in as the correct user on the Create/Update Journal Entries secondary page with the proper journal loaded</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function ValidateJournalLineEntriesSecondaryPage(startNumber, stepNumber, nResult)
	Dim i, j
	Dim sResult

	'With Browser("title:=Create/Update Journal Entries").Page("title:=Create/Update Journal Entries")
	With Browser("PeopleSoft Browser").Page("Create/Update Journal")

		'We will keep j as a counter for webpage rows, which are tracked independently of the data table as well as our for loop increments
		j = 0

		'Compare each row of the datatable(the database results) to the live data on the webpage
		For i = startNumber To nResult Step stepNumber

			'Set our current row
			DataTable.GetSheet("ValidateRevPro_PSF_GL_JOURNAL").SetCurrentRow(i)

			'LEDGER
		    sResult = Trim(DataTable.Value("LEDGER", "ValidateRevPro_PSF_GL_JOURNAL"))
			If sResult = Trim(.WebElement("html id:=JRNL_LN_SEC_VW_SEC_LEDGER\$" & j).GetROProperty("innertext")) Then
				'WriteToReport micPass, "ValidateRevPro_PSF_GL - LEDGER - Secondary Page - Row " & j + 1, "LEDGER matches - " & sResult, False
		    Else
		    	'BU 00017 has special handling and ledger is sometimes blank in the database
		    	If sResult = "" AND UCase(Trim(.WebElement("html id:=JRNL_LN_SEC_VW_SEC_LEDGER\$" & j).GetROProperty("innertext"))) = "LOCAL" Then
		    		'WriteToReport micPass, "ValidateRevPro_PSF_GL - LEDGER - Secondary Page - Row " & j + 1, "LEDGER matches - LOCAL", False
		    	Else
		    		WriteToReport micFail, "ValidateRevPro_PSF_GL - LEDGER - Secondary Page - Row " & j + 1, "LEDGER does not match - " & sResult & " in the database versus " & Trim(.WebElement("html id:=JRNL_LN_SEC_VW_SEC_LEDGER\$" & j).GetROProperty("innertext")) & " on the page", False
		    	End If
			End If

			'JOURNAL_LINE
			sResult = Trim(DataTable.Value("JOURNAL_LINE", "ValidateRevPro_PSF_GL_JOURNAL"))
			If sResult = Trim(.WebElement("html id:=win0divJRNL_LN_SEC_VW_JOURNAL_LINE\$" & j).GetROProperty("innertext")) Then
				'WriteToReport micPass, "ValidateRevPro_PSF_GL - JOURNAL_LINE - Secondary Page - Row " & j + 1, "JOURNAL_LINE matches - " & sResult, False
		    Else
		    	WriteToReport micFail, "ValidateRevPro_PSF_GL - JOURNAL_LINE - Secondary Page - Row " & j + 1, "JOURNAL_LINE does not match - " & sResult & " in the database versus " & Trim(.WebElement("html id:=win0divJRNL_LN_SEC_VW_JOURNAL_LINE\$" & j).GetROProperty("innertext")) & " on the page", False
			End If

			'MONETARY_AMOUNT
			sResult = Trim(DataTable.Value("MONETARY_AMOUNT", "ValidateRevPro_PSF_GL_JOURNAL"))

			'Format the number to resemble currecny so it matches on the page
			sResult = FormatNumber(sResult,,0)
			If sResult = Trim(.WebElement("html id:=JRNL_LN_SEC_VW_MONETARY_AMOUNT\$" & j).GetROProperty("innertext")) Then
				'WriteToReport micPass, "ValidateRevPro_PSF_GL - MONETARY_AMOUNT - Secondary Page - Row " & j + 1, "MONETARY_AMOUNT matches - " & sResult, False
		    Else
		    	'0 in the database can display as blank for this field. This is working as intended.
			    If (sResult = 0 OR sResult = "0.00") AND Trim(.WebElement("html id:=JRNL_LN_SEC_VW_MONETARY_AMOUNT\$" & j).GetROProperty("innertext")) = "" Then
					'WriteToReport micPass, "ValidateRevPro_PSF_GL - MONETARY_AMOUNT - Secondary Page - Row " & j + 1, "MONETARY_AMOUNT matches - " & sResult, False
			    Else
			    	WriteToReport micFail, "ValidateRevPro_PSF_GL - MONETARY_AMOUNT - Secondary Page - Row " & j + 1, "MONETARY_AMOUNT does not match - " & sResult & " in the database versus " & Trim(.WebElement("html id:=win0divJRNL_LN_SEC_VW_FOREIGN_AMOUNT\$" & j).GetROProperty("innertext"))  & " on the page", False
		    	End If
			End If

			'increment our webpage row counter
			j = j + 1
		Next
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' ValidateRevProOutputFile Function reads from the processed RevPro file and validates it with the database results
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>02-Feb-18</datecreated>
''' <startstate>RevPro files have been copied to the RMSearch drive and both processes have been ran</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Change Control: 
'Date of Change 	Author 			Description of change
'02/01/2019			Stephen King	Updated loop logic to account for zero'd line entries. Database doesn't write them anymore, so we can't compare line count or just line-by-line anymore.
'**************************************************************************************************************
Public Function ValidateRevProOutputFile
	Dim objFSO, objFolder, objFiles, oFile, f, sDate, sTime, sID
	Dim strTextFileName, strData, strCurrentRow, strReadFile, strTemp, strDirectoryPath
	Dim strLeft, strRight, sSQL
	Dim i, index, nResult, j
	Dim arrProperties, arrSplit, arrDate, arrRecordValues, arrTemp
	Dim regex

	'SQL query to allow us to cycle thru every line for the given transaction id in order so we can do a line-by-line comparison of the processed file
	sSQL = "SELECT * FROM PS_JGEN_ACCT_ENTRY WHERE " &_
			"TRANSACTION_ID = '" & GlobalDictionary("Project") & GlobalDictionary("TransactionID") & "' " &_
			"ORDER BY SEQUENCENO"
	WriteToReport micDone, "ValidateRevProOutputFile - PS_JGEN_ACCT_ENTRY - SQL query", sSQL, False
	dbGetRecords sSQL, "", arrRecordValues, "ValidateRevProOutputFile"

	'Validate that we got a return value. Report error if journal not found
    On Error Resume Next

	'nResult = UBound(arrRecordValues)	'arrRecordValues doesn't return for dbGetRecords like the other ones
	nResult = DataTable.GetSheet("ValidateRevProOutputFile").GetRowCount
	On Error Goto 0
	If nResult > 0 Then
    	WriteToReport micPass, "ValidateRevProOutputFile", "Journal entries found", False
	Else
	    WriteToReport micFail, "ValidateRevProOutputFile", "Zero journal entries found", False
	    ExitTest
    End If

	'We will be replacing the date with the current date, in YYYY-MM-DD format
	arrDate = Split(Date, "/")

	'Depending on user/machine settings, sometime the month is MM, sometimes just D, so we add a leading zero if needed
	If Len(arrDate(0)) = 2 Then
		sDate = arrDate(2) & "-" & arrDate(0)
	Else
		sDate = arrDate(2) & "-0" & arrDate(0)
	End If

	'Depending on user/machine settings, sometime the date is DD, sometimes just D, so we add a leading zero if needed
	If Len(arrDate(1)) = 2 Then
		sDate =  sDate & "-" & arrDate(1)
	Else
		sDate =  sDate & "-0" & arrDate(1)
	End If

	'Store the path that our text files are stored at after processing
	'strDirectoryPath = Environment("ProcessedFileNetworkFolderPath")
	strDirectoryPath = Environment("TestDataNetworkPathPart1") & Environment("Environment") & Environment("TestDataNetworkPathPart2") & "Processed\"

	'Use the first row of the datatable to grab our transaction ID
	DataTable.GetSheet("ValidateRevProOutputFile").SetCurrentRow(1)
	sID = Trim(DataTable("TRANSACTION_ID", "ValidateRevProOutputFile"))

	'Create our object for interacting with files
	Set objFSO = CreateObject("Scripting.FileSystemObject")

	'Assign the working directory to an object
	Set objFolder = objFSO.GetFolder(strDirectoryPath)

	'Get a list of the files in our directory
	Set objFiles = objFolder.Files

	'Search our folder for the processed file with our transaction ID in the title
	For Each f in objFiles

		'Grab the text file with the generated name and current transaction ID in it
		If InStr(1, f.Name, "Revpro_" & sID & "_" & sDate, vbTextCompare) >= 1 Then
			Set oFile = f
			Exit For
		End If
	Next

	'Exit our test run if we don't have a file to work with
	If oFile <> "" Then
		WriteToReport micPass, "ValidateRevProOutputFile - REVPRO file found", "Ready to start validating REVPRO file " & oFile.Name & " in location " & strDirectoryPath & ".", False
	Else
		On Error Goto 0
		WriteToReport micFail, "ValidateRevProOutputFile - No REVPRO file found to process", "Unable to find a REVPRO file to process in location " & strDirectoryPath & ".", False
		ExitTest
	End If

	'Assign our text file for reading
	strTextFileName = oFile.Name

	'Open the file for reading only
	Set strReadFile = objFSO.OpenTextFile(strDirectoryPath & "\\" & strTextFileName, 1)

	'strReadFile = "00001RG000005971         RECORDING           2018-02-23RPJ       000010   0                      0        27542               00999                                                                                                                USD   USDCRRNT1                1               9333.3                      9333.3                      0                N        0                                                             GLJ     GENERAL NN0                   "
	'strReadFile = Trim(strReadFile)
	'Set up our regular expression object for parsing the file
	Set regex = New RegExp
	regex.Global = True
	regex.Pattern = "\s+"

	'We will be starting on row one to match the rows in the datatable
	i = 1
	DataTable.GetSheet("ValidateRevProOutputFile").SetCurrentRow(i)
	On Error Goto 0

	'Read the current line until the entire file has been read
	Do Until strReadFile.AtEndOfStream

		'We will be tracking our index as not all lines return the same values due to spaces
		index = 0

		'Read the current line of our original file
		strCurrentRow = strReadFile.ReadLine

		'apply our regular expression replacements
		strCurrentRow = regex.Replace(strCurrentRow, " ")

		'Split our string for easier parsing
		arrSplit = Split(strCurrentRow, " ")

		'Using the sequenceno(unknown length, 1-3 digits so far) now to set our row number, as the files are out of order
'		If Right(arrSplit(0), Len(arrSplit(0)) - 15) <> i Then
'			DataTable.GetSheet("ValidateRevProOutputFile").SetCurrentRow(Right(arrSplit(0), Len(arrSplit(0)) - 15))
'		End If

		'Moving the sequenceno check from later up first, so we make sure we're on the right row.
		'Entries with a value of zero don't get included in the database anymore, and the business unit may or may not match. The Transaction ID should always matches.
		'So if the sequence number matches, then we start to compare the full line
		'Otherwise we move on to the next line of the file while making sure to stay on the same line of the datatable

		'00001RG000005971 - location 0 - Right(len - 15[15 being the previous 2 lengths combined]) is SEQUENCENO. Usually 1-2 spaces, sometimes 3
		strTemp = Trim(DataTable("SEQUENCENO", "ValidateRevProOutputFile"))
		If Right(arrSplit(0), Len(arrSplit(0)) - 15) = strTemp Then

			'Example: 00001RG000005971 - location 0 - split with Left(5) is BUSINESS_UNIT
			strTemp = Trim(DataTable("BUSINESS_UNIT", "ValidateRevProOutputFile"))
			If Left(arrSplit(index), 5) = strTemp Then
				'WriteToReport micPass, "ValidateRevProOutputFile - BUSINESS_UNIT - row " & i, "BUSINESS_UNIT matches: " & strTemp, False
			ElseIf strTemp = "" Then
				WriteToReport micPass, "ValidateRevProOutputFile", "All rows match", False
				Exit Do
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - BUSINESS_UNIT - row " & i, "BUSINESS_UNIT in file " & Left(arrSplit(index), 5) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'00001RG000005971 - location 0 - Mid(6, 10) is TRANSACTION_ID
			strTemp = Trim(DataTable("TRANSACTION_ID", "ValidateRevProOutputFile"))
			If Mid(arrSplit(0), 6, 10) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - TRANSACTION_ID - row " & i, "TRANSACTION_ID matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - TRANSACTION_ID - row " & i, "TRANSACTION_ID in file " & Mid(arrSplit(0), 6, 10) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'00001RG000005971 - location 0 - Right(len - 15[15 being the previous 2 lengths combined]) is SEQUENCENO. Usually 1-2 spaces, sometimes 3
			strTemp = Trim(DataTable("SEQUENCENO", "ValidateRevProOutputFile"))
			If Right(arrSplit(0), Len(arrSplit(0)) - 15) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - SEQUENCENO - row " & i, "SEQUENCENO matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - SEQUENCENO - row " & i, "SEQUENCENO in file " & Right(arrSplit(0), Len(arrSplit(0)) - 15) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'Increase our index counter by 1
			index = index + 1

			'RECORDING - 1 - LEDGER_GROUP
			strTemp = Trim(DataTable("LEDGER_GROUP", "ValidateRevProOutputFile"))
			If Trim(arrSplit(index)) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - LEDGER_GROUP - row " & i, "LEDGER_GROUP matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - LEDGER_GROUP - row " & i, "LEDGER_GROUP in file " & Trim(arrSplit(index)) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'Increase our index counter by 1
			index = index + 1

			'2018-02-23RPJ - 2 - Left(len - 3) is INSTR ACCOUNTING_DT
			arrTemp = Split(Trim(DataTable("ACCOUNTING_DT", "ValidateRevProOutputFile")), "/")
			strTemp = Right("0" & arrTemp(0), 2) & "/" & Right("0" & arrTemp(1), 2) & "/" & arrTemp(2)

			'The date values should match but they are stored in the database in a different format
			sDate = Left(arrSplit(index), Len(arrSplit(index)) - 3)
			arrDate = split(sDate, "-")
			sDate = arrDate(1) & "/" & arrDate(2) & "/" & arrDate(0)
			If sDate = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - ACCOUNTING_DT - row " & i, "ACCOUNTING_DT matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - ACCOUNTING_DT - row " & i, "ACCOUNTING_DT in file " & sDate & " does not match " & strTemp & " in database.", False
				ExitTest
			End If

			'2018-02-23RPJ - 2 - Right(3) = APPL_JRNL_ID.
			strTemp = Trim(DataTable("APPL_JRNL_ID", "ValidateRevProOutputFile"))
			If Right(arrSplit(index), 3) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - APPL_JRNL_ID - row " & i, "APPL_JRNL_ID matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - APPL_JRNL_ID - row " & i, "APPL_JRNL_ID in file " & Right(arrSplit(index), 3) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'Increase our index counter by 1
			index = index + 1

			'000010 - 3 - BUSINESS_UNIT_GL. LEFT(5)
			strTemp = Trim(DataTable("BUSINESS_UNIT_GL", "ValidateRevProOutputFile"))
			If Left(arrSplit(index), 5) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - BUSINESS_UNIT_GL - row " & i, "BUSINESS_UNIT_GL matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - BUSINESS_UNIT_GL - row " & i, "BUSINESS_UNIT_GL in file " & Left(arrSplit(index), 5) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'0 - 4 and 0 - 5 but unsure what fields they represent to valiadte against in the database
			index = 6

			'27542 - 6 - ACCOUNT
			strTemp = Trim(DataTable("ACCOUNT", "ValidateRevProOutputFile"))
			If arrSplit(index) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - ACCOUNT - row " & i, "ACCOUNT matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - ACCOUNT - row " & i, "ACCOUNT in file " & arrSplit(index) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'Increase our index counter by 1
			index = index + 1

			'00999 - 7 - DEPTID
			strTemp = Trim(DataTable("DEPTID", "ValidateRevProOutputFile"))
			If arrSplit(index) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - DEPTID - row " & i, "DEPTID matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - DEPTID - row " & i, "DEPTID in file " & arrSplit(index) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'Increase our index counter by 1
			index = index + 1

			'AFFILIATE - 8 - often blank
			strTemp = Trim(DataTable("AFFILIATE", "ValidateRevProOutputFile"))
			If strTemp <> "" Then
				If arrSplit(index) = strTemp Then
					'WriteToReport micPass, 	"ValidateRevProOutputFile - AFFILIATE - row " & i, "AFFILIATE matches: " & strTemp, False
				Else
					WriteToReport micFail, "ValidateRevProOutputFile - AFFILIATE - row " & i, "AFFILIATE in file " & arrSplit(index) & " does not match with " & strTemp & " in database.", False
					ExitTest
				End If

				'We only increment our index counter if there was a field here
				index = index + 1
			Else
				'WriteToReport micPass, 	"ValidateRevProOutputFile - AFFILIATE - row " & i, "AFFILIATE matches: blank", False
			End If

			'USD - 8/9 - CURRENCY_CD
			strTemp = Trim(DataTable("CURRENCY_CD", "ValidateRevProOutputFile"))
			If arrSplit(index) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - CURRENCY_CD - row " & i, "CURRENCY_CD matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - CURRENCY_CD - row " & i, "CURRENCY_CD in file " & arrSplit(index) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'Increase our index counter by 1
			index = index + 1

			'USDCRRNT1 - 9/10 - Left(3) = FOREIGN_CURRENCY
			strTemp = Trim(DataTable("FOREIGN_CURRENCY", "ValidateRevProOutputFile"))
			If Left(arrSplit(index), 3) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - FOREIGN_CURRENCY - row " & i, "FOREIGN_CURRENCY matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - FOREIGN_CURRENCY - row " & i, "FOREIGN_CURRENCY in file " & Left(arrSplit(index), 3) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'USDCRRNT1 - 9/10 - Right(1) = RATE_MULT
			strTemp = Trim(DataTable("RATE_MULT", "ValidateRevProOutputFile"))
			If Right(arrSplit(index), 1) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - RATE_MULT - row " & i, "RATE_MULT matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - RATE_MULT - row " & i, "RATE_MULT in file " & Right(arrSplit(index), 1) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'USDCRRNT1 - 9/10 -  MID(4, len - 4[3 for currency, 1 for rate_mult) = RT_TYPE
			strTemp = Trim(DataTable("RT_TYPE", "ValidateRevProOutputFile"))
			If Mid(arrSplit(index), 4, Len(arrSplit(index)) - 4) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - RT_TYPE - row " & i, "RT_TYPE matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - RT_TYPE - row " & i, "RT_TYPE in file " & Mid(arrSplit(index), 4, Len(arrSplit(index)) - 4) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'Increase our index counter by 1
			index = index + 1

			'1 - 10/11 - RATE_DIV
			strTemp = Trim(DataTable("RATE_DIV", "ValidateRevProOutputFile"))
			If Trim(arrSplit(index)) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - RATE_DIV - row " & i, "RATE_DIV matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - RATE_DIV - row " & i, "RATE_DIV in file " & Trim(arrSplit(index)) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'Increase our index counter by 1
			index = index + 1

			'9333.3 - 11/12 - MONETARY_AMOUNT.
			'Format changes between values and number of zeroes, so accounting for options. Also, was told not to fail test for this.
			strTemp = Trim(DataTable("MONETARY_AMOUNT", "ValidateRevProOutputFile"))
		
			'Special currency formatting needed for leading zeroes on negative values less than a dollar
			If Left(strTemp, 2) = "-0" Then
				strTemp = FormatNumber(strTemp,,0)
			End If
			If (Trim(FormatNumber(arrSplit(index), 3)) = strTemp) OR (InStr(1, arrSplit(index), strTemp, vbTextcompare) >= 1) OR InStr(1, strTemp, arrSplit(index), vbTextcompare) >= 1 Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - MONETARY_AMOUNT - row " & i, "MONETARY_AMOUNT matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - MONETARY_AMOUNT - row " & i, "MONETARY_AMOUNT in file " & arrSplit(index) & " does not contain " & strTemp & " from database.", False
				'ExitTest
			End If

			'Increase our index counter by 1
			index = index + 1

			'9333.3 - 12 - FOREIGN_AMOUNT
			'Same as MONETARY_AMOUNT above
			strTemp = Trim(DataTable("FOREIGN_AMOUNT", "ValidateRevProOutputFile"))
		
			'Special currency formatting needed for leading zeroes on negative values less than a dollar
			If Left(strTemp, 2) = "-0" Then
				strTemp = FormatNumber(strTemp,,0)
			End If

			If (Trim(FormatNumber(arrSplit(index), 3)) = strTemp) OR (InStr(1, arrSplit(index), strTemp, vbTextcompare) >= 1) OR InStr(1, strTemp, arrSplit(index), vbTextcompare) >= 1 Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - FOREIGN_AMOUNT - row " & i, "FOREIGN_AMOUNT matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - FOREIGN_AMOUNT - row " & i, "FOREIGN_AMOUNT in file " & arrSplit(index) & " does not contain " & strTemp & " from database.", False
				'ExitTest
			End If

			'Increase our index counter by 1
			index = index + 1

			'0 - 13/14 - STATISTIC_AMOUNT
			strTemp = Trim(DataTable("STATISTIC_AMOUNT", "ValidateRevProOutputFile"))
			If Trim(arrSplit(index)) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - STATISTIC_AMOUNT - row " & i, "STATISTIC_AMOUNT matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - STATISTIC_AMOUNT - row " & i, "STATISTIC_AMOUNT in file " & Trim(arrSplit(index)) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'Increase our index counter by 1
			index = index + 1

			'N - 14/15 - MOVEMENT_FLAG
			strTemp = Trim(DataTable("MOVEMENT_FLAG", "ValidateRevProOutputFile"))
			If Trim(arrSplit(index)) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - MOVEMENT_FLAG - row " & i, "MOVEMENT_FLAG matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - MOVEMENT_FLAG - row " & i, "MOVEMENT_FLAG in file " & Trim(arrSplit(index)) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'Increase our index counter by 1
			index = index + 1

			'0 - 15/16 - DOC_SEQ_NBR
			strTemp = Trim(DataTable("DOC_SEQ_NBR", "ValidateRevProOutputFile"))
			If Trim(arrSplit(index)) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - DOC_SEQ_NBR - row " & i, "DOC_SEQ_NBR matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - DOC_SEQ_NBR - row " & i, "DOC_SEQ_NBR in file " & Trim(arrSplit(index)) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'Increase our index counter by 1
			index = index + 1

			'GLJ - 16/17 - IU_SYS_TRAN_CD
			strTemp = Trim(DataTable("IU_SYS_TRAN_CD", "ValidateRevProOutputFile"))
			If Trim(arrSplit(index)) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - IU_SYS_TRAN_CD - row " & i, "IU_SYS_TRAN_CD matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - IU_SYS_TRAN_CD - row " & i, "IU_SYS_TRAN_CD in file " & Trim(arrSplit(index)) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			'Increase our index counter by 1
			index = index + 1

			'GENERAL - 17/18 - IU_TRAN_CD
			strTemp = Trim(DataTable("IU_TRAN_CD", "ValidateRevProOutputFile"))
			If Trim(arrSplit(index)) = strTemp Then
				'WriteToReport micPass, 	"ValidateRevProOutputFile - IU_TRAN_CD - row " & i, "IU_TRAN_CD matches: " & strTemp, False
			Else
				WriteToReport micFail, "ValidateRevProOutputFile - IU_TRAN_CD - row " & i, "IU_TRAN_CD in file " & Trim(arrSplit(index)) & " does not match with " & strTemp & " in database.", False
				ExitTest
			End If

			WriteToReport micPass, 	"ValidateRevProOutputFile - row " & i, "All fields in this row match!", False
			
			'Advance to the next row of the datatable
			i = i + 1
			DataTable.GetSheet("ValidateRevProOutputFile").SetCurrentRow(i)
			
		'No Else for this statement - if the sequence number doesn't match, we advance lines in the file and not the data table
		End If
	Loop

	'Close our file
	strReadFile.Close
	Set strReadFile = Nothing

	'Cleanup our RegExp object
	Set regex = Nothing

	'CHECK IS NO LONGER VALID - LINES WITH ZERO AMOUNT ARE NOT WRITTEN TO DATABASE
'	'If our file has a different line count than the database, report an error and stop the test
'	DataTable.GetSheet("ValidateRevProOutputFile").SetCurrentRow(i)
'	If Trim(DataTable("BUSINESS_UNIT", "ValidateRevProOutputFile")) = "" Then
'		WriteToReport micPass, "ValidateRevProOutputFile", "Line numbers match in database and the text file", False
'	Else
'		WriteToReport micFail, "ValidateRevProOutputFile", "More lines in database than in file, check for errors", False
'		ExitTest
'	End If
End Function

'**************************************************************************************************************
''' <summary> 
''' CopyOverScenarioFiles Function grabs the most recent file from the RevPro output folders and copies it over to the input folders for RevRec GL
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>05-Mar-18</datecreated>
''' <startstate>RevPro files have been created</startstate>
''' <endstate>RevPro files have been stored in the RevRec folders</endstate>
''' <returns type="NA"></returns>
'Change Control: 
'Date of Change 	Author 			Description of change
'**************************************************************************************************************
Public Function CopyOverScenarioFiles
	Dim arrProperties, arrRevRecMonthEnd(3), arrRevRecScenarios(3), arrSplit
	Dim strNetworkPath, strOutputPath, strTemp
	Dim f, file, folder, i
	Dim objFiles, objFolders, objFSO, objWorkingFolder, oFile
	Dim sDate, sTime, sSplit, sBaseOrPatch
	Dim newFilePath
	Dim bFileFound

	'TestDataLocalPath -> RevRecInputFolder
	'Environment("RevProOutputFolder")
	'Environment("RevRecInputFolder")

	'Populate our two arrays for our potential max of three months each of files to process
	arrRevRecMonthEnd(0) = "MonthEnd1"
	arrRevRecMonthEnd(1) = "MonthEnd2"
	arrRevRecMonthEnd(2) = "MonthEnd3"
	arrRevRecScenarios(0) = "Month1"
	arrRevRecScenarios(1) = "Month2"
	arrRevRecScenarios(2) = "Month3"

	'Create our object for interacting with files
	Set objFSO = CreateObject("Scripting.FileSystemObject")

	'Assign the working directory to an object
	strNetworkPath = Environment("RevProOutputFolder")
	Set objWorkingFolder = objFSO.GetFolder(strNetworkPath)
	Set objFiles = objWorkingFolder.Files
	For Each file in objFiles

		'Set our flag each loop
		bFileFound = False

		'search for our transaction files
		If InStr(1, file.Name, "transactions", vbTextCompare) >= 1 AND InStr(1, file.Name, "txt", vbTextCompare) >= 1 AND InStr(1, file.Name, sBaseOrPatch, vbTextcompare) Then
			arrProperties = Split(file.Name, "_M")
			strTemp = Left(arrProperties(1), 1)
			If strTemp >= 1 AND strTemp <= 4 Then
				bFileFound = True
				newFilePath = Environment("RevRecInputFolder") & arrRevRecScenarios(strTemp - 1) & sBaseOrPatch & "\REVPRO_RP_" & file.Name
			End If
		ElseIf InStr(1, file.Name, "monthend", vbTextCompare) >= 1 AND InStr(1, file.Name, "txt", vbTextCompare) >= 1 AND InStr(1, file.Name, sBaseOrPatch, vbTextcompare) Then
			arrProperties = Split(file.Name, "_M")
			strTemp = Left(arrProperties(1), 1)
			If strTemp >= 1 AND strTemp <= 4 Then
				bFileFound = True
				newFilePath = Environment("RevRecInputFolder") & arrRevRecMonthEnd(strTemp - 1) & sBaseOrPatch & "\REVPRO_RP_" & file.Name
			End If
		End If

		If bFileFound Then
			WriteToReport micPass, "CopyOverScenarioFiles - REVPRO file found", "Ready to start processing REVPRO file " & file.Name & ".", False

			'Copy our file to the RevRec input folder
			objFSO.Copyfile strNetworkPath & file.Name, newFilePath

			'Move our working copy once we confirm that the file copied successfully
			If objFSO.FileExists(newFilePath) Then
				WriteToReport micPass, "CopyOverScenarioFiles- Scenario File Copied", "New file " & newFilePath & " copied.", False
				objFso.CopyFile strNetworkPath & file.Name, strNetworkPath & "Old\REVPRO_RP_" & file.Name
				objFso.DeleteFile strNetworkPath & file.Name
			Else
				WriteToReport micFail, "CopyOverScenarioFiles- Scenario File Not Copied", "New file " & newFilePath & " was not copied. Exiting test.", False
				Set objFiles = Nothing
				Set objFolders = Nothing
				Set objWorkingFolder = Nothing
				Set objFSO = Nothing
				ExitTest
			End If
		End If
	Next

	'Clean up our file objects
	Set objFiles = Nothing
	Set objFolders = Nothing
	Set objWorkingFolder = Nothing
	Set objFSO = Nothing
End Function

Public Function CopyOverScenarioFiles_OLD_TBD
	Dim arrProperties, arrRevProScenarios(2), arrRevRecScenarios(2), arrSplit
	Dim strNetworkPath, strOutputPath, strTemp
	Dim f, file, folder, i
	Dim objFiles, objFolders, objFSO, objWorkingFolder, oFile
	Dim sDate, sTime
	Dim newFilePath

	'Populate arrays with output folders so we can run this in a loop
	'arrRevProScenarios(0) = "01_"	arrRevProScenarios(1) = "01a_"	arrRevProScenarios(2) = "04_"	arrRevProScenarios(3) = "04a_"	arrRevProScenarios(4) = "08_"
	'arrRevProScenarios(5) = "09_"	arrRevProScenarios(6) = "11_"	arrRevProScenarios(7) = "13_"	arrRevProScenarios(8) = "14_"	arrRevProScenarios(9) = "15a_"
	'arrRevProScenarios(10) = "15b_"	arrRevRecScenarios(0) = "SC_01"	arrRevRecScenarios(1) = "SC_01a"	arrRevRecScenarios(2) = "SC_04"	arrRevRecScenarios(3) = "SC_04a"
	'arrRevRecScenarios(4) = "SC_08"	arrRevRecScenarios(5) = "SC_09"	arrRevRecScenarios(6) = "SC_11"		arrRevRecScenarios(7) = "SC_13"	arrRevRecScenarios(8) = "SC_14"
	'arrRevRecScenarios(9) = "SC_15a"	arrRevRecScenarios(10) = "SC_15b"

	'TestDataLocalPath -> RevRecInputFolder
	'Environment("RevProOutputFolder")
	'Environment("RevRecInputFolder")

	'Populate our arrays for our potential max of three months of files to process
	arrRevProScenarios(0) = ""
	arrRevProScenarios(1) = ""
	arrRevProScenarios(2) = ""
	arrRevRecScenarios(0) = "Month1"
	arrRevRecScenarios(1) = "Month2"
	arrRevRecScenarios(2) = "Month3"

	'Create our object for interacting with files
	Set objFSO = CreateObject("Scripting.FileSystemObject")

	'Assign the working directory to an object
	strNetworkPath = Environment("RevProOutputFolder")
	Set objWorkingFolder = objFSO.GetFolder(strNetworkPath) ' & "Components")

	'Get a list of the folders in our working folder
	'Set objFolders = objWorkingFolder.SubFolders

	'Search through each folder looking for the highest transaction ID
	'For Each folder in objFolders
	'For i = 0 to UBound(arrRevProScenarios)

		'Start inner folder loop here
		'For i = 0 to UBound(arrRevProScenarios)
	Set objFiles = objWorkingFolder.Files
	For Each file in objFiles

			'Search until our folder name contains an existing scenario
			'If InStr(1, folder.Name, arrRevProScenarios(i), vbTextCompare) >= 1 Then

				'Get a list of the files in our directory
				'Set objFiles = folder.Files

				'Reset our file searching variables
'				sDate = ""
'				sTime = ""
'				Set oFile = Nothing
'				oFile = ""

				'Iterate through each file to get the most recent revpro text file
				'For Each f in objFiles

					'Ensure that we are working on a RevPro text file and not a miscellaneous one in the folder
					'If InStr(1, f.Name, "Custom_Summary", vbTextCompare) >= 1 AND InStr(1, f.Name, "txt", vbTextCompare) >= 1 Then
		If InStr(1, file.Name, "transactions", vbTextCompare) >= 1 AND InStr(1, file.Name, "txt", vbTextCompare) >= 1 Then
					'If (InStr(1, file.Name, "ME", vbTextCompare) = 0) AND (InStr(1, file.Name, "_Summary", vbTextCompare) >= 1) AND (InStr(1, file.Name, "_M", vbTextCompare) >= 1) AND (InStr(1, file.Name, "txt", vbTextCompare) >= 1) Then
			arrProperties = Split(file.Name, "_M")
			strTemp = Left(arrProperties(1), 1)
			If strTemp >= 1 AND strTemp <= 3 Then

'						strTemp = f.DateCreated
'						arrProperties = Split(strTemp, " ")
'
'						'If this is our first file, we will use it as a baseline
'						If sDate = "" Then
'							sDate = arrProperties(0)
'							sTime = arrProperties(1) & arrProperties(2)
							'Set oFile = f
'							Set oFile = file
'							Exit For

'						'If our file is a more recent date than our previous one, use that. No need to compare the timestamp.
'						ElseIf (CStr(arrProperties(0)) > sDate) = True Then
'							sDate = arrProperties(0)
'							sTime = arrProperties(1) & arrProperties(2)
'							Set oFile = f
'
'						'If they're the same date, then we compare times and update if we have a newer one
'						ElseIf (CStr(arrProperties(0)) = sDate) = True AND (CStr(arrProperties(1) & arrProperties(2)) > sTime) = True Then
'							sDate = arrProperties(0)
'							sTime = arrProperties(1) & arrProperties(2)
'							Set oFile = f
'						End If
'					End If
				'End file loop
				'Next

			'End of the folder name checking if statement
			'End If

				'End inner(array) loop
'				Next

				'Exit the loop if there's no more files to process, exit the test run if we don't have a file to work with at all
'				If oFile <> "" Then
					'WriteToReport micPass, "CopyOverScenarioFiles - REVPRO file found", "Ready to start processing REVPRO file " & oFile.Name & " in location " & strNetworkPath & folder.Name & ".", False
				WriteToReport micPass, "CopyOverScenarioFiles - REVPRO file found", "Ready to start processing REVPRO file " & file.Name & ".", False

					'Copy our file to the RevRec input folder
				newFilePath = Environment("RevRecInputFolder") & arrRevRecScenarios(strTemp - 1) & "\REVPRO_RP_" & file.Name
					'objFSO.Copyfile strNetworkPath & folder.Name & "\\" & oFile.Name, newFilePath
					'objFSO.Copyfile strNetworkPath & "Components\\" & file.Name, newFilePath
				objFSO.Copyfile strNetworkPath & file.Name, newFilePath

				'Move our working copy once we confirm that the file copied successfully
				If objFSO.FileExists(newFilePath) Then
					WriteToReport micPass, "CopyOverScenarioFiles- Scenario File Copied", "New file " & newFilePath & " copied.", False
					objFso.CopyFile strNetworkPath & file.Name, strNetworkPath & "Old\REVPRO_RP_" & file.Name
					objFso.DeleteFile strNetworkPath & file.Name
				Else
					WriteToReport micFail, "CopyOverScenarioFiles- Scenario File Not Copied", "New file " & newFilePath & " was not copied. Exiting test.", False
					Set objFiles = Nothing
					Set objFolders = Nothing
					Set objWorkingFolder = Nothing
					Set objFSO = Nothing
					ExitTest
				End If
'			Else
'				If i = 0 Then
'					WriteToReport micFail, "CopyOverScenarioFiles - No REVPRO files found.", "No REVPRO summary files found. Exiting test.", False
'					Set objFiles = Nothing
'					Set objFolders = Nothing
'					Set objWorkingFolder = Nothing
'					Set objFSO = Nothing
'					ExitTest
'				Else
'					WriteToReport micDone, "CopyOverScenarioFiles - No more REVPRO files found. Exiting loop.", "No REVPRO summary file for Month " & i + 1 & ".", False
'					Exit For
'				End If

'					WriteToReport micFail, "CopyOverScenarioFiles - No REVPRO file found to process", "Unable to find a REVPRO file to process in location " & strNetworkPath & folder.Name & ".", False
'					Set objFiles = Nothing
'					Set objFolders = Nothing
'					Set objWorkingFolder = Nothing
'					Set objFSO = Nothing
'					ExitTest
			End If
		End If
	'End outer(folder) loop
	Next

	'Clean up our file objects
	Set objFiles = Nothing
	Set objFolders = Nothing
	Set objWorkingFolder = Nothing
	Set objFSO = Nothing
End Function

'**************************************************************************************************************
''' <summary> 
''' Delete a pending interface ID and validate that it is removed - BI27_01_DeleteInterfaceID
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>February 14, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function DeleteInterfaceID
	Dim interfaceID, rowNum
	Dim strID
	Dim arrID

	'Navigate to the Billing > Interface Transactions > Delete Pending Transactions page
	If SelectMainMenu1(GlobalDictionary("DeletePending")) Then
		WriteToReport micPass, "DeleteInterfaceID", "Navigated to Delete Pending Transactions page", False
	Else
		WriteToReport micFail, "DeleteInterfaceID", "Unable to navigate to Delete Pending Transactions page", True
		ExitTest
	End If

	'Grab an existing Interface ID
	With Browser("PeopleSoft Browser").Page("Delete Pending Transactions").PSFrame("Delete Pending Transactions")

		'Validate we have an object on our page to start the selection logic
		If .Link("html id:=INTFC_ID\$0").Exist(10) Then

			'Determine the row number - always in format <name>$<row>
			interfaceID = Trim(.Link("html id:=INTFC_ID\$0").GetROProperty("innertext"))	'EG, 1004380
			WriteToReport micPass, "DeleteInterfaceID - ID", "Interface ID is " & interfaceID, True

		'Otherwise, exit the test
		Else
			WriteToReport micFail, "DeleteInterfaceID", "Unable to locate an interface ID", True
			ExitTest
		End If
	End With

	'Navigate to the Billing > Interface Transactions > Review Pending Transactions page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection")) Then
		WriteToReport micPass, "DeleteInterfaceID", "Navigated to Review Pending Transactions page", False
	Else
		WriteToReport micFail, "DeleteInterfaceID", "Unable to navigate to Review Pending Transactions page", True
		ExitTest
	End If

	'Validate our interface ID exists and is found
	With Browser("PeopleSoft Browser").Page("Review Pending Transactions").PSFrame("TargetContent")

		'Click Search
'		.WebButton("Search").Click
'		Browser("PeopleSoft Browser").Sync

		'Confirm that we have results, otherwise we exit the test
'		If .Link("html id:=SEARCH_RESULT1").Exist(5) Then
'			WriteToReport micPass, "DeleteInterfaceID", "Search results found!", False
'		Else
'			WriteToReport micFail, "DeleteInterfaceID", "No search results found. Exiting test.", True
'			ExitTest
'		End If

		'Store the first interface result
'		interfaceID = .Link("html id:=SEARCH_RESULT1").GetROProperty("Innertext")

		'Enter the Interface Id and search again
		.WebEdit("InterfaceId").Set interfaceID 'EG, "1002885"

		'Click Search again to narrow our results and get a row count
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Print and store the row number. We're on a different page if only one entry returned.
		If .WebElement("LineNumber").Exist(5) Then
			rowNum = .WebElement("LineNumber").GetROProperty("innertext")
			WriteToReport micPass, "DeleteInterfaceID - Search Results", "Row results for interface ID found - " & rowNum, False
		Else
			'.WebButton("Return To Search").Click
			'We don't count the header row in the table
			rowNum = .WebTable("InterfaceID").GetROProperty("rows") - 1
			If rowNum <> 0 Then
				WriteToReport micPass, "DeleteInterfaceID - Search Results", "Row results for interface ID found - " & rowNum, False
			Else
				WriteToReport micFail, "DeleteInterfaceID - Search Results", "No search results for interface ID found.", True
				ExitTest
			End If
		End If
	End With

	'Navigate to the Billing > Interface Transactions > Delete Pending Transactions page
	If SelectMainMenu1(GlobalDictionary("DeletePending")) Then
		WriteToReport micPass, "DeleteInterfaceID", "Navigated to Delete Pending Transactions page", False
	Else
		WriteToReport micFail, "DeleteInterfaceID", "Unable to navigate to Delete Pending Transactions page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Delete Pending Transactions").PSFrame("Delete Pending Transactions")

		'Confirm that our link exists on the page before continuing
		If .Link("innertext:=" & interfaceID).Exist(10) Then	'EG, 1004380

			'Determine the row number - always in format <name>$<row>
			interfaceID = Trim(.Link("html id:=INTFC_ID\$0").GetROProperty("innertext"))
			strID = .Link("innertext:=" & interfaceID).GetROProperty("html id")
			arrID = Split(strID, "$")

			'Use the row(second location) to click the checkbox
			.WebCheckBox("html id:=BI_PND_INTFC_VW\$selm\$" & arrID(1) & "\$\$0").click

			'Click the delete button
			.WebButton("Delete").Click
			Browser("PeopleSoft Browser").Sync

			'Click ok
			If Browser("PeopleSoft Browser").Page("Delete Pending Transactions").WebButton("OK").Exist(5) Then
				Browser("PeopleSoft Browser").Page("Delete Pending Transactions").WebButton("OK").Click
				Browser("PeopleSoft Browser").Sync
			End If

			WriteToReport micPass, "DeleteInterfaceID", "Interface ID deleted!", True

		'Otherwise, exit the test
		Else
			WriteToReport micFail, "DeleteInterfaceID", "Unable to locate a link with interface ID of " & interfaceID, True
			ExitTest
		End If
	End With

	'Navigate back to the Billing > Interface Transactions > Review Pending Transactions page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection")) Then
		WriteToReport micPass, "DeleteInterfaceID", "Navigated back to Review Pending Transactions page", False
	Else
		WriteToReport micFail, "DeleteInterfaceID", "Unable to navigate back to Review Pending Transactions page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Review Pending Transactions").PSFrame("TargetContent")

		'Enter the Interface Id provided in Step 1
		.WebEdit("InterfaceId").Set interfaceID 'EG, "1002885"

		'Click Search
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Print and store the row number. We're on a different page if only one entry returned.
		If NOT .WebElement("LineNumber").Exist(5) Then
			WriteToReport micPass, "DeleteInterfaceID", "ID not found", False
		Else
			WriteToReport micFail, "DeleteInterfaceID", "ID found. Delete did not work.", True
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Validate that there are "pending" transactions on Billing Workcenter page - BI24_02
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>February 14, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function CreditCardExceptionProcessing
	Dim strResults

	'Navigate to Billing > Billing WorkCenter
 	If SelectMainMenu1(GlobalDictionary("MainMenuSelection")) Then
		WriteToReport micPass, "CreditCardExceptionProcessing", "Navigated to Billing WorkCenter page", False
	Else
		WriteToReport micFail, "CreditCardExceptionProcessing", "Unable to navigate to Billing WorkCenter page", True
		ExitTest
	End If

	'Using the OR
	With Browser("PeopleSoft Browser").Page("CDW Billing Dashboard")

		'Click on the Links/Billing Dashboard/Credit Card Exception Processing link
		Setting.WebPackage("ReplayType") = 2
		.PSFrame("Pagelet Area Page").Link("Credit Card Exception").Click
		Setting.WebPackage("ReplayType") = 1
		.PSFrame("Pagelet Area Page").Link("Credit Card Exception").DoubleClick
		Browser("PeopleSoft Browser").Sync

		'Minimum one minute wait
		Wait(60)
		Browser("PeopleSoft Browser").Sync

		'Confirm that the element has loaded after clicking the link
		If .PSFrame("Pivot Grid").WebButton("Plus").Exist(10) Then
			WriteToReport micPass, "CreditCardExceptionProcessing - Display Table", "Display Table found after clicking the Credit Card Exception link.", False
		Else
			WriteToReport micFail, "CreditCardExceptionProcessing - Display Table", "Display Table not found after clicking the Credit Card Exception link.", True
			ExitTest
		End If

		'Click the +/All button
		.PSFrame("Pivot Grid").WebButton("Plus").Click
		Browser("PeopleSoft Browser").Sync

		'Search existing results
		strResults = .PSFrame("Pivot Grid").WebElement("Labels").GetROProperty("innertext")
		If InStr(1, strResults, "Pending", vbTextCompare) Then
			WriteToReport micPass, "CreditCardExceptionProcessing", "Found 'Pending' results in results table.", False
'		ElseIf InStr(1, strResults, "Processing", vbTextCompare) Then
'			WriteToReport micWarning, "CreditCardExceptionProcessing", "Found 'Processing' results in results table.", False
'		ElseIf InStr(1, strResults, "No Action", vbTextCompare) Then
'			WriteToReport micWarning, "CreditCardExceptionProcessing", "Found 'No Action' results in results table.", False

		'If we have results but Pending isn't in the table, fail the test. This is expected behavior. Test may or may not always pass.
		ElseIf strResults <> "" Then
			WriteToReport micFail, "CreditCardExceptionProcessing", "No results for Pending status in table.", True
		Else
			WriteToReport micFail, "CreditCardExceptionProcessing", "Unable to find results in table.", True
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Validate that all links appear on Billing Workcenter page - BI23
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>February 16, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function VerifyBIWorkcenterLinks
	Dim arrLinks()
	Dim i

	'Navigate to Billing > Billing WorkCenter
 	If SelectMainMenu1(GlobalDictionary("MainMenuSelection")) Then
		WriteToReport micPass, "VerifyBIWorkcenterLinks", "Navigated to Billing WorkCenter page", False
	Else
		WriteToReport micFail, "VerifyBIWorkcenterLinks", "Unable to navigate to Billing WorkCenter page", True
		ExitTest
	End If

	'Verify the Items within the Bill Entry Group section matches the Bill Entry Group Section from the BI23 Functional Specification Document 
	ReDim arrLinks(6)
	arrLinks(0) = "Mass Update Interface"
	arrLinks(1) = "Standard Billing"
	arrLinks(2) = "Details"
	arrLinks(3) = "Adjust Entire Bill"
	arrLinks(4) = "Copy Single Bill"
	arrLinks(5) = "Adjustment History"
	arrLinks(6) = "Bills Not Invoiced"

	'Verify links exist on the page. Not exiting just in case there's multiple issues.
	For i = 0 To UBound(arrLinks)
		With Browser("PeopleSoft Browser").Page("Billing WorkCenter").PSFrame("Pagelet Area Page")
			If .Link(arrLinks(i)).Exist(5) Then
				WriteToReport micPass, "VerifyBIWorkcenterLinks - Bill Entry Group - " & arrLinks(i), "Link " & arrLinks(i) & " found!", False
			Else
				WriteToReport micFail, "VerifyBIWorkcenterLinks - Bill Entry Group - " & arrLinks(i), "Link " & arrLinks(i) & " not found on page. Check properties.", True
			End If
		End With
	Next

	'Verify the Items within the Other section exist on the page as well
	ReDim arrLinks(15)
	arrLinks(0) = "Contact Information"
	arrLinks(1) = "Email Invoices Summary"
	arrLinks(2) = "Process Customer Invoices"
	arrLinks(3) = "Edit EmailID for Courtesy"
	arrLinks(4) = "Review Customer Invoices"
	arrLinks(5) = "Collections Workbench"
	arrLinks(6) = "Process Monitor"
	arrLinks(7) = "Review Pending Transactions"
	arrLinks(8) = "Review Entries by Invoice"
	arrLinks(9) = "Review Entries by Journal"
	arrLinks(10) = "Standard Billing Upload"
	arrLinks(11) = "PS - Application Extender"
	arrLinks(12) = "APP EX Error Update Page"
	arrLinks(13) = "Update Invoice Flag/PO"
	arrLinks(14) = "General Information"
	arrLinks(15) = "Update Conversations"

	'Note - two links from the original specs don't exist. Try different users?
	'PS - Application Extender EIP and APP EX Error Update Page links

	'Verify links exist on the page. Not exiting just in case there's multiple issues.
	For i = 0 To UBound(arrLinks)
		With Browser("PeopleSoft Browser").Page("Billing WorkCenter").PSFrame("Pagelet Area Page")
			If .Link(arrLinks(i)).Exist(5) Then
				WriteToReport micPass, "VerifyBIWorkcenterLinks - Other Links - " & arrLinks(i), "Link " & arrLinks(i) & " found!", False
			Else
				WriteToReport micFail, "VerifyBIWorkcenterLinks - Other Links - " & arrLinks(i), "Link " & arrLinks(i) & " not found on page. Check properties.", True
			End If
		End With
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Create an invoice, process it, and confirm it is in an error state  - BI_18_3
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>February 21, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function VerifyInvoiceInError
	Dim sInstance, sRunID, sSQL, strTemp
	Dim arrRecordValues(), arrResults, arrProcess
	Dim i, nResult
	Dim bFound

	sSQL = "Select CUST_ID, ITEM, COLLECTOR from PS_ITEM WHERE BUSINESS_UNIT = '" & GlobalDictionary("BusinessUnit") &"' AND INVOICE <> '' ORDER BY ACCOUNTING_DT DESC"
	WriteToReport micDone, "SQL Query", sSQL, False
	arrResults = dbGetFirstRecord(sSQL,"", arrRecordValues, "VerifyInvoiceInError")

    On Error Resume Next
	nResult = UBound(arrResults)
	If nResult > 0 Then
        WriteToReport micPass, "VerifyInvoiceInError - SQL Query Executed", "SQL query successfully executed. Values were returned and the test will continue.", False
    Else
    	On Error Goto 0
    	WriteToReport micFail, "VerifyInvoiceInError - SQL Query Executed", "SQL query successfully executed. However, no values were returned and the test will stop.", False
    	ExitTest
	End If

	'Navigate to Customers > Contact Information
 	If SelectMainMenu1(GlobalDictionary("MainMenuSelection")) Then
		WriteToReport micPass, "VerifyInvoiceInError", "Navigated to Contact Information page", False
	Else
		WriteToReport micFail, "VerifyInvoiceInError", "Unable to navigate to Contact Information page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Contact Information").PSFrame("TargetContent")

		'Validate our email by searching up our invoice
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micPass, "VerifyInvoiceInError - Business Unit", "Business Unit is " & GlobalDictionary("BusinessUnit"), False
		.WebEdit("CustomerID").Set arrResults(0)
		WriteToReport micPass, "VerifyInvoiceInError - Customer ID", "Customer ID is " & arrResults(0), False
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Validate that we have search results, otherwise exit the test
		If .WebTable("SetID").Exist(10) Then
			WriteToReport micPass, "VerifyInvoiceInError - Search Results", "Search Results found!", False

			For i = 0 To .WebTable("SetID").GetROProperty("rows") - 2	'Table row count includes a header, and the elements are labeled starting at 0
				If UCase(.Link("html id:=RESULT1\$" & i).GetROProperty("innertext")) = UCase(arrResults(2)) Then
					.Link("html id:=RESULT1\$" & i).Click
					Browser("PeopleSoft Browser").Sync
					Exit For
				End If
			Next
		Else
			WriteToReport micFail, "VerifyInvoiceInError", "Unable to locate results table.", True
			ExitTest
		End If

		'Validate that we're on the new page, otherwise exit the test
		If Not .WebEdit("ContactEmail").Exist(10) Then
			WriteToReport micWarning, "VerifyInvoiceInError", "Unable to locate " & arrResults(2) & " in the results table. Taking first result.", True
			.Link("html id:=RESULT1\$0").Click
			Browser("PeopleSoft Browser").Sync
			'WriteToReport micFail, "VerifyInvoiceInError", "Unable to locate " & arrResults(2) & " in the results table.", True
			'ExitTest
		End If

		'Check our email and update if needed
		If UCase(.WebEdit("ContactEmail").GetROProperty("default value")) <> UCase(GlobalDictionary("SignInUser")) & "@CDW.COM" Then
			.WebButton("Correct History").Click
			Browser("PeopleSoft Browser").Sync
			.WebEdit("ContactEmail").Set UCase(GlobalDictionary("SignInUser")) & "@CDW.COM"
			.WebButton("Save").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Report our current email
		WriteToReport micPass, "VerifyInvoiceInError - EMail address", "Email address is " & .WebEdit("ContactEmail").GetROProperty("default value"), False
	End With

	'Navigate to Billing > Maintain Bills > Copy Single Bill
	If SelectMainMenu1(GlobalDictionary("CopySingleBill")) Then
		WriteToReport micPass, "VerifyInvoiceInError", "Navigated to Copy Single Bill page", False
	Else
		WriteToReport micFail, "VerifyInvoiceInError", "Unable to navigate to Copy Single Bill page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Copy Single Bill").PSFrame("TargetContent")

		.WebEdit("Business Unit").Set GlobalDictionary("BusinessUnit")
		.WebEdit("Invoice").Set arrResults(1)
		WriteToReport micPass, "VerifyInvoiceInError - Invoice", "Invoice is " & arrResults(1), False
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		If .WebRadioGroup("Bill Action").Exist(10) Then
			WriteToReport micPass, "VerifyInvoiceInError", "Invoice found", False
		Else
			WriteToReport micPass, "VerifyInvoiceInError", "Invoice not found. Check data.", True
			ExitTest			
		End If

		.WebRadioGroup("Bill Action").Select "CPY"
		Browser("PeopleSoft Browser").Sync

		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		WriteToReport micPass, "VerifyInvoiceInError", "Invoice copied and saved. Clicking Bill Header link.", False
		.Link("Go To Bill Header").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Finish loading our new tab
	Wait 30
	Browser("PeopleSoft Browser NewTab").Sync

	'Close the first tab
	Browser("CreationTime:=0").Close

	'Use the OR on our new tab(different properties from the first)
	'With Browser("PeopleSoft Browser").Page("Standard Billing").PSFrame("TargetContent")
	With Browser("PeopleSoft Browser NewTab").Page("Standard Billing").PSFrame("TargetContent")
		If .WebElement("Unit").Exist(30) Then
			WriteToReport micPass, "VerifyInvoiceInError - Header Info 1 Tabbed Page", "Header Info 1 Tabbed Page loaded successfully", False
		Else
			WriteToReport micFail, "VerifyInvoiceInError - Header Info 1 Tabbed Page", "Header Info 1 Tabbed Page loading failed", True
			ExitTest
		End If

		'Click on Line Info 1 tab
		If .WebElement("Line - Info 1").Exist(30) Then
			.WebElement("Line - Info 1").Click
			WriteToReport micPass, "VerifyInvoiceInError - Line Info 1 header", "Line Info 1 header clicked", False
		Else
			'There are some identification issues with the Line Info 1 tab during runtime
			If .WebTable("name:=Line - Info 1").Link("name:=Line - Info 1").Exist(30) Then
				.WebTable("name:=Line - Info 1").Link("name:=Line - Info 1").Click
				WriteToReport micPass, "VerifyInvoiceInError - Line Info 1 header", "Line Info 1 header clicked", False
			Else
				On Error GoTo 0
				WriteToReport micFail, "VerifyInvoiceInError - Line Info 1 header", "Line Info 1 header not clicked. Object not found on page", True
				ExitTest
			End If
		End If
		Browser("PeopleSoft Browser NewTab").Sync

		'Store our new invoice number
		GlobalDictionary("Invoice") = Trim(.WebElement("INVOICE").GetROProperty("innertext"))
		If GlobalDictionary("Invoice") <> "" Then
			WriteToReport micPass, "VerifyInvoiceInError - Invoice Captured", GlobalDictionary("Invoice"), False
		Else
			WriteToReport micFail, "VerifyInvoiceInError - Invoice Captured", "Unable to capture invoice number.", True
			ExitTest
		End If

		'Click our Header link
		.Link("Header - Info 1").Click
		WriteToReport micPass, "VerifyInvoiceInError - Header Link clicked", "Header Link clicked", False
		Browser("PeopleSoft Browser NewTab").Sync

		'Set our bill status to RDY
		If .WebEdit("BILL_STATUS").GetROProperty("innertext") <> "RDY" Then
			.WebEdit("BILL_STATUS").Set "RDY"
			WriteToReport micPass, "VerifyInvoiceInError - Bill Status", "Bill Status set to RDY", False
			Browser("PeopleSoft Browser NewTab").Sync
		End If

		'Select "Header - Service Info" from the dropdown
		.WebList("Navigation").Select "Header - Service Info"
		WriteToReport micPass, "VerifyInvoiceInError - Header Service Info option selected", "Header Service Info option selected", False
		Browser("PeopleSoft Browser NewTab").Sync

		'Confirm we've changed pages. This sometimes slows up when changing bill status
		If Not .WebEdit("ContractNumber").Exist(5) Then
			.WebList("Navigation").Select "Header - Service Info"
			Browser("PeopleSoft Browser NewTab").Sync	
		End If
		.WebEdit("ContractNumber").Set "NoMarketingPlan"

		'Go to the Line - Misc Info page
		.WebList("Navigation").Select "Line - Misc Info"
		WriteToReport micPass, "VerifyInvoiceInError - Line - Misc Info option selected", "Line - Misc Info option selected", False
		Browser("PeopleSoft Browser NewTab").Sync

		'Confirm PoP Required
		.WebEdit("PopRequired").Set "Y"

		'Update our FMP job number
		.WebEdit("FMP").Set "NoPoP"

		'Set our line number to 1
		.WebEdit("LineNumber").Set "1"

		'Click on Save button
		.WebButton("Save").Click
		If Browser("PeopleSoft Browser NewTab").Page("Standard Billing").WebButton("OK").Exist(5) Then
			Browser("PeopleSoft Browser NewTab").Page("Standard Billing").WebButton("OK").Click
		End If

		'Added to ensure Invoice Saved
		If Browser("PeopleSoft Browser").Page("Standard Billing").PSFrame("TargetContent").WebElement("Saving").Exist(30) Then
			WriteToReport micPass, "VerifyInvoiceInError - Save Invoice", "Invoice was saved.", False
		End If
	End With

	'Navigate to Billing > Generate Invoices > Non-Consolidated > Finalize And Print Invoices
 	If SelectMainMenu1(GlobalDictionary("GenInvFinalizePrint")) Then
		WriteToReport micPass, "VerifyInvoiceInError", "Navigated to Finalize And Print Invoices page", False
	Else
		WriteToReport micFail, "VerifyInvoiceInError", "Unable to navigate to Finalize And Print Invoices page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Finalize and Print Invoices")

		'Create a new run ID - EG, auto02122019
		Wait 2
		sRunID = "Auto" & CLng(Timer)
		WriteToReport micDone, "VerifyInvoiceInError", "Run Control ID is " & sRunID, False
		.PSFrame("TargetContent").Link("Add a New Value").Click
		Wait 2
		Browser("PeopleSoft Browser").Sync
		.PSFrame("TargetContent").WebEdit("RunID").Set sRunID
		.PSFrame("TargetContent").WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Enter our business unit
		.PSFrame("TargetContent").WebEdit("FromBU").Set GlobalDictionary("BusinessUnit")
		Browser("PeopleSoft Browser").Sync
		.PSFrame("TargetContent").WebEdit("ToBU").Set GlobalDictionary("BusinessUnit")
		Browser("PeopleSoft Browser").Sync

		'Enter our new invoice number - EG, SP-0033537-00
		.PSFrame("TargetContent").WebEdit("FromInvoice").Set GlobalDictionary("Invoice")
		Wait 1
		Browser("PeopleSoft Browser").Sync
		.PSFrame("TargetContent").WebEdit("ToInvoice").Set GlobalDictionary("Invoice")
		Browser("PeopleSoft Browser").Sync

		'Click Run to start our process
		.PSFrame("TargetContent").WebButton("Run").Click
		Browser("PeopleSoft Browser").Sync

		'Select the CDWAASOR process
		.PSFrame("Process Scheduler Request").WebCheckBox("CDWAASOR").Click	'Select?
		WriteToReport micDone, "VerifyInvoiceInError - Process", "Process started is CDWAASOR", False
		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		GlobalDictionary("Process") = "CDWAASOR"
		Browser("PeopleSoft Browser").Sync

		'Grab our process number
		sInstance = .PSFrame("Status Bar").WebElement("ProcessInstance").GetROProperty("innertext")
		arrProcess = split(sInstance, ":")
		sInstance = arrProcess(1)
		WriteToReport micDone, "VerifyInvoiceInError", "Process Instance is " & sInstance, False

		'Click the process monitor link
		.PsFrame("Status Bar").Link("Process Monitor").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Call our shared function for running and monitoring our process
	SharedProcessMonitor "VerifyInvoiceInError"

	'New step and validation added post-review:
	'login as GWENCHO
	Login(GlobalDictionary("AdminUser"))

	'Navigate to the CDW Billing > Advertising Accounting > PS AppEx Setup Page
	If SelectMainMenu1(GlobalDictionary("AppExSetup")) Then
		WriteToReport micPass, "VerifyInvoiceInError", "Navigated to PS AppEx Setup page", False
	Else
		WriteToReport micFail, "VerifyInvoiceInError", "Unable to navigate to PS AppEx Setup page", True
		ExitTest
	End If

	'Set our timeout to 1 minute, not 2 hours
	With Browser("PeopleSoft Browser").Page("PS - AppEx Setup Page").PSFrame("Setup Page for AASOR Inv")
		.WebEdit("TimeoutMinutes").Set "1"
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Wait the full minute before logging back in
	Wait 60

	'Log back in as our original user
	Login(GlobalDictionary("SignInUser"))

	'Navigate to CDW Billing > Advertising Accounting > PS - Application Extender EIP
	If SelectMainMenu1(GlobalDictionary("ApplicationExtender")) Then
		WriteToReport micPass, "VerifyInvoiceInError", "Navigated to PS - Application Extender EIP page", False
	Else
		WriteToReport micFail, "VerifyInvoiceInError", "Unable to navigate to PS - Application Extender EIP page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("PS - Application Extender").PSFrame("List of Invoices for AX/BI")

		'Search the WebTable("Results") for our invoice/customer ID, otherwise exit the test
'		bFound = False
'		For i = 0 To WebTable("Results").GetROProperty("rows") - 1
'			If Trim(.Link("html id:=INVOICE\$" & i).GetROProperty("innertext")) = GlobalDictionary("Invoice") Then
'				bFound = True
'				Exit For
'			End If
'		Next
'
'		'Confirm we have our invoice
'		If bFound Then
'			WriteToReport micPass, "VerifyInvoiceInError", "Found invoice " & GlobalDictionary("Invoice") & " in results table. Starting run.", False
'		Else
'			WriteToReport micFail, "VerifyInvoiceInError", "Did not find invoice " & GlobalDictionary("Invoice") & " in results table. Exiting test.", True
'			ExitTest
'		End If

		'Click the Run Process button
		.WebButton("Run Process").Click
		WriteToReport micPass, "VerifyInvoiceInError", "Run button clicked.", False
		Browser("PeopleSoft Browser").Sync

		'Click Yes
		If Browser("PeopleSoft Browser").Page("PS - Application Extender").WebButton("Yes").Exist(10) Then
			Browser("PeopleSoft Browser").Page("PS - Application Extender").WebButton("Yes").Click
			WriteToReport micPass, "VerifyInvoiceInError", "Yes button clicked.", False
		End If

		'Click OK
		If Browser("PeopleSoft Browser").Page("PS - Application Extender").WebButton("OK").Exist(10) Then
			Browser("PeopleSoft Browser").Page("PS - Application Extender").WebButton("OK").Click
			WriteToReport micPass, "VerifyInvoiceInError", "OK button clicked.", False
		End If

		GlobalDictionary("Process") = "CDW_BIAX_RSP"
		WriteToReport micPass, "VerifyInvoiceInError", "Run button clicked.", False
		.Link("Process Monitor").Click
		Browser("PeopleSoft Browser").Sync
		SharedProcessMonitor "VerifyInvoiceInError"
	End With
End Function

'AR14_GenerateJournals - unsure if needed
Public Function ARGenerateJournals

'	'Navigate to the Generate Journals page
'	If SelectMainMenu1(GlobalDictionary("MainMenuSelection")) Then
'		WriteToReport micPass, "ARGenerateJournals", "Navigated to Generate Journals page", False
'	Else
'		WriteToReport micFail, "ARGenerateJournals", "Unable to navigate to Generate Journals page", True
'		ExitTest
'	End If

	GenerateJournals
End Function

'**************************************************************************************************************
''' <summary> 
''' Unpost and validate a payment group
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>February 28, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function ARUnpostPaymentGroups
	Dim strMonth,sColNum , oTable

	'Navigate to the Unpost groups > Payment Group page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection")) Then
		WriteToReport micPass, "ARUnpostPaymentGroups", "Navigated to Payment Group page", False
	Else
		WriteToReport micFail, "ARUnpostPaymentGroups", "Unable to navigate to Payment Group page", True
		ExitTest
	End If

	'Use our OR to complete the test case
	With Browser("PeopleSoft Browser").Page("Payment Group").PSFrame("TargetContent")

		'Enter our deposit unit - EG, 00001, 00002
		.WebEdit("DepositUnit").Set GlobalDictionary("DepositUnit")

		'Might not need since we have to filter by open periods. Can add back in if the search times out
		'.WebEdit("DepositID").Set GlobalDictionary("DepositID")
		'.WebEdit("PaymentID").Set GlobalDictionary("PaymentID")

		'Refine our search for the run date - make sure it's after the first of the month so we know it's in an open period
		.WebList("PostedDate").Select(5)	'>=

		'Create a date range for the first day of whatever month/year you run
		strMonth = Month(Date)
		If Len(strMonth) < 2 Then
			strMonth = "0" & strMonth
		End If
		.WebEdit("PostedDate").Set strMonth & "/01/" & Year(Date)	'2019"
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync


		'Validate that we have a results table
		If .WebTable("Deposit Unit").Exist(60) Then
			WriteToReport micPass, "ARUnpostPaymentGroups", "Results table exists", False

			Set oTable = Browser("PeopleSoft Browser").Page("Payment Group").PSFrame("TargetContent").WebTable("Deposit Unit")
		
			sColNum = GetColumn(oTable, "Deposit ID")
			GlobalDictionary("DepositID") = .WebTable("Deposit Unit").GetCellData(2,sColNum)
			
			sColNum = GetColumn(oTable, "Payment ID")
			GlobalDictionary("PaymentID") = .WebTable("Deposit Unit").GetCellData(2,sColNum)

			sColNum = GetColumn(oTable, "Group ID")
			GlobalDictionary("groupID") = .WebTable("Deposit Unit").GetCellData(2,sColNum)

			'Click on the results link and go to the next page
			.Link("html id:=RESULT3\$0").Click
			Browser("PeopleSoft Browser").Sync
		ElseIf NOT .WebElement("Options").Exist(30) Then
			WriteToReport micFail, "ARUnpostPaymentGroups", "No results table exists", True
			ExitTest
		End If

		'Validate that we are on the results page
		If .WebElement("Options").Exist(30) Then
			WriteToReport micPass, "ARUnpostPaymentGroups", "Options tab exists. Page loaded.", False
		Else
			WriteToReport micFail, "ARUnpostPaymentGroups", "No options table exists. Page did not load. Exiting test.", True
			ExitTest
		End If

		'Click the options header
		.WebElement("Options").Click
		Browser("PeopleSoft Browser").Sync

		'Enter our Unpost reason
		.WebEdit("UnpostReason").Set GlobalDictionary("UnpostReason")
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Make sure we don't get a popup. It should save with no errors
		If .WebButton("OK").Exist(5) Then
			WriteToReport micFail, "ARUnpostPaymentGroups", "Journal did not save. Might not be in an open period. Please check data. Exiting test.", True
			ExitTest
		End If

		'Click the Action tab
		.WebElement("Action").Click
		Browser("PeopleSoft Browser").Sync

		'Store our UnpostGroupID
		GlobalDictionary("unpostGroupID") = .WebElement("UnpostGroupID").GetROProperty("innertext")

		'Set the BATCH STANDARD posting action
		.WebList("ProcessList").Select(2)

		'Click OK
		.WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync

		'Click save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync
	End With

	UnpostARGroups "ARUnpostPaymentGroups"
	
	ValidateARGroups "ARUnpostPaymentGroups"
End Function

'**************************************************************************************************************
''' <summary> 
''' Unpost and validate a transfer group
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>February 28, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function ARUnpostTransferGroups
	Dim strMonth, strSQL
	Dim i, nResult
	Dim arrResults, arrRecordValues()
	Dim k, objItems, objResults1, objResults2

	'Navigate to the Unpost groups > Transfer Group page
	If SelectMainMenu1(GlobalDictionary("MainMenuSelection")) Then
		WriteToReport micPass, "ARUnpostTransferGroups", "Navigated to Transfer Group page", False
	Else
		WriteToReport micFail, "ARUnpostTransferGroups", "Unable to navigate to Transfer Group page", True
		ExitTest
	End If

	'Use our OR to complete the test case
	With Browser("PeopleSoft Browser").Page("Transfer Group").PSFrame("TargetContent")

		'Enter our deposit unit - EG, 00001, 00002
		.WebEdit("GroupUnit").Set GlobalDictionary("DepositUnit")

'		'Refine our search for the run date - make sure it's after the first of the month so we know it's in an open period
'		.WebList("PostedDate").Select(5)	'>=
'
'		'Create a date range for the first day of whatever month/year you run
'		strMonth = Month(Date)
'		If Len(strMonth) < 2 Then
'			strMonth = "0" & strMonth
'		End If
'		.WebEdit("PostedDate").Set strMonth & "/01/" & Year(Date)	'2019"

		'Click search and wait for results
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Validate that we have a results table
		If .WebTable("Group Unit").Exist(30) Then
			WriteToReport micPass, "ARUnpostTransferGroups", "Results table exists", False

			'If there is a View All link enabled, click it
			If .Link("View All").Exist(5) Then
				.Link("View All").Click
				Browser("PeopleSoft Browser").Sync
			End If

			'Click the "Entered By" link twice to sort by the most recent date
			.Link("Entered Date").Click
			.Link("Entered Date").Click

			'/element to sort by? We want the most recent date
			'Take the first result and store our payment & deposit ids
			GlobalDictionary("groupID") = Trim(.Link("html id:=RESULT1\$0").GetROProperty("innertext"))
			WriteToReport micPass, "ARUnpostTransferGroups", "Group ID is " & GlobalDictionary("groupID"), False

			'Click on the results link and go to the next page
			.Link("html id:=RESULT1\$0").Click
			Browser("PeopleSoft Browser").Sync
		ElseIf NOT .WebElement("Options").Exist(30) Then
			WriteToReport micFail, "ARUnpostTransferGroups", "No results table exists", True
			ExitTest
		End If

		'Validate that we are on the results page. We also end up here automatically if there's only one result
		If .WebElement("Options").Exist(30) Then
			WriteToReport micPass, "ARUnpostTransferGroups", "Options tab exists. Page loaded.", False

			'If there wasn't a results table, then we need to store the group ID
			If GlobalDictionary("groupID") = "" Then
				GlobalDictionary("groupID") = Trim(.WebElement("GroupID").GetROProperty("innertext"))
			End If
		Else
			WriteToReport micFail, "ARUnpostTransferGroups", "No options table exists. Page did not load. Exiting test.", True
			ExitTest
		End If

		'Check the SQL table for results based on our group ID. Will be used later to compare against
		strSQL = "select TOP 50 * from PS_ITEM_ACTIVITY WHERE BUSINESS_UNIT = '" & GlobalDictionary("DepositUnit") & "' AND GROUP_ID = '" & GlobalDictionary("groupID") & "'"
		nResult = -1
		arrResults = dbGetRecords(strSQL, "", arrRecordValues, "ARUnpostTransferGroups_Before")
		On Error Resume Next

		'Click the options header
		.WebElement("Options").Click
		Browser("PeopleSoft Browser").Sync

		'Enter our Unpost reason
		.WebEdit("UnpostReason").Set GlobalDictionary("UnpostReason")
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Make sure we don't get a popup. It should save with no errors
		If .WebButton("OK").Exist(5) Then
			WriteToReport micFail, "ARUnpostTransferGroups", "Journal did not save. Might not be in an open period. Please check data. Exiting test.", True
			ExitTest
		End If

		'Click the Action tab
		.WebElement("Action").Click
		Browser("PeopleSoft Browser").Sync

		'Store our UnpostGroupID
		GlobalDictionary("unpostGroupID") = .WebElement("UnpostGroupID").GetROProperty("innertext")
		WriteToReport micPass, "ARUnpostTransferGroups", "Unpost Group ID is " & GlobalDictionary("unpostGroupID"), False

		'Set the BATCH STANDARD posting action
		.WebList("ProcessList").Select(2)

		'Click OK
		.WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync

		'Click save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Run the AR_UPDATE process
	UnpostARGroups "ARUnpostTransferGroups"

	'Create our dictionaries with case-insensitive keys so as to remove duplicates
	Set objItems = CreateObject("Scripting.Dictionary")
	objItems.CompareMode = vbTextCompare
	Set objResults1 = CreateObject("Scripting.Dictionary")
	objResults1.CompareMode = vbTextCompare
	Set objResults2 = CreateObject("Scripting.Dictionary")
	objResults2.CompareMode = vbTextCompare

	'Loop through our data table, storing each unique Item ID business unit with the transaction ID(identical).
	'Can erase and use our unique IDs for each transaction if needed later
	For i = 1 To DataTable.GetSheet("ARUnpostTransferGroups_Before").GetRowCount
		DataTable.GetSheet("ARUnpostTransferGroups_Before").SetCurrentRow(i)
		objResults1(DataTable.Value("CUST_ID", "ARUnpostTransferGroups_Before") & ";" & DataTable.Value("ITEM", "ARUnpostTransferGroups_Before")) = DataTable.Value("ENTRY_AMT", "ARUnpostTransferGroups_Before")
		objItems(DataTable.Value("ITEM", "ARUnpostTransferGroups_Before")) = DataTable.Value("ITEM_SEQ_NUM", "ARUnpostTransferGroups_Before")
	Next

	'Second round of SQL to take the unique items from our first query(stored in the datatable) and compare their status after the job ran
	'This is (or should be) 2 times the results returned in our initial query, so we use that count here
	strSQL = "select TOP " & 2 * objResults1.Count & " * from PS_ITEM WHERE ITEM IN ('"

	'Loop through our unique keys(Item IDs) to help create our sql string
	For Each k in objItems.Keys
		strSQL = strSQl & k & "', '"
	Next

	'Trim off the last three spaces of our string, as we don't have any more entries to add. The , ' part.
	strSQL = Left(strSQL, Len(strSQL) - 3)

	'Now that our string is trimmed up, close off the parentheses
	strSQL = strSQL & ")"

	nResult = -1
	arrResults = dbGetRecords(strSQL, "", arrRecordValues, "ARUnpostTransferGroups_After")

	'Store the info from the second table
	For i = 1 To DataTable.GetSheet("ARUnpostTransferGroups_After").GetRowCount
		DataTable.GetSheet("ARUnpostTransferGroups_After").SetCurrentRow(i)
		objResults2(DataTable.Value("CUST_ID", "ARUnpostTransferGroups_After") & ";" & DataTable.Value("ITEM", "ARUnpostTransferGroups_After")) = DataTable.Value("BAL_AMT", "ARUnpostTransferGroups_After")
	Next

	'Compare results - results should not match
	For Each k in objResults1.Keys
		If objResults1(k) <> objResults2(k) Then
			WriteToReport micPass, k, objResults1(k) & " vs " & objResults2(k), False
		Else
			WriteToReport micFail, k, objResults1(k) & " vs " & objResults2(k), False
		End If
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Shared code for running the unpost and validation AR processes for groups
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>February 28, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition: An ARUnpost function has been ran, such as PaymentGroups or TransferGroups
'Parameter: FunctionName - string of the function that called it. Used for reporting.
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function ValidateARGroups(functionName)

	'Validate our payment
	'Log back in to our original user
	Login(GlobalDictionary("SignInUser"))

	'Navigate to Accounts Receivable > Payments > Apply Payments > Create Worksheet
	If SelectMainMenu1(GlobalDictionary("CreateWorksheetAR")) Then
		WriteToReport micPass, functionName, "Navigated to Create Worksheet page", False
	Else
		WriteToReport micFail, functionName, "Unable to navigate to Create Worksheet page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Create Worksheet_AR").PSFrame("TargetContent")

		'Enter our fields we stored earlier
		.WebEdit("DepositUnit").Set GlobalDictionary("DepositUnit")
		.WebEdit("DepositID").Set GlobalDictionary("DepositID")
		.WebEdit("PaymentID").Set GlobalDictionary("PaymentID")
		'.WebList("PaymentStatus").Select(9)	'Unposted Direct Journal is 8, Worksheet is 9
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Is there a results table? Appears with multiple instances of an ID
		If .WebTable("Deposit Unit").Exist(10) Then
			WriteToReport micPass, functionName, "Results table found", False

		'Is there only one entry and we're on the second page?
		ElseIf .WebButton("Build").Exist(5) Then
			WriteToReport micPass, functionName, "Results page loaded", False

		'If neither is true, then we fail the test
		Else
			WriteToReport micFail, functionName, "No results found", True
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Shared code for running the AR_UPDATE processes used for unposting groups
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>February 28, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition: An ARUnpost function has been ran, such as PaymentGroups or TransferGroups
'Parameter: FunctionName - string of the function that called it. Used for reporting.
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function UnpostARGroups(functionName)
	Dim strMonth, strTemp
	Dim arrTemp
	Dim runID

	'Switch users to CDW_BATCH
	'LoginCDWBATCH

	'Now we run the ARUpdate process
	'Navigate to the Accounts Receivable > Receivables Update > Request Receivables Update
	If SelectMainMenu1(GlobalDictionary("ARUpdate")) Then
		WriteToReport micPass, functionName, "Navigated to Request Receivables Update page", False
	Else
		WriteToReport micFail, functionName, "Unable to navigate to Request Receivables Update page", True
		ExitTest
	End If

	'Use the OR
	With Browser("PeopleSoft Browser").Page("Request Receivables Update")

		'Create a new Run ID
		.PSFrame("TargetContent").WebElement("Add a New Value").Click
		Browser("PeopleSoft Browser").Sync

		runID = "ARTest" & CLng(Timer)
		.PSFrame("TargetContent").WebEdit("RunID").Set runID 'EG, "Auto022620191533"
		.PSFrame("TargetContent").WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm our page loaded
		If .PSFrame("TargetContent").WebEdit("GroupUnit").Exist(10) Then
			WriteToReport micPass, functionName, "Run control " & runID & " created", False
		Else
			WriteToReport micFail, functionName, "Unable to create Run Control " & runID, True
			ExitTest
		End If

		'Enter our search criteria
		.PSFrame("TargetContent").WebEdit("GroupUnit").Set GlobalDictionary("DepositUnit")
		.PSFrame("TargetContent").WebList("ProcessFrequency").Select(1) 'A

		'Set our date
		If GlobalDictionary("FromDate") = "" Then
			strMonth = Month(Date)
			If Len(strMonth) < 2 Then
				strMonth = "0" & strMonth
			End If
			.PSFrame("TargetContent").WebEdit("FromDate").Set strMonth & "/01/" & Year(Date) 'first of the month
		Else
			.PSFrame("TargetContent").WebEdit("FromDate").Set GlobalDictionary("FromDate")
			'.PSFrame("TargetContent").WebEdit("ToDate").Set GlobalDictionary("ToDate")
		End If
		.PSFrame("TargetContent").WebEdit("ToDate").Set Date 'today

		'Enter our run criteria
		.PSFrame("TargetContent").WebList("ProcessFrequency").Select "Always"

		'Click Save
		.PSFrame("TargetContent").WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Click Run
		.PSFrame("TargetContent").WebButton("Run").Click
		Browser("PeopleSoft Browser").Sync

		'New window popup
		.PSFrame("Process Scheduler Request").WebCheckBox("SelectFlag").Click
		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync

		'Close the popup and return to the main page
		strTemp = .PSFrame("Status Bar").WebElement("ProcessInstance").GetROProperty("innertext")
		arrTemp = Split(strTemp, ":")
		GlobalDictionary("InstanceNumber") = arrTemp(1)
		WriteToReport micDone, functionName & " - Instance number", arrTemp(1), False
		.PSFrame("Status Bar").Link("Process Monitor").Click
		Browser("PeopleSoft Browser").Sync

		'Run the process
		GlobalDictionary("Process") = "ARUPDATE"
		SharedProcessMonitor functionName
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the AR14ACH testcase to create a new supplier and link the appropriate customer ID
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>March 8, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function AR14ACH
	Dim i, dtVendorID, dtDescription
	Dim dtbankDescription, dtBankName, dtBankQualifier, dtBankID, dtAcctNumber, dtDFIQualifier, dtAcctType, appBankIDqualifier
	Dim newSupplierID, custID

	'Need GlobalDictionary values for VendorID, SupplierName, ShortName
	dtVendorId=(GlobalDictionary("VendorID")) & inVoiceNumberGeneration' RandomNumberGeneraion & Day(Date)

	'Navigate to Suppliers --> Supplier Information --> Add/Update--> Supplier and add new supplier and provide the names
	'As written, every step applies to steps 1, 2, and 3 in TFS
	Call AddNewSupplierNavigate()

	'TODO IF NEEDED: Last part of step 3 - add Persistence - defaults to Regular, which is what the test wants

	'wait for the ojects to get loaded
	app_SearchSync()	

	'Click on additional ID numbers and fill out the Customer info
	With Browser("PeopleSoft Browser").Page("Supplier_2").PSFrame("TargetContent")
		.WebElement("AdditionalIDNumbers").click
		Browser("PeopleSoft Browser").Sync

		'Confirm that the area expanded
		If .WebEdit("CustomerID").Exist(5) Then
			WriteToReport micPass, "AR14ACH", "Beginning to enter the Additional ID information", False
		Else
			WriteToReport micFail, "AR14ACH", "Unable to enter the Additional ID information", False
			ExitTest
		End If

		.WebEdit("CustomerID").Set GlobalDictionary("custID")
		.WebEdit("CustSetID").Set GlobalDictionary("setID")
		.WebEdit("IDType").Set GlobalDictionary("Type")
		.WebEdit("IDNumber").Set GlobalDictionary("IDNumber")
	End With

	'Click on Address Tab and enter all the mandatory details in the Address Tab
	GlobalDictionary("EffectiveDate") = Date
	AddFirstAddress()

	'wait for the ojects to get loaded
	app_SearchSync()

	With Browser("PeopleSoft Browser").Page("Supplier_2").PSFrame("TargetContent")

		'Click on the Contacts tab
		.WebElement("Contacts").Click
		Browser("PeopleSoft Browser").Sync

		'Validate
		If .WebEdit("ContactName").Exist(5) Then
			WriteToReport micPass, "AR14ACH", "Beginning to enter the Contacts information", False
		Else
			WriteToReport micFail, "AR14ACH", "Unable to enter the Contacts information", False
			ExitTest
		End If

		'Enter our customer info
		.WebList("ContactType").Select GlobalDictionary("ContactType")
		.WebEdit("ContactName").Set GlobalDictionary("ContactName")
		.WebEdit("ContactTitle").Set GlobalDictionary("ContactTitle")
		.WebEdit("ContactEmailID").Set GlobalDictionary("ContactEmailID")
		.WebEdit("ContactPrefix").Set GlobalDictionary("ContactPrefix")
		.WebEdit("ContactPhone").Set GlobalDictionary("ContactPhone")
	End With

	With Browser("PeopleSoft Browser").Page("Supplier_1").PSFrame("TargetContent")

		'Click on Location tab
		.WebElement("tabLocation").click
		Browser("PeopleSoft Browser").Sync

		'Validate
		If .WebEdit("Location_Location").Exist(5) Then
			WriteToReport micPass, "AR14ACH", "Beginning to enter the Location information", False
		Else
			WriteToReport micFail, "AR14ACH", "Unable to enter the Location information", False
			ExitTest
		End If

		'Enter the Location ID
		.WebEdit("Location_Location").Set GlobalDictionary("LocationID")
	 	Call WriteToReport(micPass, "LocationID=" & GlobalDictionary("LocationID"), "is displayed", false)

        'Click on Payables to enter the Bank information of the supplier
        .Link("Location_Payables").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'CLick on Supply Bank information section to update the details
	With Browser("PeopleSoft Browser").Page("Supplier").PSFrame("Location_Payables")
	
		'Validate
		If .WebElement("SupplyBankInformation").Exist(5) Then
			WriteToReport micPass, "AR14ACH", "Beginning to enter the Supply Bank information", False
		Else
			WriteToReport micFail, "AR14ACH", "Unable to enter the Supply Bank information", False
			ExitTest
		End If

		'Click on the Supply Bank Information tab
		.WebElement("SupplyBankInformation").Click
		Browser("PeopleSoft Browser").Sync

		'Enter the bank details in this section
		dtbankDescription=(GlobalDictionary("Description"))
		dtBankName=(GlobalDictionary("BankName"))
		dtBankQualifier=(GlobalDictionary("BankQualifier"))
		dtBankID=(GlobalDictionary("BankID"))
		dtAcctNumber=(GlobalDictionary("AcctNumber"))
		dtDFIQualifier=(GlobalDictionary("DFIQualifier"))
		dtAcctType=(GlobalDictionary("AcctType"))

		.WebEdit("Description").Set dtbankDescription
		Call WriteToReport(micPass, "BankDescription=" & dtbankDescription, "is displayed", false)

		'Enter the Bank name
		.WebEdit("BankName").Set dtBankName
		Call WriteToReport(micPass,"BankName="&dtBankName,"is displayed",false)

		'Enter the Branch Name
		.WebEdit("BranchName").Set dtBankName
		Call WriteToReport(micPass,"Branch Name="&dtBankName,"is displayed",false)

		'Enter the Bank ID qualifier
		.WebEdit("BankIdQualifier").Set dtBankQualifier

		.Image("BankIdQualifierLookUp").Click
		Browser("PeopleSoft Browser").Sync
	End With

	With Browser("PeopleSoft Browser").Page("Supplier").PSFrame("BankID_LookUp").WebTable("BankIDQualifier")
		If .Exist(nMINWAIT) Then
			For i=1 to .RowCount
				appBankIDqualifier=.GetCellData(i,1)
				If instr(1,dtBankQualifier,appBankIDqualifier)>0 Then
					Set oBankIDQualier=.ChildItem(i,1,"Link",0)
					If oBankIDQualier.exist(nMINWAIT) Then
						oBankIDQualier.click
					End If
				End If
			Next
		Else
			Call WriteToReport(micFail,"Bank ID qualifier is","is not present",True)
		End If
	End With

	'Enter the Bank ID details
	With  Browser("PeopleSoft Browser").Page("Supplier").PSFrame("Location_Payables")
		.WebEdit("BankId").Set dtBankID
		Call WriteToReport(micPass,"BankID="&dtBankID,"is displayed",false)

        'Enter Account NUmber
        .WebEdit("AcctNumber").Set dtAcctNumber
    	Call WriteToReport(micPass,"Account Number="&dtAcctNumber,"is displayed",false)

		'Enter DFI qualifier
		.WebEdit("DFIQualifier").Set dtDFIQualifier
		Call WriteToReport(micPass,"DFI Qualifier="&dtDFIQualifier,"is displayed",false)

		'Wait for the application to load
		app_SearchSync()

		'Select the Account type
		.WebList("AccountType").Select dtAcctType

		'Enter DFI ID
		.WebEdit("DFIId").Set dtBankID
		Call WriteToReport(micPass,"Bank ID="&dtBankID,"is displayed",false)

		'Click on Ok button 
		.WebButton("Ok").Click

		'Wait for the application to load
		app_SearchSync()
	End With

	'Finish up on the Additional Info Tab page
	With Browser("PeopleSoft Browser").Page("Supplier_2").PSFrame("TargetContent")

		'Click on the additional info tab
		.WebElement("Addtl Info").Click
		Browser("PeopleSoft Browser").Sync

		'Validate
		If .WebEdit("UserID").Exist(5) Then
			WriteToReport micPass, "AR14ACH", "Beginning to enter the Additional Info Tab information", False
		Else
			WriteToReport micFail, "AR14ACH", "Unable to enter the Additional Info Tab information", False
			ExitTest
		End If

		'Assign our new user ID
		.WebEdit("UserID").Set GlobalDictionary("SupplierUser")

		'store our new supplier
		newSupplierID = Trim(.WebElement("NewSupplierID").GetROProperty("innertext"))
		WriteToReport micPass, "AR14ACH - Supplier ID", newSupplierID, False

		'Click save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Login as our super user(GWENCHO)
	Login GlobalDictionary("AssignedUser")

	'Navigate to the Customers > Customer Information > General Information page
	If SelectMainMenu1(GlobalDictionary("CustGenInfo")) Then
		WriteToReport micPass, "AR14ACH", "Navigated to General Information page", False
	Else
		WriteToReport micFail, "AR14ACH", "Unable to navigate to General Information page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("General Information").PSFrame("TargetContent")

		'Search for our customer
		.WebEdit("Set ID").Set GlobalDictionary("setID")
		.WebEdit("Customer ID").Set GlobalDictionary("custID")
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Click on the Miscellaneous General tab
		.WebElement("Miscellaneous General").Click
		Browser("PeopleSoft Browser").Sync

		'Validate
		If .WebEdit("SupplierSetID").Exist(5) Then
			WriteToReport micPass, "AR14ACH", "Beginning to enter the Miscellaneous General Tab information", False
		Else
			WriteToReport micFail, "AR14ACH", "Unable to enter the Miscellaneous General Tab information", False
			ExitTest
		End If

		'Validate supplier set ID
		If Trim(.WebEdit("SupplierSetID").GetROProperty("default value")) = GlobalDictionary("setID") Then
			WriteToReport micPass, "AR14ACH", "Supplier Set ID confirmed - " & GlobalDictionary("setID"), False
		Else
			WriteToReport micFail, "AR14ACH", "Supplier Set ID does not match - " & Trim(.WebEdit("SupplierSetID").GetROProperty("default value")) & " vs - " & GlobalDictionary("setID"), True
			ExitTest
		End If

		'Validate supplier ID - stored on previous page
		If Trim(.WebEdit("SupplierID").GetROProperty("default value")) = newSupplierID Then
			WriteToReport micPass, "AR14ACH", "Supplier ID confirmed - " & newSupplierID, False
		Else
			WriteToReport micFail, "AR14ACH", "Supplier ID does not match - " & Trim(.WebEdit("SupplierID").GetROProperty("default value")) & " vs - " & newSupplierID, True
			ExitTest
		End If

		'Click the Supplier Information link
		.Link("Supplier Information").Click
		Browser("PeopleSoft Browser").Sync

		'Check for an error
		If Browser("PeopleSoft Browser").Page("General Information").WebButton("OK").Exist(5) Then
			Browser("PeopleSoft Browser").Page("General Information").WebButton("OK").Click
			WriteToReport micFail, "AR14ACH", "Unable to navigate to Supplier Information page. Exiting test.", True
			ExitTest
		End If

		'Confirm we're back on the customer page using our customer ID
		If .WebEdit("ConfirmationCustomerID").Exist(5) AND Trim(.WebEdit("ConfirmationCustomerID").GetROProperty("default value")) = GlobalDictionary("custID") Then
			WriteToReport micPass, "AR14ACH", "Customer and Supplier link confirmed - " & GlobalDictionary("custID"), False
		Else
			WriteToReport micFail, "AR14ACH", "Customer not Supplier link not confirmed - " & Trim(.WebEdit("ConfirmationCustomerID").GetROProperty("default value")) & " vs - " & GlobalDictionary("custID"), True
			ExitTest
		End If
		
		'TODO - navigate back to Miscellaneous General tab, clear supplier and set ID, click save. Test can't rerun otherwise.
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the AR14_RefCredBal_CreditMemo end to end - create a worksheet, process, validate, post, etc
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>March 4, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function AR14RefCredBalCreditMemo
	Dim arrRecordValues, arrTemp()
	Dim nResult
	Dim strSQL

	'Run our first SQL query
	strSQL = "SELECT * FROM PS_CUSTOMER WHERE VENDOR_ID <> ''"
	WriteToReport micDone, "AR14RefCredBalCreditMemo - SQL Query", "Query being used is " & strSQL, False

	'Get the first journal that meets our criteria, exit if none found
	arrRecordValues = dbGetFirstRecord(strSQL, "", arrTemp, "AR14RefCredBalCreditMemo")
	nResult = -1

	On Error Resume Next
	nResult = UBound(arrRecordValues)
	On Error GoTo 0
	If nResult >= 0 Then
		WriteToReport micPass, "AR14RefCredBalCreditMemo - PS_CUSTOMER SQL results", "There were " & nResult + 1 & " journal(s) found!", False
	Else
		WriteToReport micFail, "AR14RefCredBalCreditMemo - PS_CUSTOMER SQL results", "There were 0 journals found. Exiting test.", False
		ExitTest
	End If

	GlobalDictionary("SetID") = arrRecordValues(0)
	GlobalDictionary("CustID") = arrRecordValues(1)
	GlobalDictionary("Name") = arrRecordValues(10)
	GlobalDictionary("VendorID") = arrRecordValues(26)
	'GlobalDictionary("BusinessUnit") = arrRecordValues(81)
	
	'With our first query, run a check for our customer. We need to find whether or not there is a supplier attached to them before continuing
	'Navigate to the Customers > Customer Information > General Information page
	If SelectMainMenu1(GlobalDictionary("CustGenInfo")) Then
		WriteToReport micPass, "AR14RefCredBalCreditMemo", "Navigated to General Information page", False
	Else
		WriteToReport micFail, "AR14RefCredBalCreditMemo", "Unable to navigate to General Information page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("General Information").PSFrame("TargetContent")

		'Search for our customer
		.WebEdit("Set ID").Set GlobalDictionary("SetID")
		.WebEdit("Customer ID").Set GlobalDictionary("CustID")
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Click on the Miscellaneous General tab
		.WebElement("Miscellaneous General").Click
		Browser("PeopleSoft Browser").Sync

		'Validate
		If .WebEdit("SupplierSetID").Exist(5) Then
			WriteToReport micPass, "AR14RefCredBalCreditMemo", "Beginning to enter the Miscellaneous General Tab information", False
		Else
			WriteToReport micFail, "AR14RefCredBalCreditMemo", "Unable to enter the Miscellaneous General Tab information", False
			ExitTest
		End If

		'Validate supplier set ID
		If Trim(.WebEdit("SupplierSetID").GetROProperty("default value")) = GlobalDictionary("SetID") Then
			WriteToReport micPass, "AR14RefCredBalCreditMemo", "Supplier Set ID confirmed - " & GlobalDictionary("SetID"), False
		Else
			WriteToReport micFail, "AR14RefCredBalCreditMemo", "Supplier Set ID does not match - " & Trim(.WebEdit("SupplierSetID").GetROProperty("default value")) & " vs - " & GlobalDictionary("SetID"), True
			ExitTest
		End If

		'Validate supplier ID - stored on previous page
		If Trim(.WebEdit("SupplierID").GetROProperty("default value")) <> "" Then
			WriteToReport micPass, "AR14RefCredBalCreditMemo", "Supplier ID confirmed - " & Trim(.WebEdit("SupplierID").GetROProperty("default value")), False
		Else
			WriteToReport micFail, "AR14RefCredBalCreditMemo", "No Supplier ID found.", True
			ExitTest
		End If

'		If Trim(.WebEdit("SupplierSetID").GetROProperty("default value")) = GlobalDictionary("SetID") Then
'			WriteToReport micPass, "AR14RefCredBalCreditMemo", "Supplier Set ID confirmed - " & GlobalDictionary("SetID"), False
'		Else
'			.WebEdit("SupplierSetID").Set GlobalDictionary("SetID")
'			WriteToReport micPass, "AR14RefCredBalCreditMemo", "Supplier Set ID set - " & GlobalDictionary("SetID"), False
'		End If
'
'		If Trim(.WebEdit("SupplierID").GetROProperty("default value")) = GlobalDictionary("VendorID") Then
'			WriteToReport micPass, "AR14RefCredBalCreditMemo", "Supplier ID already confirmed - " & GlobalDictionary("VendorID"), False
'		Else
'			.WebEdit("SupplierID").Set GlobalDictionary("VendorID")
'			WriteToReport micPass, "AR14RefCredBalCreditMemo", "Supplier ID set - " & GlobalDictionary("VendorID"), False
'		End If
	End With

	'Run our second SQL query. We have a window before we can use them, so we set it for two months
	'strSQL = "SELECT * FROM PS_ITEM WHERE ITEM_STATUS = 'O' AND BAL_AMT < 0 AND BUSINESS_UNIT IN ('00001', '00002') AND ITEM <> 'OA-13700'"
	strSQL = "SELECT * FROM PS_ITEM WHERE ITEM_STATUS = 'O' AND BAL_AMT < 0 AND BUSINESS_UNIT = '00003'"
			'='" & GlobalDictionary("BusinessUnit") & 	"'"	'_
			 '"' AND ACCOUNTING_DT <= '" & DateAdd("d", -60, Date) &	"'"	'&_ 
			 '"' AND ITEM <> 'EN00058356'"
	WriteToReport micDone, "AR14RefCredBalCreditMemo - PS_ITEM SQL Query", "Query being used is " & strSQL, False

	'Get the first journal that meets our criteria, exit if none found
	arrRecordValues = dbGetFirstRecord(strSQL, "", arrTemp, "AR14RefCredBalCreditMemo")
	nResult = -1

	On Error Resume Next
	nResult = UBound(arrRecordValues)
	On Error GoTo 0
	If nResult >= 0 Then
		WriteToReport micPass, "AR14RefCredBalCreditMemo - PS_ITEM SQL results", "There were " & nResult + 1 & " journal(s) found!", False
	Else
		WriteToReport micFail, "AR14RefCredBalCreditMemo - PS_ITEM SQL results", "There were 0 journals found. Exiting test.", False
		ExitTest
	End If

	'Update our customer ID to the new one for used when building the test data
'	GlobalDictionary("OldCustID") = GlobalDictionary("CustID")
'	GlobalDictionary("CustID") = arrRecordValues(1)

	'Store the business unit chosen
	GlobalDictionary("BusinessUnit") = arrRecordValues(0)

	'Grab the item returned in our new SQL query
    GlobalDictionary("ITEM") = arrRecordValues(2)

	'Grab the dates for future reference
	GlobalDictionary("FromDate") = arrRecordValues(10)	'(Assigned)
	'GlobalDictionary("ToDate") = arrRecordValues(10)	'Might be 13(Posted)

	'Call our shared function to create a worksheet
	SharedCreateMaintWorksheet "AR14RefCredBalCreditMemo"

	'Select our workflow action
	With Browser("PeopleSoft Browser").Page("Finalize Worksheet")

        'Verify on Worksheet Action Page
        If .WebList("Posting Action").Exist(30) Then
           Call WriteToReport (micPass, "Worksheet Action", "Page is displayed.", False)
        Else
           Call WriteToReport (micFail, "Worksheet Action", "Page is not displayed.", True)  
           ExitTest  
        End If

        'Select Submit to Workflow
        .WebList("Posting Action").Select "Submit to Workflow" 

        'Click OK
        .WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync

        'Click Save
        .WebButton("Save").Click
        Browser("PeopleSoft Browser").Sync

        'Go back a page to reload the batch options available
        .Link("Worksheet Application").click
        Browser("PeopleSoft Browser").Sync

		'If the Approved Writeoff link exists, click it
		If Browser("PeopleSoft Browser").Page("Update Worksheet").Link("Approved Write-Off").Exist(5) Then
			Browser("PeopleSoft Browser").Page("Update Worksheet").Link("Approved Write-Off").Click
			Browser("PeopleSoft Browser").Sync
		End If

        'Click on the Worksheet Action link to go back to our original page
		Browser("PeopleSoft Browser").Page("Update Worksheet").Link("Worksheet Action").Click
		Browser("PeopleSoft Browser").Sync

		'select Batch Standard from our options
		.WebList("Posting Action").Select "Post Now"	'"Batch Standard"	'2

		'Click OK
		.WebButton("Ok").Click
		Browser("PeopleSoft Browser").Sync

		'Click Save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Run first part of validation
	'Logs in as CDW_Batch user in the function
	'LOGINCDWBATCH
	UnpostARGroups "AR14RefCredBalCreditMemo"

	'Run the request refund item process
	RequestRefundItemProcess "AR14RefCredBalCreditMemo"

	'Run the voucher build process
	Login(globalDictionary("VoucherUser"))
	APVoucherBuild "AR14RefCredBalCreditMemo"

	'Grab our Voucher ID associated with our Item
	Login(globalDictionary("SignInUser"))
	DetermineVoucherID "AR14RefCredBalCreditMemo"

	'Run the voucher posting and processing code
	Login(globalDictionary("VoucherUser"))
	VoucherPostingAndProcess "AR14RefCredBalCreditMemo"

	'Delete the created worksheet
	'SharedDeleteWorksheet "AR14RefCredBalCreditMemo" - needs to be done, but uses different code
End Function

'**************************************************************************************************************
''' <summary> 
''' Enter data and run process on Refunds > Request Refund Item page 
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>March 4, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter: FunctionName - string of the function that called it. Used for reporting.
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function RequestRefundItemProcess(functionName)
	Dim runID
	Dim arrInstance

	'Navigate to the Accounts Receivable > Receivables Maintenance > Refunds > Request Refund Item page
	If SelectMainMenu1(GlobalDictionary("ARRecMaintRequestRfnd")) Then
		WriteToReport micPass, functionName, "Navigated to Request Refund Item page", False
	Else
		WriteToReport micFail, functionName, "Unable to navigate to Request Refund Item page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Request Refund Item")

		'Create a new Run ID
		.Frame("TargetContent").WebElement("Add a New Value").Click
		Browser("PeopleSoft Browser").Sync

		runID = "AR14" & CLng(Timer)
		.Frame("TargetContent").WebEdit("RunID").Set runID 'EG, "AR14022620191533"
		.Frame("TargetContent").WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm our page loaded
		If .Frame("TargetContent").WebEdit("BusinessUnit").Exist(10) Then
			WriteToReport micPass, functionName, "Run control " & runID & " created", False
		Else
			WriteToReport micFail, functionName, "Unable to create Run Control " & runID, True
			ExitTest
		End If

		'Enter Refund Business Unit
		.Frame("TargetContent").WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")

		'Click the Load Directly to AP box
		.Frame("TargetContent").WebCheckBox("LoadDirectToAP").Click

		'Click Save
		.Frame("TargetContent").WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Click Run
		.Frame("TargetContent").WebButton("Run").Click
		Browser("PeopleSoft Browser").Sync

		'Click OK(process is selected by default)
		.Frame("Process Scheduler").WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync

		'Grab Process Instance
		arrInstance = Split(.PSFrame("Status Bar").WebElement("ProcessInstance").GetROProperty("innertext"), ":")
		GlobalDictionary("InstanceNumber") = arrInstance(1)
		.PSFrame("Status Bar").Link("Process Monitor").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Run and monitor the AR_REFUND process 
	GlobalDictionary("Process") = "AR_REFUND"
	SharedProcessMonitor functionName
End Function

'**************************************************************************************************************
''' <summary> 
''' Enter data and run process on Vouchers > Voucher Posting page
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>March 4, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter: FunctionName - string of the function that called it. Used for reporting.
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function VoucherPostingAndProcess(functionName)
	Dim runID
	Dim arrInstance, arrTemp

	'Start to validate our previous batch processes

	'login as our batch user
	'Login GlobalDictionary("PostingUser")

	'Navigate to the Accounts Payable > Batch Processes > Vouchers > Voucher Posting page
	If SelectMainMenu1(GlobalDictionary("APVoucherPosting")) Then
		WriteToReport micPass, functionName, "Navigated to Voucher Posting page", False
	Else
		WriteToReport micFail, functionName, "Unable to navigate to Voucher Posting page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Voucher PostingAR")

		'Create a new Run ID
		.Frame("TargetContent").WebElement("Add a New Value").Click
		Browser("PeopleSoft Browser").Sync

		runID = "AR14" & CLng(Timer)
		.Frame("TargetContent").WebEdit("RunID").Set runID 'EG, "AR14022620191533"
		.Frame("TargetContent").WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm our page loaded
		If .Frame("TargetContent").WebEdit("RequestID").Exist(10) Then
			WriteToReport micPass, functionName, "Run control " & runID & " created", False
		Else
			WriteToReport micFail, functionName, "Unable to create Run Control " & runID, True
			ExitTest
		End If

		'Request ID
		.Frame("TargetContent").WebEdit("RequestID").Set GlobalDictionary("PostingUser")

		'Description
		.Frame("TargetContent").WebEdit("Description").Set "Test"

		'Set our frequency	-	Always Process/0
		.Frame("TargetContent").WebList("ProcessFrequency").Select "Process Once"	'2

		'Filter by voucher(if any)
		If GlobalDictionary("VoucherID") <> "" Then
			.WebList("PostVoucher").Select "Post Voucher"	'6
			.Webedit("BusinessUnit").Set GlobalDictionary("BusinessUnit")
			.Webedit("VoucherID").Set GlobalDictionary("VoucherID")
		End If

		'Click Save
		.Frame("TargetContent").WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Click Run
		.Frame("TargetContent").WebButton("Run").Click
		Browser("PeopleSoft Browser").Sync

		.Frame("Process Scheduler").WebCheckBox("SelectFlag$0").Click
		.Frame("Process Scheduler").WebCheckBox("SelectFlag$1").Click
		.Frame("Process Scheduler").WebButton("OK").Click

		'Grab Process Instance
		arrTemp = Split(.PSFrame("Status Bar").WebElement("ProcessInstance").GetROProperty("innertext"), ":")
		arrInstance = Split(arrTemp(1), ",")
		.PSFrame("Status Bar").Link("Process Monitor").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Run the voucher posting processes
	GlobalDictionary("InstanceNumber") = arrInstance(0)
	GlobalDictionary("Process") = "AP_PSTVCHR"
	SharedProcessMonitor functionName
	GlobalDictionary("InstanceNumber") = arrInstance(1)
	GlobalDictionary("Process") = "CDWPVCHR"
	SharedProcessMonitor functionName
End Function

'**************************************************************************************************************
''' <summary> 
''' Creates a new payment predictor process and monitors it.
''' </summary>
''' <author>Brian Buckhana</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function RequestPaymentPredictor()
	Dim sRunControlID, sBusinessUnit, sProcessFrequency, sProcessName, sProcessInstanceID
	
	sRunControlID = GlobalDictionary("RunControlID")
	sBusinessUnit = GlobalDictionary("BusinessUnit")
	sProcessFrequency = GlobalDictionary("ProcessFrequency")
	sProcessName = GlobalDictionary("ProcessName")
	
	'Navigate to Request Payment Predictor
	If SelectMainMenu1(GlobalDictionary("RequestPaymentPredictor")) Then
		WriteToReport micPass, "Request Payment Predictor Page", "On the Request Payment Predictor page.", FALSE
	Else
		WriteToReport micFail, "Request Payment Predictor Page", "Navigation to Request Payment Predictor page failed. Exiting test.", TRUE
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Request Payment Predictor").PSFrame("Request Payment Predictor")
		' Click the Add a New Value Tab
		.WebElement("Add a New Value Tab").Click
		
		' Enter Run Control ID
		If .WebEdit("Run Control ID").Exist(5) Then
			.WebEdit("Run Control ID").Set sRunControlID
		Else
			WriteToReport micFail, "Unable to Find Run Control ID Field", "Unable to find field after navigating to 'Add A New Value' tab.  Exiting Test.", TRUE
			ExitTest
		End If
		
		' Click Add Button.
		.WebButton("Add").Click
		
		' Use Process that already exists if it is there.
		If .Link("Already Exists Result").Exist(5) Then
			WriteToReport micInfo, "Run Control ID [" & sRunControlID & "] Already Exists" ,"Selecting existing process.", TRUE
			.Link("Already Exists Result").Click		
		End If
		
		' Set Business Unit
		If .WebEdit("Business Unit").Exist(5) Then
			.WebEdit("Business Unit").Set sBusinessUnit
		Else
			WriteToReport micFail, "Unable to Find Business Unit Field", "Unable to find field after clicking 'Add' button.  Exiting Test.", TRUE
			ExitTest
		End If
		
		' Set Process Frequency
		.WebList("Process Frequency").Select sProcessFrequency
		
		' Click Run
		.WebButton("Run").Click
		
		' Click 'OK' button on popup.
		If Browser("PeopleSoft Browser").Page("Request Payment Predictor").PSFrame("Process Scheduler Request").WebButton("OK").Exist(5) Then
			Browser("PeopleSoft Browser").Page("Request Payment Predictor").PSFrame("Process Scheduler Request").WebButton("OK").Click
		Else
			WriteToReport micFail, "Unable to Find OK Button", "Unable to find button after clicking 'Run' button.  Exiting Test.", TRUE
			ExitTest
		End If

		' Process Instance ID is Visible
		If .WebElement("Process Instance ID").Exist(5) Then
			sProcessInstanceID = Replace(.WebElement("Process Instance ID").GetROProperty("innertext"), "Process Instance:", "")
			WriteToReport micInfo, "Process Instance ID Is [" & sProcessInstanceID & "]", "Process Instance ID is visible after clicking 'OK' button.", FALSE
		Else
			WriteToReport micFail, "Unable to Find Process Instance ID Field", "Unable to find field after clicking 'OK' button.  Exiting Test.", TRUE
			ExitTest
		End If

		' Click Process Monitor Link
		.Link("Process Monitor").Click
	End With

	' Monitor Process Until Success/Posted
	Call CheckProcessMontiorStatus(sProcessName)
End Function

'**************************************************************************************************************
''' <summary> 
''' Creates a new regular deposit from online payment.
''' </summary>
''' <author>Brian Buckhana</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function RegularDeposit() ' AR15
	Dim nRowsToRequest, nBalanceAmount, nPartialPayment, nControlTotalAmount, nCount, nPayment
	Dim aResults
	Dim sBUnit, sBankCode, sBankAccount, sDepositType, sPaymentID, sCustomerID, sItemID, sDepositID, sPaymentCurrency
	Dim strTemp

	sBUnit = GlobalDictionary("BusinessUnit")
	sBankCode = GlobalDictionary("BankCode")
	sBankAccount = GlobalDictionary("BankAccount")
'	sDepositType = GlobalDictionary("DepositType")
	nRowsToRequest = GlobalDictionary("DepositRowsToRequest")
	sPaymentID = GlobalDictionary("PaymentID")
	'nCount = 1
	
	If GlobalDictionary("DepositRowsToRequest") = "" Then
		nCount = 1
	Else
		nCount = nRowsToRequest
	End If

	' Navigate to Regular Deposit (Main Menu > Account Receivable > Payments > Online Payments > Regular Deposit)
	If SelectMainMenu1(GlobalDictionary("RegularDeposit")) Then
		WriteToReport micPass, "Regular Deposit Page", "On the Regular Deposit page.", FALSE
	Else
		WriteToReport micFail, "Regular Deposit Page", "Navigation to Regular Deposit page failed. Exiting test.", TRUE
		ExitTest
	End If

	' Grab required values.
	aResults = dbFetchDepositInformation(nRowsToRequest, sBUnit)
	sCustomerID = Trim(aResults(1))
	sItemID = Trim(aResults(2))
	nBalanceAmount = Trim(aResults(7))

	If GlobalDictionary.Exists("PartialPaymentAmountToRemove") Then
		nPartialPayment = GlobalDictionary("PartialPaymentAmountToRemove")
		nControlTotalAmount = nBalanceAmount - nPartialPayment
	ElseIf nRowsToRequest = 2 Then	
		nControlTotalAmount = CDbl(nBalanceAmount) + CDbl(Trim(aResults(16)))
	ElseIf GlobalDictionary("FixedAmount") <> "" Then
		nControlTotalAmount = GlobalDictionary("FixedAmount")
	Else
		nControlTotalAmount = nBalanceAmount
	End If

	nPayment = nControlTotalAmount ' TODO: Change for multiple payments.  De-coupling for now to make maintenance later easier.

	With Browser("PeopleSoft Browser").Page("Regular Deposit").PSFrame("TargetContent")
		' Click the "Add New Value" tab.
		.WebElement("Add a New Value Tab").Click

		' Add the Business Unit
		If .WebEdit("Business Unit").Exist(5) Then
			.WebEdit("Business Unit").Set sBUnit
		Else
			ExitTest
		End If

		' Click Add.
		.WebButton("Add").Click

		' Add Bank Code
		If .WebEdit("Bank Code").Exist(10) Then
			.WebEdit("Bank Code").Set sBankCode
		Else
			ExitTest
		End If

		' Add Bank Account
		.WebEdit("Bank Account").Set sBankAccount

		' Add Control Total Amount
		.WebEdit("Control Total Amount").Set nControlTotalAmount

		' Add Count
		.WebEdit("Count").Set nCount

		' Click "Payments" Tab.
		.WebElement("Payments Tab").Click

		' Set Payment ID.
		sPaymentID = sPaymentID & CLng(Timer)
		GlobalDictionary("PaymentID") = sPaymentID	'storing in case we need later
		WriteToReport micPass, "Payment ID", "Payment ID is " & sPaymentID, False
		.WebEdit("Payment ID").Set sPaymentID

		' Set Payment Currency.
		sPaymentCurrency = GlobalDictionary("PaymentCurrency")	'EG, USD
		.WebEdit("Payment Currency").Set sPaymentCurrency

		' Set Payment Amount. 'One row uses the same math. Multiple rows requires the specific query values
		If nRowsToRequest = 1 Then
			.WebEdit("Payment Amount").Set nPayment
		ElseIf nRowsToRequest = 2 Then
			.WebEdit("Payment Amount").Set nBalanceAmount
		End If

		' Uncheck Payment Predictor
		If .WebCheckBox("Payment Predictor").GetROProperty("checked") = 1 Then
			.WebCheckBox("Payment Predictor").Click			
		End If

		'Check for JournalDirectly flag
		If GlobalDictionary("JournalDirectly") <> "" Then
			If .WebCheckBox("JournalDirectly").GetROProperty("checked") = 0 Then
				.WebCheckBox("JournalDirectly").Click
				Browser("PeopleSoft Browser").Sync
			End If
		End If

		'One of our test cases has an extra step here
		If UCase(GlobalDictionary("PaymentGoal")) = "MULTIPLE" Then

			'Click the button to add a new row
			.WebButton("AddNewRow").Click
			Browser("PeopleSoft Browser").Sync

			'Create a new payment ID
			GlobalDictionary("PaymentID2") = GlobalDictionary("PaymentID") & "2"
			WriteToReport micPass, "Second Payment ID", "Second Payment ID is " & GlobalDictionary("PaymentID2"), False
			.WebEdit("Payment ID").Set GlobalDictionary("PaymentID2")

			'Enter our fields for our second payment
			GlobalDictionary("PaymentCustomerID2") = Trim(aResults(10))

			' Set Payment Currency(same as other)
			.WebEdit("Payment Currency").Set sPaymentCurrency

			' Set Payment Amount(use the query data
			GlobalDictionary("PaymentAmount2") = Trim(aResults(16))
			.WebEdit("Payment Amount").Set GlobalDictionary("PaymentAmount2")

			' Uncheck Payment Predictor
			If .WebCheckBox("Payment Predictor").GetROProperty("checked") = 1 Then
				.WebCheckBox("Payment Predictor").Click			
			End If

			'Save our second Item ID for later
			GlobalDictionary("ItemID2") = Trim(aResults(11))

			'' Click "Save".
			'.WebButton("Save").Click
			'Browser("PeopleSoft Browser").Sync
		End If

		' Click "Save".
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		' Check and save Deposit ID.  Then click "Apply Payment".
		If .Link("Apply Payment").Exist(10) Then
			sDepositID = .WebElement("Deposit ID").GetROProperty("innertext")
			WriteToReport micInfo, "Deposit ID is [" & sDepositID & "]", "Deposit ID found after clicking the 'Save' button.", False
			GlobalDictionary("DepositID") = sDepositID
			.Link("Apply Payment").Click
		Else
			ExitTest
		End If
	End With

	' Export values
	GlobalDictionary.Add "PaymentItemID", sItemID
	GlobalDictionary.Add "PaymentItemBalance", nBalanceAmount
	GlobalDictionary.Add "PaymentAmount", nPayment
	GlobalDictionary.Add "PaymentControlTotalAMount", nControlTotalAmount
	GlobalDictionary.Add "PaymentCustomerID", sCustomerID
	
'	If GlobalDictionary.Exists("ExpenseReportID") Then
'		GlobalDictionary.Remove("ExpenseReportID")
'	End If
	
	' Cleanup
	If isArray(aResults) Then Erase aResults
End Function

'**************************************************************************************************************
''' <summary> 
''' Creates a Worksheet to Transfer an Item with Status Open
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'05/15/2019			Zach A. 	Added a View All Link check on the Selection screen
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function TransferOpenAR
	Dim arrTemp
	Const QUAL_CODE = "I"
	Const POST_NOW = "Post Now"

	'Navigate to Transfer Worksheet > Create Worksheet
	If SelectMainMenu1(GlobalDictionary("ARRecMaintTrnsfrCreateWorksheet")) Then
		WriteToReport micPass, "Transfer Worksheet > Create Worksheet Page", "On the Transfer Worksheet > Create Worksheet page.", FALSE
	Else
		WriteToReport micFail, "Transfer Worksheet > Create Worksheet Page", "Navigation to Transfer Worksheet > Create Worksheet page failed. Exiting test.", TRUE
		ExitTest
	End If

	With Browser("Peoplesoft Browser").Page("TransferCreateWorksheet").PSFrame("TargetContent")
		'Click Add a New Value
		.Link("AddANewValue").Click
		WriteToReport micDone, "Clicked the Add a New Value Link", "Link Clicked", FALSE

		'Set BU
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set Business Unit: " & GlobalDictionary("BusinessUnit"), "BU Set", FALSE

		'Click Add
		.WebButton("Add").Click
		WriteToReport micDone, "Clicked the Add Button", "Button Clicked", FALSE

		'Determine Customer ID and Item ID, also stored as the Original
		arrTemp = dbGetCustAndItem

		If GlobalDictionary.Exists("CustID") Then
       		GlobalDictionary.Remove("CustID")
    	End If
    	GlobalDictionary.Add "CustID", arrTemp(1)
    	If GlobalDictionary.Exists("OrigCustID") Then
       		GlobalDictionary.Remove("OrigCustID")
    	End If
    	GlobalDictionary.Add "OrigCustID", arrTemp(1) 
		WriteToReport micDone, "Retrieved a Customer ID: "&GlobalDictionary("CustID"), "Customer ID Stored for Later", FALSE

		If GlobalDictionary.Exists("ItemID") Then
       		GlobalDictionary.Remove("ItemID")
    	End If
    	GlobalDictionary.Add "ItemID", Trim(arrTemp(0))
		WriteToReport micDone, "Retrieved an Item ID: "&GlobalDictionary("ItemID"), "Item ID Stored for Later", FALSE

		'Set Customer ID
		If .WebEdit("CustID").Exist(15)  Then  
			.WebEdit("CustID").Set GlobalDictionary("CustID")
			WriteToReport micDone, "Set Customer ID: "&GlobalDictionary("CustID"), "Customer ID Set", FALSE
		Else
			WriteToReport micFail, "Failed to Load Page", "Page Took too Long to Load", TRUE
			ExitTest
		End If

		'Set Cust BU
		.WebEdit("CustBusinessUnit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set Customer Business Unit: " & GlobalDictionary("BusinessUnit"), "BU Set", FALSE

		'Set Qual Code
		.WebEdit("QualCode").Set QUAL_CODE
		WriteToReport micDone, "Set Qual Code: " & QUAL_CODE, "Qual Code Set", FALSE

		'Set Reference (Item ID)
		.WebEdit("Reference").Set GlobalDictionary("ItemID")
		WriteToReport micDone, "Item Reference Set: " & GlobalDictionary("ItemID"), "Item Reference Set", FALSE

		'Click Build
		.WebButton("Build").Click
		WriteToReport micDone, "Clicked the Build Button", "Button Clicked", FALSE

		'Set Transfer BU
		.WebEdit("TransferToBU").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set Trasnfer To Business Unit: " & GlobalDictionary("BusinessUnit"), "BU Set", FALSE

		'Set Transfer Customer 
		arrTemp = dbGetCustFromBU(GlobalDictionary("CustID"))
		If GlobalDictionary.Exists("NewCustID") Then
       		GlobalDictionary.Remove("NewCustID")
    	End If
    	GlobalDictionary.Add "NewCustID", arrTemp(0) 'The Customer is in the only thing returned, index 0
		WriteToReport micDone, "Retrieved a New Customer ID: " & GlobalDictionary("NewCustID"), "New Customer ID Stored for Later", FALSE
		.WebEdit("TransferToCust").Set GlobalDictionary("NewCustID")
		WriteToReport micDone, "Set the Customer to Transfer To: " & GlobalDictionary("NewCustID"), "New Customer Set", FALSE

		'Click Refresh
		.WebButton("Refresh").Click
		WriteToReport micDone, "Clicked the Refresh Button", "Button Clicked", FALSE
		Wait 5

		'Click View All if needed
		If .Link("ViewAll").Exist(5) Then
			.Link("ViewAll").Click
		End If

		'Click Checkbox for Item shown
		Call .WebCheckBox("Item").SetTOProperty("xpath", "//span[text()='"&GlobalDictionary("ItemID")&"']/../../../td[2]/div/input")
		If .WebCheckBox("Item").Exist(15) Then
			.WebCheckBox("Item").Click
			WriteToReport micDone, "Checked the Box for the Item in the Table", "Item [" & GlobalDictionary("ItemID") & "] Selected", FALSE
		Else
			WriteToReport micFail, "Could Not Locate the Checkbox for the Item: " & GlobalDictionary("ItemID"), "Item not Found", TRUE
			ExitTest
		End If
		
		'Click Save
		.WebButton("Save").Click
		WriteToReport micDone, "Clicked the Save Button", "Button Clicked", FALSE

		'Store Transfer ID
		If GlobalDictionary.Exists("TransferID") Then
       		GlobalDictionary.Remove("TransferID")
    	End If
    	GlobalDictionary.Add "TransferID", .WebElement("TransferID").GetROProperty("innertext")
		WriteToReport micDone, "Stored the Transfer ID: " & GlobalDictionary("TransferID"), "Transfer ID Stored for Later", FALSE

		'Click Worksheet Action
		.Link("WorksheetAction").Click
		WriteToReport micDone, "Clicked the Worksheet Action Link", "Link Clicked", FALSE

		'Select Post Now
		If .WebList("PostingAction").Exist(30) Then
			.WebList("PostingAction").Select POST_NOW
			WriteToReport micDone, "Selected Posting Action: " & POST_NOW, "Action Selected", FALSE
		Else
			WriteToReport micFail, "Failed to Load Page", "Page Took too Long to Load", TRUE
			ExitTest
		End If

		'Click OK
		.WebButton("OK").Click
		WriteToReport micDone, "Clicked the OK Button", "Button Clicked", FALSE

		'New tab appears
		Call WaitForProcessNewTab()

		'Close New Tab
		Browser("Peoplesoft Browser NewTab").Close
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Waits for the Process that opens in a new tab to complete to success
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function WaitForProcessNewTab
	Dim bSuccess, i
	Const SUCCESS = "Success"
	Const MAX_WAIT = 600 '10 minutes
	bSuccess = FALSE

	Browser("PeopleSoft Browser NewTab").Sync
	WriteToReport micDone, "Starting Check for Process Completion", "", FALSE
	With Browser("PeopleSoft Browser NewTab").Page("MassMaintennce_ApplicationResult")
		For i=0 To MAX_WAIT Step 30
			Browser("PeopleSoft Browser NewTab").Page("MassMaintennce_ApplicationResult").RefreshObject
			.WebElement("AppResult_RunStatus").RefreshObject
			.WebElement("AppResult_ProcessInstance").RefreshObject
			.WebElement("AppResult_ReportName").RefreshObject
			If .WebElement("AppResult_RunStatus").Exist(30) Then
				If Trim(.WebElement("AppResult_RunStatus").GetROProperty("innertext")) = SUCCESS Then
					WriteToReport micDone, "Process Instance: "&.WebElement("AppResult_ProcessInstance").GetROProperty("innertext"), "", FALSE
					WriteToReport micPass, "Process Finished: "&.WebElement("AppResult_ReportName").GetROProperty("innertext"), "Process Ran to Success", FALSE
					bSuccess = TRUE
					Exit For
				Else
					Wait 30
				End If
			End If
		Next

		If NOT bSuccess Then
			If .WebElement("AppResult_ProcessInstance").Exist(5) Then
				WriteToReport micFail, "Process Instance ["&.WebElement("AppResult_ProcessInstance").GetROProperty("innertext")&"] Never Reached Success", "Exiting", TRUE
				ExitTest
			Else
				WriteToReport micFail, "Process Did Not Appear or Run to Success Under 10 Minutes", "Exiting", TRUE
			End If
		End If
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Reviews an Item's Activity
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'24May2019			Eric Trout	Updated to accomodate WO validation
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function ReviewItemActivity
	Dim sIndex
	Const EQUAL = "="
	Const ACCT_DATE_HTMLID = "ITEM_ACTIVITY_ACCOUNTING_DT$"
	Const PSTD_DATE_HTMLID = "ITEM_ACTIVITY_POST_DT$"
	Const GRP_TYPE_HTMLID = "GROUP_TYPE_TBL_DESCRSHORT$"
	Const AMT_HTMLID = "ITEM_ACTIVITY_ENTRY_AMT$"
	Const ENTRY_TYPE_HTMLID = "ITEM_ACTIVITY_ENTRY_TYPE$"
	Const REASON_HTMLID = "ITEM_ACTIVITY_ENTRY_REASON$"
	

	'Navigate to View/Update Item Details
	If SelectMainMenu1(GlobalDictionary("ARCustAcctItemDetails")) Then
		WriteToReport micPass, "View/Update Item Details Page", "On the View/Update Item Details page.", FALSE
	Else
		WriteToReport micFail, "View/Update Item Details Page", "Navigation to View/Update Item Details page failed. Exiting test.", TRUE
		ExitTest
	End If

	With Browser("Peoplesoft Browser").Page("View/UpdateItemDetails").PSFrame("TargetContent")
		'Set BU
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set Business Unit: "&GlobalDictionary("BusinessUnit"), "BU Set", FALSE

		'Set Customer ID
		.WebEdit("CustomerID").Set GlobalDictionary("CustID")
		WriteToReport micDone, "Set Customer ID: "&GlobalDictionary("CustID"), "Customer ID Set", FALSE

		'Set Item ID Filter to =
		.WebList("ItemIDFilter").Select EQUAL
		WriteToReport micDone, "Set Item ID Filter to "&EQUAL, "Item ID Filter Set", FALSE

		'Set Item ID
		.WebEdit("ItemID").Set GlobalDictionary("ItemID")
		WriteToReport micDone, "Item Reference Set: "&GlobalDictionary("ItemID"), "Item Reference Set", FALSE

		'Click Search
		.WebButton("Search").Click
		WriteToReport micDone, "Clicked the Search Button", "Button Clicked", FALSE

		'Click Item Activity Tab
		If .WebElement("ItemActivity").Exist(30) Then
			.WebElement("ItemActivity").Click
			WriteToReport micDone, "Clicked the Item Activity Tab", "Tab Clicked", FALSE
		Else
			WriteToReport micFail, "Failed to Load Page", "Page Took too Long to Load", TRUE
			ExitTest
		End If

		'Click View All if needed
		If .Link("ViewAll").Exist(5) Then
			.Link("ViewAll").Click
			WriteToReport micDone, "Clicked the View All Link", "All Entries Shown", FALSE
		End If

		'Verify Status
		If Trim(.WebElement("Status").GetROProperty("innertext")) = GlobalDictionary("Status") Then
			WriteToReport micPass, "Status Matches Expected: "&GlobalDictionary("Status"), "Status is Correct", FALSE
		Else
			WriteToReport micFail, "Status is Not Correct", "Expected ["&GlobalDictionary("Status")&"] Found ["&Trim(.WebElement("Status").GetROProperty("innertext"))&"]", TRUE
		End If

		'Get the ID index to find the entry
		Call .Link("GroupID").SetTOProperty("text", GlobalDictionary("GroupID"))
		If .Link("GroupID").Exist(5) Then
			sIndex = Split(.Link("GroupID").GetROProperty("html id"),"$")(1) 'Take the right of the $
		Else
			WriteToReport micFail, "Group ID Not on Page", "Could Not Find Group with ID: "&GlobalDictionary("GroupID"), TRUE
			ExitTest
		End If
		
		'Verify Accounting Date
		Call .WebElement("AcctDate").SetTOProperty("html id", ACCT_DATE_HTMLID&sIndex)
		If .WebElement("AcctDate").Exist(5) Then
			If .WebElement("AcctDate").GetROProperty("innertext") = DateLeadingZeros Then
				WriteToReport micPass, "Found the Accounting Date: "&DateLeadingZeros, "Accounting Date Found", FALSE
			Else
				WriteToReport micFail, "Did Not Find the Accounting Date", "Expected ["&DateLeadingZeros&"] Found ["&.WebElement("AcctDate").GetROProperty("innertext")&"]", FALSE
			End If
		Else
			WriteToReport micFail, "Unable to Locate Accounting Date Object", "Please Check the Properties Assigned", TRUE
		End If

		'Verify Posted Date
		Call .WebElement("PostedDate").SetTOProperty("html id", PSTD_DATE_HTMLID&sIndex)
		If .WebElement("PostedDate").Exist(5) Then
			If .WebElement("PostedDate").GetROProperty("innertext") = DateLeadingZeros Then
				WriteToReport micPass, "Found the Posted Date: "&DateLeadingZeros, "Posted Date Found", FALSE
			Else
				WriteToReport micFail, "Did Not Find the Posted Date", "Expected ["&DateLeadingZeros&"] Found ["&.WebElement("PostedDate").GetROProperty("innertext")&"]", FALSE
			End If
		Else
			WriteToReport micFail, "Unable to Locate Posted Date Object", "Please Check the Properties Assigned", TRUE
		End If

		'Verify Group ID
		If .Link("GroupID").Exist(5) Then
			If .Link("GroupID").GetROProperty("innertext") = GlobalDictionary("GroupID") Then
				WriteToReport micPass, "Found the Group ID: "&GlobalDictionary("GroupID"), "Group ID Found", FALSE
			Else
				WriteToReport micFail, "Did Not Find the Group ID", "Expected ["&GlobalDictionary("GroupID")&"] Found ["&.Link("GroupID").GetROProperty("innertext")&"]", FALSE
			End If
		Else
			WriteToReport micFail, "Unable to Locate Group ID Object", "Please Check the Properties Assigned", TRUE
		End If

		'Verify Group Type
		If GlobalDictionary("GroupType") <> "" Then
		
			Call .WebElement("GroupType").SetTOProperty("html id", GRP_TYPE_HTMLID&sIndex)
			If .WebElement("GroupType").Exist(5) Then
				If .WebElement("GroupType").GetROProperty("innertext") = GlobalDictionary("GroupType") Then
					WriteToReport micPass, "Found the Group Type: "&GlobalDictionary("GroupType"), "Group Type Found", FALSE
				Else
					WriteToReport micFail, "Did Not Find the Group Type", "Expected ["&GlobalDictionary("GroupType")&"] Found ["&.WebElement("GroupType").GetROProperty("innertext")&"]", FALSE
				End If
			Else
				WriteToReport micFail, "Unable to Locate Group Type Object", "Please Check the Properties Assigned", TRUE
			End If
		End  If	
	
		'Verify Entry Type
		If GlobalDictionary("EntryType") <> "" Then			
		
			Call .WebElement("EntryType").SetTOProperty("html id", ENTRY_TYPE_HTMLID&sIndex)
			If .WebElement("EntryType").Exist(5) Then
				If .WebElement("EntryType").GetROProperty("innertext") = GlobalDictionary("EntryType") Then
					WriteToReport micPass, "Found the Group Type: "&GlobalDictionary("EntryType"), "Entry Type Found", FALSE
				Else
					WriteToReport micFail, "Did Not Find the Entry Type", "Expected ["&GlobalDictionary("EntryType")&"] Found ["&.WebElement("EntryType").GetROProperty("innertext")&"]", FALSE
				End If
			Else
				WriteToReport micFail, "Unable to Locate Entry Type Object", "Please Check the Properties Assigned", TRUE
			End If	
		End If
		
		'Verify Reason
		If  GlobalDictionary("WOReason") <> "" Then	
		
			Call .WebElement("Reason").SetTOProperty("html id", REASON_HTMLID&sIndex)
			If .WebElement("Reason").Exist(5) Then
				If .WebElement("Reason").GetROProperty("innertext") = GlobalDictionary("WOReason") Then
					WriteToReport micPass, "Found the Reason: "&GlobalDictionary("WOReason"), "Reason Found", FALSE
				Else
					WriteToReport micFail, "Did Not Find the Reason", "Expected ["&GlobalDictionary("Reason")&"] Found ["&.WebElement("Reason").GetROProperty("innertext")&"]", FALSE
				End If
			Else
				WriteToReport micFail, "Unable to Locate Reason Object", "Please Check the Properties Assigned", TRUE
			End If
		End If
		
		If GlobalDictionary("Amount") <> "" Then			
		
			'Verify Amount
			Call .WebElement("Amount").SetTOProperty("html id", AMT_HTMLID&sIndex)
			If .WebElement("Amount").Exist(5) Then
				If CDbl(.WebElement("Amount").GetROProperty("innertext")) = CDbl(GlobalDictionary("Amount")) Then
					WriteToReport micPass, "Found the Amount: "&GlobalDictionary("Amount"), "AmountFound", FALSE
				Else
					WriteToReport micFail, "Did Not Find the Amount", "Expected ["&GlobalDictionary("Amount")&"] Found ["&.WebElement("Amount").GetROProperty("innertext")&"]", FALSE
				End If
			Else
				WriteToReport micFail, "Unable to Locate Amount Object", "Please Check the Properties Assigned", TRUE
			End If
		End If
		
		
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Drives the Review of Items for Transfers. Checks the Item under New and Original Customer
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function ReviewTransfer
	Dim i
	For i=1 To 2
		'Set GroupID from TransferID
		GlobalDictionary("GroupID") = GlobalDictionary("TransferID")
		'Set Status
		GlobalDictionary("Status") = GlobalDictionary("Status"&i)
		'Set CustID	
		GlobalDictionary("CustID") = GlobalDictionary(GlobalDictionary("CustIDPrefix"&i)&"CustID")

		Call ReviewItemActivity()
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Creates a Worksheet to Offset Items of opposite value
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function EqualDebitCredit
	Dim nDebit, nCredit
	Dim arrTemp
	Const NET_ZERO = "0.00"
	Const POST_NOW = "Post Now"
	'Navigate to Maintenance Worksheet > Create Worksheet
	If SelectMainMenu1(GlobalDictionary("ARRecMaintCreateWorksheet")) Then
		WriteToReport micPass, "Maintenance Worksheet > Create Worksheet Page", "On the Maintenance Worksheet > Create Worksheet page.", FALSE
	Else
		WriteToReport micFail, "Maintenance Worksheet > Create Worksheet Page", "Navigation to Maintenance Worksheet > Create Worksheet page failed. Exiting test.", TRUE
		ExitTest
	End If

	With Browser("Peoplesoft Browser").Page("Create Worksheet")
		'Click Add a New Value
		.Link("AddANewValue").Click
		WriteToReport micDone, "Clicked the Add a New Value Link", "Link Clicked", FALSE

		'Set BU
		.WebEdit("Business Unit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set Business Unit: "&GlobalDictionary("BusinessUnit"), "BU Set", FALSE

		'Click Add
		.WebButton("Add").Click
		WriteToReport micDone, "Clicked the Add Button", "Button Clicked", FALSE

		'Determine Customer ID and Item value
		arrTemp = dbGetOffsetCreditDebit
		If GlobalDictionary.Exists("CustID") Then
       		GlobalDictionary.Remove("CustID")
    	End If

    	GlobalDictionary.Add "CustID", arrTemp(1)

    	'Set Customer ID
		If .WebEdit("Cust_ID").Exist(15)  Then  
			.WebEdit("Cust_ID").Set GlobalDictionary("CustID")
			WriteToReport micDone, "Set Customer ID: "&GlobalDictionary("CustID"), "Customer ID Set", FALSE
		Else
			WriteToReport micFail, "Failed to Load Page", "Page Took too Long to Load", TRUE
			ExitTest
		End If
		
		'Click Build
		.WebButton("Build").Click
		WriteToReport micDone, "Clicked the Build Button", "Button Clicked", FALSE
	End With

	With Browser("Peoplesoft Browser").Page("WorksheetApplication").PSFrame("TargetContent")

		'Click View All if needed
		If .Link("ViewAll").Exist(30) Then
			.Link("ViewAll").Click
			WriteToReport micDone, "Clicked the View All Link", "All Entries Shown", FALSE
		End If

		'Determine and Select First Item based on Value
		Call .WebCheckBox("ValueBasedEntry").SetTOProperty("xpath", "//input[@value='"&FormatNumber(arrTemp(9))&"']/../../../td/div/input[@type='checkbox']")
		If .WebCheckBox("ValueBasedEntry").Exist(5) Then
			WriteToReport micDone, "Found a Checkbox for an Item with Value: "&FormatNumber(arrTemp(9)), "Will Select this Item", FALSE
			.WebCheckBox("ValueBasedEntry").Click
		Else
			WriteToReport micFail, "Found no Checkbox for an Item with Value: "&FormatNumber(arrTemp(9)), "No Item Selected, Exiting", TRUE
			ExitTest
		End If

		Call .WebElement("ValueBasedItem").SetTOProperty("xpath", "//input[@value='"&FormatNumber(arrTemp(9))&"']/../../../td[6]/div/span")
		If .WebElement("ValueBasedItem").Exist(5) Then
			WriteToReport micDone, "The Item Selected has Item ID: "&.WebElement("ValueBasedItem").GetROProperty("innertext"), "Item ID Found", FALSE
		Else
			WriteToReport micFail, "Found no Item ID for an Item with Value: "&FormatNumber(arrTemp(9)), "No Item Found, Exiting", TRUE
			ExitTest
		End If

		If GlobalDictionary.Exists("ItemID1") Then
       		GlobalDictionary.Remove("ItemID1")
    	End If

    	GlobalDictionary.Add "ItemID1", .WebElement("ValueBasedItem").GetROProperty("innertext")
		WriteToReport micDone, "Retrieved an Item ID: "&GlobalDictionary("ItemID1"), "First Item ID Stored for Later", FALSE

		'Determine and Select Second Item based on Value, which has value that is opposite of the first
		Call .WebCheckBox("ValueBasedEntry").SetTOProperty("xpath", "//input[@value='"&FormatNumber(-1*arrTemp(9))&"']/../../../td/div/input[@type='checkbox']")
		If .WebCheckBox("ValueBasedEntry").Exist(5) Then
			WriteToReport micDone, "Found a Checkbox for an Item with Value: "&FormatNumber(-1*arrTemp(9)), "Will Select this Item", FALSE
			.WebCheckBox("ValueBasedEntry").Click
		Else
			WriteToReport micFail, "Found no Checkbox for an Item with Value: "&FormatNumber(-1*arrTemp(9)), "No Item Selected, Exiting", TRUE
			ExitTest
		End If
		Call .WebElement("ValueBasedItem").SetTOProperty("xpath", "//input[@value='"&FormatNumber(-1*arrTemp(9))&"']/../../../td[6]/div/span")
		If .WebElement("ValueBasedItem").Exist(5) Then
			WriteToReport micDone, "The Item Selected has Item ID: "&.WebElement("ValueBasedItem").GetROProperty("innertext"), "Item ID Found", FALSE
		Else
			WriteToReport micFail, "Found no Item ID for an Item with Value: "&FormatNumber(-1*arrTemp(9)), "No Item Found, Exiting", TRUE
			ExitTest
		End If

		If GlobalDictionary.Exists("ItemID2") Then
       		GlobalDictionary.Remove("ItemID2")
    	End If
    	GlobalDictionary.Add "ItemID2", .WebElement("ValueBasedItem").GetROProperty("innertext")
		WriteToReport micDone, "Retrieved an Item ID: "&GlobalDictionary("ItemID2"), "Second Item ID Stored for Later", FALSE

		'Note Worksheet ID and store as Group ID
		If GlobalDictionary.Exists("GroupID") Then
       		GlobalDictionary.Remove("GroupID")
    	End If
    	GlobalDictionary.Add "GroupID", .WebElement("WorksheetID").GetROProperty("innertext")
		WriteToReport micDone, "Retrieved the Worksheet ID: "&GlobalDictionary("GroupID"), "Worksheet ID Stored for Later", FALSE

		'Verify Debit and Credit are opposite
		nDebit = CDbl(.WebElement("Debit").GetROProperty("innertext"))
		nCredit = CDbl(.WebElement("Credit").GetROProperty("innertext"))
		If Abs(nDebit) = Abs(nCredit) Then
			WriteToReport micPass, "Credit and Debit Selected Offset the Other", "Offset Values Selected", FALSE
		Else
			WriteToReport micFail, "Credit ["&nCredit&"] and Debit ["&nDebit&"] Do Not Offset the Other", "Items Selected Do Not Offset", TRUE
			ExitTest
		End If

		'Verify Net is 0.00
		If .WebElement("Net").GetROProperty("innertext") <> NET_ZERO Then
			WriteToReport micFail, "Net is Not 0.00", "Net Not Zero", TRUE
			ExitTest
		Else
			WriteToReport micPass, "Net is 0.00", "Net Zero as Expected", FALSE
		End If

		'Click Save
		.WebButton("Save").Click
		WriteToReport micDone, "Clicked the Save Button", "Button Clicked", FALSE

		'Click Worksheet Action
		.Link("WorksheetAction").Click
		WriteToReport micDone, "Clicked the Worksheet Action Link", "Link Clicked", FALSE
	End With

	With Browser("Peoplesoft Browser").Page("WorksheetAction").PSFrame("TargetContent") 
		'Select Post Now
		If .WebList("PostingAction").Exist(30) Then
			.WebList("PostingAction").Select POST_NOW
			WriteToReport micDone, "Selected Posting Action: "&POST_NOW, "Action Selected", FALSE
		Else
			WriteToReport micFail, "Failed to Load Page", "Page Took too Long to Load", TRUE
			ExitTest
		End If
		
		'Click OK
		.WebButton("OK").Click
		WriteToReport micDone, "Clicked the OK Button", "Button Clicked", FALSE

		'New tab appears
		Call WaitForProcessNewTab()

		'Close New Tab
		Browser("Peoplesoft Browser NewTab").Close
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Drives the Review of the Offset Items
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function ReviewOffset
	Dim i
	For i=1 To 2
		'Set Item ID
		GlobalDictionary("ItemID") = GlobalDictionary("ItemID"&i)
		Call ReviewItemActivity()
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the AR_Worksheet_CC_Tokens test
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>March 14, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function ARCreateWorksheetCCTokens
	Dim i, itemID, runID
	Dim arrProcess
	Dim sInstance
	Dim bFound

	'Navigate to the Create Worksheet - Credit Card page
	If SelectMainMenu1(GlobalDictionary("CreditCard")) Then
		WriteToReport micPass, "ARCreateWorksheetCCTokens", "On the Create Worksheet - Credit Card page.", FALSE
	Else
		WriteToReport micFail, "ARCreateWorksheetCCTokens", "Navigation to Create Worksheet - Credit Card page failed. Exiting test.", TRUE
		ExitTest
	End If

	With Browser("Peoplesoft Browser").Page("Create Worksheet_CC")

		'Click the "Add a New Value" tab
		.PSFrame("TargetContent").WebElement("Add a New Value").Click
		Browser("Peoplesoft Browser").Sync

		'Enter our search criteria
		.PSFrame("TargetContent").WebEdit("DepositUnit").Set GlobalDictionary("BusinessUnit")
		.PSFrame("TargetContent").WebEdit("BillToCustomer").Set GlobalDictionary("BillToCustomer")
		.PSFrame("TargetContent").WebEdit("Currency").Set GlobalDictionary("PaymentCurrency")

		'Click add and validate it created
		.PSFrame("TargetContent").WebButton("Add").Click
		Browser("Peoplesoft Browser").Sync

		'Confirm the new page loaded
		If .PSFrame("TargetContent").WebEdit("CustomerID").Exist(10) Then
			WriteToReport micPass, "ARCreateWorksheetCCTokens", "Credit Card Worksheet Selection page loaded", False
		Else
			WriteToReport micFail, "ARCreateWorksheetCCTokens", "Credit Card Worksheet Selection page did not load", True
			ExitTest
		End If

		'Enter our new CC info
		.PSFrame("TargetContent").WebEdit("CustomerID").Set GlobalDictionary("BillToCustomer")

		'SubCustomer1 and 2 autopopulate with BusinessUnit
		.PSFrame("TargetContent").WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")

		'Enter our Reference Criteria - whatever the first link is
		.PSFrame("TargetContent").WebEdit("QualCode").Set GlobalDictionary("QualCode")
		.PSFrame("TargetContent").Image("Look up Reference").Click
		Browser("Peoplesoft Browser").Sync
		If .PSFrame("Look Up Reference").Link("FirstResult").Exist(5) Then
			itemID = .PSFrame("Look Up Reference").Link("FirstResult").GetROProperty("text")	'eg, Q119-11093-ALL-NOV18CSPVIR
			GlobalDictionary("ItemId") = itemID
			.PSFrame("Look Up Reference").Link("FirstResult").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Save our changes before leaving the page
		.PSFrame("TargetContent").WebButton("Save").Click
		Browser("Peoplesoft Browser").Sync

		'Click the Build button
		.PSFrame("TargetContent").WebButton("Build").Click
		Browser("Peoplesoft Browser").Sync

		'Click the Worksheet Application link if we don't switch pages
		If .PSFrame("TargetContent").Link("Worksheet Application").Exist(5) Then
			.PSFrame("TargetContent").Link("Worksheet Application").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Confirm new tab loaded
		If .PSFrame("Update Credit Card Worksheet").WebCheckBox("FirstRowSelected").Exist(5) Then
			WriteToReport micPass, "ARCreateWorksheetCCTokens", "Worksheet Application page loaded.", False
		Else
			WriteToReport micPass, "ARCreateWorksheetCCTokens", "Worksheet Application page did not load. Check input data.", True
			ExitTest
		End If

		'Confirm first line is selected
		If .PSFrame("Update Credit Card Worksheet").WebCheckBox("FirstRowSelected").GetROProperty("Checked") = 1 Then
			WriteToReport micPass, "ARCreateWorksheetCCTokens", "First result is selected.", False
		Else
			WriteToReport micWarning, "ARCreateWorksheetCCTokens", "First result is not selected. Attempting to click...", False
			.PSFrame("Update Credit Card Worksheet").WebCheckBox("FirstRowSelected").Click
		End If

		'enter our item ID(value of the first results link that we clicked and stored earlier)
		If .PSFrame("Update Credit Card Worksheet").WebEdit("ItemID").GetROProperty("default value") = "" Then
			.PSFrame("Update Credit Card Worksheet").WebEdit("ItemID").Set itemID
		End If

		'Enter our amount
		If .PSFrame("Update Credit Card Worksheet").WebEdit("Amount").GetROProperty("default value") = "" Then
			.PSFrame("Update Credit Card Worksheet").WebEdit("Amount").Set GlobalDictionary("Amount")
		End If

		'Enter our type
		If .PSFrame("Update Credit Card Worksheet").WebEdit("Type").GetROProperty("default value") = "" Then
			.PSFrame("Update Credit Card Worksheet").WebEdit("Type").Set GlobalDictionary("Type")
		End If

		'Click the Credit Card Details link
		.PSFrame("Update Credit Card Worksheet").Link("Credit Card Details").Click
		Browser("Peoplesoft Browser").Sync

		'Enter our Credit Card info
		.PSFrame("Credit Card Details").WebElement("CreditCardAction").Click
		Browser("Peoplesoft Browser").Sync
		.PSFrame("Credit Card Details").WebList("CreditCardAction").Select GlobalDictionary("CreditCardAction")
		.PSFrame("Credit Card Details").WebList("CreditCardType").Select GlobalDictionary("CreditCardType")
		.PSFrame("Credit Card Details").WebEdit("CardNumber").Set GlobalDictionary("CreditCardNumber")
		.PSFrame("Credit Card Details").WebEdit("Month").Set GlobalDictionary("ExpiryMonth")
		.PSFrame("Credit Card Details").WebEdit("Year").Set GlobalDictionary("Expiryyear")
		.PSFrame("Credit Card Details").WebEdit("FirstName").Set GlobalDictionary("CreditCardFirstName")
		.PSFrame("Credit Card Details").WebEdit("LastName").Set GlobalDictionary("CreditCardLastName")
		.PSFrame("Credit Card Details").WebEdit("EMail").Set GlobalDictionary("EMAIL")
		.PSFrame("Credit Card Details").WebEdit("Phone").Set GlobalDictionary("Phone")
		.PSFrame("Credit Card Details").WebButton("Save").Click
		Browser("Peoplesoft Browser").Sync
		.PSFrame("Credit Card Details").Link("Return to Update Worksheet").Click
		Browser("Peoplesoft Browser").Sync

		'Click the Worksheet Action link
		.PSFrame("Update Credit Card Worksheet").Link("Worksheet Action").Click
		Browser("Peoplesoft Browser").Sync
	End With

	'Switch to the CDW_Batch user
	LOGINCDWBATCH

	'Navigate to the CDW System Process Request page
	If SelectMainMenu1(GlobalDictionary("CDWSystemProcessRequest")) Then
		WriteToReport micPass, "ARCreateWorksheetCCTokens", "Navigated to the CDW System Process Request page.", False
	Else
		WriteToReport micPass, "ARCreateWorksheetCCTokens", "Unable to navigate to the CDW System Process Request page. Exiting test.", True
		ExitTest
	End If

	'enter a new run control ID
	With Browser("Peoplesoft Browser").Page("CDW System Process Request")
		.PSFrame("TargetContent").WebElement("spr_tabAddNewValue").Click
		Browser("Peoplesoft Browser").Sync

		runId = "AR_CC_Test" & CLng(Timer)
		.PSFrame("TargetContent").WebEdit("RunID").Set runID
		WriteToReport micPass, "ARCreateWorksheetCCTokens", "Run control ID is " & "AR_CC_Test" & CLng(Timer), False
		.PSFrame("TargetContent").WebButton("Add").Click
		Browser("Peoplesoft Browser").Sync

		.PSFrame("TargetContent").WebButton("Run").Click
		Browser("Peoplesoft Browser").Sync

		'Search for our credit card process
		bFound = False
		For i = 0 To .PSFrame("Process Scheduler Request").WebTable("psr_tblProcessList").GetROProperty("rows")
			If Trim(.PSframe("Process Scheduler Request").WebElement("html id:=PRCSRQSTDLGLIST_PRCSNAME\$" & i).GetROProperty("innertext")) = GlobalDictionary("Process") Then
				.PSframe("Process Scheduler Request").WebCheckBox("html id:=PRCSRQSTDLG_WRK_SELECT_FLAG\$" & i).Object.scrollIntoView
				.PSframe("Process Scheduler Request").WebCheckBox("html id:=PRCSRQSTDLG_WRK_SELECT_FLAG\$" & i).Set "ON"
				bFound = True
				Exit For
			End If
		Next

		'Confirm our process was found
		If bFound Then
			WriteToReport micPass, "ARCreateWorksheetCCTokens", "Found the process " & GlobalDictionary("Process") & " on the page.", True
		Else
			WriteToReport micFail, "ARCreateWorksheetCCTokens", "Unable to find the process " & GlobalDictionary("Process") & " listed on the page. Exiting test.", True
			ExitTest
		End If

		'Click Ok
		.PSFrame("Process Scheduler Request").WebButton("OK").Object.scrollIntoView
		.PSFrame("Process Scheduler Request").WebButton("OK").Click
		Browser("Peoplesoft Browser").Sync

		'Grab our process number
		sInstance = .PSFrame("Status Bar").WebElement("spr_labelProcessInstance").GetROProperty("innertext")
		arrProcess = split(sInstance, ":")
		sInstance = arrProcess(1)
		WriteToReport micDone, "ARCreateWorksheetCCTokens", "Process Instance is " & sInstance, False
		.PSFrame("Status Bar").Link("spr_linkProcessMonitor").Click
		Browser("Peoplesoft Browser").Sync

		'Call our shared process code
		SharedProcessMonitor "ARCreateWorksheetCCTokens"
	End With

	SharedValidateClosedPayment "ARCreateWorksheetCCTokens"
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the AR15_ApplyPayment_Full test
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>March 17, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function AR15ApplyPayment

	'Create a new payment for our test
	RegularDeposit

	'Call our SharedApplyPayments function
	SharedApplyPayments "AR15ApplyPayment"

	'Navigate to the Process Monitor page
	If SelectMainMenu1(GlobalDictionary("ProcessMonitor")) Then
		WriteToReport micPass, "ApplyPartialPaymentAS400", "Navigated to Process Monitor page", False
	Else
		WriteToReport micFail, "ApplyPartialPaymentAS400", "Unable to navigate to Process Monitor page", True
		ExitTest
	End If

	'Run the AR Update process
	GlobalDictionary("Process") = "FS_STREAMLN"
	SharedProcessMonitor "AR15ApplyPayment"

	'Validate our worksheet and deposit status
	SharedValidateClosedPayment "AR15ApplyPayment"
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the AR15_PatialPayment_AS400 test
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>March 16, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function AR15ApplyPartialPaymentAS400

	'Create a new payment for our test
	RegularDeposit

	'Call our SharedApplyPayments function
	SharedApplyPayments "AR15ApplyPartialPaymentAS400"

	'Navigate to the Process Monitor page
	If SelectMainMenu1(GlobalDictionary("ProcessMonitor")) Then
		WriteToReport micPass, "AR15ApplyPartialPaymentAS400", "Navigated to Process Monitor page", False
	Else
		WriteToReport micFail, "AR15ApplyPartialPaymentAS400", "Unable to navigate to Process Monitor page", True
		ExitTest
	End If

	'Run the AR Update process
	GlobalDictionary("Process") = "FS_STREAMLN"
	SharedProcessMonitor "AR15ApplyPartialPaymentAS400"

	'Validate our worksheet and deposit status
	SharedValidateClosedPayment "AR15ApplyPartialPaymentAS400"
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the AR15_PartialPayoff test
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>March 18, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function AR15ApplyPartialPayoff

	'Create a new payment for our test
	RegularDeposit

	'Call our SharedApplyPayments function
	SharedApplyPayments "AR15ApplyPartialPayoff"

	'Navigate to the Process Monitor page
	If SelectMainMenu1(GlobalDictionary("ProcessMonitor")) Then
		WriteToReport micPass, "AR15ApplyPartialPayoff", "Navigated to Process Monitor page", False
	Else
		WriteToReport micFail, "AR15ApplyPartialPayoff", "Unable to navigate to Process Monitor page", True
		ExitTest
	End If

	'Run the AR Update process
	GlobalDictionary("Process") = "FS_STREAMLN"
	SharedProcessMonitor "AR15ApplyPartialPayoff"

	'Validate our worksheet and deposit status
	SharedValidateClosedPayment "AR15ApplyPartialPayoff"
End Function

'**************************************************************************************************************
''' <summary> 
''' Run the AR15_FullPay_MultiplePayments test
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>March 25, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition:
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function AR15FullPayMultiplePayments
	Dim i

	'Create a new payment for our test
	RegularDeposit

	For i = 0 To 1

		'Call our SharedApplyPayments function
		SharedApplyPayments "AR15FullPayMultiplePayments"

		'Navigate to the Process Monitor page
		If SelectMainMenu1(GlobalDictionary("ProcessMonitor")) Then
			WriteToReport micPass, "AR15FullPayMultiplePayments", "Navigated to Process Monitor page", False
		Else
			WriteToReport micFail, "AR15FullPayMultiplePayments", "Unable to navigate to Process Monitor page", True
			ExitTest
		End If

		'Run the AR Update process
		GlobalDictionary("Process") = "FS_STREAMLN"
		SharedProcessMonitor "AR15FullPayMultiplePayments"

		'Validate our worksheet and deposit status
		SharedValidateClosedPayment "AR15FullPayMultiplePayments"
		
		'Update our original global dictionary values to the new ones from when we made our deposit
		WriteToReport micPass, "Global Dictionary Update", "Updating " & GlobalDictionary("PaymentID") & " to " & GlobalDictionary("PaymentID2"), False
		GlobalDictionary("PaymentID") = GlobalDictionary("PaymentID2")
		WriteToReport micPass, "Global Dictionary Update", "Updating " & GlobalDictionary("PaymentAmount") & " to " & GlobalDictionary("PaymentAmount2"), False
		GlobalDictionary("PaymentItemBalance") = GlobalDictionary("PaymentAmount2")
		GlobalDictionary("PaymentAmount") = GlobalDictionary("PaymentAmount2")
		WriteToReport micPass, "Global Dictionary Update", "Updating " & GlobalDictionary("PaymentItemID") & " to " & GlobalDictionary("ItemID2"), False
		GlobalDictionary("PaymentItemID") = GlobalDictionary("ItemID2")
		
		'GlobalDictionary("PaymentCustomerID2") if needed
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Shared code to handle entering the worksheet data and starting the batch job for the AR15 payment tests
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>March 25, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition: Function called to run the test, such as AR15FullPayMultiplePayments
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function SharedApplyPayments(functionName)
	Dim paymentID
	Dim strAmount, strTemp
	Dim i, rowNumber

	'If we are creating multiple payments, we have to have a new worksheet. Otherwise we end up on the Worksheet Selection page automatically
	If UCase(GlobalDictionary("PaymentGoal")) = "MULTIPLE" Then

		'Navigate to Accounts Receivable > Payments > Apply Payments > Create Worksheet
		If SelectMainMenu1(GlobalDictionary("CreateWorksheetAR")) Then
			WriteToReport micPass, functionName, "Navigated to Create Worksheet page", False
		Else
			WriteToReport micFail, functionName, "Unable to navigate to Create Worksheet page", True
			ExitTest
		End If

		With Browser("PeopleSoft Browser").Page("Create Worksheet_AR").PSFrame("TargetContent")
	
			'Enter our fields we stored or created earlier
			.WebEdit("DepositUnit").Set GlobalDictionary("DepositUnit")
			.WebEdit("DepositID").Set GlobalDictionary("DepositID")
			.WebEdit("PaymentID").Set GlobalDictionary("PaymentID")
			.WebButton("Search").Click
			Browser("PeopleSoft Browser").Sync

			'Confirm we have search results
			If .WebTable("Deposit Unit").Exist(10) Then
				WriteToReport micPass, functionName, "Results table found", False

				'Store the ID and click the first result
				paymentID = .Link("html id:=RESULT4\$0").GetROProperty("innertext")
				.Link("html id:=RESULT4\$0").Click
				Browser("PeopleSoft Browser").Sync

			'If there's only one result, we can go directly to that page
			ElseIf Browser("PeopleSoft Browser").Page("Create Worksheet_AR").PSFrame("TargetContent").WebButton("Build").Exist(5) Then
				WriteToReport micPass, functionName, "Specific Payment ID found!", False
			Else
				WriteToReport micFail, functionName, "Results table not found", True
			End If

			'enter our customer info
			.WebEdit("CustomerID").Set GlobalDictionary("PaymentCustomerID")
			.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")

			'click on the Build button to move to the next page
			.WebButton("Build").Click
			Browser("PeopleSoft Browser").Sync
		End With
	Else

		'On results page
		With Browser("PeopleSoft Browser").Page("Create Worksheet_AR").PSFrame("Payment Worksheet Selection")

			'enter our customer info
			.WebEdit("CustomerID").Set GlobalDictionary("PaymentCustomerID")
			.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")

			'click on the Build button to move to the next page
			.WebButton("Build").Click
			Browser("PeopleSoft Browser").Sync
		End With
	End If

	'On Worksheet Application page
	With Browser("PeopleSoft Browser").Page("Create Worksheet_AR").PSFrame("Payment Worksheet Application")

		If UCASE(GlobalDictionary("PaymentGoal")) = "FULL" Then
		
			'Select our first row
			If .WebCheckBox("ItemSelected").GetROProperty("Checked") = 1 Then
				WriteToReport micPass, functionName, "First row of results selected", False
			Else
				.WebCheckBox("ItemSelected").Click
				WriteToReport micWarning, functionName, "First row of results not selected, setting manually", True
			End If

			'Enter the amount we stored from our SQL query
			.WebEdit("PaymentAmount").Set GlobalDictionary("PaymentItemBalance")
			.WebButton("Refresh").Click
			Browser("PeopleSoft Browser").Sync

			'Confirm type matches. Examples: PY, WAO
			If .WebEdit("EntryType").GetROProperty("default value") = GlobalDictionary("ItemType") Then
				WriteToReport micPass, functionName, "Entry type confirmed as '" & GlobalDictionary("ItemType") & "'", False
			Else
				.WebEdit("EntryType").Set GlobalDictionary("ItemType")
				WriteToReport micWarning, functionName, "Entry type not defaulted to '" & GlobalDictionary("ItemType") & "', setting manually", True
			End If

			If Trim(.WebElement("RemainingAmount").GetROProperty("innertext")) = "0.00" Then
				WriteToReport micPass, functionName, "Remaining Amount confirmed as '0.00'", False
			Else
				WriteToReport micFail, functionName, "Remaining Amount not confirmed as '0.00'. Check data and/or SQL.", True
				ExitTest
			End If

		ElseIf UCASE(GlobalDictionary("PaymentGoal")) = "MULTIPLE" Then

			'Set our row variable to something impossible
			rowNumber = -1

			'Check for selecting the row based on ITEM ID. Payment IDs don't always line up with rows like with the single payment cases
			'For i = 0 To .WebTable("html id:=gbPAYMENT_ITEM\$0").GetROProperty("rows") - 1
			For i = 0 To .WebTable("html id:=tdgblPAYMENT_ITEM\$0").GetROProperty("rows") - 1			
				If Trim(.WebEdit("html id:=ITEM\$" & i).GetROProperty("Default Value")) = Trim(GlobalDictionary("PaymentItemID")) Then
					rowNumber = i
					WriteToReport micPass, functionName, "Item ID " & GlobalDictionary("PaymentItemID") & " found in the table at row " & rowNumber, False
					Exit For
				End If
			Next

			'Use this for our item id search. Fine if it gets overwritten each time as we check once each loop
			GlobalDictionary("OriginalItemID") = Trim(.WebEdit("ItemID").GetROProperty("Default value"))
			
			'Check if there was only one row. Sometimes they are blank.
			If rowNumber = -1 And GlobalDictionary("OriginalItemID") = "" Then
				.WebEdit("html id:=ITEM\$0").Set GlobalDictionary("PaymentItemID")
				rowNumber = 0
			End If

			'Remaining balance should match the first queried balance result
			If Trim(.WebElement("RemainingAmount").GetROProperty("innertext")) = FormatNumber(GlobalDictionary("PaymentItemBalance"), 2) Then
				WriteToReport micPass, functionName, "Remaining Amount matches " & GlobalDictionary("PaymentItemBalance"), False
			Else
				WriteToReport micWarning, functionName, "Remaining Amount should match " & GlobalDictionary("PaymentItemBalance") & ". Check data and/or SQL.", True
				GlobalDictionary("PaymentItemBalance") = Trim(.WebElement("RemainingAmount").GetROProperty("innertext"))
				WriteToReport micWarning, functionName, "New amount is " & GlobalDictionary("PaymentItemBalance") & ".", False
				'ExitTest
			End If

			'Exit the test if no matching rows found
			If rowNumber = -1 Then
				WriteToReport micFail, functionName, "Unable to find Item ID " & GlobalDictionary("PaymentItemID") & " in the table. Please check data.", True
				ExitTest
			End If

			'Clear the selected rows that are not our Item ID
			'For i = 0 To .WebTable("html id:=gbPAYMENT_ITEM\$0").GetROProperty("rows") - 1
			For i = 0 To .WebTable("html id:=tdgblPAYMENT_ITEM\$0").GetROProperty("rows") - 1
				If i = rowNumber Then
					If .WebCheckBox("html id:=PAYMENT_ITEM_ITEM_SELECTED\$" & i).GetROProperty("Checked") = 1 Then
						WriteToReport micPass, functionName, "Correct row of results selected", False
					Else
						.WebCheckBox("html id:=PAYMENT_ITEM_ITEM_SELECTED\$" & i).Click
						WriteToReport micPass, functionName, "Correct row of results selected.", True
					End If
				Else
					If .WebCheckBox("html id:=PAYMENT_ITEM_ITEM_SELECTED\$" & i).GetROProperty("Checked") = 1 Then
						.WebCheckBox("html id:=PAYMENT_ITEM_ITEM_SELECTED\$" & i).Click
						WriteToReport micPass, functionName, "Incorrect row of results unselected.", True
					End If
				End If
			Next

			'Enter the amount we stored from our SQL query
			.WebEdit("html id:=PAYMENT_WRK_PAY_AMT\$" & rowNumber).Set GlobalDictionary("PaymentItemBalance")
'
'			'Save the item ID
'			If Trim(.WebEdit("ItemID").GetROProperty("Default value")) <> GlobalDictionary("PaymentItemID") Then
'				WriteToReport micPass, "Item ID", "Old ID was " & Trim(.WebEdit("ItemID").GetROProperty("Default value")) & ", using saved value of " & GlobalDictionary("PaymentItemID"), False
'				.WebEdit("ItemID").Set GlobalDictionary("PaymentItemID")
'			Else
'				WriteToReport micPass, "Item ID", "ID is " & GlobalDictionary("PaymentItemID"), False
'			End If
'
			'Refresh to implement our changes
			.WebButton("Refresh").Click
			Browser("PeopleSoft Browser").Sync

			'Confirm that our field updated properly
			If Trim(.WebElement("RemainingAmount").GetROProperty("innertext")) = "0.00" Then
				WriteToReport micPass, functionName, "Remaining Amount confirmed as '0.00'", False
			Else
				WriteToReport micWarning, functionName, "Remaining Amount not confirmed as '0.00'. Check data and/or SQL.", True
				'ExitTest
			End If

		ElseIf UCASE(GlobalDictionary("PaymentGoal")) = "PARTIAL" Then

			'Select our first row
			If .WebCheckBox("ItemSelected").GetROProperty("Checked") = 1 Then
				WriteToReport micPass, functionName, "First row of results selected", False
			Else
				.WebCheckBox("ItemSelected").Click
				WriteToReport micWarning, functionName, "First row of results not selected, setting manually", True
			End If

			'Enter the amount we stored from the remaining amount
			strTemp = Trim(.WebElement("RemainingAmount").GetROProperty("innertext"))
			.WebEdit("PaymentAmount").Set strTemp

			'Make sure our Item ID field is set before clicking refresh. It doesn't like that otherwise.
			If .WebEdit("ItemID").GetROProperty("Default value") = "" Then
				.WebEdit("ItemID").Set GlobalDictionary("PaymentItemID")
			End If

			'Click refresh
			.WebButton("Refresh").Click
			Browser("PeopleSoft Browser").Sync

			'Remaining must be zero here, so if it's not make sure our first row is set to PY
			If Trim(.WebElement("RemainingAmount").GetROProperty("innertext")) = "0.00" Then
				WriteToReport micPass, functionName, "Remaining Amount confirmed as '0.00'", False
			Else
				WriteToReport micFail, functionName, "Remaining Amount not confirmed as '0.00', check data", False
				ExitTest
			End If

		ElseIf UCASE(GlobalDictionary("PaymentGoal")) = "PARTIALAS400" Then

			'Select our first row
			If .WebCheckBox("ItemSelected").GetROProperty("Checked") = 1 Then
				WriteToReport micPass, functionName, "First row of results selected", False
			Else
				.WebCheckBox("ItemSelected").Click
				WriteToReport micWarning, functionName, "First row of results not selected, setting manually", True
			End If

			'Enter the amount we stored from the remaining amount
			strTemp = Trim(.WebElement("RemainingAmount").GetROProperty("innertext"))
			'.WebEdit("PaymentAmount").Set strTemp
			.WebEdit("PaymentAmount").Set GlobalDictionary("PaymentControlTotalAMount")

			'Click refresh
			.WebButton("Refresh").Click
			Browser("PeopleSoft Browser").Sync

			'Remaining must be zero here, so if it's not make sure our first row is set to PY
			If Trim(.WebElement("RemainingAmount").GetROProperty("innertext")) = "0.00" Then
				WriteToReport micPass, functionName, "Remaining Amount confirmed as '0.00'", False
			Else
				WriteToReport micWarning, functionName, "Remaining Amount not confirmed as '0.00', updating fields", False
				.WebEdit("EntryType").Set GlobalDictionary("ItemType")
				.WebButton("Refresh").Click
				Browser("PeopleSoft Browser").Sync
			End If

			'set our reasons(normally to INTCO)
			.WebList("SelectType").Select GlobalDictionary("ItemAction")
			.WebEdit("SelectReason").Set GlobalDictionary("SelectReason")
			WriteToReport micPass, functionName, "Action reason set to " & GlobalDictionary("SelectReason"), False

			'Select second line
			If .WebCheckBox("ItemSelected2").GetROProperty("Checked") = 1 Then
				WriteToReport micPass, functionName, "Second row of results selected", False
			Else
				.WebCheckBox("ItemSelected2").Click
				WriteToReport micPass, functionName, "Second row of results selected", False
			End If

			'Confirm type matches. Examples: PY, WAO
			If .WebEdit("EntryType").GetROProperty("default value") = GlobalDictionary("ItemType") Then
				WriteToReport micPass, functionName, "Entry type confirmed as '" & GlobalDictionary("ItemType") & "'", False
			Else
				.WebEdit("EntryType").Set GlobalDictionary("ItemType")
				WriteToReport micWarning, functionName, "Entry type not defaulted to '" & GlobalDictionary("ItemType") & "', setting manually", True
			End If

			If .WebEdit("EntryType2").GetROProperty("default value") = GlobalDictionary("ItemType2") Then
				WriteToReport micPass, functionName, "Entry type confirmed as '" & GlobalDictionary("ItemType2") & "'", False
			Else
				.WebEdit("EntryType2").Set GlobalDictionary("ItemType2")
				WriteToReport micWarning, functionName, "Entry type not defaulted to '" & GlobalDictionary("ItemType2") & "', setting manually", True
			End If

			'Confirm write-off amount is not 0. Should match amount1 + amount2(since amount2 is negative), but it being non-zero is required.
			If Trim(.WebElement("WriteOffAmount").GetROProperty("innertext")) <> "0.00" Then
				WriteToReport micPass, functionName, "Write-off Amount confirmed - " & Trim(.WebElement("WriteOffAmount").GetROProperty("innertext")), False
			Else
				WriteToReport micFail, functionName, "Write-off Amount is '0.00'. Check data and/or SQL.", True
				ExitTest
			End If
		End If

		'Click Save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Click the Worksheet Action link
		.Link("Worksheet Action").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'On Update worksheet page
	With Browser("PeopleSoft Browser").Page("Create Worksheet_AR").PSFrame("Payment Worksheet Action")

		If UCASE(GlobalDictionary("PaymentGoal")) = "PARTIALAS400" Then

			'Click OK
			.WebButton("OK").Click
			Browser("PeopleSoft Browser").Sync

			'Click link to leave then come back
			.Link("Worksheet Application").Click
			Browser("PeopleSoft Browser").Sync

			'Click the Worksheet Action link to return
			Browser("PeopleSoft Browser").Page("Create Worksheet_AR").PSFrame("Payment Worksheet Application").Link("Worksheet Action").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Select our batch process
		.WebList("ProcessList").Select "Post Now"	'#4  "Batch Standard"	'#2

		'Click OK
		.WebButton("OK").Click
		Browser("PeopleSoft Browser").Sync
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' Shared code to handle the validation of our worksheet and item info. Used in multiple tests
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>March 25, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition: Function to run the test, such as AR15FullPayMultiplePayments
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function SharedValidateClosedPayment(functionName)
	Dim itemID, customerID

	If GlobalDictionary("ItemId") <> "" Then
		itemID = GlobalDictionary("ItemId")
	ElseIf GlobalDictionary("PaymentItemID") <> "" Then
		itemID = GlobalDictionary("PaymentItemID")
	Else
		itemID = ""
	End If

	If GlobalDictionary("CustomerID") <> "" Then
		customerID = GlobalDictionary("CustomerID")
	ElseIf GlobalDictionary("PaymentCustomerID") <> "" Then
		customerID = GlobalDictionary("PaymentCustomerID")
	Else
		customerID = ""
	End If

	'Log back in as the original user
	Login(GlobalDictionary("SignInUser"))

	'Navigate to the Accounts Receivable > Customer Accounts > Item Information > View/Update Item Details page
	If SelectMainMenu1(GlobalDictionary("ARCustAcctItemDetails")) Then
		WriteToReport micPass, functionName, "Navigated to the View/Update Item Details page.", False
	Else
		WriteToReport micPass, functionName, "Unable to navigate to the View/Update Item Details page. Exiting test.", True
		ExitTest
	End If

	'Use our OR on the validation page
	With Browser("Peoplesoft Browser").Page("View/UpdateItemDetails").PSFrame("TargetContent")

		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")
		.WebEdit("CustomerID").Set customerID
		.WebEdit("ItemID").Set itemID
		.WebButton("Search").Click
		Browser("Peoplesoft Browser").Sync

		'Check if we are not on the Item page automatically
		If .Link("html id:=RESULT2\$0").Exist(5) Then
			.Link("html id:=RESULT2\$0").Click
			Browser("Peoplesoft Browser").Sync
		End If

		'Validate we are on the Item page
		If .WebElement("Status").Exist(5) Then
			WriteToReport micPass, functionName, "Item page loaded.", False
		Else
			WriteToReport micPass, functionName, "Item page did not load. Check data. Exiting test.", True
			ExitTest
		End If

		'Different search criteria based on the testcase. AR15 ones have a flag set, anything else (so far) is built to check for "closed" status
		If UCASE(GlobalDictionary("PaymentGoal")) <> "" Then

			'Navigate to the Item Activity page
			.WebElement("ItemActivity").Click
			Browser("Peoplesoft Browser").Sync

			'Compare the payment to our previous entry
			If .WebElement("Amount").Exist(5) Then
				If Trim(.WebElement("Amount").GetROProperty("innertext")) = FormatNumber(GlobalDictionary("PaymentItemBalance"), 2) Then
					WriteToReport micPass, functionName, "Payments match! - " & FormatNumber(GlobalDictionary("PaymentItemBalance"), 2), False
				Else
					WriteToReport micWarning, functionName, "Payments do not match - " & Trim(.WebElement("Amount").GetROProperty("innertext")) & " vs " & GlobalDictionary("PaymentItemBalance"), True
					'ExitTest
				End If
			Else
				WriteToReport micFail, functionName, "Amount not displayed.", True
				ExitTest
			End If

			'Second row may or may not exist
			If .WebElement("Amount2").Exist(5) Then
				If Trim(.WebElement("Amount2").GetROProperty("innertext")) = "-" & FormatNumber(GlobalDictionary("PaymentItemBalance"), 2) Then
					WriteToReport micPass, functionName, "Payments balanced out! - " & FormatNumber(GlobalDictionary("PaymentItemBalance"), 2), False
				Else
					WriteToReport micWarning, functionName, "Payments are not equal - " & Trim(.WebElement("Amount2").GetROProperty("innertext")) & " vs " & GlobalDictionary("PaymentItemBalance"), True
					'ExitTest
				End If
			End If
		Else

			'Validate that the Item status is closed
			If Trim(.WebElement("Status").GetROProperty("innertext")) = "Closed" Then
				WriteToReport micPass, functionName, "Status is closed.", False
			Else
				WriteToReport micFail, functionName, "Status is not closed. Check test steps.", True
			End If
		End If
	End With	
End Function

'**************************************************************************************************************
''' <summary> 
''' Shared code to handle deleting the worksheet data. Currently on hold.
''' </summary>
''' <author>Stephen King</author>
''' <datecreated>March 25, 2019</datecreated>
''' <startstate>Logged into peoplesoft website as correct user</startstate>
''' <endstate>Completed</endstate>
''' <returns type="NA"></returns>
'Precondition: Function to run the test, such as AR15FullPayMultiplePayments.
'Parameter:
'Change Control: 
'Date of Change 	Author 			Description of change
'______________________________________________________ 
'**************************************************************************************************************
Public Function SharedDeleteWorksheet(functionName)

	WriteToReport micPass, functionName, "Attempting to delete worksheet with payment ID " & GlobalDictionary("PaymentID"), False

	'Navigate to Accounts Receivable > Payments > Apply Payments > Create Worksheet
	If SelectMainMenu1(GlobalDictionary("CreateWorksheetAR")) Then
		WriteToReport micPass, functionName, "Navigated to Create Worksheet page", False
	Else
		WriteToReport micFail, functionName, "Unable to navigate to Create Worksheet page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Create Worksheet_AR").PSFrame("TargetContent")

		'Enter our fields we stored earlier
		.WebEdit("DepositUnit").Set GlobalDictionary("DepositUnit")
		.WebEdit("DepositID").Set GlobalDictionary("DepositID")
		.WebEdit("PaymentID").Set GlobalDictionary("PaymentID")
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync
	End With
	
	With Browser("PeopleSoft Browser").Page("Create Worksheet_AR").PSFrame("Payment Worksheet Selection")

		'Click Worksheet Action link
		.Link("Worksheet Action").Click
		Browser("PeopleSoft Browser").Sync
	End With

	With Browser("PeopleSoft Browser").Page("Create Worksheet_AR").PSFrame("Payment Worksheet Selection")
	
		'If the button is disabled go back and click build
		If .WebButton("Delete Worksheet").GetROProperty("disabled") = 1 Then
			.Link("Worksheet Selection").Click
			Browser("PeopleSoft Browser").Sync
			Browser("PeopleSoft Browser").Page("Create Worksheet_AR").PSFrame("Payment Worksheet Selection").WebButton("Build").Click
			Browser("PeopleSoft Browser").Sync
			Browser("PeopleSoft Browser").Page("Create Worksheet_AR").PSFrame("Payment Worksheet Application").Link("Worksheet Action").Click
			Browser("PeopleSoft Browser").Sync
		End If

		'Click the Delete Worksheet button
		.WebButton("Delete Worksheet").Click
		Browser("PeopleSoft Browser").Sync
		WriteToReport micPass, functionName, "Worksheet with payment ID " & GlobalDictionary("PaymentID") & " successfully deleted!", False
	End With
End Function

'**************************************************************************************************************
''' <summary> 
''' One Deposit, multiple payments for item/customer combos. Driven by GlobalDictionary("Count")
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function RegularDepositTotal
	Dim arrResult
	Dim sAmounts
	Dim nControlTotalAmount, i, nPosition
	Dim bDepositID
	
	bDepositID = False
	sAmounts = ""
	nControlTotalAmount = 0.0
	'Navigate to Regular Deposit (Main Menu > Account Receivable > Payments > Online Payments > Regular Deposit)
	If SelectMainMenu1(GlobalDictionary("ARPmntOnlineRegDeposit")) Then
		WriteToReport micPass, "Regular Deposit Page", "On the Regular Deposit page.", FALSE
	Else
		WriteToReport micFail, "Regular Deposit Page", "Navigation to Regular Deposit page failed. Exiting test.", TRUE
		ExitTest
	End If

	With Browser("Peoplesoft Browser").Page("Regular Deposit").PSFrame("TargetContent")
		'Click Add a New Value
		.WebElement("Add a New Value Tab").Click
		WriteToReport micDone, "Clicked the Add a New Value Tab", "Tab Clicked", FALSE

		'Set Business Unit
		.WebEdit("Business Unit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set Business Unit: "&GlobalDictionary("BusinessUnit"), "BU Set", FALSE

		'Click Add
		.WebButton("Add").Click
		WriteToReport micDone, "Clicked the Add Button", "Button Clicked", FALSE

		'Set Accounting Date, first of month previous
		.WebEdit("Accounting Date").Set AnyDateLeadingZeros(DateSerial(Year(Now), Month(Now)-1, 1))
		WriteToReport micDone, "Set the Accounting Date: "&AnyDateLeadingZeros(DateSerial(Year(Now), Month(Now)-1, 1)), "Accounting Date Set To Day One of Month Previous", FALSE

		'Set Bank Code
		.WebEdit("Bank Code").Set GlobalDictionary("BankCode")
		WriteToReport micDone, "Set Bank Code: "&GlobalDictionary("BankCode"), "Bank Code Set", FALSE

		'Set Bank Account
		.WebEdit("Bank Account").Set GlobalDictionary("BankAccount")
		WriteToReport micDone, "Set Bank Account: "&GlobalDictionary("BankAccount"), "Bank Account Set", FALSE

		'Set Control Currency
		.WebEdit("Control Currency").Set GlobalDictionary("Currency")
		WriteToReport micDone, "Set Control Currency: "&GlobalDictionary("Currency"), "Control Currency Set", FALSE

		'Obtain Items with Customer/Balance data
		arrResult = dbGetItems(GlobalDictionary("Count"))
		'0 = First Item Customer, 1 = First Item ID, 2 = First Item Balance Amount, 3 = Second Item Customer, 4 = Second Item ID, 5 = Second Balance Amount, etc

		'Set Total Amount of all Items
		For i=0 To CInt(GlobalDictionary("Count"))-1
			nControlTotalAmount = Round(nControlTotalAmount + arrResult(2+(i*3)), 2)
		Next
		.WebEdit("Control Total Amount").Set nControlTotalAmount
		WriteToReport micDone, "Set Control Total Amount: "&nControlTotalAmount, "Control Total Amount Set", FALSE

		'Set Count of Payments
		.WebEdit("Count").Set CInt(GlobalDictionary("Count"))
		WriteToReport micDone, "Set Count: "&GlobalDictionary("Count"), "Count Set", FALSE

		'Click Payments Tab
		.WebElement("Payments Tab").Click
		WriteToReport micDone, "Clicked the Payments Tab", "Tab Clicked", FALSE

		For i=0 To CInt(GlobalDictionary("Count"))-1
			'if not first, click the + button
			If i <> 0 Then
				.WebButton("+Payment").Click
				WriteToReport micDone, "Clicked the + Button to Add a Payment", "Button Clicked", FALSE
			End If

			'Set Payment ID based on "TEST" & counter +1
			.WebEdit("Payment ID").Set "TEST"&(i+1)
			WriteToReport micDone, "Set Payment ID: "&"TEST"&(i+1), "Payment ID Set", FALSE

			'Set Amount of an item based on counter position
			nPosition = 2 + (i * 3)
			.WebEdit("Payment Amount").Set arrResult(nPosition)
			WriteToReport micDone, "Set Payment Amount for Item Number ["&i&"]: "&arrResult(nPosition), "Payment Amount Set", FALSE
			sAmounts = sAmounts & "'"&arrResult(nPosition)&"',"

			'Check that Payment Predictor is checked
			If .WebCheckBox("Payment Predictor").GetROProperty("checked") <> 1 Then '1 is checked, 0 is cleared
				.WebCheckBox("Payment Predictor").Click
				WriteToReport micDone, "Checked the Payment Predictor Box", "Box Checked", FALSE
			Else
				WriteToReport micDone, "Payment Predictor Box Already Checked", "No Action Taken", FALSE
			End If

			'Customer ID and BU
			nPosition = 0 + (i * 3)
			.WebEdit("Customer ID").Set arrResult(nPosition)
			WriteToReport micDone, "Set Customer for Item Number ["&i&"]: "&arrResult(nPosition), "Customer Set", FALSE

			.WebEdit("Customer BU").Set GlobalDictionary("BusinessUnit")
			WriteToReport micDone, "Set Customer BU for Item Number ["&i&"]: "&GlobalDictionary("BusinessUnit"), "Customer BU Set", FALSE

			'Set Qual Code
			.WebEdit("Qual Code").Set GlobalDictionary("QualCode")
			WriteToReport micDone, "Set Qual Code for Item Number ["&i&"]: "&GlobalDictionary("QualCode"), "Qual Code Set", FALSE

			'Set Item ID aka Reference
			nPosition = 1 + (i * 3)
			.WebEdit("Reference").Set arrResult(nPosition)
			WriteToReport micDone, "Set Reference for Item Number ["&i&"]: "&arrResult(nPosition), "Reference Set", FALSE
		Next
		'Click Save
		.WebButton("Save").Click
		WriteToReport micDone, "Clicked the Save Button", "Button Clicked", FALSE
		Wait 5

		'Save Deposit ID
		If GlobalDictionary.Exists("DepositID") Then
			GlobalDictionary.Remove("DepositID")
		End If
		
		For i = 1 To 10 
		
			wait(1)
			If TRIM(.WebElement("Deposit ID").GetROProperty("innertext")) <> "NEXT" Then
				bDepositID = True
				Exit For		
			End If
			
		Next

		GlobalDictionary.Add "DepositID", .WebElement("Deposit ID").GetROProperty("innertext")
		WriteToReport micDone, "Deposit ID is [" & GlobalDictionary("DepositID") & "]", "Deposit ID found after clicking the 'Save' button.", FALSE
	End With
	'Save amounts to GlobalDictionary
	If GlobalDictionary.Exists("Amounts") Then
		GlobalDictionary.Remove("Amounts")
	End If
	GlobalDictionary.Add "Amounts", Left(sAmounts, Len(sAmounts)-1) 'Removes the final comma
	WriteToReport micDone, "Amounts are [" & GlobalDictionary("Amounts") & "]", "Amounts saved", FALSE
End Function

'**************************************************************************************************************
''' <summary> 
''' Checks the applied payments for items from RegularDepositTotal
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function CheckAppliedPayment
	Dim arrItems, arrAmounts, arrResult, i
	arrItems = Split(GlobalDictionary("Items"), ",")
	arrAmounts = Split(GlobalDictionary("Amounts"), ",")
	For i=0 To UBound(arrItems)
		arrResult = dbCheckItemPayment(arrItems(i), GlobalDictionary("DepositID"))
		arrAmounts(i) = Replace(arrAmounts(i), "'", "") 'Remove the single quotes
		If CDbl(arrResult(7)) = (-1 * CDbl(arrAmounts(i))) Then
			WriteToReport micPass, "Found the Payment in the Database", "Payment Applied", FALSE
		Else
			WriteToReport micFail, "Did not Find the Payment for Item ["&arrItems(i)&"] on Deposit ["&GlobalDictionary("DepositID")&"] for Amount ["&arrAmounts(i)&"]", "", FALSE
		End If
	Next
End Function

'**************************************************************************************************************
''' <summary> 
''' Run Update AR for Payments only
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function UpdateARPmtOnly
	Dim sRunID
	Const PROCNAME = "ARUPDATE"
	Const RUNCONTROL = "REQRECUPD"
	Const PROCFREQ = "Always"


	'Navigate to Request Receivables Update
	If SelectMainMenu1(GlobalDictionary("ARRecReqUpdate")) Then
		WriteToReport micPass, "Request Receivables Update Page", "On the Request Receivables Update page.", FALSE
	Else
		WriteToReport micFail, "Request Receivables Update Page", "Navigation to Request Receivables Update page failed. Exiting test.", TRUE
		ExitTest
	End If

	With Browser("Peoplesoft Browser").Page("Request Receivables Update").PSFrame("TargetContent")
		'Click Add a New Value
		.WebElement("Add a New Value").Click
		WriteToReport micDone, "Clicked Add a New Value", "Tab Clicked", FALSE

		'Set Run Control ID
		Randomize
		sRunID = RUNCONTROL & CStr(Round(100000*Rnd))
		.WebEdit("RunID").Set sRunID
		WriteToReport micDone, "Set Run Control ID: "&sRunID, "Run Control ID Set", FALSE

		'Click Add
		.WebButton("Add").Click
		WriteToReport micDone, "Clicked the Add Button", "Button Clicked", FALSE

		If .Link("REQRECUPD").Exist(5) Then
			.Link("REQRECUPD").Click
			WriteToReport micDone, "Run Control Already Used, Clicking Link", "Link Clicked", FALSE
		End If

		'Set Group Unit
		If .WebEdit("GroupUnit").Exist(15) Then
			.WebEdit("GroupUnit").Set GlobalDictionary("BusinessUnit")
			WriteToReport micDone, "Set Group Unit: "&GlobalDictionary("BusinessUnit"), "Group Unit Set", FALSE
		Else
			WriteToReport micFail, "Failed to Load Request Receivables Update Details Page", "Exiting Test", TRUE
			ExitTest
		End If
		

		'Set Process Frequency
		.WebList("ProcessFrequency").Select PROCFREQ
		WriteToReport micDone, "Selected Process Frequency: "&PROCFREQ, "Process Frequency Selected", FALSE

		'Set Accounting To Date
		'.WebEdit("FromDate").Set DateLeadingZeros
		.WebEdit("ToDate").Set DateLeadingZeros
		WriteToReport micDone, "Set the To Date to: "&DateLeadingZeros, "From/To Date Set", FALSE

		'Uncheck ALL
		If .WebCheckBox("All").GetROProperty("checked") = 1 Then '1 is checked, 0 is cleared
			.WebCheckBox("All").Click
			WriteToReport micDone, "Unchecked the All Box", "Box Unchecked", FALSE
		Else
			WriteToReport micDone, "All Box Already Unchecked", "No Action Taken", FALSE
		End If

		'Check Payments
		If .WebCheckBox("Payments").GetROProperty("checked") <> 1 Then '1 is checked, 0 is cleared
			.WebCheckBox("Payments").Click
			WriteToReport micDone, "Checked the Payments Box", "Box Checked", FALSE
		Else
			WriteToReport micDone, "Payments Box Already Checked", "No Action Taken", FALSE
		End If

		'Click Run
		.WebButton("Run").Click
		WriteToReport micDone, "Clicked the Run Button", "Button Clicked", FALSE

		'Check box for PS/AR Receivables Updates 
		Browser("Peoplesoft Browser").Page("Request Receivables Update").PSFrame("Process Scheduler Request").WebCheckBox("SelectFlag").Click
		WriteToReport micDone, "Checked the Box for  PS/AR Receivables Updates", "Box Checked", FALSE

		'Click OK
		Browser("Peoplesoft Browser").Page("Request Receivables Update").PSFrame("Process Scheduler Request").WebButton("OK").Click
		WriteToReport micDone, "Clicked the OK Button", "Button Clicked", FALSE

		'Click Process Monitor
		.Link("Process Monitor").Click
		WriteToReport micDone, "Clicked the Process Monitor Link", "Link Clicked", FALSE
	End With

	Call CheckProcessMontiorStatus(PROCNAME)
End Function

'**************************************************************************************************************
''' <summary> 
''' One Deposit, One Payment, Multiple Accounts/items
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function RegularDepositMultipleAccounts
	Dim arrResult
	Dim sAmounts, sCustIDs, sItemIDs
	Dim nControlTotalAmount, i, nPosition
	Const ONE_PAYMENT = 1
	sAmounts = ""
	sItemIDs = ""
	sCustIDs = ""
	nControlTotalAmount = 0.0
	'Navigate to Regular Deposit (Main Menu > Account Receivable > Payments > Online Payments > Regular Deposit)
	If SelectMainMenu1(GlobalDictionary("ARPmntOnlineRegDeposit")) Then
		WriteToReport micPass, "Regular Deposit Page", "On the Regular Deposit page.", FALSE
	Else
		WriteToReport micFail, "Regular Deposit Page", "Navigation to Regular Deposit page failed. Exiting test.", TRUE
		ExitTest
	End If

	With Browser("Peoplesoft Browser").Page("Regular Deposit").PSFrame("TargetContent")
		'Click Add a New Value
		.WebElement("Add a New Value Tab").Click
		WriteToReport micDone, "Clicked the Add a New Value Tab", "Tab Clicked", FALSE

		'Set Business Unit
		.WebEdit("Business Unit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set Business Unit: "&GlobalDictionary("BusinessUnit"), "BU Set", FALSE

		'Click Add
		.WebButton("Add").Click
		WriteToReport micDone, "Clicked the Add Button", "Button Clicked", FALSE

		'Set Accounting Date, first of month previous
		.WebEdit("Accounting Date").Set AnyDateLeadingZeros(DateSerial(Year(Now), Month(Now)-1, 1))
		WriteToReport micDone, "Set the Accounting Date: "&AnyDateLeadingZeros(DateSerial(Year(Now), Month(Now)-1, 1)), "Accounting Date Set To Day One of Month Previous", FALSE

		'Set Bank Code
		.WebEdit("Bank Code").Set GlobalDictionary("BankCode")
		WriteToReport micDone, "Set Bank Code: "&GlobalDictionary("BankCode"), "Bank Code Set", FALSE

		'Set Bank Account
		.WebEdit("Bank Account").Set GlobalDictionary("BankAccount")
		WriteToReport micDone, "Set Bank Account: "&GlobalDictionary("BankAccount"), "Bank Account Set", FALSE

		'Set Control Currency
		.WebEdit("Control Currency").Set GlobalDictionary("Currency")
		WriteToReport micDone, "Set Control Currency: "&GlobalDictionary("Currency"), "Control Currency Set", FALSE

		'Obtain Items with Customer/Balance data
		arrResult = dbGetItems(GlobalDictionary("Count"))
		'0 = First Item Customer, 1 = First Item ID, 2 = First Item Balance Amount, 3 = Second Item Customer, 4 = Second Item ID, 5 = Second Balance Amount, etc

		'Set Total Amount of all Items
		For i=0 To CInt(GlobalDictionary("Count"))-1
			nControlTotalAmount = Round(nControlTotalAmount + arrResult(2+(i*3)), 2)
		Next
		.WebEdit("Control Total Amount").Set nControlTotalAmount
		WriteToReport micDone, "Set Control Total Amount: "&nControlTotalAmount, "Control Total Amount Set", FALSE

		'Set Count of Payments
		.WebEdit("Count").Set ONE_PAYMENT
		WriteToReport micDone, "Set Count: "&ONE_PAYMENT, "Count Set", FALSE

		'Click Payments Tab
		.WebElement("Payments Tab").Click
		WriteToReport micDone, "Clicked the Payments Tab", "Tab Clicked", FALSE

		'Set Payment ID to "TEST1" for one Payment ID
		.WebEdit("Payment ID").Set "TEST1"
		WriteToReport micDone, "Set Payment ID: "&"TEST1", "Payment ID Set", FALSE

		'Set Amount of all items
		.WebEdit("Payment Amount").Set nControlTotalAmount
		WriteToReport micDone, "Set Payment Amount for all Items: "& nControlTotalAmount, "Payment Amount Set", FALSE

		For i=0 To CInt(GlobalDictionary("Count"))-1
			'if not first, click the + buttons
			If i <> 0 Then
				.WebButton("+Customer").Click
				WriteToReport micDone, "Clicked the + Button to Add a Customer", "Button Clicked", FALSE
				.WebButton("+Item").Click
				WriteToReport micDone, "Clicked the + Item to Add an Item", "Button Clicked", FALSE
				Dialog("NoofRowsToAdd").WinEdit("NoOfRows").Set 1
				Dialog("NoofRowsToAdd").WinButton("Ok").Click
				WriteToReport micDone, "Added 1 Item Row", "1 Row Added", FALSE
			End If

			'Store individual amounts for later
			nPosition = 2 + (i * 3)
			sAmounts = sAmounts & "'"&arrResult(nPosition)&"',"
			
			'Check that Payment Predictor is checked
			If .WebCheckBox("Payment Predictor").GetROProperty("checked") <> 1 Then '1 is checked, 0 is cleared
				.WebCheckBox("Payment Predictor").Click
				WriteToReport micDone, "Checked the Payment Predictor Box", "Box Checked", FALSE
			Else
				WriteToReport micDone, "Payment Predictor Box Already Checked", "No Action Taken", FALSE
			End If

			'Customer ID and BU
			nPosition = 0 + (i * 3)
			.WebEdit("Customer ID").Set arrResult(nPosition)
			WriteToReport micDone, "Set Customer for Item Number ["&i+1&"]: "&arrResult(nPosition), "Customer Set", FALSE
			sCustIDs = sCustIDs & "'"&arrResult(nPosition)&"',"

			.WebEdit("Customer BU").Set GlobalDictionary("BusinessUnit")
			WriteToReport micDone, "Set Customer BU for Item Number ["&i+1&"]: "&GlobalDictionary("BusinessUnit"), "Customer BU Set", FALSE

			'Set Qual Code
			Call .WebEdit("Qual Code").SetTOProperty("name", "PAYMENT_ID_ITEM_REF_QUALIFIER_CODE\$"&i)
			.WebEdit("Qual Code").Set GlobalDictionary("QualCode")
			WriteToReport micDone, "Set Qual Code for Item Number ["&i+1&"]: "&GlobalDictionary("QualCode"), "Qual Code Set", FALSE

			'Set Item ID aka Reference
			nPosition = 1 + (i * 3)
			Call .Webedit("Reference").SetTOProperty("name", "PAYMENT_ID_ITEM_REF_VALUE\$"&i)
			.WebEdit("Reference").Set arrResult(nPosition)
			WriteToReport micDone, "Set Reference for Item Number ["&i+1&"]: "&arrResult(nPosition), "Reference Set", FALSE
			sItemIDs = sItemIDs & "'"&arrResult(nPosition)&"',"
		Next
		'Click Save
		.WebButton("Save").Click
		WriteToReport micDone, "Clicked the Save Button", "Button Clicked", FALSE
		Wait 5

		'Save Deposit ID
		If GlobalDictionary.Exists("DepositID") Then
			GlobalDictionary.Remove("DepositID")
		End If
		GlobalDictionary.Add "DepositID", .WebElement("Deposit ID").GetROProperty("innertext")
		WriteToReport micDone, "Deposit ID is [" & GlobalDictionary("DepositID") & "]", "Deposit ID found after clicking the 'Save' button.", FALSE
	End With
	'Save amounts and IDs to GlobalDictionary
	If GlobalDictionary.Exists("Amounts") Then
		GlobalDictionary.Remove("Amounts")
	End If
	GlobalDictionary.Add "Amounts", Left(sAmounts, Len(sAmounts)-1) 'Removes the final comma
	WriteToReport micDone, "Amounts are [" & GlobalDictionary("Amounts") & "]", "Amounts saved", FALSE

	If GlobalDictionary.Exists("CustomerIDs") Then
		GlobalDictionary.Remove("CustomerIDs")
	End If
	GlobalDictionary.Add "CustomerIDs", Left(sCustIDs, Len(sCustIDs)-1) 'Removes the final comma
	WriteToReport micDone, "Customers are [" & GlobalDictionary("CustomerIDs") & "]", "Customers saved", FALSE
	
	If GlobalDictionary.Exists("ItemIDs") Then
		GlobalDictionary.Remove("ItemIDs")
	End If
	GlobalDictionary.Add "ItemIDs", Left(sItemIDs, Len(sItemIDs)-1) 'Removes the final comma
	WriteToReport micDone, "Items are [" & GlobalDictionary("ItemIDs") & "]", "Items saved", FALSE
End Function

'**************************************************************************************************************
''' <summary> 
''' Sets the payment of one item in the deposit to partial (half), and leaves the other as default full. 
''' Does not post the payment.
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function PaymentOneFullOnePartial
	Dim i, nHalf, nLeftover, nOriginal
	Dim arrTemp

	'Navigate to Apply Payments > Create Worksheet
	If SelectMainMenu1(GlobalDictionary("ARPmntCreateWorksheet")) Then
		WriteToReport micPass, "Apply Payments > Create Worksheet Page", "On the Apply Payments > Create Worksheet page.", FALSE
	Else
		WriteToReport micFail, "Apply Payments > Create Worksheet Page", "Navigation to Apply Payments > Create Worksheet page failed. Exiting test.", TRUE
		ExitTest
	End If
	With Browser("PeopleSoft Browser").Page("Create Worksheet_AR").PSFrame("TargetContent")

		'Set Deposit BU
		.WebEdit("DepositUnit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set Deposit Unit: "&GlobalDictionary("BusinessUnit"), "BU Set", FALSE

		'Set Deposit ID
		.WebEdit("DepositID").Set GlobalDictionary("DepositID")
		WriteToReport micDone, "Set Deposit ID: "&GlobalDictionary("DepositID"), "Deposit ID Set", FALSE

		'Click Search
		.WebButton("Search").Click
		WriteToReport micDone, "Clicked the Search Button", "Button Clicked", FALSE

		'Verify Customers
		arrTemp = Split(GlobalDictionary("CustomerIDs"), ",")
		For i=0 To UBound(arrTemp)
			If InStr(1, GlobalDictionary("CustomerIDs"), .WebEdit("CustomerID").GetROProperty("value")) > 0 Then
				WriteToReport micDone, "Found Expected Customer ID: "&.WebEdit("CustomerID").GetROProperty("value"), "Expected Customer Found", FALSE
			Else
				WriteToReport micFail, "Found Unexpected Customer ID: "&.WebEdit("CustomerID").GetROProperty("value"), "Unexpected Customer", TRUE
				ExitTest
			End If
			If .WebButton("CustRef>").Exist(5) Then
				.WebButton("CustRef>").Click
				WriteToReport micDone, "Clicked the Right Button to Show Next Customer", "Button Clicked", FALSE
			End If
		Next

		'Verify Items
		arrTemp = Split(GlobalDictionary("ItemIDs"), ",")
		For i=0 To UBound(arrTemp) 
			Call .WebEdit("ItemReference").SetTOProperty("name", "PAYMENT_ID_ITEM_REF_VALUE$"&i)
			If InStr(1, GlobalDictionary("ItemIDs"), .WebEdit("ItemReference").GetROProperty("value")) > 0 Then
				WriteToReport micDone, "Found Expected Item ID: "&.WebEdit("ItemReference").GetROProperty("value"), "Expected Item Found", FALSE
			Else
				WriteToReport micFail, "Found Unexpected Item ID: "&.WebEdit("ItemReference").GetROProperty("value"), "Unexpected Item", TRUE
				ExitTest
			End If
		Next

		'Click Build
		.WebButton("Build").Click
		WriteToReport micDone, "Clicked the Build Button", "Button Clicked", FALSE

		Browser("PeopleSoft Browser").Sync

		'Click View All if needed
		If .Link("ViewAll").Exist(5) Then
			.Link("ViewAll").Click
			WriteToReport micDone, "Clicked the View All Link", "Link Clicked", FALSE
		End If

		'Find the first Item from the Deposit created earlier
		arrTemp(0) = Replace(arrTemp(0), "'", "") 'Remove the single quotes
		Call .WebEdit("ItemToHalve").SetTOProperty("xpath", "//input[@value='"&arrTemp(0)&"']/../../../td[4]/div/input") 'arrTemp(0) here is the first of the Item IDs.

		Do While .WebButton(">Next").Exist(5) AND NOT .WebEdit("ItemToHalve").Exist(5)
			.WebButton(">Next").Click
			WriteToReport micDone, "Clicked the Right Button to Show More Items", "", FALSE
		Loop

		If NOT .WebEdit("ItemToHalve").Exist(5) Then
			WriteToReport micFail, "Could Not Find Item ["&arrTemp(0)&"]", "Item Not Found", TRUE
			ExitTest
		End If

		nOriginal = .WebEdit("ItemToHalve").GetROProperty("value")
		WriteToReport micDone, "The Orignal Amount for Item ["&arrTemp(0)&"] is ["&nOriginal&"]", "Original Value Stored", FALSE

		'Decrease the Pay Amt of that Item to half (if odd, half rounded down to 2 decimal places). Store the Leftover
		nHalf = Round(nOriginal/2,2)
		nLeftover = nOriginal - nHalf
		.WebEdit("ItemToHalve").Set nHalf
		WriteToReport micDone, "Set the Pay Amount for Item ["&arrTemp(0)&"] to a Partial Amount ["&nHalf&"]", "Partial Amount Set", FALSE

		'Click Save
		.WebButton("Save").Click
		WriteToReport micDone, "Clicked the Save Button", "Button Clicked", FALSE

		Wait 90
		Browser("PeopleSoft Browser").Sync

		'Verify the Remaining displays the other half of the Pay Amt chosen
		If nLeftover <> CDbl(.WebElement("Remaining").GetROProperty("innertext")) Then
			WriteToReport micFail, "The Remaining Field ["&CDbl(.WebElement("Remaining").GetROProperty("innertext"))&"] Does Not Match the Remainder of the Partial Payment ["&nLeftover&"] for Item ["&arrTemp(0)&"]", "Remaining is Not Correct", TRUE
			ExitTest
		Else
			WriteToReport micPass, "The Remaining Field ["&CDbl(.WebElement("Remaining").GetROProperty("innertext"))&"] Matches the Remainder of the Partial Payment ["&nLeftover&"] for Item ["&arrTemp(0)&"]", "Remaining is Correct", FALSE
		End If
	End With
End Function

Public Function DetermineVoucherID(functionName)

	'Navigate to the Accounts Receivable > Receivables Maintenance > Refunds > Refund Status page
	If SelectMainMenu1(GlobalDictionary("RefundStatus")) Then
		WriteToReport micPass, functionName, "Navigated to Refund Status page", False
	Else
		WriteToReport micFail, functionName, "Unable to navigate to Refund Status page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Refund Status").PSFrame("TargetContent")

		'Enter our business unit
		.WebEdit("BusinessUnit").Set GlobalDictionary("BusinessUnit")

		'Enter our invoice number(Item ID stored earlier)
		.WebEdit("InvoiceID").Set GlobalDictionary("ITEM")

		'Click Search
		.WebButton("Search").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm we have search results
		If .Link("VoucherResult").Exist(5) Then
			GlobalDictionary("VoucherID") = Trim(.Link("VoucherResult").GetROProperty("innertext"))
			WriteToReport micPass, functionName, "Voucher Result link found - " & GlobalDictionary("VoucherID"), False
		Else
			WriteToReport micFail, functionName, "Voucher Result link not found. Check data.", True
			ExitTest
		End If
	End With
End Function

Public Function APVoucherBuild(functionName)
	Dim arrTemp
	Dim strInstance
	Dim runID

	'Navigate to the Accounts Payable > Batch Processes > Vouchers > Voucher Build page
	If SelectMainMenu1(GlobalDictionary("APVoucherBuild")) Then
		WriteToReport micPass, functionName, "Navigated to Voucher Build page", False
	Else
		WriteToReport micFail, functionName, "Unable to navigate to Voucher Build page", True
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("VoucherBuildRequest")

		'Create a new Run ID
		.WebElement("AddNewValue").Click
		Browser("PeopleSoft Browser").Sync

		runID = "APVB" & CLng(Timer)
		.WebEdit("RunControlId").Set runID 'EG, "APVB14022620191533"
		.WebButton("Add").Click
		Browser("PeopleSoft Browser").Sync

		'Confirm our page loaded
		If .WebEdit("RequestId").Exist(10) Then
			WriteToReport micPass, functionName, "Run control " & runID & " created", False
		Else
			WriteToReport micFail, functionName, "Unable to create Run Control " & runID, True
			ExitTest
		End If

		'Request ID - can be anything
		.WebEdit("RequestID").Set "1"

		'Description
		.WebEdit("Description").Set "Test"

		'Enter our journal's date
		.WebEdit("FromDate").Set GlobalDictionary("FromDate")
		
		'Enter today's date
		.WebEdit("ToDate").Set Date

		'Set our Process Option selection
		.WebList("ProcessOptions").Select GlobalDictionary("APProcessOption")

		'Set our Voucher Source selection
		.WebList("VoucherSources").Select GlobalDictionary("APVoucherSource")

		'Set our business unit if needed
		If GlobalDictionary("APProcessOption") = "Business Unit" Then
			.Webedit("BusinessUnitRow1").Set GlobalDictionary("BusinessUnit")
		End If

		'Set our Interface run option
		.WebList("VoucherBuildInterface").Select GlobalDictionary("APInterface")

		'Click Save
		.WebButton("Save").Click
		Browser("PeopleSoft Browser").Sync

		'Click Run
		.WebButton("Run").Click
		Browser("PeopleSoft Browser").Sync

		'Select our build process
		.PSFrame("Process Scheduler Request").WebCheckBox("BatchProcessSelection").Click
		.PSFrame("Process Scheduler Request").WebButton("OK").Click

		'Grab Process Instance
		arrTemp = Split(.PSFrame("Status Bar").WebElement("ProcessInstance").GetROProperty("innertext"), ":")
		strInstance = arrTemp(1)
		.PSFrame("Status Bar").Link("Process Monitor").Click
		Browser("PeopleSoft Browser").Sync
	End With

	'Run the voucher posting processes
	GlobalDictionary("InstanceNumber") = strInstance
	GlobalDictionary("Process") = "AP_VCHRBLD"
	SharedProcessMonitor functionName
End Function
'**************************************************************************************************************
''' <summary> 
''' Create a Maintenance Worksheet for Writeoff from Collections Workbench
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function WorkbenchWO
	Dim arrResults
	Dim sCustomerID, sItemID, sRows, sRowItem, sRow
	Dim bFound
	Dim i
	Const ITEM_COL = 4
	bFound = FALSE

	'Navigate to Collections Workbench
	If SelectMainMenu1(GlobalDictionary("ARCollectionsWorkbench")) Then
		WriteToReport micPass, "Collections Workbench Page", "On the Collections Workbench page.", FALSE
	Else
		WriteToReport micFail, "Collections Workbench Page", "Navigation to Collections Workbench page failed. Exiting test.", TRUE
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Collections Workbench")
		'Set ShareID
		.WebEdit("SetID").Set GlobalDictionary("SetID")
		WriteToReport micDone, "Set the SetID: "&GlobalDictionary("SetID"), "SetID Set", FALSE

		'Set BU
		.WebEdit("Business Unit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set Business Unit: "&GlobalDictionary("BusinessUnit"), "BU Set", FALSE

		'Get Customer and Item for WriteOff
		arrResults = dbgetWOItem("", GlobalDictionary("MIN"), GlobalDictionary("MAX"))
		sCustomerID = arrResults(1)
		GlobalDictionary("CustID") = sCustomerID
		sItemID = arrResults(2)
		GlobalDictionary("ItemID") = sItemID

		'Set Customer
		.WebEdit("Customer ID").Set sCustomerID
		WriteToReport micDone, "Set Customer: "&sCustomerID, "Customer ID Set", FALSE

		'Click Search
		.WebButton("Search").Click
		WriteToReport micDone, "Clicked the Search Button", "Button Clicked", FALSE

		If .PSFrame("Collections Workbench").Link("View All").Exist(5) Then
			.PSFrame("Collections Workbench").Link("View All").Click
		End If

		'Select the Item in the Table
		sRows = .WebTable("Item Table").RowCount
		        
		For i = 1 to sRows
			sRowItem = .WebTable("Item Table").GetCellData(i,ITEM_COL)

			If Trim(sRowItem) = Trim(sItemID) Then
				.WebCheckBox("Select ITEM").SetTOProperty "html id", "SELECT_CB$" & i - 1
				.WebCheckBox("Select ITEM").Set "ON"
				bFound = TRUE
				Exit For
			End If
		Next
					
		If bFound Then
			WriteToReport micDone, "Selected the Item in the Table", "Item Selected", FALSE
		Else
			WriteToReport micFail, "Item Not Found in the Table", "Item Not Selected", TRUE
			ExitTest
		End If

		'Select Item Action and Click GO
		.WebList("Item Action").Select GlobalDictionary("ItemAction")
		WriteToReport micDone, "Selected Item Action: "&GlobalDictionary("ItemAction"), "Item Action Selected", FALSE
		Wait 2
		.WebButton("Item Action Go").Click 
		WriteToReport micDone, "Clicked the Item Action GO Button", "Button Clicked", FALSE

		'Set Type and Reason
		Call .PSFrame("MaintenanceWorksheet").WebElement("ItemID").SetTOProperty("innertext", sItemID)
		If NOT .PSFrame("MaintenanceWorksheet").WebElement("ItemID").Exist(5) Then
			WriteToReport micFail, "Did Not Find the Item ID", "Item Not Found on Worksheet", TRUE
			.WebElement("ClosePopup").Click
			ExitTest
		End If
		sRow = Split(.PSFrame("MaintenanceWorksheet").WebElement("ItemID").GetROProperty("html id"), "$")(1)

		Call .PSFrame("MaintenanceWorksheet").WebEdit("Type").SetTOProperty("name", "WS_ITEM_ENTRY_TYPE$"&sRow)
		Call .PSFrame("MaintenanceWorksheet").WebEdit("Reason").SetTOProperty("name", "WS_ITEM_ENTRY_REASON$"&sRow)

		If .PSFrame("MaintenanceWorksheet").WebEdit("Type").Exist(15) Then
			.PSFrame("MaintenanceWorksheet").WebEdit("Type").Set GlobalDictionary("Type")
			WriteToReport micDone, "Set Type: "&GlobalDictionary("Type"), "Type Set", FALSE
		Else
			WriteToReport micFail, "Type Field Not Found", "Field did not appear under 15 seconds", TRUE
			ExitTest
		End If

		If .PSFrame("MaintenanceWorksheet").WebEdit("Reason").Exist(15) Then
			Wait 3 'Although the field exists, sometimes it wont accept text immediately
			.PSFrame("MaintenanceWorksheet").WebEdit("Reason").Set GlobalDictionary("Reason")
			WriteToReport micDone, "Set Reason: "&GlobalDictionary("Reason"), "Reason Set", FALSE
		Else
			WriteToReport micFail, "Reason Field Not Found", "Field did not appear under 15 seconds", TRUE
			ExitTest
		End If

		'Click Submit to Workflow
		.PSFrame("MaintenanceWorksheet").WebButton("SubmitToWorkflow").Click
		WriteToReport micDone, "Clicked Submit to Workflow", "Button Clicked", FALSE

		'Open Approval Flow
		If .PSFrame("MaintenanceWorksheet").Link("Initial").Exist(30) Then
			.PSFrame("MaintenanceWorksheet").Link("Initial").Click
			WriteToReport micDone, "Opened the Approval Flow Window", "Window Opened", FALSE
		ElseIf .PSFrame("MaintenanceWorksheet").Link("PendingWrite-OffApproval").Exist(30) Then
			.PSFrame("MaintenanceWorksheet").Link("PendingWrite-OffApproval").Click
			WriteToReport micDone, "Opened the Approval Flow Window", "Window Opened", FALSE
		Else
			WriteToReport micFail, "Link to Open the Approval Flow Not Found", "Could Not Open the Approval Flow Window", TRUE
			.WebElement("ClosePopup").Click
			ExitTest
		End If

		If GlobalDictionary("OnlyDirector") = "TRUE" Then
			If .PSFrame("WriteoffApproverStage").Link("Supervisor").Exist(5) Then
				WriteToReport micFail, "Supervisor Found In Flow", "Only the Director Should Appear in the Flow", TRUE
				.PSFrame("WriteoffApproverStage").WebButton("Close").Click
				Wait 3
				.WebElement("ClosePopup").Click
				ExitTest
			ElseIf .PSFrame("WriteoffApproverStage").Link("Manager").Exist(5) Then
				WriteToReport micFail, "Manager Found In Flow", "Only the Director Should Appear in the Flow", TRUE
				.PSFrame("WriteoffApproverStage").WebButton("Close").Click
				Wait 3
				.WebElement("ClosePopup").Click
				ExitTest
			ElseIf NOT .PSFrame("WriteoffApproverStage").Link("Director").Exist(5) Then
				WriteToReport micFail, "No Director Found In Flow", "The Director Should Appear in the Flow", TRUE
				.PSFrame("WriteoffApproverStage").WebButton("Close").Click
				Wait 3
				.WebElement("ClosePopup").Click
				ExitTest
			Else
				GlobalDictionary("ApprovedUser") = dbFindOPRIDByDisplayedName(.PSFrame("WriteoffApproverStage").Link("Director").GetROProperty("innertext"))
				WriteToReport micDone, "The Director in the Workflow is: "&GlobalDictionary("ApprovedUser"), "Director Found", FALSE
			End If
		End If

		If GlobalDictionary("NoApprover") = "TRUE" Then
			If .PSFrame("WriteoffApproverStage").Link("Supervisor").Exist(5) Then
				WriteToReport micFail, "Supervisor Found In Flow", "No Approver Should Appear in the Flow", TRUE
				.PSFrame("WriteoffApproverStage").WebButton("Close").Click
				Wait 3
				.WebElement("ClosePopup").Click
				ExitTest
			ElseIf .PSFrame("WriteoffApproverStage").Link("Manager").Exist(5) Then
				WriteToReport micFail, "Manager Found In Flow", "No Approver Should Appear in the Flow", TRUE
				.PSFrame("WriteoffApproverStage").WebButton("Close").Click
				Wait 3
				.WebElement("ClosePopup").Click
				ExitTest
			ElseIf .PSFrame("WriteoffApproverStage").Link("Director").Exist(5) Then
				WriteToReport micFail, "Director Found In Flow", "No Approver Should Appear in the Flow", TRUE
				.PSFrame("WriteoffApproverStage").WebButton("Close").Click
				Wait 3
				.WebElement("ClosePopup").Click
				ExitTest
			Else
				If .PSFrame("WriteoffApproverStage").WebElement("NoApprovalsReq").Exist(5) Then
					WriteToReport micPass, "Found the Message 'No approvals required'", "Message Found", FALSE
				Else
					WriteToReport micFail, "Did Not Find the Message 'No approvals required'", "Message Not Found", TRUE
					.PSFrame("WriteoffApproverStage").WebButton("Close").Click
					Wait 3
					.WebElement("ClosePopup").Click
					ExitTest
				End If
			End If
		End If

		If GlobalDictionary("OnlyManager") = "TRUE" Then
			If .PSFrame("WriteoffApproverStage").Link("Supervisor").Exist(5) Then
				WriteToReport micFail, "Supervisor Found In Flow", "Only the Manager Should Appear in the Flow", TRUE
				.PSFrame("WriteoffApproverStage").WebButton("Close").Click
				Wait 3
				.WebElement("ClosePopup").Click
				ExitTest
			ElseIf NOT .PSFrame("WriteoffApproverStage").Link("Manager").Exist(5) Then
				WriteToReport micFail, "No Manager Found In Flow", "The Manager Should Appear in the Flow", TRUE
				.PSFrame("WriteoffApproverStage").WebButton("Close").Click
				Wait 3
				.WebElement("ClosePopup").Click
				ExitTest
			ElseIf .PSFrame("WriteoffApproverStage").Link("Director").Exist(5) Then
				WriteToReport micFail, "Director Found In Flow", "Only The Manager Should Appear in the Flow", TRUE
				.PSFrame("WriteoffApproverStage").WebButton("Close").Click
				Wait 3
				.WebElement("ClosePopup").Click
				ExitTest
			Else
				If .PSFrame("WriteoffApproverStage").Link("Manager").GetROProperty("innertext") = "Multiple Approvers" Then
					.PSFrame("WriteoffApproverStage").Link("Manager").Click
					WriteToReport micDone, "Multiple Approvers Found, Opening Link", "Approvers Window Opened", FALSE
					Wait 3
					If Browser("PeopleSoft Browser NewTab").Page("WOApprovers").WebElement("Approver").Exist(15) Then
						GlobalDictionary("ApprovedUser") = dbFindOPRIDByDisplayedName(Browser("PeopleSoft Browser NewTab").Page("WOApprovers").WebElement("Approver").GetROProperty("innertext"))
						WriteToReport micDone, "The Manager Chosen from the Multiple Approvers is: "&GlobalDictionary("ApprovedUser"), "Manager Found", FALSE
						Browser("PeopleSoft Browser NewTab").Page("WOApprovers").WebButton("Close").Click
						Wait 3
					Else
						WriteToReport micFail, "The Multiple Approvers Window Did Not Appear", "No Manager Found", TRUE
						Browser("PeopleSoft Browser NewTab").Page("WOApprovers").WebButton("Close").Click
						Wait 3
						.PSFrame("WriteoffApproverStage").WebButton("Close").Click
						Wait 3
						.WebElement("ClosePopup").Click
						ExitTest
					End If
				Else
					GlobalDictionary("ApprovedUser") = dbFindOPRIDByDisplayedName(.PSFrame("WriteoffApproverStage").Link("Manager").GetROProperty("innertext"))
					WriteToReport micDone, "The Manager in the Workflow is: "&GlobalDictionary("ApprovedUser"), "Manager Found", FALSE
				End If
			End If
		End If

		'Note Worksheet ID
		GlobalDictionary("WorksheetId") = .PSFrame("MaintenanceWorksheet").WebElement("WorksheetID").GetROProperty("innertext")
		GlobalDictionary("GroupID") = GlobalDictionary("WorksheetId")
		WriteToReport micDone, "The Worksheet ID is: "&GlobalDictionary("WorksheetId"), "Stored Worksheet ID for Later", FALSE

		'Close Popups for next text steps
		.PSFrame("WriteoffApproverStage").WebButton("Close").Click
		Wait 3
		.WebElement("ClosePopup").Click
	End With
End Function
'**************************************************************************************************************
''' <summary> 
''' Denies the selected WriteOff
''' </summary>
''' <author>Zach Apple</author>
''' <datecreated>08-May-2019</datecreated>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type=""></returns>
'Change Control: 
'Date of Change 	Author 		Description of change
'
'**************************************************************************************************************
Public Function DenyWriteOff
	'Login as assigned approver from worksheet.
	Login(GlobalDictionary("ApprovedUser"))

	'Navigate to the proper destination 'Select Navigator/WorkList/WorkList
	If SelectMainMenu1(GlobalDictionary("Worklist")) Then
		WriteToReport micPass, "DenyWriteOff - Menu Navigation", "Successfully navigated to the proper page", FALSE
	Else
		WriteToReport micFail, "DenyWriteOff - Menu Navigation", "Unable to successfully navigate to the proper page", TRUE
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Worklist").PSFrame("Worklist")
		If .Link("DateFrom").Exist(5) Then
			'Click on "Date From" twice to sort by date. First click puts oldest on top, second click puts newest on top
			.Link("DateFrom").Click
			
			.Link("DateFrom").Click
			
			WriteToReport micPass, "Sort By Date", "Successfully sorted by date.", FALSE
		Else
			WriteToReport micFail, "Sort By Date", "Unable to sort by date.", TRUE
			ExitTest
		End If

		'Checks to see if Worksheet link is there and clicks on it
		If .Link("innertext:=.*" & GlobalDictionary("WorksheetId") &".*").Exist(60) Then
			.Link("innertext:=.*" & GlobalDictionary("WorksheetId") &".*").Click
		Else
			WriteToReport micFail, "Click Worklist Link", "Link for Worksheet ID ["& GlobalDictionary("WorksheetId")& "]  is not diaplayed.", TRUE
			ExitTest
		End If
	End With

	With Browser("PeopleSoft Browser").Page("Update Worksheet")
		'Set Denial Message in 'Approval Comments' Box
		If .WebEdit("Comments").Exist(20) Then
			.WebEdit("Comments").Set "Denied as User: "&GlobalDictionary("ApprovedUser")
			WriteToReport micPass, "Approval Comments Set: Denied as User: "&GlobalDictionary("ApprovedUser"), "Approval Comments Set.", FALSE
		Else
			WriteToReport micFail, "Approval Comments", "Approver comments field not found.", TRUE
			ExitTest
		End If

		'Click on Deny button
		If .WebButton("Deny").Exist(20) Then
			.WebButton("Deny").Click
			WriteToReport micPass, "Deny Button", "Deny button successfully clicked.", FALSE
		Else
			WriteToReport micFail, "Deny Button", "Deny button not found.", TRUE
			ExitTest
		End If

        'Verify Denied
        If .Link("Denied Write-Off").Exist(10) Then          
            WriteToReport micPass, "Found the Denied Write-Off Link", "Writeoff shows as Denied.", FALSE
		Else
			WriteToReport micFail, "Did Not Find the Denied Write-Off Link", "Writeoff did not show as Denied.", TRUE
			ExitTest
        End If
   End With
End Function
'**************************************************************************************************************
''' <summary> 
''' Create a Maintenance Worksheet for 'CDW MultiItem Write off' from Collections Workbench
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
'**************************************************************************************************************
Public Function WorkbenchMultiItemWO
	Dim arrResults, sCustomerID, sItemID, i, sWSIDs, sMessage
	Dim oShell
	Set oShell = CreateObject("WScript.Shell")
	Const PROCNAME = "CDW_AR_MWSWO"
	Const MSGTXT = 3

	'Navigate to Collections Workbench
	If SelectMainMenu1(GlobalDictionary("ARCollectionsWorkbench")) Then
		WriteToReport micPass, "Collections Workbench Page", "On the Collections Workbench page.", FALSE
	Else
		WriteToReport micFail, "Collections Workbench Page", "Navigation to Collections Workbench page failed. Exiting test.", TRUE
		ExitTest
	End If

	With Browser("PeopleSoft Browser").Page("Collections Workbench")
		'Set ShareID
		.WebEdit("SetID").Set GlobalDictionary("SetID")
		WriteToReport micDone, "Set the SetID: "&GlobalDictionary("SetID"), "SetID Set", FALSE

		'Set BU
		.WebEdit("Business Unit").Set GlobalDictionary("BusinessUnit")
		WriteToReport micDone, "Set Business Unit: "&GlobalDictionary("BusinessUnit"), "BU Set", FALSE

		'Get Customer and Item for WriteOff
		arrResults = dbgetWOItem("", GlobalDictionary("MIN"), GlobalDictionary("MAX"))
		sCustomerID = arrResults(1)
		GlobalDictionary("CustID") = sCustomerID
		sItemID = arrResults(2)
		GlobalDictionary("ItemID") = sItemID

		'Set Customer
		.WebEdit("Customer ID").Set sCustomerID
		WriteToReport micDone, "Set Customer: "&sCustomerID, "Customer ID Set", FALSE

		'Click Search
		.WebButton("Search").Click
		WriteToReport micDone, "Clicked the Search Button", "Button Clicked", FALSE

		If .PSFrame("Collections Workbench").Link("View All").Exist(5) Then
			.PSFrame("Collections Workbench").Link("View All").Click
		End If

		'Select Item Action and Click GO
		.WebList("Item Action").Select GlobalDictionary("ItemAction")
		WriteToReport micDone, "Selected Item Action: "&GlobalDictionary("ItemAction"), "Item Action Selected", FALSE
		Wait 2
		.WebButton("Item Action Go").Click 
		WriteToReport micDone, "Clicked the Item Action GO Button", "Button Clicked", FALSE
	End With

	With Browser("PeopleSoft Browser").Page("ARMultLineWOWS").PSFrame("TargetContent")
		'Click Search
		.WebButton("Search").Click
		WriteToReport micDone, "Clicked the Search Button", "Button Clicked", FALSE
		Browser("PeopleSoft Browser").Page("ARMultLineWOWS").Sync

		'Set Reason field, sets all once Select All is clicked 
		.WebEdit("Reason").Set ""
		Wait 2
		.WebButton("SelectAll").Click
		Wait 2
		.WebEdit("Reason").Set GlobalDictionary("Reason")
		WriteToReport micDone, "Set the Reason: "&GlobalDictionary("Reason"), "Reason Set", FALSE

		'Click Select All
		.WebButton("SelectAll").Click
		WriteToReport micDone, "Clicked the Select All Button", "Button Clicked", FALSE
		Wait 2

		'Click Submit
		.WebButton("Submit").Click
		WriteToReport micDone, "Clicked the Submit Button", "Button Clicked", FALSE

		If Browser("PeopleSoft Browser").Page("ARMultLineWOWS").WebButton("OK").Exist(15) Then
			Browser("PeopleSoft Browser").Page("ARMultLineWOWS").WebButton("OK").Click
		End If

		'Click Process Monitor
		.Link("ProcessMonitor").Click
		WriteToReport micDone, "Clicked the Process Monitor Link", "Link Clicked", FALSE
	End With
	
	'Watch to Success/Posted
	Call CheckProcessMontiorStatus(PROCNAME)

	'Obtain the Worksheet IDs that were created by the process
	With Browser("PeopleSoft Browser").Page("Process Monitor")
		.PSFrame("Process Monitor").Link("Details").Click
		WriteToReport micDone, "Opened the Details for the Process", "Details Opened", FALSE
		
		.PSFrame("Process Detail").Link("Message Log").Click
		WriteToReport micDone, "Opened the Message Log for the Process", "Message Log Opened", FALSE

		For i=3 To .PSFrame("Message Log").WebTable("Personalize").RowCount
			sMessage = .PSFrame("Message Log").WebTable("Personalize").ChildItem(i, MSGTXT, "WebElement", 0).GetROProperty("innertext")
			If InStr(1, sMessage, "WSBU/WSID:") > 0 Then
				'EX: Process Created WSBU/WSID: 00002/14834 For Customer/Item: 1873778/EN00062004 (0,0)
				'Take right of WSBU/WSID, take left of Customer/Item, split over final "/" and take right for the Worksheet ID
				sWSIDs = Trim(Split(Split(Split(sMessage, "WSBU/WSID:")(1), "For Customer")(0), "/")(1)) & ","
			End If
		Next
		'Remove the final comma
		sWSIDs = Left(sWSIDs,Len(sWSIDs)-1)

		WriteToReport micDone, "The Worksheet(s) Created Are: "&sWSIDs, "Displayed the Created Worksheet(s)", FALSE
		GlobalDictionary("WorksheetIDs") = sWSIDs
	
		.PSFrame("Message Log").WebButton("Return").Click
		WriteToReport micDone, "Clicked Return Button", "Button Clicked", FALSE

		.PSFrame("Process Detail").WebButton("OK").Click
		WriteToReport micDone, "Clicked OK Button", "Button Clicked", FALSE
	End With
End Function
'**************************************************************************************************************
''' <summary> 
''' Created to verify that the worksheets created by the MultiItem process exist
''' Can also be used to verify any multiple Maintenance worksheets exist
''' </summary>
''' <author>Zach Apple</author>
''' <startstate></startstate>
''' <endstate></endstate>
''' <returns type="N/A">N/A</returns>
' Change Control:
' Date of Change 	Author 		Description of change
'______________________________________________________________________________________________________________
'
'______________________________________________________________________________________________________________
Public Function VerifyWorksheetsExist
	Dim arrWSs, i
	arrWSs = Split(GlobalDictionary("WorksheetIDs"), ",")
	If NOT IsArrayDimmed(arrWSs) Then
		WriteToReport micFail, "No Worksheets were Found Stored in the GlobalDictionary", "Failed to find Worksheets", FALSE
		ExitTest
	End If
	For i=0 To UBound(arrWSs)
		'Navigate to Rec. Maintenance > Update Worksheet
		If SelectMainMenu1(GlobalDictionary("ARRecMaintUpdateWorksheet")) Then
			WriteToReport micPass, "Rec. Maintenance > Update Worksheet Page", "On the Rec. Maintenance > Update Worksheet page.", FALSE
		Else
			WriteToReport micFail, "Rec. Maintenance > Update Worksheet Page", "Navigation to Rec. Maintenance > Update Worksheet page failed. Exiting test.", TRUE
			ExitTest
		End If

		With Browser("PeopleSoft Browser").Page("Update Worksheet")
			'Set BU
			.WebEdit("WSBusinessUnit").Set GlobalDictionary("BusinessUnit")
			WriteToReport micDone, "Set BU: "&GlobalDictionary("BusinessUnit"), "BU Set", FALSE

			'Set WS ID
			.WebEdit("WorksheetID").Set arrWSs(i)
			WriteToReport micDone, "Worksheet ID Set: "&arrWSs(i), "WS ID Set", FALSE

			'Set User ID that created the Worksheet
			.WebEdit("UserID").Set GlobalDictionary("Creator") 'Used Creator instead of SignInUser, in case this needs to be ran from 
			WriteToReport micDone, "Set the User ID of the Worksheet Creator: "&GlobalDictionary("Creator"), "User ID Set", FALSE

			'Click Search
			.WebButton("Search").Click
			WriteToReport micDone, "Clicked the Search Button", "Button Clicked", FALSE
		

			'Check for the Worksheet. Does not Exit early
			If .WebElement("Worksheet ID").Exist(15) Then
				If Trim(.WebElement("Worksheet ID").GetROProperty("innertext")) = Trim(arrWSs(i)) Then
					WriteToReport micPass, "Found the Worksheet: "&arrWSs(i), "Worksheet Was Created Successfully by the MultiItem Process", FALSE
				Else
					WriteToReport micFail, "Failed to Open the Worksheet with ID: "&arrWSs(i), "Incorrect Worksheet Displayed", TRUE
				End If
			Else
				WriteToReport micFail, "Failed to Locate the Worksheet with ID: "&arrWSs(i), "Worksheet Not Found", TRUE
			End If
		End With
	Next
End Function
